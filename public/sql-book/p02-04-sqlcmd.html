

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="vi" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="vi" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>3. SQLCMD &mdash; Tài liệu Khai thác dữ liệu với SQL 2019</title>
  

  
  
  
  

  
  <script type="text/javascript" src="_static/js/modernizr.min.js"></script>
  
    
      <script type="text/javascript">
          var DOCUMENTATION_OPTIONS = {
              URL_ROOT:'./',
              VERSION:'2019',
              LANGUAGE:'vi',
              COLLAPSE_INDEX:false,
              FILE_SUFFIX:'.html',
              HAS_SOURCE:  true,
              SOURCELINK_SUFFIX: '.txt'
          };
      </script>
        <script type="text/javascript" src="_static/jquery.js"></script>
        <script type="text/javascript" src="_static/underscore.js"></script>
        <script type="text/javascript" src="_static/doctools.js"></script>
        <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.0/clipboard.min.js"></script>
        <script type="text/javascript" src="_static/copybutton.js"></script>
        <script type="text/javascript" src="_static/translations.js"></script>
        <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
    
    <script type="text/javascript" src="_static/js/theme.js"></script>

    

  
  <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="_static/copybutton.css" type="text/css" />
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Tìm Kiếm" href="search.html" />
    <link rel="next" title="4. SQL prọject" href="p02-05-sql-project.html" />
    <link rel="prev" title="1. Pivot - Unpivot" href="p02-03-sql-nang-cao.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="index.html" class="icon icon-home"> Khai thác dữ liệu với SQL
          

          
          </a>

          
            
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <p class="caption"><span class="caption-text">SQL cơ bản</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="p01-01-sql-co-ban.html">1. Giới thiệu về SQL</a></li>
<li class="toctree-l1"><a class="reference internal" href="p01-01-sql-co-ban.html#cac-nhom-cau-lenh-truy-van-tong-hop">2. Các nhóm câu lệnh truy vấn, tổng hợp</a></li>
<li class="toctree-l1"><a class="reference internal" href="p01-01-sql-co-ban.html#cac-nhom-cau-lenh-thay-doi-du-lieu-trong-csdl">3. Các nhóm câu lệnh thay đổi dữ liệu trong CSDL</a></li>
<li class="toctree-l1"><a class="reference internal" href="p01-01-sql-co-ban.html#sub-query">4. Sub Query</a></li>
<li class="toctree-l1"><a class="reference internal" href="p01-01-sql-co-ban.html#cac-nhom-cau-lenh-co-ban-khac">5. Các nhóm câu lệnh cơ bản khác</a></li>
<li class="toctree-l1"><a class="reference internal" href="p01-01-sql-co-ban.html#sql-dong-voi-exec">6. SQL động với Exec</a></li>
<li class="toctree-l1"><a class="reference internal" href="p01-01-sql-co-ban.html#ham-va-thu-tuc">7. Hàm và thủ tục</a></li>
<li class="toctree-l1"><a class="reference internal" href="p01-01-sql-co-ban.html#cac-nhom-cau-lenh-nang-cao">8. Các nhóm câu lệnh nâng cao</a></li>
<li class="toctree-l1"><a class="reference internal" href="p01-01-sql-co-ban.html#dat-job-trong-sql">9. Đặt job trong SQL</a></li>
<li class="toctree-l1"><a class="reference internal" href="p01-01-sql-co-ban.html#cac-nhom-cau-lenh-quan-tri">10. Các nhóm câu lệnh quản trị</a></li>
<li class="toctree-l1"><a class="reference internal" href="p01-02-tricks-sql.html">11. Tricks khi dùng với SQL</a></li>
</ul>
<p class="caption"><span class="caption-text">SQL nâng cao</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="p02-03-sql-nang-cao.html">1. Pivot - Unpivot</a></li>
<li class="toctree-l1"><a class="reference internal" href="p02-03-sql-nang-cao.html#chia-mot-cot-thanh-nhieu-cot">2. Chia một cột thành nhiều cột</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">3. SQLCMD</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#sqlcmd-la-gi">3.1. SQLCMD là gì?</a></li>
<li class="toctree-l2"><a class="reference internal" href="#cmd">3.2. CMD</a></li>
<li class="toctree-l2"><a class="reference internal" href="#sqlcmd-1">3.3. SQLCMD</a></li>
<li class="toctree-l2"><a class="reference internal" href="#cac-lenh-trong-sqlcmd">3.4. Các lệnh trong SQLCMD</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#cac-lenh-tren-nen-sqlquery">3.4.1. Các lệnh trên nền SQLQuery</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#r">3.4.1.1. :r</a></li>
<li class="toctree-l4"><a class="reference internal" href="#setvar">3.4.1.2. :setvar</a></li>
<li class="toctree-l4"><a class="reference internal" href="#connect">3.4.1.3. :connect</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#cac-lenh-tren-cmdexec">3.4.2. Các lệnh trên CmdExec</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#cac-buoc-dat-job-su-dung-cmdexec">3.4.2.1. Các bước đặt job sử dụng CmdExec</a></li>
<li class="toctree-l4"><a class="reference internal" href="#cac-lenh-tren-cmdexec-1">3.4.2.2. Các lệnh trên CmdExec</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#tao-file-bat">3.5. Tạo file bat</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="p02-05-sql-project.html">4. SQL prọject</a></li>
</ul>
<p class="caption"><span class="caption-text">SQL &amp; Analytics</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="p03-06-sql-va-excel.html">1. Kết nối SQL với Excel phục vụ báo cáo tự động</a></li>
<li class="toctree-l1"><a class="reference internal" href="p03-07-r-va-sql.html">2. R &amp; SQL Server</a></li>
<li class="toctree-l1"><a class="reference internal" href="p03-08-r-server.html">3. SQL RServer</a></li>
</ul>
<p class="caption"><span class="caption-text">Xây dựng DataMart</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="p04-11-xay-dung-database.html">1. Xây dựng Data warehouse &amp; Data Mart</a></li>
</ul>
<p class="caption"><span class="caption-text">Tài liệu tham khảo:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="p09-79-tai-lieu-tham-khao.html">Tài liệu tham khảo</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">Khai thác dữ liệu với SQL</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="index.html">Docs</a> &raquo;</li>
        
      <li>3. SQLCMD</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="_sources/p02-04-sqlcmd.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  
<style>
/* CSS overrides for sphinx_rtd_theme */

/* 24px margin */
.nbinput.nblast,
.nboutput.nblast {
    margin-bottom: 19px;  /* padding has already 5px */
}

/* ... except between code cells! */
.nblast + .nbinput {
    margin-top: -19px;
}

.admonition > p:before {
    margin-right: 4px;  /* make room for the exclamation icon */
}

/* Fix math alignment, see https://github.com/rtfd/sphinx_rtd_theme/pull/686 */
.math {
    text-align: unset;
}
</style>
<div class="section" id="sqlcmd">
<h1>3. SQLCMD<a class="headerlink" href="#sqlcmd" title="Permalink to this headline">¶</a></h1>
<ul class="simple">
<li>Bật SQLCMD Mode: <code class="docutils literal notranslate"><span class="pre">SQL</span> <span class="pre">Script</span> <span class="pre">&gt;&gt;</span> <span class="pre">Query</span> <span class="pre">&gt;&gt;</span> <span class="pre">SQLCMD</span> <span class="pre">Mode</span></code></li>
<li>Bật SQLCMD Mode default: Tools &gt;&gt; Options &gt;&gt; Query Execution &gt;&gt;
SQLCMD Mode</li>
</ul>
<p><strong>Chạy script từ script</strong></p>
<div class="highlight-sql notranslate"><div class="highlight"><pre><span></span>:setvar path &quot;F:\OneDrive - VPBank\1. Personal projects\SQL in R\sqlcmd example&quot;

:r $(path)&quot;\test\test_1.sql&quot;
</pre></div>
</div>
<ul class="simple">
<li>Chạy SQL từ bat</li>
</ul>
<div class="highlight-sql notranslate"><div class="highlight"><pre><span></span><span class="n">sqlcmd</span> <span class="o">-</span><span class="n">S</span> <span class="n">HON</span><span class="o">-</span><span class="n">BICC</span><span class="o">-</span><span class="n">PC0035</span> <span class="o">-</span><span class="n">U</span> <span class="n">sa</span> <span class="o">-</span><span class="n">P</span> <span class="mi">123</span> <span class="o">-</span><span class="n">i</span> <span class="n">master</span><span class="p">.</span><span class="k">sql</span> <span class="o">-</span><span class="n">o</span> <span class="k">out</span><span class="p">.</span><span class="n">log</span>
</pre></div>
</div>
<ul class="simple">
<li>Đặt job với SQLCMD option</li>
</ul>
<div class="highlight-sql notranslate"><div class="highlight"><pre><span></span><span class="n">sqlcmd</span> <span class="o">-</span><span class="n">i</span> <span class="ss">&quot;F:/OneDrive - VPBank/1. Personal projects/SQL in R/sqlcmd example/master.sql&quot;</span>
</pre></div>
</div>
<p><img alt="image0" src="Images/job_sqlcmd.png" /></p>
<div class="section" id="sqlcmd-la-gi">
<h2>3.1. SQLCMD là gì?<a class="headerlink" href="#sqlcmd-la-gi" title="Permalink to this headline">¶</a></h2>
</div>
<div class="section" id="cmd">
<h2>3.2. CMD<a class="headerlink" href="#cmd" title="Permalink to this headline">¶</a></h2>
<p>CMD (Command Prompt) là một ứng dụng dùng để thực thi các lệnh có sẵn
trong Windows. Những lệnh này được sử dụng trên một giao diện nhập lệnh
thay vì thao tác trực tiếp trên giao diện Windows.</p>
<div class="figure" id="id3">
<img alt="GIAO DIỆN CMD" src="Images/cmd.png" />
<p class="caption"><span class="caption-text">GIAO DIỆN CMD</span></p>
</div>
</div>
<div class="section" id="sqlcmd-1">
<span id="id1"></span><h2>3.3. SQLCMD<a class="headerlink" href="#sqlcmd-1" title="Permalink to this headline">¶</a></h2>
<p>SQLCMD là một công cụ đi kèm với SQL Server, cho phép ta thực hiện :</p>
<ul class="simple">
<li>Các câu lệnh truy vấn</li>
<li>Stored Procedure</li>
<li>Chạy các file SQL Script có sẵn</li>
</ul>
<p>bằng cách sử dụng các dòng lệnh của ứng dụng CMD.</p>
<p><strong>Khởi động SQLCMD trong SQL Server :</strong></p>
<p><img alt="image1" src="Images/sqlcmd.png" /></p>
<p>Các bước :</p>
<ul class="simple">
<li>Query</li>
<li>SQLCMD Mode</li>
</ul>
<p><strong>Sự khác nhau giữa trước và sau khi khởi động SQLCMD trong SQL Server
:</strong></p>
<p><img alt="image2" src="Images/sqlcmd1.png" /></p>
<p>Các dòng lệnh SQLCMD sẽ được bôi nền xám</p>
</div>
<div class="section" id="cac-lenh-trong-sqlcmd">
<h2>3.4. Các lệnh trong SQLCMD<a class="headerlink" href="#cac-lenh-trong-sqlcmd" title="Permalink to this headline">¶</a></h2>
<div class="section" id="cac-lenh-tren-nen-sqlquery">
<h3>3.4.1. Các lệnh trên nền SQLQuery<a class="headerlink" href="#cac-lenh-tren-nen-sqlquery" title="Permalink to this headline">¶</a></h3>
<div class="section" id="r">
<h4>3.4.1.1. :r<a class="headerlink" href="#r" title="Permalink to this headline">¶</a></h4>
<p><strong>:r</strong> &lt;<em>filename</em>&gt;</p>
<p>Mục đích : chạy các file SQL scrip có sẵn</p>
<p>Ví dụ :</p>
<p><img alt="image3" src="Images/1_r.png" /></p>
<p>Lưu ý :</p>
<ul class="simple">
<li>Các bảng tạm ở mỗi SQL scrip sẽ được giữ lại trong suốt quá trình
chạy các SQL scrip</li>
</ul>
<p><img alt="image4" src="Images/1_r2.png" /></p>
</div>
<div class="section" id="setvar">
<h4>3.4.1.2. :setvar<a class="headerlink" href="#setvar" title="Permalink to this headline">¶</a></h4>
<p>Gồm 2 bước :</p>
<ul class="simple">
<li>Tạo biến <strong>:setvar</strong> &lt;<em>varname</em>&gt; &lt;<em>“value”</em>&gt;</li>
<li>Gọi biến <strong>:r $</strong>(&lt;<em>varname</em>&gt;)</li>
</ul>
<p>Mục đích :</p>
<p>Ví dụ :</p>
<p><img alt="image5" src="Images/2_setvar.png" /></p>
</div>
<div class="section" id="connect">
<h4>3.4.1.3. :connect<a class="headerlink" href="#connect" title="Permalink to this headline">¶</a></h4>
<p><strong>:connect</strong> &lt;<em>server_name</em>&gt; &lt;<em>[-l timeout]</em>&gt; &lt;<em>[-U user_name -P
password]</em>&gt;</p>
<p>Trong đó :</p>
<ul class="simple">
<li>server_name : tên server muốn truy cập</li>
<li>l : thời gian để kết nối với server, tính theo (giây), thời gian mặc
định : 8s</li>
<li>U : user name</li>
<li>P : password</li>
</ul>
<p>Mục đích : với những câu lệnh nặng phải query toàn bộ trên 1 server
khác, nên đăng nhập server đó để query vào 1 bảng tạm –&gt; sau đó kéo về
server của mình.</p>
<p>Ví dụ :</p>
<p><img alt="image6" src="Images/3_connect1.png" /></p>
<p>Lưu ý :</p>
<ul class="simple">
<li>Bảng tạm trên server khác cần kéo về có dạng <strong>##</strong></li>
<li>Khi chuyển data về server của mình, không được đóng tab chứa query
của bảng tạm</li>
</ul>
</div>
</div>
<div class="section" id="cac-lenh-tren-cmdexec">
<h3>3.4.2. Các lệnh trên CmdExec<a class="headerlink" href="#cac-lenh-tren-cmdexec" title="Permalink to this headline">¶</a></h3>
<div class="section" id="cac-buoc-dat-job-su-dung-cmdexec">
<h4>3.4.2.1. Các bước đặt job sử dụng CmdExec<a class="headerlink" href="#cac-buoc-dat-job-su-dung-cmdexec" title="Permalink to this headline">¶</a></h4>
<p><img alt="image7" src="Images/4_job1.png" /></p>
<p><img alt="image8" src="Images/4_job2.png" /></p>
<ul class="simple">
<li>B0: Thực hiện đặt job như thông thường tới bước tạo các Step</li>
<li>B1: Chọn Type : Operating system (CmdExec)</li>
<li>B2: chọn Run as : SQL Server Agent service Account</li>
<li>B3: Viết câu lệnh sqlcmd</li>
</ul>
</div>
<div class="section" id="cac-lenh-tren-cmdexec-1">
<span id="id2"></span><h4>3.4.2.2. Các lệnh trên CmdExec<a class="headerlink" href="#cac-lenh-tren-cmdexec-1" title="Permalink to this headline">¶</a></h4>
<p>Cấu trúc</p>
<div class="highlight-bat notranslate"><div class="highlight"><pre><span></span>sqlcmd <span class="p">&lt;</span>[-S server_name]<span class="p">&gt;</span> &lt;[-l timeout]<span class="p">&gt;</span> &lt;[-U user -P password]<span class="p">&gt;</span> &lt;[-d database_name]<span class="p">&gt;</span> &lt;-i <span class="s2">&quot;input_file&quot;</span><span class="p">&gt;</span> &lt;<span class="s2">&quot;file&quot;</span><span class="p">&gt;</span> &lt;[-t query_timeout]<span class="p">&gt;</span> &lt;[-o output_file]&gt;
</pre></div>
</div>
<p>Trong đó:</p>
<p><code class="docutils literal notranslate"><span class="pre">-S</span></code> server name (default : server hiện tại của máy)</p>
<p><code class="docutils literal notranslate"><span class="pre">-l</span></code> login timeout (default = 8s)</p>
<p><code class="docutils literal notranslate"><span class="pre">-U</span></code> user login</p>
<p><code class="docutils literal notranslate"><span class="pre">-P</span></code> password login (-U và -P là 1 cặp đi cùng nhau)</p>
<p><code class="docutils literal notranslate"><span class="pre">-d</span></code> use database name (default = master)</p>
<p><code class="docutils literal notranslate"><span class="pre">-i</span></code> input file (nếu đường dẫn có khoảng trống thì cần đặt trong &quot;&quot;)</p>
<p><code class="docutils literal notranslate"><span class="pre">-t</span></code> query timeout (default = n, nếu gán giá trị thì trong khoảng 1 -
65534s)</p>
<p><code class="docutils literal notranslate"><span class="pre">-o</span></code> output file, được xuất ra thư mục chứa <strong>input file</strong>, gồm các
định dạng: .log, .doc, .xls</p>
<p>Ví dụ :</p>
<p><img alt="image9" src="Images/4_job3.png" /></p>
<p>Tìm hiểu thêm về các lệnh : Trên màn hình cmd, nhập lệnh <strong>sqlcmd -?</strong></p>
<p><img alt="image10" src="Images/4_bonus.png" /></p>
</div>
</div>
</div>
<div class="section" id="tao-file-bat">
<h2>3.5. Tạo file bat<a class="headerlink" href="#tao-file-bat" title="Permalink to this headline">¶</a></h2>
<p>Mục đích : Có thể nhanh chóng query câu lệnh và xuất dữ liệu</p>
<p>Các bước :</p>
<ul class="simple">
<li>Bước 1: Tạo 1 file Text</li>
</ul>
<p><img alt="image11" src="Images/5_bat1.png" /></p>
<ul class="simple">
<li>Bước 2 : Copy toàn bộ câu lệnh trong CmdExec vào file Text</li>
</ul>
<p><img alt="image12" src="Images/5_bat2.png" /></p>
<ul class="simple">
<li>Bước 3 : Save as file –&gt; thêm đuôi <strong>.bat</strong> vào tên file</li>
</ul>
<p><img alt="image13" src="Images/5_bat3.png" /></p>
<ul class="simple">
<li>Bước 4: Double click vào file .bat vừa tạo để chạy câu lệnh</li>
</ul>
<p><img alt="image14" src="Images/5_bat4.png" /></p>
</div>
</div>


           </div>
           
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="p02-05-sql-project.html" class="btn btn-neutral float-right" title="4. SQL prọject" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="p02-03-sql-nang-cao.html" class="btn btn-neutral float-left" title="1. Pivot - Unpivot" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2019, Anh Hoang Duc

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>