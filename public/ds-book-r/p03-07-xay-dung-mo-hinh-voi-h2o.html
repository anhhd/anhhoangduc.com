<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.3.353">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>Khoa học dữ liệu với R - 25&nbsp; Xây dựng mô hình với H2O</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/quarto-nav/headroom.min.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="./">
<link href="./p03-08-xgboost.html" rel="next">
<link href="./p03-05-bagging-boosting.html" rel="prev">
<script src="site_libs/quarto-html/quarto.js"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" class="quarto-color-scheme" id="quarto-text-highlighting-styles">
<link href="site_libs/quarto-html/quarto-syntax-highlighting-dark.css" rel="prefetch" class="quarto-color-scheme quarto-color-alternate" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" class="quarto-color-scheme" id="quarto-bootstrap" data-mode="light">
<link href="site_libs/bootstrap/bootstrap-dark.min.css" rel="prefetch" class="quarto-color-scheme quarto-color-alternate" id="quarto-bootstrap" data-mode="dark">
<link href="site_libs/quarto-contrib/bookup_fonts_embed-0.0/fonts-download.css" rel="stylesheet">
<script id="quarto-search-options" type="application/json">{
  "location": "sidebar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "start",
  "type": "textbox",
  "limit": 20,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit"
  }
}</script>


</head>

<body class="nav-sidebar docked">


<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
  <nav class="quarto-secondary-nav">
    <div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar,#quarto-sidebar-glass" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
      <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="./p03-01-gioi-thieu-hoc-may.html">Supervised Learning</a></li><li class="breadcrumb-item"><a href="./p03-07-xay-dung-mo-hinh-voi-h2o.html"><span class="chapter-number">25</span>&nbsp; <span class="chapter-title">Xây dựng mô hình với H2O</span></a></li></ol></nav>
      <a class="flex-grow-1" role="button" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar,#quarto-sidebar-glass" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
      </a>
      <button type="button" class="btn quarto-search-button" aria-label="Search" onclick="window.quartoOpenSearch();">
        <i class="bi bi-search"></i>
      </button>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal sidebar-navigation docked overflow-auto">
    <div class="pt-lg-2 mt-2 text-left sidebar-header">
    <div class="sidebar-title mb-0 py-0">
      <a href="./">Khoa học dữ liệu với R</a> 
        <div class="sidebar-tools-main">
  <a href="" class="quarto-color-scheme-toggle quarto-navigation-tool  px-1" onclick="window.quartoToggleColorScheme(); return false;" title="Toggle dark mode"><i class="bi"></i></a>
  <a href="" class="quarto-reader-toggle quarto-navigation-tool px-1" onclick="window.quartoToggleReader(); return false;" title="Toggle reader mode">
  <div class="quarto-reader-toggle-btn">
  <i class="bi"></i>
  </div>
</a>
</div>
    </div>
      </div>
        <div class="mt-2 flex-shrink-0 align-items-center">
        <div class="sidebar-search">
        <div id="quarto-search" class="" title="Search"></div>
        </div>
        </div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">1</span>&nbsp; <span class="chapter-title">Khoa học dữ liệu và nghề phân tích dữ liệu</span></span></a>
  </div>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" aria-expanded="true">
 <span class="menu-text">Phân tích khám phá dữ liệu</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-1" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./p02-01-gioi-thieu-co-ban-ve-r.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">2</span>&nbsp; <span class="chapter-title">Giới thiệu cơ bản về R</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./p02-03-xay-dung-bao-cao-voi-rmarkdown-quarto.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">3</span>&nbsp; <span class="chapter-title">Xây dựng báo cáo với Rmarkdown &amp; Quarto</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./p02-03-import-du-lieu.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">4</span>&nbsp; <span class="chapter-title">Import dữ liệu</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./p02-02-bien-doi-du-lieu-dplyr.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">5</span>&nbsp; <span class="chapter-title">Ngữ pháp của biến đổi dữ liệu với DPLYR</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./p02-03-phan-ra-va-xoay-chieu-du-lieu.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">6</span>&nbsp; <span class="chapter-title">Làm sạch và biến đổi dữ liệu nâng cao</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./p02-04-ngu-phap-bieu-do-ggplot2.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">7</span>&nbsp; <span class="chapter-title">Ngữ pháp của biểu đồ với <code>ggplot2</code></span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./p02-05-cac-chi-so-thong-ke.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">8</span>&nbsp; <span class="chapter-title">Các chỉ số thống kê mô tả cơ bản</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./p02-06-lap-trinh-ham.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">9</span>&nbsp; <span class="chapter-title">Lập trình hàm</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./p02-07-lap-trinh-ham-voi-purrr.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">10</span>&nbsp; <span class="chapter-title">Lập trình chức năng hàm với purrr</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./p02-08-bien-doi-du-lieu-text.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">11</span>&nbsp; <span class="chapter-title">Biến đổi dữ liệu text</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./p02-09-bien-doi-du-lieu-thoi-gian.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">12</span>&nbsp; <span class="chapter-title">Biến đổi dữ liệu thời gian</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./p02-11-quan-ly-nhieu-mo-hinh.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">13</span>&nbsp; <span class="chapter-title">Quản lý kết quả phân tích từ nhiều mô hình</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./p02-16-power-analysis.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">14</span>&nbsp; <span class="chapter-title">Power analysis</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./p02-20-sampling-methods.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">15</span>&nbsp; <span class="chapter-title">Phương pháp ước lượng tham số thông qua lấy mẫu</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./p02-50-datatable.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">16</span>&nbsp; <span class="chapter-title">Biến đổi dữ liệu với <code>data.table</code></span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./p02-51-du-lieu-lon.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">17</span>&nbsp; <span class="chapter-title">Cách thức xử lý dữ liệu lớn</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./p02-60-thu-thap-du-lieu-tu-website.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">18</span>&nbsp; <span class="chapter-title">Thu thập dữ liệu từ website</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./p02-99-meo-trong-r.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">19</span>&nbsp; <span class="chapter-title">Các mẹo trong R</span></span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" aria-expanded="true">
 <span class="menu-text">Supervised Learning</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-2" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./p03-01-gioi-thieu-hoc-may.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">20</span>&nbsp; <span class="chapter-title">Giới thiệu về học máy</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./p03-02-mo-hinh-ols.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">21</span>&nbsp; <span class="chapter-title">Mô hình hồi quy tuyến tính</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./p03-03-logistic-regression.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">22</span>&nbsp; <span class="chapter-title">Mô hình hồi quy logistic</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./p03-04-decision-tree.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">23</span>&nbsp; <span class="chapter-title">Cây quyết định</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./p03-05-bagging-boosting.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">24</span>&nbsp; <span class="chapter-title">Bagging, RandomForest và Boosting</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./p03-07-xay-dung-mo-hinh-voi-h2o.html" class="sidebar-item-text sidebar-link active">
 <span class="menu-text"><span class="chapter-number">25</span>&nbsp; <span class="chapter-title">Xây dựng mô hình với H2O</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./p03-08-xgboost.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">26</span>&nbsp; <span class="chapter-title">XGBoost &amp; LightGBM</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./p03-10-knn.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">27</span>&nbsp; <span class="chapter-title">K nearest neighbors</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./p03-11-svm.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">28</span>&nbsp; <span class="chapter-title">Support Vector Machine</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./p03-15-nonlinear.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">29</span>&nbsp; <span class="chapter-title">Mô hình phi tuyến tính</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./p03-17-regularization.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">30</span>&nbsp; <span class="chapter-title">Lựa chọn biến &amp; regularization</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./p03-20-feature-engineering.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">31</span>&nbsp; <span class="chapter-title">Feature Engineering</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./p03-70-tidymodels.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">32</span>&nbsp; <span class="chapter-title">Tidymodels</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./p03-40-interpretable-ml.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">33</span>&nbsp; <span class="chapter-title">Giải thích mô hình học máy</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./p03-30-credit-scoring.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">34</span>&nbsp; <span class="chapter-title">Credit Scoring</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./p03-50-chat-luong-mo-hinh.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">35</span>&nbsp; <span class="chapter-title">Chất lượng mô hình</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./p03-75-mlops-vetiver.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">36</span>&nbsp; <span class="chapter-title">Deployment &amp; MLOPS</span></span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" aria-expanded="true">
 <span class="menu-text">Unsupervised Learning</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-3" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./p04-01-unsupervised-learning.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">37</span>&nbsp; <span class="chapter-title">Unsupervised learning</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./p04-02-hierarchical-clustering.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">38</span>&nbsp; <span class="chapter-title">Hierachical clustering</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./p04-03-kmeans.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">39</span>&nbsp; <span class="chapter-title">k-means</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./p04-04-basket-analysis.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">40</span>&nbsp; <span class="chapter-title">Phân tích giỏ hàng</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./p04-05-pca.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">41</span>&nbsp; <span class="chapter-title">Principal component analysis</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./p04-06-factor-analysis.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">42</span>&nbsp; <span class="chapter-title">Phân tích nhân tố ẩn (factor analysis)</span></span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-4" aria-expanded="true">
 <span class="menu-text">Chuỗi thời gian</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-4" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-4" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./p05-01-chuoi-thoi-gian.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">43</span>&nbsp; <span class="chapter-title">Giới thiệu về chuỗi thời gian</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./p05-02-arima.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">44</span>&nbsp; <span class="chapter-title">Mô hình ARIMA</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./p05-07-du-bao-ts-voi-timetk.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">45</span>&nbsp; <span class="chapter-title">Dự báo chuỗi thời gian với học máy</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./p05-08-abnomaly-detection.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">46</span>&nbsp; <span class="chapter-title">Abnomaly detection trong times series</span></span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-5" aria-expanded="true">
 <span class="menu-text">Xử lý ngôn ngữ tự nhiên</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-5" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-5" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./p06-01-nlp-co-ban.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">47</span>&nbsp; <span class="chapter-title">Xử lý ngôn ngữ tự nhiên</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./p06-04-text-classification.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">48</span>&nbsp; <span class="chapter-title">Phân loại text</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./p06-07-nlp-api.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">49</span>&nbsp; <span class="chapter-title">Sử dụng API từ các dịch vụ đám mây</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./p06-10-ocr-tesseract.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">50</span>&nbsp; <span class="chapter-title">OCR với <code>tesseract</code></span></span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-6" aria-expanded="true">
 <span class="menu-text">Các phương pháp phân tích khác</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-6" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-6" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./p07-03-collaborative-filtering.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">51</span>&nbsp; <span class="chapter-title">Collaborative Filtering</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./p07-04-survival-analysis.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">52</span>&nbsp; <span class="chapter-title">Survival Analysis</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./p07-05-vintage-analysis.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">53</span>&nbsp; <span class="chapter-title">Vintage analysis</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./p07-06-rfm.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">54</span>&nbsp; <span class="chapter-title">Mô hình RFM</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./p07-07-spatial-data.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">55</span>&nbsp; <span class="chapter-title">Spatial data</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./p07-08-anomaly-detection.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">56</span>&nbsp; <span class="chapter-title">Abnomaly detection</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./p07-15-quantile-regression.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">57</span>&nbsp; <span class="chapter-title">Hồi quy phân vị</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./p07-16-retention-analysis.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">58</span>&nbsp; <span class="chapter-title">Retention analysis</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./p07-20-network-analysis.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">59</span>&nbsp; <span class="chapter-title">Network analysis</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./p07-21-dea.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">60</span>&nbsp; <span class="chapter-title">Data Envelopment Analysis</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./p07-22-bupar.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">61</span>&nbsp; <span class="chapter-title">Business Process Analytics</span></span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-7" aria-expanded="true">
 <span class="menu-text">Cloud Computing</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-7" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-7" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./p10-01-cai-dat-rstudio-server-tren-amazon.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">62</span>&nbsp; <span class="chapter-title">Cài đặt server RStudio trên Amazon</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./p10-03-web-service-azure.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">63</span>&nbsp; <span class="chapter-title">Xây dựng web service với Azure</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./p10-09-apis-voi-plumber.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">64</span>&nbsp; <span class="chapter-title">API với Plumber</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./p07-10-shiny.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">65</span>&nbsp; <span class="chapter-title">Shiny apps</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./p10-02-deploy-shiny-app-aws.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">66</span>&nbsp; <span class="chapter-title">Deploy Shiny Apps lên AWS</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./p07-30-python-voi-r.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">67</span>&nbsp; <span class="chapter-title">Sử dụng Python với R</span></span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-8" aria-expanded="true">
 <span class="menu-text">Kiến thức bổ trợ</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-8" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-8" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./p11-01-git.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">68</span>&nbsp; <span class="chapter-title">Sử dụng GIT</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./p11-02-cmd.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">69</span>&nbsp; <span class="chapter-title">CMD và Bash</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./p11-03-docker.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">70</span>&nbsp; <span class="chapter-title">Sử dụng docker</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./p11-04-apis.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">71</span>&nbsp; <span class="chapter-title">API</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./p11-90-other.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">72</span>&nbsp; <span class="chapter-title">Các tricks khác</span></span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-9" aria-expanded="true">
 <span class="menu-text">Phân tích thực tế</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-9" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-9" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./p13-01-phan-tich-thuc-te.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">73</span>&nbsp; <span class="chapter-title">Các lưu ý phân tích thực tế</span></span></a>
  </div>
</li>
      </ul>
  </li>
    </ul>
    </div>
</nav>
<div id="quarto-sidebar-glass" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar,#quarto-sidebar-glass"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">Mục lục</h2>
   
  <ul>
  <li><a href="#giới-thiệu" id="toc-giới-thiệu" class="nav-link active" data-scroll-target="#giới-thiệu"><span class="header-section-number">25.1</span> Giới thiệu</a></li>
  <li><a href="#cài-đặt-và-khởi-động" id="toc-cài-đặt-và-khởi-động" class="nav-link" data-scroll-target="#cài-đặt-và-khởi-động"><span class="header-section-number">25.2</span> Cài đặt và khởi động</a></li>
  <li><a href="#thực-hành-với-r" id="toc-thực-hành-với-r" class="nav-link" data-scroll-target="#thực-hành-với-r"><span class="header-section-number">25.3</span> Thực hành với R</a>
  <ul>
  <li><a href="#lấy-dữ-liệu" id="toc-lấy-dữ-liệu" class="nav-link" data-scroll-target="#lấy-dữ-liệu"><span class="header-section-number">25.3.1</span> Lấy dữ liệu</a></li>
  <li><a href="#kiểm-tra-dữ-liệu" id="toc-kiểm-tra-dữ-liệu" class="nav-link" data-scroll-target="#kiểm-tra-dữ-liệu"><span class="header-section-number">25.3.2</span> Kiểm tra dữ liệu</a></li>
  <li><a href="#khởi-động-h2o" id="toc-khởi-động-h2o" class="nav-link" data-scroll-target="#khởi-động-h2o"><span class="header-section-number">25.3.3</span> Khởi động H2O</a></li>
  <li><a href="#đưa-dữ-liệu-vào-h2o" id="toc-đưa-dữ-liệu-vào-h2o" class="nav-link" data-scroll-target="#đưa-dữ-liệu-vào-h2o"><span class="header-section-number">25.3.4</span> Đưa dữ liệu vào H2O</a></li>
  <li><a href="#chia-dữ-liệu-traintest" id="toc-chia-dữ-liệu-traintest" class="nav-link" data-scroll-target="#chia-dữ-liệu-traintest"><span class="header-section-number">25.3.5</span> Chia dữ liệu train/test</a></li>
  <li><a href="#xây-dựng-mô-hình-trên-tập-train" id="toc-xây-dựng-mô-hình-trên-tập-train" class="nav-link" data-scroll-target="#xây-dựng-mô-hình-trên-tập-train"><span class="header-section-number">25.3.6</span> Xây dựng mô hình trên tập train</a></li>
  <li><a href="#dự-báo-trên-tập-test" id="toc-dự-báo-trên-tập-test" class="nav-link" data-scroll-target="#dự-báo-trên-tập-test"><span class="header-section-number">25.3.7</span> Dự báo trên tập test</a></li>
  <li><a href="#đánh-giá-chất-lượng-dự-báo-trên-test" id="toc-đánh-giá-chất-lượng-dự-báo-trên-test" class="nav-link" data-scroll-target="#đánh-giá-chất-lượng-dự-báo-trên-test"><span class="header-section-number">25.3.8</span> Đánh giá chất lượng dự báo trên test</a></li>
  <li><a href="#tuning" id="toc-tuning" class="nav-link" data-scroll-target="#tuning"><span class="header-section-number">25.3.9</span> Tuning</a></li>
  <li><a href="#lưu-và-load-mô-hình" id="toc-lưu-và-load-mô-hình" class="nav-link" data-scroll-target="#lưu-và-load-mô-hình"><span class="header-section-number">25.3.10</span> Lưu và load mô hình</a></li>
  </ul></li>
  <li><a href="#tìm-kiếm-mô-hình-tự-động" id="toc-tìm-kiếm-mô-hình-tự-động" class="nav-link" data-scroll-target="#tìm-kiếm-mô-hình-tự-động"><span class="header-section-number">25.4</span> Tìm kiếm mô hình tự động</a></li>
  <li><a href="#h2o-flow" id="toc-h2o-flow" class="nav-link" data-scroll-target="#h2o-flow"><span class="header-section-number">25.5</span> H2o Flow</a></li>
  <li><a href="#tài-liệu-tham-khảo" id="toc-tài-liệu-tham-khảo" class="nav-link" data-scroll-target="#tài-liệu-tham-khảo"><span class="header-section-number">25.6</span> Tài liệu tham khảo</a></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title"><span class="chapter-number">25</span>&nbsp; <span class="chapter-title">Xây dựng mô hình với H2O</span></h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  

</header>

<section id="giới-thiệu" class="level2" data-number="25.1">
<h2 data-number="25.1" class="anchored" data-anchor-id="giới-thiệu"><span class="header-section-number">25.1</span> Giới thiệu</h2>
<ul>
<li>H2O là một phần mềm dựa trên nền tảng của Java dùng để mô hình hóa dữ liệu (data modeling) và tính toán nói chung.</li>
<li>H2O là một platform mã nguồn mở hàng đầu thế giới hiện nay về Machine Learning và AI.</li>
<li>Hỗ trợ nhiều phần mềm khác nhau như: R, Python, Azure, Spark…</li>
</ul>
</section>
<section id="cài-đặt-và-khởi-động" class="level2" data-number="25.2">
<h2 data-number="25.2" class="anchored" data-anchor-id="cài-đặt-và-khởi-động"><span class="header-section-number">25.2</span> Cài đặt và khởi động</h2>
<p>Để cài đặt và khởi động H2O, chúng ta cần thực hiện các bước sau:</p>
<ul>
<li><strong>Bước 1</strong>: Cài đặt Java</li>
</ul>
<div class="tabset-margin-container"></div><div class="panel-tabset">
<ul class="nav nav-tabs" role="tablist"><li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-1-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-1-1" role="tab" aria-controls="tabset-1-1" aria-selected="true" aria-current="page">Windows</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-1-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-1-2" role="tab" aria-controls="tabset-1-2" aria-selected="false">Ubuntu</a></li></ul>
<div class="tab-content">
<div id="tabset-1-1" class="tab-pane active" role="tabpanel" aria-labelledby="tabset-1-1-tab">
<ul>
<li>Download &amp; cài đặt Java <a href="">https://www.oracle.com/java/technologies/downloads/</a></li>
</ul>
</div>
<div id="tabset-1-2" class="tab-pane" role="tabpanel" aria-labelledby="tabset-1-2-tab">
<p>Thực hiện câu lệnh sau</p>
<pre><code>sudo apt-get update
sudo apt install default-jdk</code></pre>
</div>
</div>
</div>
<ul>
<li><strong>Bước 2</strong>: Cài đặt R package <code>h2o</code></li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="fu">install.packages</span>(<span class="st">"h2o"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<ul>
<li><strong>Bước 3</strong>: Khởi động H2O từ R - sử dụng câu lệnh <code>h2o.init()</code></li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(h2o)</span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a><span class="fu">h2o.init</span>(<span class="at">ip =</span> <span class="st">"localhost"</span>, </span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a>         <span class="at">port =</span> <span class="dv">54321</span>, </span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a>         <span class="at">nthreads=</span> <span class="sc">-</span><span class="dv">1</span>,</span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a>         <span class="at">max_mem_size =</span> <span class="st">"4g"</span>) <span class="co"># Đặt mức RAM tối đa</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code> Connection successful!

R is connected to the H2O cluster: 
    H2O cluster uptime:         1 hours 18 minutes 
    H2O cluster timezone:       Etc/UTC 
    H2O data parsing timezone:  UTC 
    H2O cluster version:        3.42.0.2 
    H2O cluster version age:    11 months and 25 days 
    H2O cluster name:           H2O_started_from_R_jovyan_ydg016 
    H2O cluster total nodes:    1 
    H2O cluster total memory:   3.86 GB 
    H2O cluster total cores:    2 
    H2O cluster allowed cores:  2 
    H2O cluster healthy:        TRUE 
    H2O Connection ip:          localhost 
    H2O Connection port:        54321 
    H2O Connection proxy:       NA 
    H2O Internal Security:      FALSE 
    R Version:                  R version 4.3.0 (2023-04-21) </code></pre>
</div>
</div>
<p><strong>Lưu ý</strong>: Trong trường hợp chúng ta muốn tắt H2O cluster, chúng ta có thể sử dụng câu lệnh sau:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="fu">h2o.shutdown</span>(<span class="at">prompt =</span> T)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="thực-hành-với-r" class="level2" data-number="25.3">
<h2 data-number="25.3" class="anchored" data-anchor-id="thực-hành-với-r"><span class="header-section-number">25.3</span> Thực hành với R</h2>
<p>Để thực hành xây dựng mô hình dự báo với H2O, chúng ta sẽ sử dụng dữ liệu có sẵn trong <code>R</code> - <code>credit_data</code> trong package <strong>modeldata</strong>.</p>
<p>Đây là dữ liệu ghi nhận về lịch sử vay của khách hàng, với các 61 biến đầu vào cùng với biến đầu ra <code>Class</code> ghi nhận thực tế là các khoản vay đó có phải là khoản nợ xấu hay không. Chúng ta sẽ dự báo khoản vay nào không có nợ xấu.</p>
<section id="lấy-dữ-liệu" class="level3" data-number="25.3.1">
<h3 data-number="25.3.1" class="anchored" data-anchor-id="lấy-dữ-liệu"><span class="header-section-number">25.3.1</span> Lấy dữ liệu</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Bước 1: Lấy dữ liệu</span></span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(modeldata)</span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a><span class="fu">data</span>(<span class="st">"credit_data"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="kiểm-tra-dữ-liệu" class="level3" data-number="25.3.2">
<h3 data-number="25.3.2" class="anchored" data-anchor-id="kiểm-tra-dữ-liệu"><span class="header-section-number">25.3.2</span> Kiểm tra dữ liệu</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Bước 2: Kiểm tra dữ liệu</span></span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a><span class="co"># Kiểm tra định dạng các biến trong tập dữ liệu</span></span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(dplyr)</span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a>credit_data <span class="sc">%&gt;%</span> str</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>'data.frame':   4454 obs. of  14 variables:
 $ Status   : Factor w/ 2 levels "bad","good": 2 2 1 2 2 2 2 2 2 1 ...
 $ Seniority: int  9 17 10 0 0 1 29 9 0 0 ...
 $ Home     : Factor w/ 6 levels "ignore","other",..: 6 6 3 6 6 3 3 4 3 4 ...
 $ Time     : int  60 60 36 60 36 60 60 12 60 48 ...
 $ Age      : int  30 58 46 24 26 36 44 27 32 41 ...
 $ Marital  : Factor w/ 5 levels "divorced","married",..: 2 5 2 4 4 2 2 4 2 2 ...
 $ Records  : Factor w/ 2 levels "no","yes": 1 1 2 1 1 1 1 1 1 1 ...
 $ Job      : Factor w/ 4 levels "fixed","freelance",..: 2 1 2 1 1 1 1 1 2 4 ...
 $ Expenses : int  73 48 90 63 46 75 75 35 90 90 ...
 $ Income   : int  129 131 200 182 107 214 125 80 107 80 ...
 $ Assets   : int  0 0 3000 2500 0 3500 10000 0 15000 0 ...
 $ Debt     : int  0 0 0 0 0 0 0 0 0 0 ...
 $ Amount   : int  800 1000 2000 900 310 650 1600 200 1200 1200 ...
 $ Price    : int  846 1658 2985 1325 910 1645 1800 1093 1957 1468 ...</code></pre>
</div>
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Kiểm tra biến đầu ra (biến muốn dự báo)</span></span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a>credit_data<span class="sc">$</span>Status <span class="sc">%&gt;%</span> </span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a>  table <span class="sc">%&gt;%</span> </span>
<span id="cb9-4"><a href="#cb9-4" aria-hidden="true" tabindex="-1"></a>  prop.table</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>.
      bad      good 
0.2815447 0.7184553 </code></pre>
</div>
</div>
<p>Như vậy, chúng ta thấy trong tập dữ liệu này:</p>
<ul>
<li>72% là các khoản vay không có nợ xấu</li>
<li>28% là các khoản vay có nợ xấu</li>
</ul>
</section>
<section id="khởi-động-h2o" class="level3" data-number="25.3.3">
<h3 data-number="25.3.3" class="anchored" data-anchor-id="khởi-động-h2o"><span class="header-section-number">25.3.3</span> Khởi động H2O</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Bước 3: Khởi động H2O</span></span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(h2o)</span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a><span class="fu">h2o.init</span>(<span class="at">ip =</span> <span class="st">"localhost"</span>, </span>
<span id="cb11-4"><a href="#cb11-4" aria-hidden="true" tabindex="-1"></a>         <span class="at">port =</span> <span class="dv">54321</span>, </span>
<span id="cb11-5"><a href="#cb11-5" aria-hidden="true" tabindex="-1"></a>         <span class="at">nthreads=</span> <span class="sc">-</span><span class="dv">1</span>,</span>
<span id="cb11-6"><a href="#cb11-6" aria-hidden="true" tabindex="-1"></a>         <span class="at">max_mem_size =</span> <span class="st">"3g"</span>) <span class="co"># Đặt mức RAM tối đa</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code> Connection successful!

R is connected to the H2O cluster: 
    H2O cluster uptime:         1 hours 18 minutes 
    H2O cluster timezone:       Etc/UTC 
    H2O data parsing timezone:  UTC 
    H2O cluster version:        3.42.0.2 
    H2O cluster version age:    11 months and 25 days 
    H2O cluster name:           H2O_started_from_R_jovyan_ydg016 
    H2O cluster total nodes:    1 
    H2O cluster total memory:   3.86 GB 
    H2O cluster total cores:    2 
    H2O cluster allowed cores:  2 
    H2O cluster healthy:        TRUE 
    H2O Connection ip:          localhost 
    H2O Connection port:        54321 
    H2O Connection proxy:       NA 
    H2O Internal Security:      FALSE 
    R Version:                  R version 4.3.0 (2023-04-21) </code></pre>
</div>
</div>
</section>
<section id="đưa-dữ-liệu-vào-h2o" class="level3" data-number="25.3.4">
<h3 data-number="25.3.4" class="anchored" data-anchor-id="đưa-dữ-liệu-vào-h2o"><span class="header-section-number">25.3.4</span> Đưa dữ liệu vào H2O</h3>
<p>Để đưa dữ liệu vào H2O, chúng ta sử dụng câu lệnh: <code>as.h2o()</code>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a>credit_data <span class="sc">%&gt;%</span> head</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>  Status Seniority  Home Time Age Marital Records       Job Expenses Income
1   good         9  rent   60  30 married      no freelance       73    129
2   good        17  rent   60  58   widow      no     fixed       48    131
3    bad        10 owner   36  46 married     yes freelance       90    200
4   good         0  rent   60  24  single      no     fixed       63    182
5   good         0  rent   36  26  single      no     fixed       46    107
6   good         1 owner   60  36 married      no     fixed       75    214
  Assets Debt Amount Price
1      0    0    800   846
2      0    0   1000  1658
3   3000    0   2000  2985
4   2500    0    900  1325
5      0    0    310   910
6   3500    0    650  1645</code></pre>
</div>
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Lower name</span></span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a><span class="fu">names</span>(credit_data) <span class="ot">&lt;-</span> <span class="fu">names</span>(credit_data) <span class="sc">%&gt;%</span> <span class="fu">tolower</span>()</span>
<span id="cb15-3"><a href="#cb15-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Bước 4: Đưa dữ liệu vào h2o</span></span>
<span id="cb15-4"><a href="#cb15-4" aria-hidden="true" tabindex="-1"></a>data_h2o <span class="ot">&lt;-</span> <span class="fu">as.h2o</span>(credit_data)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
  |                                                                            
  |                                                                      |   0%
  |                                                                            
  |======================================================================| 100%</code></pre>
</div>
</div>
</section>
<section id="chia-dữ-liệu-traintest" class="level3" data-number="25.3.5">
<h3 data-number="25.3.5" class="anchored" data-anchor-id="chia-dữ-liệu-traintest"><span class="header-section-number">25.3.5</span> Chia dữ liệu train/test</h3>
<p>Chia tập dữ liệu thành 2 tập dữ liệu train và test (tỷ lệ 80-20)</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Bước 5: Chia tập dữ liệu thành: train/test (tỷ lệ 80/20) </span></span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">1234</span>)</span>
<span id="cb17-3"><a href="#cb17-3" aria-hidden="true" tabindex="-1"></a>data_split <span class="ot">=</span> <span class="fu">h2o.splitFrame</span>(<span class="at">data =</span> data_h2o, </span>
<span id="cb17-4"><a href="#cb17-4" aria-hidden="true" tabindex="-1"></a>                            <span class="at">ratios =</span> <span class="fl">0.8</span>)</span>
<span id="cb17-5"><a href="#cb17-5" aria-hidden="true" tabindex="-1"></a>train <span class="ot">=</span> data_split[[<span class="dv">1</span>]]</span>
<span id="cb17-6"><a href="#cb17-6" aria-hidden="true" tabindex="-1"></a>test <span class="ot">=</span> data_split[[<span class="dv">2</span>]]</span>
<span id="cb17-7"><a href="#cb17-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-8"><a href="#cb17-8" aria-hidden="true" tabindex="-1"></a><span class="co"># Tập dữ liệu train (data frame)</span></span>
<span id="cb17-9"><a href="#cb17-9" aria-hidden="true" tabindex="-1"></a>train_df <span class="ot">&lt;-</span> <span class="fu">as.data.frame</span>(train)</span>
<span id="cb17-10"><a href="#cb17-10" aria-hidden="true" tabindex="-1"></a>train_df<span class="sc">$</span>status <span class="sc">%&gt;%</span> table</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>.
 bad good 
 997 2517 </code></pre>
</div>
<div class="sourceCode cell-code" id="cb19"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Tập dữ liệu test (data frame)</span></span>
<span id="cb19-2"><a href="#cb19-2" aria-hidden="true" tabindex="-1"></a>test_df <span class="ot">&lt;-</span> <span class="fu">as.data.frame</span>(test)</span>
<span id="cb19-3"><a href="#cb19-3" aria-hidden="true" tabindex="-1"></a>test_df<span class="sc">$</span>status <span class="sc">%&gt;%</span> table</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>.
 bad good 
 257  683 </code></pre>
</div>
</div>
</section>
<section id="xây-dựng-mô-hình-trên-tập-train" class="level3" data-number="25.3.6">
<h3 data-number="25.3.6" class="anchored" data-anchor-id="xây-dựng-mô-hình-trên-tập-train"><span class="header-section-number">25.3.6</span> Xây dựng mô hình trên tập train</h3>
<p>Để xây dựng mô hình dự báo với H2O, chúng ta có thể sử dụng những câu lệnh khác nhau tương ứng với từng phương pháp/thuật toán như: Logistic regression, Random Forests, Boosting…</p>
<ul>
<li><code>h2o.glm()</code> - Logistic regression</li>
<li><code>h2o.randomForest()</code> - Random Forests</li>
<li><code>h2o.gbm()</code> - Boosting</li>
</ul>
<p>Ta sẽ sử dụng <code>h2o.gbm</code> trong toàn bộ quá trình hướng dẫn về train &amp; tune mô hình trên <code>H2O</code></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb21"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Bước 6: Xây dựng mô hình trên train</span></span>
<span id="cb21-2"><a href="#cb21-2" aria-hidden="true" tabindex="-1"></a>start_time <span class="ot">&lt;-</span> <span class="fu">Sys.time</span>()</span>
<span id="cb21-3"><a href="#cb21-3" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">1</span>)</span>
<span id="cb21-4"><a href="#cb21-4" aria-hidden="true" tabindex="-1"></a>gbm_model1 <span class="ot">&lt;-</span> <span class="fu">h2o.gbm</span>(<span class="at">training_frame =</span> train, <span class="co"># Tập dữ liệu train</span></span>
<span id="cb21-5"><a href="#cb21-5" aria-hidden="true" tabindex="-1"></a>                      <span class="at">x =</span> <span class="fu">setdiff</span>(<span class="fu">names</span>(credit_data), <span class="st">"status"</span>),  <span class="co"># Các biến đầu vào</span></span>
<span id="cb21-6"><a href="#cb21-6" aria-hidden="true" tabindex="-1"></a>                      <span class="at">y =</span> <span class="st">"status"</span> <span class="co"># Biến đầu ra (biến muốn dự báo)</span></span>
<span id="cb21-7"><a href="#cb21-7" aria-hidden="true" tabindex="-1"></a>                      )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
  |                                                                            
  |                                                                      |   0%
  |                                                                            
  |===========================================                           |  62%
  |                                                                            
  |======================================================================| 100%</code></pre>
</div>
<div class="sourceCode cell-code" id="cb23"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a>end_time <span class="ot">&lt;-</span> <span class="fu">Sys.time</span>()</span>
<span id="cb23-2"><a href="#cb23-2" aria-hidden="true" tabindex="-1"></a>time <span class="ot">&lt;-</span> end_time <span class="sc">-</span> start_time</span>
<span id="cb23-3"><a href="#cb23-3" aria-hidden="true" tabindex="-1"></a>time</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Time difference of 2.366523 secs</code></pre>
</div>
</div>
<p>Chúng ta thấy việc xây dựng mô hình với H2O có tốc độ rất nhanh, xây dựng mô hình với các tham số cơ bản với dữ liệu này chỉ mất khoảng 2.37 giây. Đương nhiên trong trường hợp này dữ liệu nhỏ nên chúng ta chưa nhìn thấy rõ ưu điểm vượt trội của H2O về tốc độ, nhưng trong trường hơp dữ liệu lớn, việc sử dụng H2O sẽ rút ngắn thời gian xây dựng mô hình dự báo của chúng ta đi rất nhiều.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb25"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Summary model</span></span>
<span id="cb25-2"><a href="#cb25-2" aria-hidden="true" tabindex="-1"></a>gbm_model1 <span class="sc">%&gt;%</span> summary</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Model Details:
==============

H2OBinomialModel: gbm
Model Key:  GBM_model_R_1721520775246_5409 
Model Summary: 
  number_of_trees number_of_internal_trees model_size_in_bytes min_depth
1              50                       50               19226         5
  max_depth mean_depth min_leaves max_leaves mean_leaves
1         5    5.00000         17         32    25.94000

H2OBinomialMetrics: gbm
** Reported on training data. **

MSE:  0.09385543
RMSE:  0.3063583
LogLoss:  0.3147498
Mean Per-Class Error:  0.161882
AUC:  0.9357281
AUCPR:  0.9714834
Gini:  0.8714562
R^2:  0.5381675

Confusion Matrix (vertical: actual; across: predicted) for F1-optimal threshold:
       bad good    Error       Rate
bad    736  261 0.261785   =261/997
good   156 2361 0.061979  =156/2517
Totals 892 2622 0.118668  =417/3514

Maximum Metrics: Maximum metrics at their respective thresholds
                        metric threshold       value idx
1                       max f1  0.563945    0.918856 222
2                       max f2  0.396719    0.949796 278
3                 max f0point5  0.693235    0.923835 175
4                 max accuracy  0.582656    0.881616 216
5                max precision  0.982744    1.000000   0
6                   max recall  0.164248    1.000000 357
7              max specificity  0.982744    1.000000   0
8             max absolute_mcc  0.582656    0.703714 216
9   max min_per_class_accuracy  0.703102    0.859579 171
10 max mean_per_class_accuracy  0.693235    0.862920 175
11                     max tns  0.982744  997.000000   0
12                     max fns  0.982744 2513.000000   0
13                     max fps  0.028254  997.000000 399
14                     max tps  0.164248 2517.000000 357
15                     max tnr  0.982744    1.000000   0
16                     max fnr  0.982744    0.998411   0
17                     max fpr  0.028254    1.000000 399
18                     max tpr  0.164248    1.000000 357

Gains/Lift Table: Extract with `h2o.gainsLift(&lt;model&gt;, &lt;data&gt;)` or `h2o.gainsLift(&lt;model&gt;, valid=&lt;T/F&gt;, xval=&lt;T/F&gt;)`



Scoring History: 
            timestamp   duration number_of_trees training_rmse training_logloss
1 2024-07-21 01:31:27  0.022 sec               0       0.45080          0.59643
2 2024-07-21 01:31:27  0.054 sec               1       0.43683          0.56675
3 2024-07-21 01:31:28  0.104 sec               2       0.42488          0.54279
4 2024-07-21 01:31:28  0.133 sec               3       0.41477          0.52310
5 2024-07-21 01:31:28  0.174 sec               4       0.40619          0.50680
  training_auc training_pr_auc training_lift training_classification_error
1      0.50000         0.71628       1.00000                       0.28372
2      0.82756         0.91358       1.37025                       0.19550
3      0.84619         0.92053       1.34660                       0.18640
4      0.85325         0.92546       1.35631                       0.18412
5      0.85400         0.92514       1.35631                       0.18412

---
             timestamp   duration number_of_trees training_rmse
46 2024-07-21 01:31:29  1.532 sec              45       0.31040
47 2024-07-21 01:31:29  1.580 sec              46       0.30989
48 2024-07-21 01:31:29  1.608 sec              47       0.30903
49 2024-07-21 01:31:29  1.648 sec              48       0.30808
50 2024-07-21 01:31:29  1.673 sec              49       0.30722
51 2024-07-21 01:31:29  1.700 sec              50       0.30636
   training_logloss training_auc training_pr_auc training_lift
46          0.32226      0.93209         0.96943       1.39611
47          0.32123      0.93246         0.96960       1.39611
48          0.31969      0.93326         0.96997       1.39611
49          0.31793      0.93426         0.97062       1.39611
50          0.31639      0.93478         0.97082       1.39611
51          0.31475      0.93573         0.97148       1.39611
   training_classification_error
46                       0.12237
47                       0.12294
48                       0.12180
49                       0.11981
50                       0.12094
51                       0.11867

Variable Importances: (Extract with `h2o.varimp`) 
=================================================

Variable Importances: 
    variable relative_importance scaled_importance percentage
1  seniority          324.636536          1.000000   0.166827
2     income          301.767517          0.929555   0.155075
3    records          296.553772          0.913495   0.152395
4     amount          233.128555          0.718122   0.119802
5        job          163.762939          0.504450   0.084156
6       home          132.941345          0.409508   0.068317
7     assets          113.164719          0.348589   0.058154
8      price          105.915077          0.326257   0.054428
9   expenses           77.263611          0.238000   0.039705
10       age           71.007111          0.218728   0.036490
11      time           56.115288          0.172856   0.028837
12      debt           36.218292          0.111566   0.018612
13   marital           33.476219          0.103119   0.017203</code></pre>
</div>
</div>
<p>Nhìn vào kết quả mô hình vừa được xây dựng trên tập train, chúng ta có thể thấy một số thông tin quan trọng sau:</p>
<ul>
<li>Các tham số (<code>parameters</code>) cơ bản của mô hình:
<ul>
<li><code>number_of_trees</code> = 50: Số lượng cây là 50</li>
<li><code>max_depth</code> = 5: Mỗi cây có 5 tầng (mức độ phức tạp của mô hình)</li>
</ul></li>
<li>AUC trên tập train: 0.935</li>
<li>Dựa vào mục <code>Confusion Matrix</code> tại điểm tối ưu hóa chỉ số F1-score có thể tính toán được:
<ul>
<li><code>error rate</code> (tỷ lệ quan sát dự báo sai): 11.87%</li>
<li><code>accuracy</code> (tỷ lệ quan sát dự báo đúng): 1 - 11.87%= 88.13%</li>
<li><code>precision</code>: 736/997 = 74% - trong 100 khách hàng dự báo là <code>bad</code>, có 74 khách hàng hàng thực sự là <code>bad</code></li>
<li><code>recall</code>: 736/892 = 82.5% - trong 100 khách hàng thực tế là <code>bad</code>, mô hình dự báo phủ được chính xác 82 khách hàng</li>
</ul></li>
<li>Dựa vào mục <code>Maximum Metrics</code>, chúng ta có thể biết được các ngưỡng cutoff xác suất để tối ưu hóa các chỉ số như accuracy, precision, recall, f1-score…
<ul>
<li><code>max f1</code>: Điểm cutoff xác suất là 0.56</li>
<li><code>max accuracy</code>: 0.582</li>
<li><code>max recall</code>: 0.164</li>
<li><code>max precision</code>: 0.982</li>
</ul></li>
<li>Dựa vào mục <code>Variable Importances</code>, chúng ta có thể biết được những biến nào có ảnh hưởng nhiều nhất đến biến đầu ra mà chúng ta muốn dự báo (có thể sử dụng câu lệnh <code>h2o.varimp()</code> để xem chi tiết). Trong trường hợp này, 4 biến có ảnh hưởng nhiều nhất tới biến <code>status</code> theo thứ tự là:
<ul>
<li>seniority</li>
<li>income</li>
<li>records</li>
<li>amount</li>
</ul></li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb27"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Kiểm tra chi tiết các biến có ảnh hướng nhiều tới biến dự báo trong mô hình</span></span>
<span id="cb27-2"><a href="#cb27-2" aria-hidden="true" tabindex="-1"></a>gbm_model1 <span class="sc">%&gt;%</span> </span>
<span id="cb27-3"><a href="#cb27-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">h2o.varimp</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb27-4"><a href="#cb27-4" aria-hidden="true" tabindex="-1"></a>  as.data.frame <span class="sc">%&gt;%</span> </span>
<span id="cb27-5"><a href="#cb27-5" aria-hidden="true" tabindex="-1"></a>  knitr<span class="sc">::</span><span class="fu">kable</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<table class="table table-sm table-striped small">
<thead>
<tr class="header">
<th style="text-align: left;">variable</th>
<th style="text-align: right;">relative_importance</th>
<th style="text-align: right;">scaled_importance</th>
<th style="text-align: right;">percentage</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">seniority</td>
<td style="text-align: right;">324.63654</td>
<td style="text-align: right;">1.0000000</td>
<td style="text-align: right;">0.1668267</td>
</tr>
<tr class="even">
<td style="text-align: left;">income</td>
<td style="text-align: right;">301.76752</td>
<td style="text-align: right;">0.9295550</td>
<td style="text-align: right;">0.1550746</td>
</tr>
<tr class="odd">
<td style="text-align: left;">records</td>
<td style="text-align: right;">296.55377</td>
<td style="text-align: right;">0.9134948</td>
<td style="text-align: right;">0.1523953</td>
</tr>
<tr class="even">
<td style="text-align: left;">amount</td>
<td style="text-align: right;">233.12856</td>
<td style="text-align: right;">0.7181217</td>
<td style="text-align: right;">0.1198019</td>
</tr>
<tr class="odd">
<td style="text-align: left;">job</td>
<td style="text-align: right;">163.76294</td>
<td style="text-align: right;">0.5044501</td>
<td style="text-align: right;">0.0841557</td>
</tr>
<tr class="even">
<td style="text-align: left;">home</td>
<td style="text-align: right;">132.94135</td>
<td style="text-align: right;">0.4095083</td>
<td style="text-align: right;">0.0683169</td>
</tr>
<tr class="odd">
<td style="text-align: left;">assets</td>
<td style="text-align: right;">113.16472</td>
<td style="text-align: right;">0.3485890</td>
<td style="text-align: right;">0.0581539</td>
</tr>
<tr class="even">
<td style="text-align: left;">price</td>
<td style="text-align: right;">105.91508</td>
<td style="text-align: right;">0.3262574</td>
<td style="text-align: right;">0.0544284</td>
</tr>
<tr class="odd">
<td style="text-align: left;">expenses</td>
<td style="text-align: right;">77.26361</td>
<td style="text-align: right;">0.2380004</td>
<td style="text-align: right;">0.0397048</td>
</tr>
<tr class="even">
<td style="text-align: left;">age</td>
<td style="text-align: right;">71.00711</td>
<td style="text-align: right;">0.2187280</td>
<td style="text-align: right;">0.0364897</td>
</tr>
<tr class="odd">
<td style="text-align: left;">time</td>
<td style="text-align: right;">56.11529</td>
<td style="text-align: right;">0.1728557</td>
<td style="text-align: right;">0.0288369</td>
</tr>
<tr class="even">
<td style="text-align: left;">debt</td>
<td style="text-align: right;">36.21829</td>
<td style="text-align: right;">0.1115657</td>
<td style="text-align: right;">0.0186121</td>
</tr>
<tr class="odd">
<td style="text-align: left;">marital</td>
<td style="text-align: right;">33.47622</td>
<td style="text-align: right;">0.1031191</td>
<td style="text-align: right;">0.0172030</td>
</tr>
</tbody>
</table>
</div>
</div>
</section>
<section id="dự-báo-trên-tập-test" class="level3" data-number="25.3.7">
<h3 data-number="25.3.7" class="anchored" data-anchor-id="dự-báo-trên-tập-test"><span class="header-section-number">25.3.7</span> Dự báo trên tập test</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb28"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Bước 7: Dự báo trên tập test</span></span>
<span id="cb28-2"><a href="#cb28-2" aria-hidden="true" tabindex="-1"></a>pred_test1 <span class="ot">&lt;-</span> <span class="fu">h2o.predict</span>(gbm_model1, <span class="at">newdata =</span> test) <span class="sc">%&gt;%</span> </span>
<span id="cb28-3"><a href="#cb28-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as.data.frame</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
  |                                                                            
  |                                                                      |   0%
  |                                                                            
  |======================================================================| 100%</code></pre>
</div>
<div class="sourceCode cell-code" id="cb30"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb30-1"><a href="#cb30-1" aria-hidden="true" tabindex="-1"></a>pred_test1 <span class="sc">%&gt;%</span> head</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>  predict        bad       good
1    good 0.19107951 0.80892049
2     bad 0.91849176 0.08150824
3    good 0.07805707 0.92194293
4     bad 0.63806808 0.36193192
5    good 0.03455521 0.96544479
6    good 0.01889339 0.98110661</code></pre>
</div>
</div>
<p>Nhìn vào kết quả trên, ta có thể biết được những thông tin sau:</p>
<ul>
<li>Cột <code>predict</code>: Là <code>status</code> của khoản vay được dự báo
<ul>
<li><code>good</code>: Khoản vay không phải là khoản nợ xấu</li>
<li><code>bad</code>: Khoản vay là khoản nợ xấu</li>
</ul></li>
<li><code>bad</code>: Xác suất khoản vay là khoản nợ xấu</li>
<li><code>good</code>: Xác suất khoản vay là khoản không có nợ xấu</li>
</ul>
</section>
<section id="đánh-giá-chất-lượng-dự-báo-trên-test" class="level3" data-number="25.3.8">
<h3 data-number="25.3.8" class="anchored" data-anchor-id="đánh-giá-chất-lượng-dự-báo-trên-test"><span class="header-section-number">25.3.8</span> Đánh giá chất lượng dự báo trên test</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb32"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb32-1"><a href="#cb32-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Bước 8: Đánh giá chất lượng dự báo trên test</span></span>
<span id="cb32-2"><a href="#cb32-2" aria-hidden="true" tabindex="-1"></a><span class="co"># Confusion matrix</span></span>
<span id="cb32-3"><a href="#cb32-3" aria-hidden="true" tabindex="-1"></a><span class="fu">table</span>(<span class="fu">as.vector</span>(pred_test1<span class="sc">$</span>predict), </span>
<span id="cb32-4"><a href="#cb32-4" aria-hidden="true" tabindex="-1"></a>      test_df<span class="sc">$</span>status,</span>
<span id="cb32-5"><a href="#cb32-5" aria-hidden="true" tabindex="-1"></a>      <span class="at">dnn =</span> <span class="fu">c</span>(<span class="st">"Predicted"</span>, <span class="st">"Actual"</span>)</span>
<span id="cb32-6"><a href="#cb32-6" aria-hidden="true" tabindex="-1"></a>      )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>         Actual
Predicted bad good
     bad  147   82
     good 110  601</code></pre>
</div>
<div class="sourceCode cell-code" id="cb34"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb34-1"><a href="#cb34-1" aria-hidden="true" tabindex="-1"></a><span class="do">## AUC</span></span>
<span id="cb34-2"><a href="#cb34-2" aria-hidden="true" tabindex="-1"></a>perf <span class="ot">&lt;-</span> <span class="fu">h2o.performance</span>(gbm_model1, test)</span>
<span id="cb34-3"><a href="#cb34-3" aria-hidden="true" tabindex="-1"></a><span class="fu">h2o.auc</span>(perf)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0.8259852</code></pre>
</div>
</div>
<p>Như vậy, AUC mô hình trên validation chỉ đạt khoảng 82%</p>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Lưu ý
</div>
</div>
<div class="callout-body-container callout-body">
<p>Với H2O, chúng ta hoàn toàn có thể xây dựng mô hình trên tập train, rồi sau đó đánh giá chất lượng trên tập train và test đồng thời</p>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb36"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb36-1"><a href="#cb36-1" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">2</span>)</span>
<span id="cb36-2"><a href="#cb36-2" aria-hidden="true" tabindex="-1"></a>gbm_model2 <span class="ot">&lt;-</span> <span class="fu">h2o.gbm</span>(<span class="at">training_frame =</span> train, <span class="co"># Xây dựng trên train</span></span>
<span id="cb36-3"><a href="#cb36-3" aria-hidden="true" tabindex="-1"></a>                      <span class="at">x =</span> <span class="fu">setdiff</span>(<span class="fu">names</span>(credit_data), <span class="st">"status"</span>),  <span class="co"># Các biến đầu vào</span></span>
<span id="cb36-4"><a href="#cb36-4" aria-hidden="true" tabindex="-1"></a>                      <span class="at">y =</span> <span class="st">"status"</span>, <span class="co"># Biến đầu ra (biến muốn dự báo)</span></span>
<span id="cb36-5"><a href="#cb36-5" aria-hidden="true" tabindex="-1"></a>                      <span class="at">validation_frame =</span> test <span class="co"># Đánh giá trên test</span></span>
<span id="cb36-6"><a href="#cb36-6" aria-hidden="true" tabindex="-1"></a>                      )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
  |                                                                            
  |                                                                      |   0%
  |                                                                            
  |==========================================                            |  60%
  |                                                                            
  |======================================================================| 100%</code></pre>
</div>
<div class="sourceCode cell-code" id="cb38"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb38-1"><a href="#cb38-1" aria-hidden="true" tabindex="-1"></a>gbm_model2 <span class="sc">%&gt;%</span> summary</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Model Details:
==============

H2OBinomialModel: gbm
Model Key:  GBM_model_R_1721520775246_5462 
Model Summary: 
  number_of_trees number_of_internal_trees model_size_in_bytes min_depth
1              50                       50               19224         5
  max_depth mean_depth min_leaves max_leaves mean_leaves
1         5    5.00000         17         32    25.94000

H2OBinomialMetrics: gbm
** Reported on training data. **

MSE:  0.09385543
RMSE:  0.3063583
LogLoss:  0.3147498
Mean Per-Class Error:  0.161882
AUC:  0.9357281
AUCPR:  0.9714834
Gini:  0.8714562
R^2:  0.5381675

Confusion Matrix (vertical: actual; across: predicted) for F1-optimal threshold:
       bad good    Error       Rate
bad    736  261 0.261785   =261/997
good   156 2361 0.061979  =156/2517
Totals 892 2622 0.118668  =417/3514

Maximum Metrics: Maximum metrics at their respective thresholds
                        metric threshold       value idx
1                       max f1  0.563945    0.918856 222
2                       max f2  0.396719    0.949796 278
3                 max f0point5  0.693235    0.923835 175
4                 max accuracy  0.582656    0.881616 216
5                max precision  0.982744    1.000000   0
6                   max recall  0.164248    1.000000 357
7              max specificity  0.982744    1.000000   0
8             max absolute_mcc  0.582656    0.703714 216
9   max min_per_class_accuracy  0.703102    0.859579 171
10 max mean_per_class_accuracy  0.693235    0.862920 175
11                     max tns  0.982744  997.000000   0
12                     max fns  0.982744 2513.000000   0
13                     max fps  0.028254  997.000000 399
14                     max tps  0.164248 2517.000000 357
15                     max tnr  0.982744    1.000000   0
16                     max fnr  0.982744    0.998411   0
17                     max fpr  0.028254    1.000000 399
18                     max tpr  0.164248    1.000000 357

Gains/Lift Table: Extract with `h2o.gainsLift(&lt;model&gt;, &lt;data&gt;)` or `h2o.gainsLift(&lt;model&gt;, valid=&lt;T/F&gt;, xval=&lt;T/F&gt;)`
H2OBinomialMetrics: gbm
** Reported on validation data. **

MSE:  0.1457177
RMSE:  0.3817299
LogLoss:  0.4481171
Mean Per-Class Error:  0.2878665
AUC:  0.8259852
AUCPR:  0.923276
Gini:  0.6519703
R^2:  0.2664762

Confusion Matrix (vertical: actual; across: predicted) for F1-optimal threshold:
       bad good    Error      Rate
bad    135  122 0.474708  =122/257
good    69  614 0.101025   =69/683
Totals 204  736 0.203191  =191/940

Maximum Metrics: Maximum metrics at their respective thresholds
                        metric threshold      value idx
1                       max f1  0.509710   0.865398 269
2                       max f2  0.090316   0.930931 392
3                 max f0point5  0.691926   0.866645 197
4                 max accuracy  0.567370   0.797872 250
5                max precision  0.982366   1.000000   0
6                   max recall  0.055538   1.000000 397
7              max specificity  0.982366   1.000000   0
8             max absolute_mcc  0.691926   0.490659 197
9   max min_per_class_accuracy  0.734352   0.752562 176
10 max mean_per_class_accuracy  0.691926   0.762538 197
11                     max tns  0.982366 257.000000   0
12                     max fns  0.982366 679.000000   0
13                     max fps  0.039014 257.000000 399
14                     max tps  0.055538 683.000000 397
15                     max tnr  0.982366   1.000000   0
16                     max fnr  0.982366   0.994143   0
17                     max fpr  0.039014   1.000000 399
18                     max tpr  0.055538   1.000000 397

Gains/Lift Table: Extract with `h2o.gainsLift(&lt;model&gt;, &lt;data&gt;)` or `h2o.gainsLift(&lt;model&gt;, valid=&lt;T/F&gt;, xval=&lt;T/F&gt;)`


Scoring History: 
            timestamp   duration number_of_trees training_rmse training_logloss
1 2024-07-21 01:31:30  0.008 sec               0       0.45080          0.59643
2 2024-07-21 01:31:30  0.067 sec               1       0.43683          0.56675
3 2024-07-21 01:31:30  0.110 sec               2       0.42488          0.54279
4 2024-07-21 01:31:30  0.152 sec               3       0.41477          0.52310
5 2024-07-21 01:31:30  0.174 sec               4       0.40619          0.50680
  training_auc training_pr_auc training_lift training_classification_error
1      0.50000         0.71628       1.00000                       0.28372
2      0.82756         0.91358       1.37025                       0.19550
3      0.84619         0.92053       1.34660                       0.18640
4      0.85325         0.92546       1.35631                       0.18412
5      0.85400         0.92514       1.35631                       0.18412
  validation_rmse validation_logloss validation_auc validation_pr_auc
1         0.44583            0.58688        0.50000           0.72660
2         0.43462            0.56312        0.78467           0.88779
3         0.42670            0.54683        0.79756           0.90384
4         0.41985            0.53290        0.80255           0.91345
5         0.41464            0.52232        0.79920           0.91185
  validation_lift validation_classification_error
1         1.00000                         0.27340
2         1.13341                         0.22766
3         1.32748                         0.22979
4         1.36431                         0.22766
5         1.36431                         0.22766

---
             timestamp   duration number_of_trees training_rmse
46 2024-07-21 01:31:32  1.635 sec              45       0.31040
47 2024-07-21 01:31:32  1.667 sec              46       0.30989
48 2024-07-21 01:31:32  1.694 sec              47       0.30903
49 2024-07-21 01:31:32  1.723 sec              48       0.30808
50 2024-07-21 01:31:32  1.756 sec              49       0.30722
51 2024-07-21 01:31:32  1.786 sec              50       0.30636
   training_logloss training_auc training_pr_auc training_lift
46          0.32226      0.93209         0.96943       1.39611
47          0.32123      0.93246         0.96960       1.39611
48          0.31969      0.93326         0.96997       1.39611
49          0.31793      0.93426         0.97062       1.39611
50          0.31639      0.93478         0.97082       1.39611
51          0.31475      0.93573         0.97148       1.39611
   training_classification_error validation_rmse validation_logloss
46                       0.12237         0.38125            0.44727
47                       0.12294         0.38123            0.44732
48                       0.12180         0.38153            0.44779
49                       0.11981         0.38154            0.44778
50                       0.12094         0.38191            0.44834
51                       0.11867         0.38173            0.44812
   validation_auc validation_pr_auc validation_lift
46        0.82706           0.92364         1.37628
47        0.82675           0.92316         1.37628
48        0.82621           0.92293         1.37628
49        0.82582           0.92294         1.37628
50        0.82585           0.92319         1.37628
51        0.82599           0.92328         1.37628
   validation_classification_error
46                         0.20000
47                         0.19894
48                         0.20213
49                         0.20106
50                         0.20319
51                         0.20319

Variable Importances: (Extract with `h2o.varimp`) 
=================================================

Variable Importances: 
    variable relative_importance scaled_importance percentage
1  seniority          324.636536          1.000000   0.166827
2     income          301.767517          0.929555   0.155075
3    records          296.553772          0.913495   0.152395
4     amount          233.128555          0.718122   0.119802
5        job          163.762939          0.504450   0.084156
6       home          132.941345          0.409508   0.068317
7     assets          113.164719          0.348589   0.058154
8      price          105.915077          0.326257   0.054428
9   expenses           77.263611          0.238000   0.039705
10       age           71.007111          0.218728   0.036490
11      time           56.115288          0.172856   0.028837
12      debt           36.218292          0.111566   0.018612
13   marital           33.476219          0.103119   0.017203</code></pre>
</div>
</div>
</section>
<section id="tuning" class="level3" data-number="25.3.9">
<h3 data-number="25.3.9" class="anchored" data-anchor-id="tuning"><span class="header-section-number">25.3.9</span> Tuning</h3>
<p><strong>Tuning</strong> là quá trình tìm kiếm tổ hợp các bộ siêu tham số để tối ưu hóa mô hình theo một tiêu chí nhất định. Quá trình tuning sẽ diễn ra theo 2 bước lớn:</p>
<ul>
<li>Bước 1: Liệt kê các bộ tổ hợp tham số</li>
<li>Bước 2: Xây dựng lần lượt từng mô hình với bộ tham số vừa chọn, có thể có 2 cách - chạy tuần tự (<em>grid search</em>) hoặc chạy ngẫu nhiên (<em>random search</em>)</li>
</ul>
<p>Để giới hạn thời gian training, ta có thể đặt ra các tiêu chí cho phép dừng việc xây dựng mô hình. Ví dụ:</p>
<ul>
<li>Thời gian tối đa training</li>
<li>Số lượng mô hình tối đa</li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb40"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb40-1"><a href="#cb40-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Bước 9: Tuning</span></span>
<span id="cb40-2"><a href="#cb40-2" aria-hidden="true" tabindex="-1"></a><span class="co"># 9.1. Set hyper parameters</span></span>
<span id="cb40-3"><a href="#cb40-3" aria-hidden="true" tabindex="-1"></a>hyper_params <span class="ot">=</span> <span class="fu">list</span>( </span>
<span id="cb40-4"><a href="#cb40-4" aria-hidden="true" tabindex="-1"></a>  <span class="do">## Số tầng tối đa trong cây - restrict the search to the range of max_depth established above</span></span>
<span id="cb40-5"><a href="#cb40-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">max_depth =</span> <span class="fu">c</span>(<span class="dv">3</span><span class="sc">:</span><span class="dv">7</span>),                                      </span>
<span id="cb40-6"><a href="#cb40-6" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb40-7"><a href="#cb40-7" aria-hidden="true" tabindex="-1"></a>  <span class="do">## search a large space of row sampling rates per tree</span></span>
<span id="cb40-8"><a href="#cb40-8" aria-hidden="true" tabindex="-1"></a>  <span class="at">sample_rate =</span> <span class="fu">seq</span>(<span class="fl">0.5</span>,<span class="dv">1</span>,<span class="fl">0.05</span>),                                             </span>
<span id="cb40-9"><a href="#cb40-9" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb40-10"><a href="#cb40-10" aria-hidden="true" tabindex="-1"></a>  <span class="do">## search a large space of column sampling rates per split</span></span>
<span id="cb40-11"><a href="#cb40-11" aria-hidden="true" tabindex="-1"></a>  <span class="at">col_sample_rate =</span> <span class="fu">seq</span>(<span class="fl">0.5</span>,<span class="dv">1</span>,<span class="fl">0.05</span>),                                  </span>
<span id="cb40-12"><a href="#cb40-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb40-13"><a href="#cb40-13" aria-hidden="true" tabindex="-1"></a>  <span class="do">## search a large space of the number of min rows in a terminal node</span></span>
<span id="cb40-14"><a href="#cb40-14" aria-hidden="true" tabindex="-1"></a>  <span class="at">min_rows =</span> <span class="dv">2</span><span class="sc">^</span><span class="fu">seq</span>(<span class="dv">0</span>,<span class="fu">log2</span>(<span class="fu">nrow</span>(train))<span class="sc">-</span><span class="dv">1</span>,<span class="dv">1</span>),                                 </span>
<span id="cb40-15"><a href="#cb40-15" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb40-16"><a href="#cb40-16" aria-hidden="true" tabindex="-1"></a>  <span class="do">## search a large space of the number of bins for split-finding for continuous and integer columns</span></span>
<span id="cb40-17"><a href="#cb40-17" aria-hidden="true" tabindex="-1"></a>  <span class="at">nbins =</span> <span class="dv">2</span><span class="sc">^</span><span class="fu">seq</span>(<span class="dv">4</span>,<span class="dv">10</span>,<span class="dv">1</span>),                                                     </span>
<span id="cb40-18"><a href="#cb40-18" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb40-19"><a href="#cb40-19" aria-hidden="true" tabindex="-1"></a>  <span class="do">## search a large space of the number of bins for split-finding for categorical columns</span></span>
<span id="cb40-20"><a href="#cb40-20" aria-hidden="true" tabindex="-1"></a>  <span class="at">nbins_cats =</span> <span class="dv">2</span><span class="sc">^</span><span class="fu">seq</span>(<span class="dv">4</span>,<span class="dv">12</span>,<span class="dv">1</span>),                                                </span>
<span id="cb40-21"><a href="#cb40-21" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb40-22"><a href="#cb40-22" aria-hidden="true" tabindex="-1"></a>  <span class="do">## search a few minimum required relative error improvement thresholds for a split to happen</span></span>
<span id="cb40-23"><a href="#cb40-23" aria-hidden="true" tabindex="-1"></a>  <span class="at">min_split_improvement =</span> <span class="fu">c</span>(<span class="dv">0</span>,<span class="fl">1e-8</span>,<span class="fl">1e-6</span>,<span class="fl">1e-4</span>),                               </span>
<span id="cb40-24"><a href="#cb40-24" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb40-25"><a href="#cb40-25" aria-hidden="true" tabindex="-1"></a>  <span class="do">## try all histogram types (QuantilesGlobal and RoundRobin are good for numeric columns with outliers)</span></span>
<span id="cb40-26"><a href="#cb40-26" aria-hidden="true" tabindex="-1"></a>  <span class="at">histogram_type =</span> <span class="fu">c</span>(<span class="st">"UniformAdaptive"</span>,<span class="st">"QuantilesGlobal"</span>,<span class="st">"RoundRobin"</span>)      </span>
<span id="cb40-27"><a href="#cb40-27" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb40-28"><a href="#cb40-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb40-29"><a href="#cb40-29" aria-hidden="true" tabindex="-1"></a><span class="co"># 9.2. Set search criteria</span></span>
<span id="cb40-30"><a href="#cb40-30" aria-hidden="true" tabindex="-1"></a>search_criteria <span class="ot">=</span> <span class="fu">list</span>(</span>
<span id="cb40-31"><a href="#cb40-31" aria-hidden="true" tabindex="-1"></a>  <span class="do">## Random grid search</span></span>
<span id="cb40-32"><a href="#cb40-32" aria-hidden="true" tabindex="-1"></a>  <span class="at">strategy =</span> <span class="st">"RandomDiscrete"</span>,      </span>
<span id="cb40-33"><a href="#cb40-33" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb40-34"><a href="#cb40-34" aria-hidden="true" tabindex="-1"></a>  <span class="do">## limit the runtime to xx minutes</span></span>
<span id="cb40-35"><a href="#cb40-35" aria-hidden="true" tabindex="-1"></a>  <span class="at">max_runtime_secs =</span> <span class="dv">10</span>,         </span>
<span id="cb40-36"><a href="#cb40-36" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb40-37"><a href="#cb40-37" aria-hidden="true" tabindex="-1"></a>  <span class="do">## build no more than xx models</span></span>
<span id="cb40-38"><a href="#cb40-38" aria-hidden="true" tabindex="-1"></a>  <span class="at">max_models =</span> <span class="dv">20</span>,                  </span>
<span id="cb40-39"><a href="#cb40-39" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb40-40"><a href="#cb40-40" aria-hidden="true" tabindex="-1"></a>  <span class="do">## random number generator seed to make sampling of parameter combinations reproducible</span></span>
<span id="cb40-41"><a href="#cb40-41" aria-hidden="true" tabindex="-1"></a>  <span class="at">seed =</span> <span class="dv">1234</span>,                        </span>
<span id="cb40-42"><a href="#cb40-42" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb40-43"><a href="#cb40-43" aria-hidden="true" tabindex="-1"></a>  <span class="do">## early stopping once the leaderboard of the top 5 models is converged to 0.1% relative difference</span></span>
<span id="cb40-44"><a href="#cb40-44" aria-hidden="true" tabindex="-1"></a>  <span class="at">stopping_rounds =</span> <span class="dv">5</span>,                </span>
<span id="cb40-45"><a href="#cb40-45" aria-hidden="true" tabindex="-1"></a>  <span class="at">stopping_metric =</span> <span class="st">"AUC"</span>,</span>
<span id="cb40-46"><a href="#cb40-46" aria-hidden="true" tabindex="-1"></a>  <span class="at">stopping_tolerance =</span> <span class="fl">1e-3</span></span>
<span id="cb40-47"><a href="#cb40-47" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb40-48"><a href="#cb40-48" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb40-49"><a href="#cb40-49" aria-hidden="true" tabindex="-1"></a><span class="co"># 9.3. Grid search</span></span>
<span id="cb40-50"><a href="#cb40-50" aria-hidden="true" tabindex="-1"></a>grid <span class="ot">&lt;-</span> <span class="fu">h2o.grid</span>(</span>
<span id="cb40-51"><a href="#cb40-51" aria-hidden="true" tabindex="-1"></a>  <span class="do">## hyper parameters</span></span>
<span id="cb40-52"><a href="#cb40-52" aria-hidden="true" tabindex="-1"></a>  <span class="at">hyper_params =</span> hyper_params,</span>
<span id="cb40-53"><a href="#cb40-53" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb40-54"><a href="#cb40-54" aria-hidden="true" tabindex="-1"></a>  <span class="do">## hyper-parameter search configuration (see above)</span></span>
<span id="cb40-55"><a href="#cb40-55" aria-hidden="true" tabindex="-1"></a>  <span class="at">search_criteria =</span> search_criteria,</span>
<span id="cb40-56"><a href="#cb40-56" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb40-57"><a href="#cb40-57" aria-hidden="true" tabindex="-1"></a>  <span class="do">## which algorithm to run</span></span>
<span id="cb40-58"><a href="#cb40-58" aria-hidden="true" tabindex="-1"></a>  <span class="at">algorithm =</span> <span class="st">"gbm"</span>,</span>
<span id="cb40-59"><a href="#cb40-59" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb40-60"><a href="#cb40-60" aria-hidden="true" tabindex="-1"></a>  <span class="do">## identifier for the grid, to later retrieve it</span></span>
<span id="cb40-61"><a href="#cb40-61" aria-hidden="true" tabindex="-1"></a>  <span class="at">grid_id =</span> <span class="st">"model_id"</span>, </span>
<span id="cb40-62"><a href="#cb40-62" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb40-63"><a href="#cb40-63" aria-hidden="true" tabindex="-1"></a>  <span class="do">## standard model parameters</span></span>
<span id="cb40-64"><a href="#cb40-64" aria-hidden="true" tabindex="-1"></a>  <span class="at">x =</span> <span class="fu">setdiff</span>(<span class="fu">names</span>(credit_data), <span class="st">"status"</span>), </span>
<span id="cb40-65"><a href="#cb40-65" aria-hidden="true" tabindex="-1"></a>  <span class="at">y =</span> <span class="st">"status"</span>, </span>
<span id="cb40-66"><a href="#cb40-66" aria-hidden="true" tabindex="-1"></a>  <span class="at">training_frame =</span> train, </span>
<span id="cb40-67"><a href="#cb40-67" aria-hidden="true" tabindex="-1"></a>  <span class="at">validation_frame =</span> test,</span>
<span id="cb40-68"><a href="#cb40-68" aria-hidden="true" tabindex="-1"></a>  <span class="co">#balance_classes = T, #Option to solve imbalanced classification</span></span>
<span id="cb40-69"><a href="#cb40-69" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb40-70"><a href="#cb40-70" aria-hidden="true" tabindex="-1"></a>  <span class="do">## more trees is better if the learning rate is small enough</span></span>
<span id="cb40-71"><a href="#cb40-71" aria-hidden="true" tabindex="-1"></a>  <span class="do">## use "more than enough" trees - we have early stopping</span></span>
<span id="cb40-72"><a href="#cb40-72" aria-hidden="true" tabindex="-1"></a>  <span class="at">ntrees =</span> <span class="dv">200</span>,                                                            </span>
<span id="cb40-73"><a href="#cb40-73" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb40-74"><a href="#cb40-74" aria-hidden="true" tabindex="-1"></a>  <span class="do">## smaller learning rate is better</span></span>
<span id="cb40-75"><a href="#cb40-75" aria-hidden="true" tabindex="-1"></a>  <span class="do">## since we have learning_rate_annealing, we can afford to start with a bigger learning rate</span></span>
<span id="cb40-76"><a href="#cb40-76" aria-hidden="true" tabindex="-1"></a>  <span class="at">learn_rate =</span> <span class="fl">0.05</span>,                                                         </span>
<span id="cb40-77"><a href="#cb40-77" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb40-78"><a href="#cb40-78" aria-hidden="true" tabindex="-1"></a>  <span class="do">## learning rate annealing: learning_rate shrinks by 1% after every tree </span></span>
<span id="cb40-79"><a href="#cb40-79" aria-hidden="true" tabindex="-1"></a>  <span class="do">## (use 1.00 to disable, but then lower the learning_rate)</span></span>
<span id="cb40-80"><a href="#cb40-80" aria-hidden="true" tabindex="-1"></a>  <span class="at">learn_rate_annealing =</span> <span class="fl">0.99</span>,                                               </span>
<span id="cb40-81"><a href="#cb40-81" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb40-82"><a href="#cb40-82" aria-hidden="true" tabindex="-1"></a>  <span class="do">## early stopping based on timeout (no model should take more than 1 hour - modify as needed)</span></span>
<span id="cb40-83"><a href="#cb40-83" aria-hidden="true" tabindex="-1"></a>  <span class="at">max_runtime_secs =</span> <span class="dv">30</span>,                                                 </span>
<span id="cb40-84"><a href="#cb40-84" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb40-85"><a href="#cb40-85" aria-hidden="true" tabindex="-1"></a>  <span class="do">## early stopping once the validation AUC doesn't improve by at least 0.01% for 5 consecutive scoring events</span></span>
<span id="cb40-86"><a href="#cb40-86" aria-hidden="true" tabindex="-1"></a>  <span class="at">stopping_rounds =</span> <span class="dv">5</span>, <span class="at">stopping_tolerance =</span> <span class="fl">1e-3</span>, <span class="at">stopping_metric =</span> <span class="st">"AUC"</span>, </span>
<span id="cb40-87"><a href="#cb40-87" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb40-88"><a href="#cb40-88" aria-hidden="true" tabindex="-1"></a>  <span class="do">## score every 10 trees to make early stopping reproducible (it depends on the scoring interval)</span></span>
<span id="cb40-89"><a href="#cb40-89" aria-hidden="true" tabindex="-1"></a>  <span class="at">score_tree_interval =</span> <span class="dv">10</span>,                                                </span>
<span id="cb40-90"><a href="#cb40-90" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb40-91"><a href="#cb40-91" aria-hidden="true" tabindex="-1"></a>  <span class="do">## base random number generator seed for each model (automatically gets incremented internally for each model)</span></span>
<span id="cb40-92"><a href="#cb40-92" aria-hidden="true" tabindex="-1"></a>  <span class="at">seed =</span> <span class="dv">1234</span>                                                             </span>
<span id="cb40-93"><a href="#cb40-93" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
  |                                                                            
  |                                                                      |   0%
  |                                                                            
  |=======                                                               |  10%
  |                                                                            
  |=====================                                                 |  30%
  |                                                                            
  |===================================                                   |  50%
  |                                                                            
  |=================================================                     |  71%
  |                                                                            
  |================================================================      |  91%
  |                                                                            
  |======================================================================| 100%</code></pre>
</div>
<div class="sourceCode cell-code" id="cb42"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb42-1"><a href="#cb42-1" aria-hidden="true" tabindex="-1"></a><span class="co"># 9.4. Get models</span></span>
<span id="cb42-2"><a href="#cb42-2" aria-hidden="true" tabindex="-1"></a>sortedGrid <span class="ot">&lt;-</span> <span class="fu">h2o.getGrid</span>(<span class="st">"model_id"</span>, <span class="at">sort_by =</span> <span class="st">"auc"</span>, <span class="at">decreasing =</span> <span class="cn">TRUE</span>)    </span>
<span id="cb42-3"><a href="#cb42-3" aria-hidden="true" tabindex="-1"></a>sortedGrid</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>H2O Grid Details
================

Grid ID: model_id 
Used hyper parameters: 
  -  col_sample_rate 
  -  histogram_type 
  -  max_depth 
  -  min_rows 
  -  min_split_improvement 
  -  nbins 
  -  nbins_cats 
  -  sample_rate 
Number of models: 15 
Number of failed models: 0 

Hyper-Parameter Search Summary: ordered by decreasing auc
   col_sample_rate  histogram_type max_depth min_rows min_split_improvement
1          0.75000 QuantilesGlobal   5.00000  4.00000               0.00000
2          0.80000 UniformAdaptive   5.00000  1.00000               0.00000
3          0.80000 UniformAdaptive   5.00000  1.00000               0.00000
4          0.85000      RoundRobin   8.00000 32.00000               0.00010
5          0.80000 UniformAdaptive   5.00000  1.00000               0.00000
6          0.85000      RoundRobin   6.00000 32.00000               0.00010
7          0.85000      RoundRobin   6.00000 32.00000               0.00010
8          0.85000      RoundRobin   6.00000 32.00000               0.00010
9          0.70000 UniformAdaptive   3.00000 16.00000               0.00000
10         0.75000 QuantilesGlobal   3.00000  4.00000               0.00000
11         0.75000 QuantilesGlobal   3.00000  4.00000               0.00000
12         0.75000 QuantilesGlobal   3.00000  4.00000               0.00000
13         0.70000 UniformAdaptive   3.00000 16.00000               0.00000
14         0.80000 UniformAdaptive   5.00000 32.00000               0.00010
15         0.80000 UniformAdaptive   5.00000 32.00000               0.00010
       nbins nbins_cats sample_rate         model_ids     auc
1   64.00000  512.00000     0.50000  model_id_model_2 0.83925
2  512.00000 2048.00000     0.55000 model_id_model_13 0.83607
3  512.00000 2048.00000     0.55000 model_id_model_13 0.83607
4   16.00000  256.00000     0.55000  model_id_model_1 0.83597
5  512.00000 2048.00000     0.55000  model_id_model_5 0.83592
6   16.00000  256.00000     0.55000 model_id_model_11 0.83588
7   16.00000  256.00000     0.55000 model_id_model_11 0.83588
8   16.00000  256.00000     0.55000  model_id_model_3 0.83588
9   64.00000  128.00000     0.50000 model_id_model_10 0.83490
10  64.00000  512.00000     0.50000 model_id_model_12 0.83436
11  64.00000  512.00000     0.50000 model_id_model_12 0.83436
12  64.00000  512.00000     0.50000  model_id_model_4 0.83436
13  64.00000  128.00000     0.50000 model_id_model_15 0.83205
14  16.00000   16.00000     1.00000 model_id_model_14 0.82979
15  16.00000   16.00000     1.00000  model_id_model_9 0.82979</code></pre>
</div>
<div class="sourceCode cell-code" id="cb44"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb44-1"><a href="#cb44-1" aria-hidden="true" tabindex="-1"></a><span class="co"># 9.5. Get best model</span></span>
<span id="cb44-2"><a href="#cb44-2" aria-hidden="true" tabindex="-1"></a>gbm <span class="ot">&lt;-</span> <span class="fu">h2o.getModel</span>(sortedGrid<span class="sc">@</span>model_ids[[<span class="dv">1</span>]])</span>
<span id="cb44-3"><a href="#cb44-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-4"><a href="#cb44-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Parameters of the best model</span></span>
<span id="cb44-5"><a href="#cb44-5" aria-hidden="true" tabindex="-1"></a>gbm<span class="sc">@</span>parameters</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>$model_id
[1] "model_id_model_2"

$score_tree_interval
[1] 10

$ntrees
[1] 200

$min_rows
[1] 4

$nbins
[1] 64

$nbins_cats
[1] 512

$stopping_rounds
[1] 5

$stopping_metric
[1] "AUC"

$max_runtime_secs
[1] 3.343

$seed
[1] 1234

$learn_rate
[1] 0.05

$learn_rate_annealing
[1] 0.99

$distribution
[1] "bernoulli"

$sample_rate
[1] 0.5

$col_sample_rate
[1] 0.75

$min_split_improvement
[1] 1e-08

$histogram_type
[1] "QuantilesGlobal"

$categorical_encoding
[1] "Enum"

$calibration_method
[1] "PlattScaling"

$x
 [1] "seniority" "home"      "time"      "age"       "marital"   "records"  
 [7] "job"       "expenses"  "income"    "assets"    "debt"      "amount"   
[13] "price"    

$y
[1] "status"</code></pre>
</div>
<div class="sourceCode cell-code" id="cb46"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb46-1"><a href="#cb46-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Summary best model</span></span>
<span id="cb46-2"><a href="#cb46-2" aria-hidden="true" tabindex="-1"></a>gbm <span class="sc">%&gt;%</span> summary</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Model Details:
==============

H2OBinomialModel: gbm
Model Key:  model_id_model_2 
Model Summary: 
  number_of_trees number_of_internal_trees model_size_in_bytes min_depth
1             101                      101               41267         5
  max_depth mean_depth min_leaves max_leaves mean_leaves
1         5    5.00000         22         32    27.84158

H2OBinomialMetrics: gbm
** Reported on training data. **

MSE:  0.1038766
RMSE:  0.3222989
LogLoss:  0.3444046
Mean Per-Class Error:  0.1962122
AUC:  0.922945
AUCPR:  0.9656416
Gini:  0.8458901
R^2:  0.4888564

Confusion Matrix (vertical: actual; across: predicted) for F1-optimal threshold:
       bad good    Error       Rate
bad    662  335 0.336008   =335/997
good   142 2375 0.056416  =142/2517
Totals 804 2710 0.135743  =477/3514

Maximum Metrics: Maximum metrics at their respective thresholds
                        metric threshold       value idx
1                       max f1  0.542663    0.908743 238
2                       max f2  0.294600    0.945905 323
3                 max f0point5  0.714438    0.916011 169
4                 max accuracy  0.613301    0.865680 211
5                max precision  0.966763    1.000000   0
6                   max recall  0.208347    1.000000 353
7              max specificity  0.966763    1.000000   0
8             max absolute_mcc  0.638907    0.669366 201
9   max min_per_class_accuracy  0.705850    0.846540 173
10 max mean_per_class_accuracy  0.714438    0.849024 169
11                     max tns  0.966763  997.000000   0
12                     max fns  0.966763 2506.000000   0
13                     max fps  0.051253  997.000000 399
14                     max tps  0.208347 2517.000000 353
15                     max tnr  0.966763    1.000000   0
16                     max fnr  0.966763    0.995630   0
17                     max fpr  0.051253    1.000000 399
18                     max tpr  0.208347    1.000000 353

Gains/Lift Table: Extract with `h2o.gainsLift(&lt;model&gt;, &lt;data&gt;)` or `h2o.gainsLift(&lt;model&gt;, valid=&lt;T/F&gt;, xval=&lt;T/F&gt;)`
H2OBinomialMetrics: gbm
** Reported on validation data. **

MSE:  0.1428533
RMSE:  0.3779594
LogLoss:  0.4379932
Mean Per-Class Error:  0.3311096
AUC:  0.8392535
AUCPR:  0.9339088
Gini:  0.6785069
R^2:  0.2808953

Confusion Matrix (vertical: actual; across: predicted) for F1-optimal threshold:
       bad good    Error      Rate
bad    106  151 0.587549  =151/257
good    51  632 0.074671   =51/683
Totals 157  783 0.214894  =202/940

Maximum Metrics: Maximum metrics at their respective thresholds
                        metric threshold      value idx
1                       max f1  0.441956   0.862210 290
2                       max f2  0.121529   0.931787 392
3                 max f0point5  0.718631   0.873643 183
4                 max accuracy  0.564764   0.791489 249
5                max precision  0.969009   1.000000   0
6                   max recall  0.121529   1.000000 392
7              max specificity  0.969009   1.000000   0
8             max absolute_mcc  0.718631   0.508423 183
9   max min_per_class_accuracy  0.719839   0.774319 182
10 max mean_per_class_accuracy  0.718631   0.775886 183
11                     max tns  0.969009 257.000000   0
12                     max fns  0.969009 682.000000   0
13                     max fps  0.067426 257.000000 399
14                     max tps  0.121529 683.000000 392
15                     max tnr  0.969009   1.000000   0
16                     max fnr  0.969009   0.998536   0
17                     max fpr  0.067426   1.000000 399
18                     max tpr  0.121529   1.000000 392

Gains/Lift Table: Extract with `h2o.gainsLift(&lt;model&gt;, &lt;data&gt;)` or `h2o.gainsLift(&lt;model&gt;, valid=&lt;T/F&gt;, xval=&lt;T/F&gt;)`


Scoring History: 
             timestamp   duration number_of_trees training_rmse
1  2024-07-21 00:47:47  6.695 sec               0       0.45080
2  2024-07-21 00:47:48  7.465 sec              10       0.40036
3  2024-07-21 00:47:48  7.794 sec              20       0.37458
4  2024-07-21 00:47:48  8.049 sec              30       0.35923
5  2024-07-21 00:47:49  8.310 sec              40       0.34906
6  2024-07-21 00:47:49  8.618 sec              50       0.34114
7  2024-07-21 00:47:49  8.881 sec              60       0.33579
8  2024-07-21 00:47:50  9.173 sec              70       0.33160
9  2024-07-21 00:47:50  9.421 sec              80       0.32802
10 2024-07-21 00:47:50  9.661 sec              90       0.32507
11 2024-07-21 00:47:50  9.943 sec             100       0.32249
12 2024-07-21 00:47:50 10.024 sec             101       0.32230
   training_logloss training_auc training_pr_auc training_lift
1           0.59643      0.50000         0.71628       1.00000
2           0.49553      0.86878         0.93508       1.37866
3           0.44705      0.88372         0.94399       1.39611
4           0.41759      0.89342         0.94946       1.39611
5           0.39769      0.89918         0.95265       1.39611
6           0.38221      0.90611         0.95626       1.39611
7           0.37140      0.91002         0.95838       1.39611
8           0.36303      0.91369         0.96043       1.39611
9           0.35584      0.91740         0.96247       1.39611
10          0.34982      0.92029         0.96416       1.39611
11          0.34478      0.92285         0.96560       1.39611
12          0.34440      0.92295         0.96564       1.39611
   training_classification_error validation_rmse validation_logloss
1                        0.28372         0.44583            0.58688
2                        0.17018         0.40908            0.51104
3                        0.16107         0.39433            0.48005
4                        0.15652         0.38791            0.46455
5                        0.14855         0.38363            0.45392
6                        0.14542         0.38158            0.44841
7                        0.14200         0.38040            0.44500
8                        0.14257         0.37967            0.44279
9                        0.14001         0.37912            0.44085
10                       0.13773         0.37843            0.43921
11                       0.13631         0.37793            0.43792
12                       0.13574         0.37796            0.43799
   validation_auc validation_pr_auc validation_lift
1         0.50000           0.72660         1.00000
2         0.81990           0.92592         1.37628
3         0.82699           0.92973         1.37628
4         0.83052           0.93151         1.37628
5         0.83445           0.93282         1.37628
6         0.83548           0.93258         1.37628
7         0.83624           0.93228         1.37628
8         0.83724           0.93272         1.37628
9         0.83846           0.93397         1.37628
10        0.83879           0.93375         1.37628
11        0.83950           0.93411         1.37628
12        0.83925           0.93391         1.37628
   validation_classification_error
1                          0.27340
2                          0.23511
3                          0.22553
4                          0.22766
5                          0.23085
6                          0.22128
7                          0.22021
8                          0.22766
9                          0.21170
10                         0.21596
11                         0.21383
12                         0.21489

Variable Importances: (Extract with `h2o.varimp`) 
=================================================

Variable Importances: 
    variable relative_importance scaled_importance percentage
1     income          601.478210          1.000000   0.164163
2  seniority          588.334229          0.978147   0.160575
3    records          508.306793          0.845096   0.138733
4     amount          403.860840          0.671447   0.110227
5      price          290.374207          0.482768   0.079252
6       home          232.835678          0.387106   0.063548
7     assets          229.250427          0.381145   0.062570
8        job          215.411026          0.358136   0.058793
9        age          183.053497          0.304339   0.049961
10  expenses          148.772507          0.247345   0.040605
11      time           99.452026          0.165346   0.027144
12      debt           82.594765          0.137320   0.022543
13   marital           80.189468          0.133321   0.021886</code></pre>
</div>
</div>
<p>Như vậy, sau khi <code>tuning</code>, ta đã nâng chất lượng mô hình với AUC từ 0.82 lên 0.84.</p>
</section>
<section id="lưu-và-load-mô-hình" class="level3" data-number="25.3.10">
<h3 data-number="25.3.10" class="anchored" data-anchor-id="lưu-và-load-mô-hình"><span class="header-section-number">25.3.10</span> Lưu và load mô hình</h3>
<p>Để lưu lại mô hình trên H2O, chúng ta sử dụng câu lệnh <code>h2o.saveModel()</code>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb48"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb48-1"><a href="#cb48-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Lưu model</span></span>
<span id="cb48-2"><a href="#cb48-2" aria-hidden="true" tabindex="-1"></a><span class="fu">h2o.saveModel</span>(gbm, <span class="co"># Tên mô hình</span></span>
<span id="cb48-3"><a href="#cb48-3" aria-hidden="true" tabindex="-1"></a>              <span class="at">path =</span> <span class="fu">getwd</span>(), <span class="co"># Đường dẫn muốn lưu</span></span>
<span id="cb48-4"><a href="#cb48-4" aria-hidden="true" tabindex="-1"></a>              <span class="at">force =</span> T)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Để load mô hình trên H2O, chúng ta sử dụng câu lệnh <code>h2o.loadModel()</code>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb49"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb49-1"><a href="#cb49-1" aria-hidden="true" tabindex="-1"></a><span class="fu">h2o.shutdown</span>(<span class="at">prompt =</span> F)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
</section>
<section id="tìm-kiếm-mô-hình-tự-động" class="level2" data-number="25.4">
<h2 data-number="25.4" class="anchored" data-anchor-id="tìm-kiếm-mô-hình-tự-động"><span class="header-section-number">25.4</span> Tìm kiếm mô hình tự động</h2>
<p>Bên cạnh các mô hình thông thường như random forest, gbm,… <code>h2o</code> còn cho phép tự động xây dựng mô hình với hàm <code>h2o.automl</code> bằng cách xây dựng 1 loạt nhiều mô hình về đánh giá hiệu quả mô hình. Bên cạnh các thuật toán thông thường, h2o còn có thể sử dụng cả các thuật toán thuộc nhóm <code>stack ensemble</code> khi kết hợp kết quả đầu ra của nhiều mô hình</p>
<p>Xêm thêm hướng dẫn về <a href="https://docs.h2o.ai/h2o/latest-stable/h2o-docs/automl.html">h2o.automl</a></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb50"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb50-1"><a href="#cb50-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Bước 6: Xây dựng mô hình trên train</span></span>
<span id="cb50-2"><a href="#cb50-2" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">1</span>)</span>
<span id="cb50-3"><a href="#cb50-3" aria-hidden="true" tabindex="-1"></a>auto_model <span class="ot">&lt;-</span> <span class="fu">h2o.automl</span>(<span class="at">training_frame =</span> train, <span class="co"># Tập dữ liệu train</span></span>
<span id="cb50-4"><a href="#cb50-4" aria-hidden="true" tabindex="-1"></a>                         <span class="at">validation_frame =</span> test,</span>
<span id="cb50-5"><a href="#cb50-5" aria-hidden="true" tabindex="-1"></a>                      <span class="at">x =</span> <span class="fu">setdiff</span>(<span class="fu">names</span>(credit_data), <span class="st">"status"</span>),  <span class="co"># Các biến đầu vào</span></span>
<span id="cb50-6"><a href="#cb50-6" aria-hidden="true" tabindex="-1"></a>                      <span class="at">y =</span> <span class="st">"status"</span>, <span class="co"># Biến đầu ra (biến muốn dự báo),</span></span>
<span id="cb50-7"><a href="#cb50-7" aria-hidden="true" tabindex="-1"></a>                      <span class="at">max_runtime_secs =</span> <span class="dv">100</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
  |                                                                            
  |                                                                      |   0%
  |                                                                            
  |=                                                                     |   1%
01:31:44.938: User specified a validation frame with cross-validation still enabled. Please note that the models will still be validated using cross-validation only, the validation frame will be used to provide purely informative validation metrics on the trained models.
  |                                                                            
  |==                                                                    |   3%
  |                                                                            
  |====                                                                  |   5%
  |                                                                            
  |=====                                                                 |   7%
  |                                                                            
  |=======                                                               |   9%
  |                                                                            
  |========                                                              |  12%
  |                                                                            
  |==========                                                            |  14%
  |                                                                            
  |===========                                                           |  16%
  |                                                                            
  |============                                                          |  18%
  |                                                                            
  |==============                                                        |  20%
  |                                                                            
  |===============                                                       |  22%
  |                                                                            
  |=================                                                     |  24%
  |                                                                            
  |==================                                                    |  26%
  |                                                                            
  |====================                                                  |  28%
  |                                                                            
  |=====================                                                 |  30%
  |                                                                            
  |=======================                                               |  32%
  |                                                                            
  |========================                                              |  34%
  |                                                                            
  |==========================                                            |  37%
  |                                                                            
  |===========================                                           |  39%
  |                                                                            
  |============================                                          |  41%
  |                                                                            
  |==============================                                        |  43%
  |                                                                            
  |===============================                                       |  45%
  |                                                                            
  |=================================                                     |  47%
  |                                                                            
  |==================================                                    |  49%
  |                                                                            
  |====================================                                  |  51%
  |                                                                            
  |=====================================                                 |  53%
  |                                                                            
  |=======================================                               |  55%
  |                                                                            
  |========================================                              |  57%
  |                                                                            
  |==========================================                            |  60%
  |                                                                            
  |===========================================                           |  62%
  |                                                                            
  |=============================================                         |  64%
  |                                                                            
  |==============================================                        |  66%
  |                                                                            
  |===============================================                       |  68%
  |                                                                            
  |=================================================                     |  70%
  |                                                                            
  |==================================================                    |  72%
  |                                                                            
  |====================================================                  |  74%
  |                                                                            
  |=====================================================                 |  76%
  |                                                                            
  |=======================================================               |  78%
  |                                                                            
  |========================================================              |  80%
  |                                                                            
  |==========================================================            |  82%
  |                                                                            
  |===========================================================           |  85%
  |                                                                            
  |=============================================================         |  87%
  |                                                                            
  |==============================================================        |  89%
  |                                                                            
  |================================================================      |  91%
  |                                                                            
  |=================================================================     |  93%
  |                                                                            
  |==================================================================    |  95%
  |                                                                            
  |====================================================================  |  97%
  |                                                                            
  |===================================================================== |  99%
  |                                                                            
  |======================================================================| 100%</code></pre>
</div>
<div class="sourceCode cell-code" id="cb52"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb52-1"><a href="#cb52-1" aria-hidden="true" tabindex="-1"></a>leader_board <span class="ot">&lt;-</span> auto_model<span class="sc">@</span>leaderboard</span>
<span id="cb52-2"><a href="#cb52-2" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(leader_board)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>                                                model_id       auc   logloss
1 StackedEnsemble_BestOfFamily_4_AutoML_2_20240721_13144 0.8534487 0.4169469
2    StackedEnsemble_AllModels_1_AutoML_2_20240721_13144 0.8531564 0.4171070
3 StackedEnsemble_BestOfFamily_2_AutoML_2_20240721_13144 0.8528731 0.4173195
4    StackedEnsemble_AllModels_2_AutoML_2_20240721_13144 0.8528609 0.4177210
5 StackedEnsemble_BestOfFamily_3_AutoML_2_20240721_13144 0.8526422 0.4180335
6 StackedEnsemble_BestOfFamily_1_AutoML_2_20240721_13144 0.8524405 0.4192514
      aucpr mean_per_class_error      rmse       mse
1 0.9341279            0.2999846 0.3675472 0.1350909
2 0.9341054            0.3255450 0.3678989 0.1353496
3 0.9339738            0.2993496 0.3680767 0.1354805
4 0.9341232            0.3221191 0.3682857 0.1356344
5 0.9339085            0.3043841 0.3684068 0.1357235
6 0.9326967            0.3003526 0.3684118 0.1357272

[23 rows x 7 columns] </code></pre>
</div>
<div class="sourceCode cell-code" id="cb54"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb54-1"><a href="#cb54-1" aria-hidden="true" tabindex="-1"></a>auto_model<span class="sc">@</span>leader</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Model Details:
==============

H2OBinomialModel: stackedensemble
Model ID:  StackedEnsemble_BestOfFamily_4_AutoML_2_20240721_13144 
Model Summary for Stacked Ensemble: 
                                         key            value
1                          Stacking strategy cross_validation
2       Number of base models (used / total)              5/6
3           # GBM base models (used / total)              1/1
4       # XGBoost base models (used / total)              1/1
5           # DRF base models (used / total)              1/2
6           # GLM base models (used / total)              1/1
7  # DeepLearning base models (used / total)              1/1
8                      Metalearner algorithm              GLM
9         Metalearner fold assignment scheme           Random
10                        Metalearner nfolds                5
11                   Metalearner fold_column               NA
12        Custom metalearner hyperparameters             None


H2OBinomialMetrics: stackedensemble
** Reported on training data. **

MSE:  0.09643506
RMSE:  0.3105399
LogLoss:  0.3128246
Mean Per-Class Error:  0.1923532
AUC:  0.9355476
AUCPR:  0.9737279
Gini:  0.8710952

Confusion Matrix (vertical: actual; across: predicted) for F1-optimal threshold:
       bad good    Error       Rate
bad    659  338 0.339017   =338/997
good   115 2402 0.045689  =115/2517
Totals 774 2740 0.128913  =453/3514

Maximum Metrics: Maximum metrics at their respective thresholds
                        metric threshold       value idx
1                       max f1  0.494350    0.913829 247
2                       max f2  0.350355    0.945802 299
3                 max f0point5  0.725015    0.924141 158
4                 max accuracy  0.517631    0.871372 238
5                max precision  0.999255    1.000000   0
6                   max recall  0.103566    1.000000 378
7              max specificity  0.999255    1.000000   0
8             max absolute_mcc  0.660383    0.678322 184
9   max min_per_class_accuracy  0.680776    0.855781 176
10 max mean_per_class_accuracy  0.725015    0.860751 158
11                     max tns  0.999255  997.000000   0
12                     max fns  0.999255 2415.000000   0
13                     max fps  0.002845  997.000000 399
14                     max tps  0.103566 2517.000000 378
15                     max tnr  0.999255    1.000000   0
16                     max fnr  0.999255    0.959476   0
17                     max fpr  0.002845    1.000000 399
18                     max tpr  0.103566    1.000000 378

Gains/Lift Table: Extract with `h2o.gainsLift(&lt;model&gt;, &lt;data&gt;)` or `h2o.gainsLift(&lt;model&gt;, valid=&lt;T/F&gt;, xval=&lt;T/F&gt;)`
H2OBinomialMetrics: stackedensemble
** Reported on validation data. **

MSE:  0.140289
RMSE:  0.3745517
LogLoss:  0.4362446
Mean Per-Class Error:  0.2819901
AUC:  0.8385641
AUCPR:  0.9285414
Gini:  0.6771283

Confusion Matrix (vertical: actual; across: predicted) for F1-optimal threshold:
       bad good    Error      Rate
bad    132  125 0.486381  =125/257
good    53  630 0.077599   =53/683
Totals 185  755 0.189362  =178/940

Maximum Metrics: Maximum metrics at their respective thresholds
                        metric threshold      value idx
1                       max f1  0.469641   0.876217 281
2                       max f2  0.092632   0.931025 395
3                 max f0point5  0.699172   0.871997 190
4                 max accuracy  0.487164   0.810638 273
5                max precision  0.999320   1.000000   0
6                   max recall  0.092632   1.000000 395
7              max specificity  0.999320   1.000000   0
8             max absolute_mcc  0.699172   0.503488 190
9   max min_per_class_accuracy  0.703256   0.770428 188
10 max mean_per_class_accuracy  0.699172   0.773208 190
11                     max tns  0.999320 257.000000   0
12                     max fns  0.999320 667.000000   0
13                     max fps  0.037535 257.000000 399
14                     max tps  0.092632 683.000000 395
15                     max tnr  0.999320   1.000000   0
16                     max fnr  0.999320   0.976574   0
17                     max fpr  0.037535   1.000000 399
18                     max tpr  0.092632   1.000000 395

Gains/Lift Table: Extract with `h2o.gainsLift(&lt;model&gt;, &lt;data&gt;)` or `h2o.gainsLift(&lt;model&gt;, valid=&lt;T/F&gt;, xval=&lt;T/F&gt;)`
H2OBinomialMetrics: stackedensemble
** Reported on cross-validation data. **
** 5-fold cross-validation on training data (Metrics computed for combined holdout predictions) **

MSE:  0.1350909
RMSE:  0.3675472
LogLoss:  0.4169469
Mean Per-Class Error:  0.2999846
AUC:  0.8534487
AUCPR:  0.9341279
Gini:  0.7068974

Confusion Matrix (vertical: actual; across: predicted) for F1-optimal threshold:
       bad good    Error       Rate
bad    463  534 0.535607   =534/997
good   162 2355 0.064362  =162/2517
Totals 625 2889 0.198065  =696/3514

Maximum Metrics: Maximum metrics at their respective thresholds
                        metric threshold       value idx
1                       max f1  0.446814    0.871254 271
2                       max f2  0.265483    0.930775 333
3                 max f0point5  0.676737    0.870721 178
4                 max accuracy  0.505327    0.806488 249
5                max precision  0.999446    1.000000   0
6                   max recall  0.066952    1.000000 390
7              max specificity  0.999446    1.000000   0
8             max absolute_mcc  0.670883    0.521238 181
9   max min_per_class_accuracy  0.711799    0.770311 164
10 max mean_per_class_accuracy  0.676737    0.775374 178
11                     max tns  0.999446  997.000000   0
12                     max fns  0.999446 2466.000000   0
13                     max fps  0.002866  997.000000 399
14                     max tps  0.066952 2517.000000 390
15                     max tnr  0.999446    1.000000   0
16                     max fnr  0.999446    0.979738   0
17                     max fpr  0.002866    1.000000 399
18                     max tpr  0.066952    1.000000 390

Gains/Lift Table: Extract with `h2o.gainsLift(&lt;model&gt;, &lt;data&gt;)` or `h2o.gainsLift(&lt;model&gt;, valid=&lt;T/F&gt;, xval=&lt;T/F&gt;)`
Cross-Validation Metrics Summary: 
                mean       sd cv_1_valid cv_2_valid cv_3_valid cv_4_valid
accuracy    0.808428 0.012594   0.802594   0.815860   0.808720   0.791001
auc         0.851518 0.017519   0.835943   0.878418   0.858033   0.837123
err         0.191572 0.012594   0.197406   0.184140   0.191280   0.208999
err_count 134.600000 9.289780 137.000000 137.000000 136.000000 144.000000
f0point5    0.842002 0.012469   0.825227   0.851689   0.840466   0.836139
          cv_5_valid
accuracy    0.823964
auc         0.848073
err         0.176036
err_count 119.000000
f0point5    0.856490

---
                        mean        sd cv_1_valid cv_2_valid cv_3_valid
precision           0.821474  0.019687   0.791602   0.839060   0.816972
r2                  0.315125  0.031421   0.276733   0.337323   0.333887
recall              0.937694  0.036457   0.994141   0.906250   0.949710
residual_deviance 604.525800 32.584343 603.022900 656.117300 588.399840
rmse                0.372478  0.007452   0.374077   0.377100   0.363539
specificity         0.473502  0.135374   0.263736   0.616379   0.432990
                  cv_4_valid cv_5_valid
precision           0.820183   0.839552
r2                  0.285319   0.342363
recall              0.906694   0.931677
residual_deviance 606.860700 568.228200
rmse                0.381407   0.366268
specificity         0.500000   0.554404</code></pre>
</div>
</div>
</section>
<section id="h2o-flow" class="level2" data-number="25.5">
<h2 data-number="25.5" class="anchored" data-anchor-id="h2o-flow"><span class="header-section-number">25.5</span> H2o Flow</h2>
<p>Bên cạnh sử dụng các câu lệnh trong R, H2O còn hỗ trợ xây dựng mô hình với flow. Sau khi khởi động h2o, ta có thể truy cập vào <code>localhost:54321</code> và xây dựng mô hình dưới dạng GUI</p>
<p><img src="Images/p03-07-h2o-flow.png" class="img-fluid"></p>
<p>Chi tiết hướng dẫn sử dụng có thể xem thêm tại <a href="">https://docs.h2o.ai/h2o/latest-stable/h2o-docs/flow.html</a></p>
</section>
<section id="tài-liệu-tham-khảo" class="level2" data-number="25.6">
<h2 data-number="25.6" class="anchored" data-anchor-id="tài-liệu-tham-khảo"><span class="header-section-number">25.6</span> Tài liệu tham khảo</h2>
<ul>
<li><a href="https://github.com/h2oai/h2o-tutorials">https://github.com/h2oai/h2o-tutorials</a></li>
<li><a href="https://docs.h2o.ai/h2o/latest-stable/h2o-docs/automl.html">https://docs.h2o.ai/h2o/latest-stable/h2o-docs/automl.html</a></li>
<li><a href="https://h2o.ai/blog/2016/h2o-gbm-tuning-tutorial-for-r/">https://h2o.ai/blog/2016/h2o-gbm-tuning-tutorial-for-r/</a></li>
</ul>


</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const disableStylesheet = (stylesheets) => {
    for (let i=0; i < stylesheets.length; i++) {
      const stylesheet = stylesheets[i];
      stylesheet.rel = 'prefetch';
    }
  }
  const enableStylesheet = (stylesheets) => {
    for (let i=0; i < stylesheets.length; i++) {
      const stylesheet = stylesheets[i];
      stylesheet.rel = 'stylesheet';
    }
  }
  const manageTransitions = (selector, allowTransitions) => {
    const els = window.document.querySelectorAll(selector);
    for (let i=0; i < els.length; i++) {
      const el = els[i];
      if (allowTransitions) {
        el.classList.remove('notransition');
      } else {
        el.classList.add('notransition');
      }
    }
  }
  const toggleColorMode = (alternate) => {
    // Switch the stylesheets
    const alternateStylesheets = window.document.querySelectorAll('link.quarto-color-scheme.quarto-color-alternate');
    manageTransitions('#quarto-margin-sidebar .nav-link', false);
    if (alternate) {
      enableStylesheet(alternateStylesheets);
      for (const sheetNode of alternateStylesheets) {
        if (sheetNode.id === "quarto-bootstrap") {
          toggleBodyColorMode(sheetNode);
        }
      }
    } else {
      disableStylesheet(alternateStylesheets);
      toggleBodyColorPrimary();
    }
    manageTransitions('#quarto-margin-sidebar .nav-link', true);
    // Switch the toggles
    const toggles = window.document.querySelectorAll('.quarto-color-scheme-toggle');
    for (let i=0; i < toggles.length; i++) {
      const toggle = toggles[i];
      if (toggle) {
        if (alternate) {
          toggle.classList.add("alternate");     
        } else {
          toggle.classList.remove("alternate");
        }
      }
    }
    // Hack to workaround the fact that safari doesn't
    // properly recolor the scrollbar when toggling (#1455)
    if (navigator.userAgent.indexOf('Safari') > 0 && navigator.userAgent.indexOf('Chrome') == -1) {
      manageTransitions("body", false);
      window.scrollTo(0, 1);
      setTimeout(() => {
        window.scrollTo(0, 0);
        manageTransitions("body", true);
      }, 40);  
    }
  }
  const isFileUrl = () => { 
    return window.location.protocol === 'file:';
  }
  const hasAlternateSentinel = () => {  
    let styleSentinel = getColorSchemeSentinel();
    if (styleSentinel !== null) {
      return styleSentinel === "alternate";
    } else {
      return false;
    }
  }
  const setStyleSentinel = (alternate) => {
    const value = alternate ? "alternate" : "default";
    if (!isFileUrl()) {
      window.localStorage.setItem("quarto-color-scheme", value);
    } else {
      localAlternateSentinel = value;
    }
  }
  const getColorSchemeSentinel = () => {
    if (!isFileUrl()) {
      const storageValue = window.localStorage.getItem("quarto-color-scheme");
      return storageValue != null ? storageValue : localAlternateSentinel;
    } else {
      return localAlternateSentinel;
    }
  }
  let localAlternateSentinel = 'default';
  // Dark / light mode switch
  window.quartoToggleColorScheme = () => {
    // Read the current dark / light value 
    let toAlternate = !hasAlternateSentinel();
    toggleColorMode(toAlternate);
    setStyleSentinel(toAlternate);
  };
  // Ensure there is a toggle, if there isn't float one in the top right
  if (window.document.querySelector('.quarto-color-scheme-toggle') === null) {
    const a = window.document.createElement('a');
    a.classList.add('top-right');
    a.classList.add('quarto-color-scheme-toggle');
    a.href = "";
    a.onclick = function() { try { window.quartoToggleColorScheme(); } catch {} return false; };
    const i = window.document.createElement("i");
    i.classList.add('bi');
    a.appendChild(i);
    window.document.body.appendChild(a);
  }
  // Switch to dark mode if need be
  if (hasAlternateSentinel()) {
    toggleColorMode(true);
  } else {
    toggleColorMode(false);
  }
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
<nav class="page-navigation">
  <div class="nav-page nav-page-previous">
      <a href="./p03-05-bagging-boosting.html" class="pagination-link">
        <i class="bi bi-arrow-left-short"></i> <span class="nav-page-text"><span class="chapter-number">24</span>&nbsp; <span class="chapter-title">Bagging, RandomForest và Boosting</span></span>
      </a>          
  </div>
  <div class="nav-page nav-page-next">
      <a href="./p03-08-xgboost.html" class="pagination-link">
        <span class="nav-page-text"><span class="chapter-number">26</span>&nbsp; <span class="chapter-title">XGBoost &amp; LightGBM</span></span> <i class="bi bi-arrow-right-short"></i>
      </a>
  </div>
</nav>
</div> <!-- /content -->



</body></html>