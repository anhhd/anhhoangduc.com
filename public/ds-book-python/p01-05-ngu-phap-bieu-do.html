<!DOCTYPE html>
<html class="writer-html5" lang="vn" >
<head>
  <meta charset="utf-8" /><meta name="viewport" content="width=device-width, initial-scale=1" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>5. Ngữ pháp của biểu đồ với plotnine &mdash; Phân tích dữ liệu với Python 2019 documentation</title>
      <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
      <link rel="stylesheet" href="_static/copybutton.css" type="text/css" />
      <link rel="stylesheet" href="_static/nbsphinx-code-cells.css" type="text/css" />
  <!--[if lt IE 9]>
    <script src="_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script src="_static/jquery.js?v=5d32c60e"></script>
        <script src="_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
        <script src="_static/documentation_options.js?v=1ea3fed6"></script>
        <script src="_static/doctools.js?v=9a2dae69"></script>
        <script src="_static/sphinx_highlight.js?v=dc90522c"></script>
        <script src="_static/clipboard.min.js?v=a7894cd8"></script>
        <script src="_static/copybutton.js?v=f281be69"></script>
        <script crossorigin="anonymous" integrity="sha256-Ae2Vz/4ePdIu6ZyI/5ZGsYnb+m0JlOmKPjt6XZ9JJkA=" src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
        <script>window.MathJax = {"tex": {"inlineMath": [["$", "$"], ["\\(", "\\)"]], "processEscapes": true}, "options": {"ignoreHtmlClass": "tex2jax_ignore|mathjax_ignore|document", "processHtmlClass": "tex2jax_process|mathjax_process|math|output_area"}}</script>
        <script defer="defer" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <script src="_static/js/theme.js"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="6. Dữ liệu thời gian trong Python" href="p01-06-datetime.html" />
    <link rel="prev" title="4. Pandas" href="p01-04-pandas.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="index.html" class="icon icon-home">
            Phân tích dữ liệu với Python
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Python cơ bản</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="p01-01-gioi-thieu-python.html">1. Giới thiệu về Python</a></li>
<li class="toctree-l1"><a class="reference internal" href="p01-02-python-ide.html">2. Python IDE - Jupyter lab &amp; Visual Studio</a></li>
<li class="toctree-l1"><a class="reference internal" href="p01-03-cau-truc-du-lieu-python.html">3. Các cấu trúc cơ bản trong Python</a></li>
<li class="toctree-l1"><a class="reference internal" href="p01-04-pandas.html">4. Pandas</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">5. Ngữ pháp của biểu đồ với <code class="docutils literal notranslate"><span class="pre">plotnine</span></code></a><ul>
<li class="toctree-l2"><a class="reference internal" href="#Giới-thiệu">5.1. Giới thiệu</a></li>
<li class="toctree-l2"><a class="reference internal" href="#Xây-dựng-biểu-đồ">5.2. Xây dựng biểu đồ</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#Biểu-đồ-cơ-bản">5.2.1. Biểu đồ cơ bản</a></li>
<li class="toctree-l3"><a class="reference internal" href="#Facet">5.2.2. Facet</a></li>
<li class="toctree-l3"><a class="reference internal" href="#Thuộc-tính-hình-học---geom">5.2.3. Thuộc tính hình học - geom</a></li>
<li class="toctree-l3"><a class="reference internal" href="#Tính-toán-thống-kê---statistical-transformations">5.2.4. Tính toán thống kê - statistical transformations</a></li>
<li class="toctree-l3"><a class="reference internal" href="#Vị-trí-trong-biểu-đồ">5.2.5. Vị trí trong biểu đồ</a></li>
<li class="toctree-l3"><a class="reference internal" href="#Hệ-trục-tọa-độ">5.2.6. Hệ trục tọa độ</a></li>
<li class="toctree-l3"><a class="reference internal" href="#Các-yếu-tố-khác">5.2.7. Các yếu tố khác</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#Labs">5.2.7.1. Labs</a></li>
<li class="toctree-l4"><a class="reference internal" href="#Theme">5.2.7.2. Theme</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#Thay-đổi-màu-trong-biểu-đồ">5.2.8. Thay đổi màu trong biểu đồ</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#Các-mẹo-với-plotnine">5.3. Các mẹo với <code class="docutils literal notranslate"><span class="pre">plotnine</span></code></a><ul>
<li class="toctree-l3"><a class="reference internal" href="#Đặt-global-option-cho-theme">5.3.1. Đặt global option cho theme</a></li>
<li class="toctree-l3"><a class="reference internal" href="#Loại-bỏ-legend-trong-1-lớp">5.3.2. Loại bỏ legend trong 1 lớp</a></li>
<li class="toctree-l3"><a class="reference internal" href="#Làm-nổi-bật-biểu-đồ-với-annotate">5.3.3. Làm nổi bật biểu đồ với <code class="docutils literal notranslate"><span class="pre">annotate</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="#Hiển-thị-text-biểu-đồ-ở-giữa-bar-chart">5.3.4. Hiển thị text biểu đồ ở giữa bar chart</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#Các-package-bổ-trợ">5.4. Các package bổ trợ</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#Kết-hợp-nhiều-biểu-đồ-với-patchworklib">5.4.1. Kết hợp nhiều biểu đồ với <code class="docutils literal notranslate"><span class="pre">patchworklib</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="#Biểu-đồ-động-với-lets-plot">5.4.2. Biểu đồ động với lets-plot</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#Tài-liệu-tham-khảo">5.5. Tài liệu tham khảo</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="p01-06-datetime.html">6. Dữ liệu thời gian trong Python</a></li>
<li class="toctree-l1"><a class="reference internal" href="p01-07-lam-viec-voi-text.html">7. Biến đổi dữ liệu text trong python</a></li>
<li class="toctree-l1"><a class="reference internal" href="p01-08-numpy.html">8. Numpy</a></li>
<li class="toctree-l1"><a class="reference internal" href="p01-09-seaborn.html">9. Trực quan hóa với Seaborn</a></li>
<li class="toctree-l1"><a class="reference internal" href="p01-10-matplotlib.html">10. Trực quan hóa với Matplotlib</a></li>
<li class="toctree-l1"><a class="reference internal" href="p01-19-so-sanh-python-r.html">11. So sánh R với Python cơ bản</a></li>
<li class="toctree-l1"><a class="reference internal" href="p01-20-polars.html">12. Polars</a></li>
<li class="toctree-l1"><a class="reference internal" href="p01-99-tricks-python.html">13. Các mẹo trong Python</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Machine learning với sklearn</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="p02-01-sklearn.html">1. Giới thiệu cơ bản về Scikit learn</a></li>
<li class="toctree-l1"><a class="reference internal" href="p02-02-sklearn-advanced.html">2. sklearn nâng cao</a></li>
<li class="toctree-l1"><a class="reference internal" href="p02-03-xgboost.html">3. Xgboost với sklearn</a></li>
<li class="toctree-l1"><a class="reference internal" href="p02-07-machine-learning-h2o.html">4. Machine learning với <code class="docutils literal notranslate"><span class="pre">H2O</span></code></a></li>
<li class="toctree-l1"><a class="reference internal" href="p02-20-api-flask.html">5. Xây dựng API dự báo với Flask</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Lập trình trong Python</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="p06-01-lap-trinh-doi-tuong-python.html">1. Lập trình hướng - đối tượng với Python</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Xây dựng Python package</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="p07-01-functions-in-python.html">1. Viết hàm trong Python</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Case studies</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="p09-01-data-exploration-case-study.html">1. Ví dụ phân tích với pandas và matplotlib</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">Phân tích dữ liệu với Python</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="index.html" class="icon icon-home" aria-label="Home"></a></li>
      <li class="breadcrumb-item active"><span class="section-number">5. </span>Ngữ pháp của biểu đồ với <code class="docutils literal notranslate"><span class="pre">plotnine</span></code></li>
      <li class="wy-breadcrumbs-aside">
            <a href="_sources/p01-05-ngu-phap-bieu-do.ipynb.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="Ngữ-pháp-của-biểu-đồ-với-plotnine">
<h1><span class="section-number">5. </span>Ngữ pháp của biểu đồ với <code class="docutils literal notranslate"><span class="pre">plotnine</span></code><a class="headerlink" href="#Ngữ-pháp-của-biểu-đồ-với-plotnine" title="Link to this heading"></a></h1>
<section id="Giới-thiệu">
<h2><span class="section-number">5.1. </span>Giới thiệu<a class="headerlink" href="#Giới-thiệu" title="Link to this heading"></a></h2>
<p>Trong lĩnh vực phân tích dữ liệu, bên cạnh việc biến đổi dữ liệu, kỹ năng trực quan hóa biểu đồ là kỹ năng đặc biệt quan trọng, giúp cho người đọc báo cáo, phân tích nắm được kết quả phân tích một cách đơn giản hơn.</p>
<p>Với python, việc trực quan hóa thường được sử dụng với <code class="docutils literal notranslate"><span class="pre">matplotlib</span></code> hoặc <code class="docutils literal notranslate"><span class="pre">searborn</span></code>. Tuy nhiên, trong lĩnh vực trực quan hóa dữ liệu, tư tưởng mang tính đột phá là tư duy <em>ngữ pháp biểu đồ</em> và được phổ biến rộng rãi qua ngôn ngữ R. Với <code class="docutils literal notranslate"><span class="pre">python</span></code>, ta có thể sử dụng package <code class="docutils literal notranslate"><span class="pre">plotnine</span></code>.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="err">!</span><span class="n">pip</span> <span class="n">install</span> <span class="n">plotnine</span>
</pre></div>
</div>
<p>Các thư viện khác như <code class="docutils literal notranslate"><span class="pre">matplotlib</span></code> hoặc <code class="docutils literal notranslate"><span class="pre">searborn</span></code> sẽ được trình bày trong các chương tiếp theo</p>
<hr class="docutils" />
<p>Khái niệm &quot;ngữ pháp của biểu đồ&quot; cho rằng: Mỗi biểu đồ được tạo ra do 2 hay nhiều lớp chống lấn mà thành. Các lớp của biểu đồ bao gồm</p>
<p><strong>Các lớp (layer) cơ bản (bắt buộc phải có)</strong>:</p>
<ol class="arabic simple">
<li><p><strong>Dữ liệu (data)</strong>: Tập số liệu được sử dụng cho việc xây dựng biểu đồ.</p></li>
<li><p><strong>Biến (aesthetic attribute)</strong>: Xác định các biến trong dữ liệu được sắp xếp như thế nào. VD: trục tung, trục hoành là biến nào? Màu sắc được sắp xếp theo biến nào? Độ lớn của mỗi điểm được xác định theo biến nào?</p></li>
<li><p><strong>Tính chất hình học của biểu đồ (geometric object)</strong>: xác định loại biểu đồ được sử dụng. VD: biểu đồ cột, biểu đồ điểm (scatter plot), biểu đồ dây (line chart)</p></li>
</ol>
<p><strong>Các lớp (layer) nâng cao (không bắt buộc)</strong>:</p>
<ol class="arabic simple" start="4">
<li><p><strong>Facet</strong> (tạm dịch: cách thức sắp xếp số liệu trên cùng 1 biểu đồ): Xác định cách thức sắp xếp vị trí của nhiều biểu đồ trên cùng một màn hình.</p></li>
<li><p><strong>Tính toán thống kê (statistical transformation)</strong>: Sử dụng các tính toán trong biểu đồ. VD: Thêm các biểu đồ xu hướng dạng trơ (geom_smooth) , số lượng bin trong histogram… Lớp này có thể nằm lồng trong ngay trong nhóm <code class="docutils literal notranslate"><span class="pre">aesthetics</span></code></p></li>
<li><p><strong>Vị trí (position)</strong>: Xác định vị trí trong biểu đồ</p></li>
<li><p><strong>Trục tọa độ (Coordinate)</strong>: Xác định hệ trục tọa độ vẽ biểu đồ. VD: Hệ tọa độ 3 trục trong không gian (hệ tọa đồ Descartes), hệ tọa độ cực</p></li>
</ol>
<p>Các lớp trong biểu đồ có thể thể hiện thành các lớp như sau</p>
<img alt="_images/ggplot2-01.png" src="_images/ggplot2-01.png" />
<blockquote>
<div><p>Việc hiểu và nắm vững nguyên lý của <code class="docutils literal notranslate"><span class="pre">ggplot2</span></code> sẽ cho phép chúng ta xây dựng gần như bất kỳ biểu đồ nào.</p>
</div></blockquote>
</section>
<section id="Xây-dựng-biểu-đồ">
<h2><span class="section-number">5.2. </span>Xây dựng biểu đồ<a class="headerlink" href="#Xây-dựng-biểu-đồ" title="Link to this heading"></a></h2>
<section id="Biểu-đồ-cơ-bản">
<h3><span class="section-number">5.2.1. </span>Biểu đồ cơ bản<a class="headerlink" href="#Biểu-đồ-cơ-bản" title="Link to this heading"></a></h3>
<p>Câu lệnh cơ bản của <code class="docutils literal notranslate"><span class="pre">ggplot</span></code> như sau:</p>
<div class="highlight-{python} notranslate"><div class="highlight"><pre><span></span>ggplot(data = &lt;DATA&gt;) +
  &lt;GEOM_FUNCTION&gt;(mapping = aes(&lt;MAPPINGS&gt;))
</pre></div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[1]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="c1"># Sử dụng data mpg</span>
<span class="kn">from</span> <span class="nn">plotnine.data</span> <span class="kn">import</span> <span class="n">mpg</span>
<span class="c1"># Sử dụng tất cả các hàm trong plotnine</span>
<span class="kn">from</span> <span class="nn">plotnine</span> <span class="kn">import</span> <span class="o">*</span>
</pre></div>
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[2]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">mpg</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[2]:
</pre></div>
</div>
<div class="output_area rendered_html docutils container">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>manufacturer</th>
      <th>model</th>
      <th>displ</th>
      <th>year</th>
      <th>cyl</th>
      <th>trans</th>
      <th>drv</th>
      <th>cty</th>
      <th>hwy</th>
      <th>fl</th>
      <th>class</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>audi</td>
      <td>a4</td>
      <td>1.8</td>
      <td>1999</td>
      <td>4</td>
      <td>auto(l5)</td>
      <td>f</td>
      <td>18</td>
      <td>29</td>
      <td>p</td>
      <td>compact</td>
    </tr>
    <tr>
      <th>1</th>
      <td>audi</td>
      <td>a4</td>
      <td>1.8</td>
      <td>1999</td>
      <td>4</td>
      <td>manual(m5)</td>
      <td>f</td>
      <td>21</td>
      <td>29</td>
      <td>p</td>
      <td>compact</td>
    </tr>
    <tr>
      <th>2</th>
      <td>audi</td>
      <td>a4</td>
      <td>2.0</td>
      <td>2008</td>
      <td>4</td>
      <td>manual(m6)</td>
      <td>f</td>
      <td>20</td>
      <td>31</td>
      <td>p</td>
      <td>compact</td>
    </tr>
    <tr>
      <th>3</th>
      <td>audi</td>
      <td>a4</td>
      <td>2.0</td>
      <td>2008</td>
      <td>4</td>
      <td>auto(av)</td>
      <td>f</td>
      <td>21</td>
      <td>30</td>
      <td>p</td>
      <td>compact</td>
    </tr>
    <tr>
      <th>4</th>
      <td>audi</td>
      <td>a4</td>
      <td>2.8</td>
      <td>1999</td>
      <td>6</td>
      <td>auto(l5)</td>
      <td>f</td>
      <td>16</td>
      <td>26</td>
      <td>p</td>
      <td>compact</td>
    </tr>
  </tbody>
</table>
</div></div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[3]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Set theme minimal</span>
<span class="kn">import</span> <span class="nn">plotnine</span> <span class="k">as</span> <span class="nn">pln</span>
<span class="n">pln</span><span class="o">.</span><span class="n">theme_set</span><span class="p">(</span><span class="n">theme_minimal</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[4]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">ggplot</span><span class="p">(</span><span class="n">data</span> <span class="o">=</span> <span class="n">mpg</span><span class="p">)</span> <span class="o">+</span> \
  <span class="n">geom_point</span><span class="p">(</span><span class="n">mapping</span> <span class="o">=</span> <span class="n">aes</span><span class="p">(</span><span class="n">x</span> <span class="o">=</span> <span class="s2">&quot;displ&quot;</span><span class="p">,</span> <span class="c1"># Trục x là displ</span>
                           <span class="n">y</span> <span class="o">=</span> <span class="s2">&quot;hwy&quot;</span><span class="p">,</span>   <span class="c1"># Trục y là hwy</span>
                           <span class="n">color</span> <span class="o">=</span> <span class="s2">&quot;class&quot;</span><span class="p">))</span> <span class="c1"># Color là class</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/p01-05-ngu-phap-bieu-do_10_0.png" class="no-scaled-link" src="_images/p01-05-ngu-phap-bieu-do_10_0.png" style="width: 640px; height: 480px;" />
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[4]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
&lt;Figure Size: (640 x 480)&gt;
</pre></div></div>
</div>
<p>Trong ví dụ trên, ta đã vẽ biểu đồ điểm (<code class="docutils literal notranslate"><span class="pre">geom_point</span></code>) với tập dữ liệu <code class="docutils literal notranslate"><span class="pre">mpg</span></code> để phân tích quan hệ giữa hai biến <code class="docutils literal notranslate"><span class="pre">displ</span></code> và <code class="docutils literal notranslate"><span class="pre">hwy</span></code> và phân nhóm màu theo class.</p>
<p>Ta có thể vẽ biểu đồ với kích thước của từng điểm theo <code class="docutils literal notranslate"><span class="pre">cyl</span></code> như sau.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[5]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">ggplot</span><span class="p">(</span><span class="n">data</span> <span class="o">=</span> <span class="n">mpg</span><span class="p">)</span> <span class="o">+</span> \
  <span class="n">geom_point</span><span class="p">(</span><span class="n">mapping</span> <span class="o">=</span> <span class="n">aes</span><span class="p">(</span><span class="n">x</span> <span class="o">=</span> <span class="s2">&quot;displ&quot;</span><span class="p">,</span>   <span class="c1"># Trục x là displ</span>
                           <span class="n">y</span> <span class="o">=</span> <span class="s2">&quot;hwy&quot;</span><span class="p">,</span>     <span class="c1"># Trục y là hwy</span>
                           <span class="n">size</span> <span class="o">=</span> <span class="s2">&quot;cyl&quot;</span><span class="p">),</span> <span class="c1"># Kích thước theo cyl</span>
             <span class="n">color</span> <span class="o">=</span> <span class="s2">&quot;darkblue&quot;</span><span class="p">)</span>          <span class="c1"># Tất cả các điểm có màu là blue</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/p01-05-ngu-phap-bieu-do_12_0.png" class="no-scaled-link" src="_images/p01-05-ngu-phap-bieu-do_12_0.png" style="width: 640px; height: 480px;" />
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[5]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
&lt;Figure Size: (640 x 480)&gt;
</pre></div></div>
</div>
</section>
<section id="Facet">
<h3><span class="section-number">5.2.2. </span>Facet<a class="headerlink" href="#Facet" title="Link to this heading"></a></h3>
<p><code class="docutils literal notranslate"><span class="pre">Facet</span></code> cho phép chúng ta chia dữ liệu thành nhiều phần theo từng nhóm và xây dựng biểu đồ cho mỗi nhóm trong đó. Câu lệnh của facet như sau</p>
<div class="highlight-{python notranslate"><div class="highlight"><pre><span></span>facet_wrap( group_variable,   # Chia nhóm
            nrow = 2,         # Số lượng dòng trong biểu đồ
            scale = &quot;free&quot;)   # &quot;free&quot; cho phép biểu đồ auto scale
</pre></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[6]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">ggplot</span><span class="p">(</span><span class="n">data</span> <span class="o">=</span> <span class="n">mpg</span><span class="p">)</span> <span class="o">+</span> \
  <span class="n">geom_point</span><span class="p">(</span><span class="n">mapping</span> <span class="o">=</span> <span class="n">aes</span><span class="p">(</span><span class="n">x</span> <span class="o">=</span> <span class="s2">&quot;displ&quot;</span><span class="p">,</span>
                           <span class="n">y</span> <span class="o">=</span> <span class="s2">&quot;hwy&quot;</span><span class="p">),</span>
             <span class="n">color</span> <span class="o">=</span> <span class="s2">&quot;darkblue&quot;</span><span class="p">,</span>
             <span class="n">alpha</span> <span class="o">=</span> <span class="mf">0.2</span><span class="p">)</span> <span class="o">+</span>\
<span class="n">facet_wrap</span><span class="p">(</span><span class="s2">&quot;class&quot;</span><span class="p">)</span> <span class="o">+</span> \
<span class="n">labs</span><span class="p">(</span><span class="n">title</span> <span class="o">=</span> <span class="s2">&quot;Facet wrap&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/p01-05-ngu-phap-bieu-do_16_0.png" class="no-scaled-link" src="_images/p01-05-ngu-phap-bieu-do_16_0.png" style="width: 640px; height: 480px;" />
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[6]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
&lt;Figure Size: (640 x 480)&gt;
</pre></div></div>
</div>
<p><strong>Lưu ý</strong>: Ta có thể viết cách khác như sau</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[7]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="p">(</span>
    <span class="n">ggplot</span><span class="p">(</span><span class="n">data</span> <span class="o">=</span> <span class="n">mpg</span><span class="p">)</span>
        <span class="o">+</span> <span class="n">geom_point</span><span class="p">(</span><span class="n">mapping</span> <span class="o">=</span> <span class="n">aes</span><span class="p">(</span><span class="n">x</span> <span class="o">=</span> <span class="s2">&quot;displ&quot;</span><span class="p">,</span>
                                <span class="n">y</span> <span class="o">=</span> <span class="s2">&quot;hwy&quot;</span><span class="p">),</span>
                                <span class="n">color</span> <span class="o">=</span> <span class="s2">&quot;darkgreen&quot;</span><span class="p">,</span>
                                <span class="n">alpha</span> <span class="o">=</span> <span class="mf">0.2</span><span class="p">)</span>
        <span class="o">+</span> <span class="n">facet_wrap</span><span class="p">(</span><span class="s2">&quot;class&quot;</span><span class="p">,</span>
                    <span class="n">nrow</span> <span class="o">=</span> <span class="mi">2</span><span class="p">)</span>
        <span class="o">+</span> <span class="n">labs</span><span class="p">(</span><span class="n">title</span> <span class="o">=</span> <span class="s2">&quot;Facet wrap&quot;</span><span class="p">)</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/p01-05-ngu-phap-bieu-do_18_0.png" class="no-scaled-link" src="_images/p01-05-ngu-phap-bieu-do_18_0.png" style="width: 640px; height: 480px;" />
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[7]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
&lt;Figure Size: (640 x 480)&gt;
</pre></div></div>
</div>
</section>
<section id="Thuộc-tính-hình-học---geom">
<h3><span class="section-number">5.2.3. </span>Thuộc tính hình học - geom<a class="headerlink" href="#Thuộc-tính-hình-học---geom" title="Link to this heading"></a></h3>
<p>Các loại biểu đồ khác nhau trong <code class="docutils literal notranslate"><span class="pre">plotnine</span></code> chỉ khác nhau ở <code class="docutils literal notranslate"><span class="pre">geom_</span></code> - thuộc tính hình học của biểu đồ. Mỗi <code class="docutils literal notranslate"><span class="pre">geom</span></code> sẽ có các tham số khác nhau cần được điều chỉnh.</p>
<p>Trong ví dụ dưới đây, ta vẽ 2 loại biểu đồ chồng lên nhau gồm 1. biểu đồ điểm và 2. biểu đồ thể hiện xu hướng</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[8]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">ggplot</span><span class="p">(</span><span class="n">mpg</span><span class="p">,</span>
  <span class="n">mapping</span> <span class="o">=</span> <span class="n">aes</span><span class="p">(</span><span class="s2">&quot;displ&quot;</span><span class="p">,</span> <span class="s2">&quot;hwy&quot;</span><span class="p">))</span> <span class="o">+</span>\
  <span class="n">geom_point</span><span class="p">(</span><span class="n">color</span> <span class="o">=</span> <span class="s2">&quot;darkblue&quot;</span><span class="p">,</span> <span class="n">alpha</span> <span class="o">=</span> <span class="mf">0.4</span><span class="p">,</span> <span class="n">size</span> <span class="o">=</span> <span class="mi">4</span><span class="p">)</span> <span class="o">+</span>\
  <span class="n">geom_smooth</span><span class="p">(</span><span class="n">color</span> <span class="o">=</span> <span class="s2">&quot;darkred&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area stderr docutils container">
<div class="highlight"><pre>
c:\Users\Hoang Duc Anh\AppData\Local\Programs\Python\Python311\Lib\site-packages\plotnine\stats\smoothers.py:330: PlotnineWarning: Confidence intervals are not yet implemented for lowess smoothings.
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/p01-05-ngu-phap-bieu-do_20_1.png" class="no-scaled-link" src="_images/p01-05-ngu-phap-bieu-do_20_1.png" style="width: 640px; height: 480px;" />
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[8]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
&lt;Figure Size: (640 x 480)&gt;
</pre></div></div>
</div>
<p><strong>Lưu ý</strong>: Khi có nhiều <code class="docutils literal notranslate"><span class="pre">geom_object</span></code>, nếu không có sự điều chỉnh khi mapping của từng <code class="docutils literal notranslate"><span class="pre">geom</span></code>, các lớp sau sẽ lấy các biến <code class="docutils literal notranslate"><span class="pre">global</span></code> để làm thuộc tính. Trong ví dụ trên, hai lớp <code class="docutils literal notranslate"><span class="pre">geom_point</span></code> và <code class="docutils literal notranslate"><span class="pre">geom_smooth</span></code> lấy giá trị mặc định là <code class="docutils literal notranslate"><span class="pre">aes(displ,</span> <span class="pre">hwy)</span></code></p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[9]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">ggplot</span><span class="p">(</span><span class="n">mpg</span><span class="p">,</span> <span class="n">mapping</span> <span class="o">=</span> <span class="n">aes</span><span class="p">(</span><span class="s2">&quot;displ&quot;</span><span class="p">,</span> <span class="s2">&quot;hwy&quot;</span><span class="p">))</span> <span class="o">+</span>\
  <span class="n">geom_point</span><span class="p">(</span><span class="n">aes</span><span class="p">(</span><span class="n">color</span> <span class="o">=</span> <span class="s2">&quot;drv&quot;</span><span class="p">),</span> <span class="n">alpha</span> <span class="o">=</span> <span class="mf">0.4</span><span class="p">)</span> <span class="o">+</span>\
  <span class="n">geom_smooth</span><span class="p">(</span><span class="n">aes</span><span class="p">(</span><span class="n">color</span> <span class="o">=</span> <span class="s2">&quot;drv&quot;</span><span class="p">),</span>
              <span class="n">size</span> <span class="o">=</span> <span class="mf">1.2</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area stderr docutils container">
<div class="highlight"><pre>
c:\Users\Hoang Duc Anh\AppData\Local\Programs\Python\Python311\Lib\site-packages\plotnine\stats\smoothers.py:330: PlotnineWarning: Confidence intervals are not yet implemented for lowess smoothings.
c:\Users\Hoang Duc Anh\AppData\Local\Programs\Python\Python311\Lib\site-packages\plotnine\stats\smoothers.py:330: PlotnineWarning: Confidence intervals are not yet implemented for lowess smoothings.
c:\Users\Hoang Duc Anh\AppData\Local\Programs\Python\Python311\Lib\site-packages\plotnine\stats\smoothers.py:330: PlotnineWarning: Confidence intervals are not yet implemented for lowess smoothings.
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/p01-05-ngu-phap-bieu-do_22_1.png" class="no-scaled-link" src="_images/p01-05-ngu-phap-bieu-do_22_1.png" style="width: 640px; height: 480px;" />
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[9]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
&lt;Figure Size: (640 x 480)&gt;
</pre></div></div>
</div>
<p>Trong <code class="docutils literal notranslate"><span class="pre">plotnine</span></code> có rất nhiều <code class="docutils literal notranslate"><span class="pre">geom</span></code> phục vụ các loại biểu đồ khác nhau. Tuy nhiên, để phục vụ công viên thực tế, trong <code class="docutils literal notranslate"><span class="pre">ggplot2</span></code> cần nắm vững các loại <code class="docutils literal notranslate"><span class="pre">geom</span></code> quan trọng nhất như sau.</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">geom_point</span></code>: Biểu đồ điểm</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">geom_line</span></code>: Biểu đồ đường</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">geom_boxplot</span></code>: Biểu đồ boxplot</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">geom_col</span></code>, <code class="docutils literal notranslate"><span class="pre">geom_bar</span></code>: Biểu đồ cột</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">geom_smooth</span></code>: Biểu đồ vẽ xu hướng</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">geom_histogram</span></code>, <code class="docutils literal notranslate"><span class="pre">geom_density</span></code>: Biểu đồ phân phối</p></li>
</ul>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[10]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># geom_boxplot</span>
<span class="n">ggplot</span><span class="p">(</span><span class="n">mpg</span><span class="p">,</span> <span class="n">aes</span><span class="p">(</span><span class="s2">&quot;class&quot;</span><span class="p">,</span> <span class="s2">&quot;hwy&quot;</span><span class="p">))</span> <span class="o">+</span>\
  <span class="n">geom_boxplot</span><span class="p">(</span><span class="n">fill</span> <span class="o">=</span> <span class="s2">&quot;darkblue&quot;</span><span class="p">,</span> <span class="n">alpha</span> <span class="o">=</span> <span class="mf">0.5</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/p01-05-ngu-phap-bieu-do_24_0.png" class="no-scaled-link" src="_images/p01-05-ngu-phap-bieu-do_24_0.png" style="width: 640px; height: 480px;" />
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[10]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
&lt;Figure Size: (640 x 480)&gt;
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[11]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># geom_col</span>
<span class="n">ggplot</span><span class="p">(</span><span class="n">mpg</span><span class="p">,</span> <span class="n">aes</span><span class="p">(</span><span class="s2">&quot;class&quot;</span><span class="p">))</span> <span class="o">+</span>\
  <span class="n">geom_bar</span><span class="p">(</span><span class="n">aes</span><span class="p">(</span><span class="n">fill</span> <span class="o">=</span> <span class="s2">&quot;drv&quot;</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/p01-05-ngu-phap-bieu-do_25_0.png" class="no-scaled-link" src="_images/p01-05-ngu-phap-bieu-do_25_0.png" style="width: 640px; height: 480px;" />
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[11]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
&lt;Figure Size: (640 x 480)&gt;
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[12]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># geom_density</span>
<span class="n">ggplot</span><span class="p">(</span><span class="n">mpg</span><span class="p">,</span> <span class="n">aes</span><span class="p">(</span><span class="s2">&quot;hwy&quot;</span><span class="p">))</span> <span class="o">+</span>\
  <span class="n">geom_density</span><span class="p">(</span><span class="n">fill</span> <span class="o">=</span> <span class="s2">&quot;darkblue&quot;</span><span class="p">,</span> <span class="n">alpha</span> <span class="o">=</span> <span class="mf">0.2</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/p01-05-ngu-phap-bieu-do_26_0.png" class="no-scaled-link" src="_images/p01-05-ngu-phap-bieu-do_26_0.png" style="width: 640px; height: 480px;" />
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[12]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
&lt;Figure Size: (640 x 480)&gt;
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[13]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># geom_histogram</span>
<span class="n">ggplot</span><span class="p">(</span><span class="n">mpg</span><span class="p">,</span> <span class="n">aes</span><span class="p">(</span><span class="s2">&quot;hwy&quot;</span><span class="p">))</span> <span class="o">+</span>\
  <span class="n">geom_histogram</span><span class="p">(</span><span class="n">fill</span> <span class="o">=</span> <span class="s2">&quot;darkgreen&quot;</span><span class="p">,</span> <span class="n">alpha</span> <span class="o">=</span> <span class="mf">0.4</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area stderr docutils container">
<div class="highlight"><pre>
c:\Users\Hoang Duc Anh\AppData\Local\Programs\Python\Python311\Lib\site-packages\plotnine\stats\stat_bin.py:109: PlotnineWarning: &#39;stat_bin()&#39; using &#39;bins = 11&#39;. Pick better value with &#39;binwidth&#39;.
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/p01-05-ngu-phap-bieu-do_27_1.png" class="no-scaled-link" src="_images/p01-05-ngu-phap-bieu-do_27_1.png" style="width: 640px; height: 480px;" />
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[13]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
&lt;Figure Size: (640 x 480)&gt;
</pre></div></div>
</div>
</section>
<section id="Tính-toán-thống-kê---statistical-transformations">
<h3><span class="section-number">5.2.4. </span>Tính toán thống kê - statistical transformations<a class="headerlink" href="#Tính-toán-thống-kê---statistical-transformations" title="Link to this heading"></a></h3>
<p>Đối với lớp <em>tính toán thống kê</em> (statistical transformation), biểu đồ không được vẽ trực tiếp với 2 trục tung và trục hoành mà sẽ phải trải qua bước tính toán thống kê trước.</p>
<p>Xem ví dụ biểu đồ cột dưới đây.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[14]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">plotnine.data</span> <span class="kn">import</span> <span class="n">diamonds</span>

<span class="n">ggplot</span><span class="p">(</span><span class="n">diamonds</span><span class="p">)</span> <span class="o">+</span>\
  <span class="n">geom_bar</span><span class="p">(</span><span class="n">mapping</span> <span class="o">=</span> <span class="n">aes</span><span class="p">(</span><span class="n">x</span> <span class="o">=</span> <span class="s2">&quot;cut&quot;</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/p01-05-ngu-phap-bieu-do_29_0.png" class="no-scaled-link" src="_images/p01-05-ngu-phap-bieu-do_29_0.png" style="width: 640px; height: 480px;" />
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[14]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
&lt;Figure Size: (640 x 480)&gt;
</pre></div></div>
</div>
<p>Ở ví dụ này, trục <code class="docutils literal notranslate"><span class="pre">x</span></code> là các nhóm của <code class="docutils literal notranslate"><span class="pre">cut</span></code> trong khi trục <code class="docutils literal notranslate"><span class="pre">y</span></code> là <code class="docutils literal notranslate"><span class="pre">số</span> <span class="pre">lượng</span> <span class="pre">quan</span> <span class="pre">sát</span></code> ở mỗi nhóm, giá trị này không phải là biến trực tiếp từ dữ liệu mà là 1 biến phái sinh. Quá trình xây dựng biểu đồ được thực hiện qua 3 bước như sau.</p>
<img alt="_images/ggplot2-02.png" src="_images/ggplot2-02.png" />
<p>Ta cũng có thể thay đổi lớp biến đổi dữ liệu trong biểu đồ trên để hiển thị dạng tổng của 1 biến bất kỳ như sau.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[15]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">ggplot</span><span class="p">(</span><span class="n">diamonds</span><span class="p">)</span> <span class="o">+</span>\
  <span class="n">geom_bar</span><span class="p">(</span><span class="n">mapping</span> <span class="o">=</span> <span class="n">aes</span><span class="p">(</span><span class="n">x</span> <span class="o">=</span> <span class="s2">&quot;cut&quot;</span><span class="p">,</span> <span class="n">y</span> <span class="o">=</span> <span class="s2">&quot;carat&quot;</span><span class="p">),</span> <span class="n">stat</span> <span class="o">=</span> <span class="s2">&quot;identity&quot;</span><span class="p">,</span> <span class="n">group</span> <span class="o">=</span> <span class="mi">1</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/p01-05-ngu-phap-bieu-do_31_0.png" class="no-scaled-link" src="_images/p01-05-ngu-phap-bieu-do_31_0.png" style="width: 640px; height: 480px;" />
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[15]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
&lt;Figure Size: (640 x 480)&gt;
</pre></div></div>
</div>
</section>
<section id="Vị-trí-trong-biểu-đồ">
<h3><span class="section-number">5.2.5. </span>Vị trí trong biểu đồ<a class="headerlink" href="#Vị-trí-trong-biểu-đồ" title="Link to this heading"></a></h3>
<p>Quay lại ví dụ <code class="docutils literal notranslate"><span class="pre">bar</span> <span class="pre">chart</span></code> phía trên, khi xây dựng biểu đồ có 2 hoặc nhiều nhóm, biểu đồ có thể có 3 kiểu vị trí như sau:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">position</span> <span class="pre">=</span> <span class="pre">&quot;identity&quot;</span></code> (default): Giữ nguyên chế độ mặc định, để dạng stack bar với giá trị trục y mặc định</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">position</span> <span class="pre">=</span> <span class="pre">&quot;fill&quot;</span></code>: Tương tự &quot;identity&quot; nhưng mỗi cột sẽ có tỷ trọng bằng nhau</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">position</span> <span class="pre">=</span> <span class="pre">&quot;dodge&quot;</span></code>: Phân nhóm biểu đồ</p></li>
</ul>
<p>Xem ví dụ dưới đây.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[16]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># position = &quot;identity&quot;</span>
<span class="n">ggplot</span><span class="p">(</span><span class="n">diamonds</span><span class="p">)</span> <span class="o">+</span>\
  <span class="n">geom_bar</span><span class="p">(</span><span class="n">mapping</span> <span class="o">=</span> <span class="n">aes</span><span class="p">(</span><span class="n">x</span> <span class="o">=</span> <span class="s2">&quot;cut&quot;</span><span class="p">,</span> <span class="n">fill</span> <span class="o">=</span> <span class="s2">&quot;clarity&quot;</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/p01-05-ngu-phap-bieu-do_33_0.png" class="no-scaled-link" src="_images/p01-05-ngu-phap-bieu-do_33_0.png" style="width: 640px; height: 480px;" />
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[16]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
&lt;Figure Size: (640 x 480)&gt;
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[17]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># position = &quot;fill&quot;</span>
<span class="n">ggplot</span><span class="p">(</span><span class="n">diamonds</span><span class="p">)</span> <span class="o">+</span>\
  <span class="n">geom_bar</span><span class="p">(</span><span class="n">mapping</span> <span class="o">=</span> <span class="n">aes</span><span class="p">(</span><span class="n">x</span> <span class="o">=</span> <span class="s2">&quot;cut&quot;</span><span class="p">,</span> <span class="n">fill</span> <span class="o">=</span> <span class="s2">&quot;clarity&quot;</span><span class="p">),</span>
           <span class="n">position</span> <span class="o">=</span> <span class="s2">&quot;fill&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/p01-05-ngu-phap-bieu-do_34_0.png" class="no-scaled-link" src="_images/p01-05-ngu-phap-bieu-do_34_0.png" style="width: 640px; height: 480px;" />
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[17]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
&lt;Figure Size: (640 x 480)&gt;
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[18]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># position = &quot;dodge&quot;</span>
<span class="n">ggplot</span><span class="p">(</span><span class="n">diamonds</span><span class="p">)</span> <span class="o">+</span>\
  <span class="n">geom_bar</span><span class="p">(</span><span class="n">mapping</span> <span class="o">=</span> <span class="n">aes</span><span class="p">(</span><span class="n">x</span> <span class="o">=</span> <span class="s2">&quot;cut&quot;</span><span class="p">,</span> <span class="n">fill</span> <span class="o">=</span> <span class="s2">&quot;clarity&quot;</span><span class="p">),</span>
           <span class="n">position</span> <span class="o">=</span> <span class="s2">&quot;dodge&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/p01-05-ngu-phap-bieu-do_35_0.png" class="no-scaled-link" src="_images/p01-05-ngu-phap-bieu-do_35_0.png" style="width: 640px; height: 480px;" />
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[18]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
&lt;Figure Size: (640 x 480)&gt;
</pre></div></div>
</div>
<p>Bên cạnh 3 nhóm <code class="docutils literal notranslate"><span class="pre">position</span></code> trên, biểu đồ điểm còn có nhóm riêng là <code class="docutils literal notranslate"><span class="pre">postion</span> <span class="pre">=</span> <span class="pre">&quot;jitter&quot;</span></code>. Option này cho phép thay đổi giá trị của mỗi điểm một lượng nhỏ để biểu đồ điểm không bị trùng lặp nhiều quan sát (khi nhiều quan sát có chung một giá trị). Nhóm này có thể sử dụng tương đương với <code class="docutils literal notranslate"><span class="pre">geom_jitter</span></code>.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[19]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">ggplot</span><span class="p">(</span><span class="n">data</span> <span class="o">=</span> <span class="n">mpg</span><span class="p">)</span> <span class="o">+</span>\
  <span class="n">geom_point</span><span class="p">(</span><span class="n">mapping</span> <span class="o">=</span> <span class="n">aes</span><span class="p">(</span><span class="n">x</span> <span class="o">=</span> <span class="s2">&quot;displ&quot;</span><span class="p">,</span> <span class="n">y</span> <span class="o">=</span> <span class="s2">&quot;hwy&quot;</span><span class="p">))</span> <span class="o">+</span>\
  <span class="n">labs</span><span class="p">(</span><span class="n">title</span> <span class="o">=</span> <span class="s2">&quot;Without position jitter&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/p01-05-ngu-phap-bieu-do_37_0.png" class="no-scaled-link" src="_images/p01-05-ngu-phap-bieu-do_37_0.png" style="width: 640px; height: 480px;" />
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[19]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
&lt;Figure Size: (640 x 480)&gt;
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[20]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">ggplot</span><span class="p">(</span><span class="n">data</span> <span class="o">=</span> <span class="n">mpg</span><span class="p">)</span> <span class="o">+</span> \
  <span class="n">geom_point</span><span class="p">(</span><span class="n">mapping</span> <span class="o">=</span> <span class="n">aes</span><span class="p">(</span><span class="n">x</span> <span class="o">=</span> <span class="s2">&quot;displ&quot;</span><span class="p">,</span> <span class="n">y</span> <span class="o">=</span> <span class="s2">&quot;hwy&quot;</span><span class="p">),</span>
             <span class="n">position</span> <span class="o">=</span> <span class="s2">&quot;jitter&quot;</span><span class="p">)</span> <span class="o">+</span> \
  <span class="n">labs</span><span class="p">(</span><span class="n">title</span> <span class="o">=</span> <span class="s2">&quot;Position jitter&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/p01-05-ngu-phap-bieu-do_38_0.png" class="no-scaled-link" src="_images/p01-05-ngu-phap-bieu-do_38_0.png" style="width: 640px; height: 480px;" />
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[20]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
&lt;Figure Size: (640 x 480)&gt;
</pre></div></div>
</div>
<center><p>§</p>
</center><p>Đối với biểu đồ miền (area chart), ta có thể sử dụng option <code class="docutils literal notranslate"><span class="pre">position</span> <span class="pre">=</span> <span class="pre">&quot;fill&quot;</span></code> để thể hiện dạng phần trăm.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[21]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>

<span class="c1"># Tạo dữ liệu giả lập</span>
<span class="n">year</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">1875</span><span class="p">,</span> <span class="mi">1973</span><span class="p">)</span>
<span class="n">group</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;A&quot;</span><span class="p">,</span> <span class="s2">&quot;B&quot;</span><span class="p">,</span> <span class="s2">&quot;C&quot;</span><span class="p">]</span>
<span class="n">df</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">meshgrid</span><span class="p">(</span><span class="n">year</span><span class="p">,</span> <span class="n">group</span><span class="p">))</span><span class="o">.</span>\
    <span class="n">reshape</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">year</span><span class="p">)</span> <span class="o">*</span> <span class="nb">len</span><span class="p">(</span><span class="n">group</span><span class="p">))</span>
<span class="c1"># Convert sang data frame</span>
<span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">({</span>
    <span class="s1">&#39;year&#39;</span> <span class="p">:</span> <span class="n">df</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
    <span class="s1">&#39;group&#39;</span> <span class="p">:</span> <span class="n">df</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
<span class="p">})</span>
<span class="c1"># Tạo biến level</span>
<span class="n">df</span><span class="p">[</span><span class="s1">&#39;level&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">normal</span><span class="p">(</span><span class="mi">50</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="n">df</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>

<span class="c1"># Chỉnh sửa category</span>
<span class="n">df</span><span class="p">[</span><span class="s1">&#39;year&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;year&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="s1">&#39;float&#39;</span><span class="p">)</span>
<span class="n">df</span><span class="p">[</span><span class="s1">&#39;group&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;group&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="s1">&#39;category&#39;</span><span class="p">)</span>

<span class="n">df</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[21]:
</pre></div>
</div>
<div class="output_area rendered_html docutils container">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>year</th>
      <th>group</th>
      <th>level</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>1875.0</td>
      <td>A</td>
      <td>47.532653</td>
    </tr>
    <tr>
      <th>1</th>
      <td>1876.0</td>
      <td>A</td>
      <td>38.900201</td>
    </tr>
    <tr>
      <th>2</th>
      <td>1877.0</td>
      <td>A</td>
      <td>61.386196</td>
    </tr>
    <tr>
      <th>3</th>
      <td>1878.0</td>
      <td>A</td>
      <td>52.910796</td>
    </tr>
    <tr>
      <th>4</th>
      <td>1879.0</td>
      <td>A</td>
      <td>40.989734</td>
    </tr>
  </tbody>
</table>
</div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[22]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Lấy theo số tuyệt đối</span>
<span class="n">ggplot</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="n">aes</span><span class="p">(</span><span class="s2">&quot;year&quot;</span><span class="p">,</span> <span class="s2">&quot;level&quot;</span><span class="p">))</span> <span class="o">+</span>\
  <span class="n">geom_area</span><span class="p">(</span><span class="n">aes</span><span class="p">(</span><span class="n">fill</span> <span class="o">=</span> <span class="s2">&quot;group&quot;</span><span class="p">))</span>
<br/></pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/p01-05-ngu-phap-bieu-do_42_0.png" class="no-scaled-link" src="_images/p01-05-ngu-phap-bieu-do_42_0.png" style="width: 640px; height: 480px;" />
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[22]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
&lt;Figure Size: (640 x 480)&gt;
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[23]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Lấy theo tỷ lệ</span>
<span class="n">ggplot</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="n">aes</span><span class="p">(</span><span class="s2">&quot;year&quot;</span><span class="p">,</span> <span class="s2">&quot;level&quot;</span><span class="p">))</span> <span class="o">+</span>\
  <span class="n">geom_area</span><span class="p">(</span><span class="n">aes</span><span class="p">(</span><span class="n">fill</span> <span class="o">=</span> <span class="s2">&quot;group&quot;</span><span class="p">),</span>
            <span class="n">position</span> <span class="o">=</span> <span class="n">position_fill</span><span class="p">())</span> <span class="o">+</span>\
  <span class="n">labs</span><span class="p">(</span><span class="n">title</span> <span class="o">=</span> <span class="s2">&quot;Position fill&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/p01-05-ngu-phap-bieu-do_43_0.png" class="no-scaled-link" src="_images/p01-05-ngu-phap-bieu-do_43_0.png" style="width: 640px; height: 480px;" />
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[23]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
&lt;Figure Size: (640 x 480)&gt;
</pre></div></div>
</div>
</section>
<section id="Hệ-trục-tọa-độ">
<h3><span class="section-number">5.2.6. </span>Hệ trục tọa độ<a class="headerlink" href="#Hệ-trục-tọa-độ" title="Link to this heading"></a></h3>
<p>Biểu đồ thông thường được xây trên hệ trục tọa độ Đề-các với tỷ lệ 1-1. Bên cạnh hệ trục này, <code class="docutils literal notranslate"><span class="pre">ggplot2</span></code> hỗ trợ các hệ trục tọa độ khác nhưng thông dụng nhất là <code class="docutils literal notranslate"><span class="pre">coord_flip</span></code>, cho phép đổi vị trí hai trục tọa độ cho nhau</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[24]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">ggplot</span><span class="p">(</span><span class="n">mpg</span><span class="p">,</span> <span class="n">aes</span><span class="p">(</span><span class="s2">&quot;factor(cyl)&quot;</span><span class="p">,</span> <span class="s2">&quot;hwy&quot;</span><span class="p">))</span> <span class="o">+</span>\
  <span class="n">geom_boxplot</span><span class="p">(</span><span class="n">aes</span><span class="p">(</span><span class="n">fill</span> <span class="o">=</span> <span class="s2">&quot;cyl&quot;</span><span class="p">))</span> <span class="o">+</span>\
  <span class="n">coord_flip</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/p01-05-ngu-phap-bieu-do_45_0.png" class="no-scaled-link" src="_images/p01-05-ngu-phap-bieu-do_45_0.png" style="width: 640px; height: 480px;" />
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[24]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
&lt;Figure Size: (640 x 480)&gt;
</pre></div></div>
</div>
</section>
<section id="Các-yếu-tố-khác">
<h3><span class="section-number">5.2.7. </span>Các yếu tố khác<a class="headerlink" href="#Các-yếu-tố-khác" title="Link to this heading"></a></h3>
<p>Bên cạnh các lớp biểu đồ đã phân tích trên, khi xây dựng biểu đồ với, còn 2 nhóm câu lệnh thường sử dụng:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">labs</span></code>: Đặt tên bản đồ, chú giải, tên các trục</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">theme</span></code>: Sử dụng để có bản đồ đẹp và phù hợp hơn</p></li>
</ul>
<section id="Labs">
<h4><span class="section-number">5.2.7.1. </span>Labs<a class="headerlink" href="#Labs" title="Link to this heading"></a></h4>
<p>Để điều chỉnh tên biểu đồ, chú giải, ta có thể sử dụng câu lệnh <code class="docutils literal notranslate"><span class="pre">labs</span></code></p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">labs</span><span class="p">(</span><span class="n">title</span> <span class="o">=</span> <span class="s2">&quot;title&quot;</span><span class="p">,</span>
     <span class="n">subtitle</span> <span class="o">=</span> <span class="s2">&quot;subtitle&quot;</span><span class="p">,</span>
     <span class="n">x</span> <span class="o">=</span> <span class="s2">&quot;Trục x&quot;</span><span class="p">,</span>
     <span class="n">y</span> <span class="o">=</span> <span class="s2">&quot;Trục y&quot;</span><span class="p">,</span>
     <span class="n">caption</span> <span class="o">=</span> <span class="s2">&quot;Footnote&quot;</span><span class="p">)</span>
</pre></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[25]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">ggplot</span><span class="p">(</span><span class="n">mpg</span><span class="p">,</span> <span class="n">aes</span><span class="p">(</span><span class="s2">&quot;displ&quot;</span><span class="p">,</span> <span class="s2">&quot;hwy&quot;</span><span class="p">))</span> <span class="o">+</span>\
  <span class="n">geom_point</span><span class="p">(</span><span class="n">color</span> <span class="o">=</span> <span class="s2">&quot;darkblue&quot;</span><span class="p">,</span> <span class="n">alpha</span> <span class="o">=</span> <span class="mf">0.4</span><span class="p">,</span> <span class="n">position</span> <span class="o">=</span> <span class="s2">&quot;jitter&quot;</span><span class="p">,</span> <span class="n">size</span> <span class="o">=</span> <span class="mi">4</span><span class="p">)</span> <span class="o">+</span>\
  <span class="n">labs</span><span class="p">(</span><span class="n">title</span> <span class="o">=</span> <span class="s2">&quot;Highway miles per gallon by Engine displacement&quot;</span><span class="p">,</span>
       <span class="n">subtitle</span> <span class="o">=</span> <span class="s2">&quot;From mpg data set&quot;</span><span class="p">,</span>
       <span class="n">x</span> <span class="o">=</span> <span class="s2">&quot;Engine displacement&quot;</span><span class="p">,</span>
       <span class="n">y</span> <span class="o">=</span> <span class="s2">&quot;Highway miles per gallon&quot;</span><span class="p">,</span>
       <span class="n">caption</span> <span class="o">=</span> <span class="s2">&quot;Source: data science team&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/p01-05-ngu-phap-bieu-do_49_0.png" class="no-scaled-link" src="_images/p01-05-ngu-phap-bieu-do_49_0.png" style="width: 640px; height: 480px;" />
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[25]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
&lt;Figure Size: (640 x 480)&gt;
</pre></div></div>
</div>
</section>
<section id="Theme">
<h4><span class="section-number">5.2.7.2. </span>Theme<a class="headerlink" href="#Theme" title="Link to this heading"></a></h4>
<p>Khi xây dựng biểu đồ với <code class="docutils literal notranslate"><span class="pre">ggplot2</span></code>, ta có thể sử dụng rất nhiều <code class="docutils literal notranslate"><span class="pre">theme</span></code> có sẵn nhưng được dùng nhiều nhất là <code class="docutils literal notranslate"><span class="pre">theme_bw()</span></code>, <code class="docutils literal notranslate"><span class="pre">theme_classic()</span></code>, <code class="docutils literal notranslate"><span class="pre">theme_minimal()</span></code></p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[26]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><br/><span></span><span class="n">p</span> <span class="o">=</span> <span class="n">ggplot</span><span class="p">(</span><span class="n">mpg</span><span class="p">,</span> <span class="n">aes</span><span class="p">(</span><span class="s2">&quot;displ&quot;</span><span class="p">,</span> <span class="s2">&quot;hwy&quot;</span><span class="p">))</span> <span class="o">+</span>\
  <span class="n">geom_point</span><span class="p">(</span><span class="n">fill</span> <span class="o">=</span> <span class="s2">&quot;darkblue&quot;</span><span class="p">,</span> <span class="n">alpha</span> <span class="o">=</span> <span class="mf">0.4</span><span class="p">,</span>  <span class="n">size</span> <span class="o">=</span> <span class="mi">3</span><span class="p">)</span>

<span class="n">p</span> <span class="o">+</span> <span class="n">labs</span><span class="p">(</span><span class="n">title</span> <span class="o">=</span> <span class="s2">&quot;Default theme&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/p01-05-ngu-phap-bieu-do_51_0.png" class="no-scaled-link" src="_images/p01-05-ngu-phap-bieu-do_51_0.png" style="width: 640px; height: 480px;" />
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[26]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
&lt;Figure Size: (640 x 480)&gt;
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[27]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">p</span> <span class="o">+</span> <span class="n">labs</span><span class="p">(</span><span class="n">title</span> <span class="o">=</span> <span class="s2">&quot;Theme black &amp; white&quot;</span><span class="p">)</span> <span class="o">+</span> <span class="n">theme_bw</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/p01-05-ngu-phap-bieu-do_52_0.png" class="no-scaled-link" src="_images/p01-05-ngu-phap-bieu-do_52_0.png" style="width: 640px; height: 480px;" />
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[27]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
&lt;Figure Size: (640 x 480)&gt;
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[28]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">p</span> <span class="o">+</span> <span class="n">labs</span><span class="p">(</span><span class="n">title</span> <span class="o">=</span> <span class="s2">&quot;Theme classic&quot;</span><span class="p">)</span> <span class="o">+</span> <span class="n">theme_classic</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/p01-05-ngu-phap-bieu-do_53_0.png" class="no-scaled-link" src="_images/p01-05-ngu-phap-bieu-do_53_0.png" style="width: 640px; height: 480px;" />
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[28]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
&lt;Figure Size: (640 x 480)&gt;
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[29]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">p</span> <span class="o">+</span> <span class="n">theme_minimal</span><span class="p">()</span> <span class="o">+</span> <span class="n">labs</span><span class="p">(</span><span class="n">title</span> <span class="o">=</span> <span class="s2">&quot;Theme minimal&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/p01-05-ngu-phap-bieu-do_54_0.png" class="no-scaled-link" src="_images/p01-05-ngu-phap-bieu-do_54_0.png" style="width: 640px; height: 480px;" />
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[29]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
&lt;Figure Size: (640 x 480)&gt;
</pre></div></div>
</div>
<p>Để tùy chỉnh các thành phần có sẵn trong biểu đồ, ta có thể sử dụng hàm <code class="docutils literal notranslate"><span class="pre">theme</span></code> để customize từng thành phần như sau.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[30]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">p</span> <span class="o">+</span> <span class="n">theme</span><span class="p">(</span>
  <span class="c1"># Tên title</span>
  <span class="n">axis_title</span> <span class="o">=</span> <span class="n">element_text</span><span class="p">(</span><span class="n">family</span> <span class="o">=</span> <span class="s2">&quot;serif&quot;</span><span class="p">,</span> <span class="n">face</span> <span class="o">=</span> <span class="s2">&quot;bold&quot;</span><span class="p">,</span> <span class="n">fontsize</span> <span class="o">=</span> <span class="mi">16</span><span class="p">),</span>
  <span class="c1"># Tên của trục x và y</span>
  <span class="n">axis_title_x</span> <span class="o">=</span> <span class="n">element_text</span><span class="p">(</span><span class="n">family</span> <span class="o">=</span> <span class="s2">&quot;serif&quot;</span><span class="p">,</span> <span class="n">face</span> <span class="o">=</span> <span class="s2">&quot;bold&quot;</span><span class="p">),</span>
  <span class="n">axis_title_y</span> <span class="o">=</span> <span class="n">element_text</span><span class="p">(</span><span class="n">family</span> <span class="o">=</span> <span class="s2">&quot;serif&quot;</span><span class="p">,</span> <span class="n">face</span> <span class="o">=</span> <span class="s2">&quot;bold&quot;</span><span class="p">),</span>
  <span class="c1"># Chữ trên trục</span>
  <span class="n">axis_text</span> <span class="o">=</span> <span class="n">element_text</span><span class="p">(</span><span class="n">face</span> <span class="o">=</span> <span class="s2">&quot;italic&quot;</span><span class="p">),</span>
  <span class="c1"># Xóa phần nền trong panel</span>
  <span class="n">panel_background</span> <span class="o">=</span> <span class="n">element_blank</span><span class="p">()</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/p01-05-ngu-phap-bieu-do_56_0.png" class="no-scaled-link" src="_images/p01-05-ngu-phap-bieu-do_56_0.png" style="width: 640px; height: 480px;" />
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[30]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
&lt;Figure Size: (640 x 480)&gt;
</pre></div></div>
</div>
<p>Để xem các yếu tố có thể tùy chỉnh trong <code class="docutils literal notranslate"><span class="pre">theme</span></code>, ta có thể sử dụng câu lệnh <code class="docutils literal notranslate"><span class="pre">plotnine.theme??</span></code></p>
</section>
</section>
<section id="Thay-đổi-màu-trong-biểu-đồ">
<h3><span class="section-number">5.2.8. </span>Thay đổi màu trong biểu đồ<a class="headerlink" href="#Thay-đổi-màu-trong-biểu-đồ" title="Link to this heading"></a></h3>
<p>Hệ mã màu trong <code class="docutils literal notranslate"><span class="pre">plotnine</span></code> được chia làm 2 nhóm chính:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">color</span></code>: Với các nhóm biểu đồ điểm, đường (<code class="docutils literal notranslate"><span class="pre">point</span></code>, <code class="docutils literal notranslate"><span class="pre">line</span></code>)</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">fill</span></code>: Với các biểu đồ như biểu đồ cột, miền, boxplot</p></li>
</ul>
<p>Bên cạnh đó, dải màu cũng được chia làm 2 nhóm</p>
<ul class="simple">
<li><p>Biến liên tục</p></li>
<li><p>Biến rời rạc</p></li>
</ul>
<p><strong>Với biến màu rời rạc</strong></p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[31]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Điều chỉnh màu thủ công</span>
<span class="n">p</span> <span class="o">=</span> <span class="n">ggplot</span><span class="p">(</span><span class="n">mpg</span><span class="p">,</span> <span class="n">aes</span><span class="p">(</span><span class="s2">&quot;class&quot;</span><span class="p">,</span> <span class="s2">&quot;hwy&quot;</span><span class="p">))</span> <span class="o">+</span>\
  <span class="n">geom_boxplot</span><span class="p">(</span><span class="n">aes</span><span class="p">(</span><span class="n">fill</span> <span class="o">=</span> <span class="s2">&quot;class&quot;</span><span class="p">))</span> <span class="o">+</span>\
  <span class="n">coord_flip</span><span class="p">()</span>
<span class="n">p</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/p01-05-ngu-phap-bieu-do_59_0.png" class="no-scaled-link" src="_images/p01-05-ngu-phap-bieu-do_59_0.png" style="width: 640px; height: 480px;" />
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[31]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
&lt;Figure Size: (640 x 480)&gt;
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[32]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">p</span> <span class="o">+</span> <span class="n">scale_fill_brewer</span><span class="p">(</span><span class="n">palette</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/p01-05-ngu-phap-bieu-do_60_0.png" class="no-scaled-link" src="_images/p01-05-ngu-phap-bieu-do_60_0.png" style="width: 640px; height: 480px;" />
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[32]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
&lt;Figure Size: (640 x 480)&gt;
</pre></div></div>
</div>
</section>
</section>
<section id="Các-mẹo-với-plotnine">
<h2><span class="section-number">5.3. </span>Các mẹo với <code class="docutils literal notranslate"><span class="pre">plotnine</span></code><a class="headerlink" href="#Các-mẹo-với-plotnine" title="Link to this heading"></a></h2>
<section id="Đặt-global-option-cho-theme">
<h3><span class="section-number">5.3.1. </span>Đặt global option cho theme<a class="headerlink" href="#Đặt-global-option-cho-theme" title="Link to this heading"></a></h3>
<p>Khi bắt đầu project, ta có thể đặt một <code class="docutils literal notranslate"><span class="pre">theme</span></code> để sử dụng với tất cả biểu đồ với hàm <code class="docutils literal notranslate"><span class="pre">theme_set</span></code>.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[33]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Set theme</span>
<span class="n">theme_set</span><span class="p">(</span><span class="n">theme_bw</span><span class="p">()</span> <span class="o">+</span>\
          <span class="n">theme</span><span class="p">(</span><span class="n">legend_position</span> <span class="o">=</span> <span class="s2">&quot;top&quot;</span><span class="p">))</span>

<span class="n">ggplot</span><span class="p">(</span><span class="n">mpg</span><span class="p">,</span> <span class="n">aes</span><span class="p">(</span><span class="s2">&quot;displ&quot;</span><span class="p">,</span> <span class="s2">&quot;hwy&quot;</span><span class="p">))</span> <span class="o">+</span>\
  <span class="n">geom_point</span><span class="p">(</span><span class="n">aes</span><span class="p">(</span><span class="n">color</span> <span class="o">=</span> <span class="s2">&quot;cyl&quot;</span><span class="p">),</span> <span class="n">alpha</span> <span class="o">=</span> <span class="mf">0.4</span><span class="p">,</span>  <span class="n">size</span> <span class="o">=</span> <span class="mi">5</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/p01-05-ngu-phap-bieu-do_63_0.png" class="no-scaled-link" src="_images/p01-05-ngu-phap-bieu-do_63_0.png" style="width: 640px; height: 480px;" />
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[33]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
&lt;Figure Size: (640 x 480)&gt;
</pre></div></div>
</div>
</section>
<section id="Loại-bỏ-legend-trong-1-lớp">
<h3><span class="section-number">5.3.2. </span>Loại bỏ legend trong 1 lớp<a class="headerlink" href="#Loại-bỏ-legend-trong-1-lớp" title="Link to this heading"></a></h3>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[34]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">theme_set</span><span class="p">(</span><span class="n">theme_minimal</span><span class="p">())</span>
<span class="c1"># Để cả 2 legend</span>
<span class="n">ggplot</span><span class="p">(</span><span class="n">mpg</span><span class="p">,</span> <span class="n">aes</span><span class="p">(</span><span class="s2">&quot;displ&quot;</span><span class="p">,</span> <span class="s2">&quot;hwy&quot;</span><span class="p">))</span> <span class="o">+</span>\
  <span class="n">geom_point</span><span class="p">(</span><span class="n">aes</span><span class="p">(</span><span class="n">color</span> <span class="o">=</span> <span class="s2">&quot;class&quot;</span><span class="p">),</span> <span class="n">alpha</span> <span class="o">=</span> <span class="mf">0.4</span><span class="p">,</span>  <span class="n">size</span> <span class="o">=</span> <span class="mi">5</span><span class="p">)</span> <span class="o">+</span>\
  <span class="n">geom_smooth</span><span class="p">(</span><span class="n">aes</span><span class="p">(</span><span class="n">color</span> <span class="o">=</span> <span class="s2">&quot;class&quot;</span><span class="p">))</span> <span class="o">+</span>\
  <span class="n">labs</span><span class="p">(</span><span class="n">title</span> <span class="o">=</span> <span class="s2">&quot;Legend in 2 layers&quot;</span><span class="p">)</span>
<br/><br/></pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area stderr docutils container">
<div class="highlight"><pre>
c:\Users\Hoang Duc Anh\AppData\Local\Programs\Python\Python311\Lib\site-packages\plotnine\stats\smoothers.py:330: PlotnineWarning: Confidence intervals are not yet implemented for lowess smoothings.
c:\Users\Hoang Duc Anh\AppData\Local\Programs\Python\Python311\Lib\site-packages\plotnine\stats\smoothers.py:330: PlotnineWarning: Confidence intervals are not yet implemented for lowess smoothings.
c:\Users\Hoang Duc Anh\AppData\Local\Programs\Python\Python311\Lib\site-packages\plotnine\stats\smoothers.py:330: PlotnineWarning: Confidence intervals are not yet implemented for lowess smoothings.
c:\Users\Hoang Duc Anh\AppData\Local\Programs\Python\Python311\Lib\site-packages\plotnine\stats\smoothers.py:330: PlotnineWarning: Confidence intervals are not yet implemented for lowess smoothings.
c:\Users\Hoang Duc Anh\AppData\Local\Programs\Python\Python311\Lib\site-packages\plotnine\stats\smoothers.py:330: PlotnineWarning: Confidence intervals are not yet implemented for lowess smoothings.
c:\Users\Hoang Duc Anh\AppData\Local\Programs\Python\Python311\Lib\site-packages\plotnine\stats\smoothers.py:330: PlotnineWarning: Confidence intervals are not yet implemented for lowess smoothings.
c:\Users\Hoang Duc Anh\AppData\Local\Programs\Python\Python311\Lib\site-packages\plotnine\stats\smoothers.py:330: PlotnineWarning: Confidence intervals are not yet implemented for lowess smoothings.
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/p01-05-ngu-phap-bieu-do_65_1.png" class="no-scaled-link" src="_images/p01-05-ngu-phap-bieu-do_65_1.png" style="width: 640px; height: 480px;" />
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[34]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
&lt;Figure Size: (640 x 480)&gt;
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[35]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Loại bỏ 1 legend</span>
<span class="n">ggplot</span><span class="p">(</span><span class="n">mpg</span><span class="p">,</span> <span class="n">aes</span><span class="p">(</span><span class="s2">&quot;displ&quot;</span><span class="p">,</span> <span class="s2">&quot;hwy&quot;</span><span class="p">))</span> <span class="o">+</span>\
  <span class="n">geom_point</span><span class="p">(</span><span class="n">aes</span><span class="p">(</span><span class="n">color</span> <span class="o">=</span> <span class="s2">&quot;class&quot;</span><span class="p">),</span> <span class="n">alpha</span> <span class="o">=</span> <span class="mf">0.4</span><span class="p">,</span>  <span class="n">size</span> <span class="o">=</span> <span class="mi">5</span><span class="p">)</span> <span class="o">+</span>\
  <span class="n">geom_smooth</span><span class="p">(</span><span class="n">aes</span><span class="p">(</span><span class="n">color</span> <span class="o">=</span> <span class="s2">&quot;class&quot;</span><span class="p">),</span> <span class="n">show_legend</span> <span class="o">=</span> <span class="kc">False</span><span class="p">)</span> <span class="o">+</span>\
  <span class="n">labs</span><span class="p">(</span><span class="n">title</span> <span class="o">=</span> <span class="s2">&quot;Legend in 1 layer only&quot;</span><span class="p">)</span> <span class="o">+</span>\
  <span class="n">theme</span><span class="p">(</span><span class="n">legend_position</span><span class="o">=</span> <span class="s2">&quot;top&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area stderr docutils container">
<div class="highlight"><pre>
c:\Users\Hoang Duc Anh\AppData\Local\Programs\Python\Python311\Lib\site-packages\plotnine\stats\smoothers.py:330: PlotnineWarning: Confidence intervals are not yet implemented for lowess smoothings.
c:\Users\Hoang Duc Anh\AppData\Local\Programs\Python\Python311\Lib\site-packages\plotnine\stats\smoothers.py:330: PlotnineWarning: Confidence intervals are not yet implemented for lowess smoothings.
c:\Users\Hoang Duc Anh\AppData\Local\Programs\Python\Python311\Lib\site-packages\plotnine\stats\smoothers.py:330: PlotnineWarning: Confidence intervals are not yet implemented for lowess smoothings.
c:\Users\Hoang Duc Anh\AppData\Local\Programs\Python\Python311\Lib\site-packages\plotnine\stats\smoothers.py:330: PlotnineWarning: Confidence intervals are not yet implemented for lowess smoothings.
c:\Users\Hoang Duc Anh\AppData\Local\Programs\Python\Python311\Lib\site-packages\plotnine\stats\smoothers.py:330: PlotnineWarning: Confidence intervals are not yet implemented for lowess smoothings.
c:\Users\Hoang Duc Anh\AppData\Local\Programs\Python\Python311\Lib\site-packages\plotnine\stats\smoothers.py:330: PlotnineWarning: Confidence intervals are not yet implemented for lowess smoothings.
c:\Users\Hoang Duc Anh\AppData\Local\Programs\Python\Python311\Lib\site-packages\plotnine\stats\smoothers.py:330: PlotnineWarning: Confidence intervals are not yet implemented for lowess smoothings.
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/p01-05-ngu-phap-bieu-do_66_1.png" class="no-scaled-link" src="_images/p01-05-ngu-phap-bieu-do_66_1.png" style="width: 640px; height: 480px;" />
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[35]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
&lt;Figure Size: (640 x 480)&gt;
</pre></div></div>
</div>
</section>
<section id="Làm-nổi-bật-biểu-đồ-với-annotate">
<h3><span class="section-number">5.3.3. </span>Làm nổi bật biểu đồ với <code class="docutils literal notranslate"><span class="pre">annotate</span></code><a class="headerlink" href="#Làm-nổi-bật-biểu-đồ-với-annotate" title="Link to this heading"></a></h3>
<p>Trong biểu đồ, để tạo hiệu ứng tốt nhất, ta có thể thêm các vùng highlight để làm nổi bật biểu đồ bằng cách sử dụng <code class="docutils literal notranslate"><span class="pre">annotate</span></code>.</p>
<p>Hàm <code class="docutils literal notranslate"><span class="pre">annotate</span></code> tương tự như <code class="docutils literal notranslate"><span class="pre">geom</span></code> nhưng khác biệt ở chỗ, tham số của annotate được thêm vào dưới dạng vector.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[36]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">ggplot</span><span class="p">(</span><span class="n">mpg</span><span class="p">,</span> <span class="n">aes</span><span class="p">(</span><span class="n">x</span> <span class="o">=</span> <span class="s2">&quot;displ&quot;</span><span class="p">,</span> <span class="n">y</span> <span class="o">=</span> <span class="s2">&quot;hwy&quot;</span><span class="p">))</span> <span class="o">+</span> \
  <span class="n">geom_point</span><span class="p">(</span><span class="n">color</span> <span class="o">=</span> <span class="s2">&quot;darkblue&quot;</span><span class="p">,</span> <span class="n">alpha</span> <span class="o">=</span> <span class="mf">0.3</span><span class="p">,</span> <span class="n">size</span> <span class="o">=</span> <span class="mi">3</span><span class="p">)</span> <span class="o">+</span>\
  <span class="n">annotate</span><span class="p">(</span><span class="n">xmin</span> <span class="o">=</span> <span class="mi">4</span><span class="p">,</span> <span class="n">xmax</span> <span class="o">=</span> <span class="mi">7</span><span class="p">,</span> <span class="n">ymin</span> <span class="o">=</span> <span class="mi">20</span><span class="p">,</span> <span class="n">ymax</span> <span class="o">=</span> <span class="mi">44</span><span class="p">,</span>
           <span class="n">geom</span> <span class="o">=</span> <span class="s2">&quot;rect&quot;</span><span class="p">,</span> <span class="n">fill</span> <span class="o">=</span> <span class="s2">&quot;darkred&quot;</span><span class="p">,</span> <span class="n">alpha</span> <span class="o">=</span> <span class="mf">0.2</span><span class="p">)</span>
<br/></pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/p01-05-ngu-phap-bieu-do_68_0.png" class="no-scaled-link" src="_images/p01-05-ngu-phap-bieu-do_68_0.png" style="width: 640px; height: 480px;" />
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[36]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
&lt;Figure Size: (640 x 480)&gt;
</pre></div></div>
</div>
</section>
<section id="Hiển-thị-text-biểu-đồ-ở-giữa-bar-chart">
<h3><span class="section-number">5.3.4. </span>Hiển thị text biểu đồ ở giữa bar chart<a class="headerlink" href="#Hiển-thị-text-biểu-đồ-ở-giữa-bar-chart" title="Link to this heading"></a></h3>
<ul class="simple">
<li><p>Sử dụng option <code class="docutils literal notranslate"><span class="pre">position</span> <span class="pre">=</span> <span class="pre">position_stack(vjust</span> <span class="pre">=</span> <span class="pre">0.5)</span></code></p></li>
</ul>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[37]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">df</span> <span class="o">=</span> <span class="n">mpg</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s2">&quot;class&quot;</span><span class="p">)</span><span class="o">.</span>\
  <span class="n">size</span><span class="p">()</span><span class="o">.</span>\
  <span class="n">reset_index</span><span class="p">(</span><span class="n">name</span> <span class="o">=</span> <span class="s2">&quot;no&quot;</span><span class="p">)</span>
<span class="n">df</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area stderr docutils container">
<div class="highlight"><pre>
C:\Users\Hoang Duc Anh\AppData\Local\Temp\ipykernel_21780\179534537.py:1: FutureWarning: The default of observed=False is deprecated and will be changed to True in a future version of pandas. Pass observed=False to retain current behavior or observed=True to adopt the future default and silence this warning.
</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[37]:
</pre></div>
</div>
<div class="output_area rendered_html docutils container">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>class</th>
      <th>no</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>2seater</td>
      <td>5</td>
    </tr>
    <tr>
      <th>1</th>
      <td>compact</td>
      <td>47</td>
    </tr>
    <tr>
      <th>2</th>
      <td>midsize</td>
      <td>41</td>
    </tr>
    <tr>
      <th>3</th>
      <td>minivan</td>
      <td>11</td>
    </tr>
    <tr>
      <th>4</th>
      <td>pickup</td>
      <td>33</td>
    </tr>
    <tr>
      <th>5</th>
      <td>subcompact</td>
      <td>35</td>
    </tr>
    <tr>
      <th>6</th>
      <td>suv</td>
      <td>62</td>
    </tr>
  </tbody>
</table>
</div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[38]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">ggplot</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="n">aes</span><span class="p">(</span><span class="s2">&quot;class&quot;</span><span class="p">,</span> <span class="s2">&quot;no&quot;</span><span class="p">))</span> <span class="o">+</span>\
  <span class="n">geom_bar</span><span class="p">(</span><span class="n">stat</span> <span class="o">=</span> <span class="s2">&quot;identity&quot;</span><span class="p">,</span> <span class="n">fill</span> <span class="o">=</span> <span class="s2">&quot;darkblue&quot;</span><span class="p">,</span> <span class="n">alpha</span> <span class="o">=</span> <span class="mf">0.6</span><span class="p">)</span> <span class="o">+</span>\
  <span class="n">geom_text</span><span class="p">(</span><span class="n">aes</span><span class="p">(</span><span class="n">label</span> <span class="o">=</span> <span class="s2">&quot;no&quot;</span><span class="p">),</span> <span class="n">position</span> <span class="o">=</span> <span class="n">position_stack</span><span class="p">(</span><span class="n">vjust</span> <span class="o">=</span> <span class="mf">0.5</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/p01-05-ngu-phap-bieu-do_71_0.png" class="no-scaled-link" src="_images/p01-05-ngu-phap-bieu-do_71_0.png" style="width: 640px; height: 480px;" />
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[38]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
&lt;Figure Size: (640 x 480)&gt;
</pre></div></div>
</div>
</section>
</section>
<section id="Các-package-bổ-trợ">
<h2><span class="section-number">5.4. </span>Các package bổ trợ<a class="headerlink" href="#Các-package-bổ-trợ" title="Link to this heading"></a></h2>
<section id="Kết-hợp-nhiều-biểu-đồ-với-patchworklib">
<h3><span class="section-number">5.4.1. </span>Kết hợp nhiều biểu đồ với <code class="docutils literal notranslate"><span class="pre">patchworklib</span></code><a class="headerlink" href="#Kết-hợp-nhiều-biểu-đồ-với-patchworklib" title="Link to this heading"></a></h3>
<p>Khi trực quan hóa dữ liệu, ta có thể kết hợp nhiều biểu đồ với nhau để thành 1 biểu đồ duy nhất. Để kết hợp các biểu đồ của <code class="docutils literal notranslate"><span class="pre">ggplotnine</span></code>, ta có thể sử dụng package <code class="docutils literal notranslate"><span class="pre">patchworklib</span></code>.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[39]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">patchworklib</span> <span class="k">as</span> <span class="nn">pw</span>
<span class="kn">from</span> <span class="nn">plotnine.data</span> <span class="kn">import</span> <span class="n">mtcars</span>
<span class="kn">from</span> <span class="nn">plotnine</span> <span class="kn">import</span> <span class="o">*</span>

<span class="n">p1</span> <span class="o">=</span> <span class="p">(</span><span class="n">ggplot</span><span class="p">(</span><span class="n">mtcars</span><span class="p">,</span> <span class="n">aes</span><span class="p">(</span><span class="s2">&quot;mpg&quot;</span><span class="p">,</span> <span class="s2">&quot;cyl&quot;</span><span class="p">))</span> <span class="o">+</span>\
    <span class="n">geom_point</span><span class="p">(</span><span class="n">aes</span><span class="p">(</span><span class="n">color</span> <span class="o">=</span> <span class="s2">&quot;factor(vs)&quot;</span><span class="p">),</span> <span class="n">size</span> <span class="o">=</span> <span class="mi">4</span><span class="p">)</span> <span class="o">+</span>\
    <span class="n">theme_minimal</span><span class="p">())</span>
<span class="n">p2</span> <span class="o">=</span> <span class="p">(</span><span class="n">ggplot</span><span class="p">(</span><span class="n">mtcars</span><span class="p">,</span> <span class="n">aes</span><span class="p">(</span><span class="s2">&quot;mpg&quot;</span><span class="p">,</span> <span class="s2">&quot;disp&quot;</span><span class="p">))</span> \
        <span class="o">+</span> <span class="n">geom_point</span><span class="p">(</span><span class="n">color</span> <span class="o">=</span> <span class="s2">&quot;darkblue&quot;</span><span class="p">,</span> <span class="n">alpha</span> <span class="o">=</span> <span class="mf">0.3</span><span class="p">,</span> <span class="n">size</span> <span class="o">=</span> <span class="mi">2</span><span class="p">)</span> \
        <span class="o">+</span> <span class="n">geom_smooth</span><span class="p">(</span><span class="n">color</span> <span class="o">=</span> <span class="s2">&quot;darkred&quot;</span><span class="p">)</span> \
        <span class="o">+</span> <span class="n">theme_minimal</span><span class="p">())</span>
<span class="n">p3</span> <span class="o">=</span> <span class="p">(</span><span class="n">ggplot</span><span class="p">(</span><span class="n">mtcars</span><span class="p">,</span> <span class="n">aes</span><span class="p">(</span><span class="s2">&quot;factor(vs)&quot;</span><span class="p">,</span> <span class="s2">&quot;mpg&quot;</span><span class="p">))</span> \
     <span class="o">+</span> <span class="n">geom_boxplot</span><span class="p">(</span><span class="n">aes</span><span class="p">(</span><span class="n">fill</span> <span class="o">=</span> <span class="s2">&quot;factor(vs)&quot;</span><span class="p">))</span> \
     <span class="o">+</span> <span class="n">theme_minimal</span><span class="p">())</span>
</pre></div>
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[40]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Load object plotnine</span>
<span class="n">p1_new</span> <span class="o">=</span> <span class="n">pw</span><span class="o">.</span><span class="n">load_ggplot</span><span class="p">(</span><span class="n">p1</span><span class="p">,</span> <span class="n">figsize</span> <span class="o">=</span> <span class="p">(</span><span class="mi">4</span><span class="p">,</span> <span class="mi">5</span><span class="p">))</span>
<span class="n">p2_new</span> <span class="o">=</span> <span class="n">pw</span><span class="o">.</span><span class="n">load_ggplot</span><span class="p">(</span><span class="n">p2</span><span class="p">,</span> <span class="n">figsize</span> <span class="o">=</span> <span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">))</span>
<span class="n">p3_new</span> <span class="o">=</span> <span class="n">pw</span><span class="o">.</span><span class="n">load_ggplot</span><span class="p">(</span><span class="n">p3</span><span class="p">,</span> <span class="n">figsize</span> <span class="o">=</span> <span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[41]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Kết hợp biểu đồ</span>
<span class="n">p1_new</span> <span class="o">+</span> <span class="p">(</span><span class="n">p2_new</span> <span class="o">/</span> <span class="n">p3_new</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[41]:
</pre></div>
</div>
<div class="output_area docutils container">
<img alt="_images/p01-05-ngu-phap-bieu-do_76_0.png" src="_images/p01-05-ngu-phap-bieu-do_76_0.png" />
</div>
</div>
</section>
<section id="Biểu-đồ-động-với-lets-plot">
<h3><span class="section-number">5.4.2. </span>Biểu đồ động với lets-plot<a class="headerlink" href="#Biểu-đồ-động-với-lets-plot" title="Link to this heading"></a></h3>
<p>Ta có thể tạo biểu đồ theo dạng plotnine động với <code class="docutils literal notranslate"><span class="pre">lets-plot</span></code></p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[42]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">lets_plot</span> <span class="kn">import</span> <span class="o">*</span>
<span class="n">LetsPlot</span><span class="o">.</span><span class="n">setup_html</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area rendered_html docutils container">
<div id="bOi8xe"></div>
<script type="text/javascript" data-lets-plot-script="library">
    if(!window.letsPlotCallQueue) {
        window.letsPlotCallQueue = [];
    };
    window.letsPlotCall = function(f) {
        window.letsPlotCallQueue.push(f);
    };
    (function() {
        var script = document.createElement("script");
        script.type = "text/javascript";
        script.src = "https://cdn.jsdelivr.net/gh/JetBrains/lets-plot@v4.3.1/js-package/distr/lets-plot.min.js";
        script.onload = function() {
            window.letsPlotCall = function(f) {f();};
            window.letsPlotCallQueue.forEach(function(f) {f();});
            window.letsPlotCallQueue = [];

        };
        script.onerror = function(event) {
            window.letsPlotCall = function(f) {};    // noop
            window.letsPlotCallQueue = [];
            var div = document.createElement("div");
            div.style.color = 'darkred';
            div.textContent = 'Error loading Lets-Plot JS';
            document.getElementById("bOi8xe").appendChild(div);
        };
        var e = document.getElementById("bOi8xe");
        e.appendChild(script);
    })()
</script></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[43]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">ggplot</span><span class="p">(</span><span class="n">mpg</span><span class="p">,</span> <span class="n">aes</span><span class="p">(</span><span class="s2">&quot;class&quot;</span><span class="p">,</span> <span class="s2">&quot;displ&quot;</span><span class="p">))</span> <span class="o">+</span>\
    <span class="n">geom_boxplot</span><span class="p">(</span><span class="n">aes</span><span class="p">(</span><span class="n">fill</span> <span class="o">=</span> <span class="s2">&quot;class&quot;</span><span class="p">))</span> <span class="o">+</span>\
    <span class="n">coord_flip</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[43]:
</pre></div>
</div>
<div class="output_area rendered_html docutils container">
   <div id="1r0rLy"></div>
   <script type="text/javascript" data-lets-plot-script="plot">
       (function() {
           var plotSpec={
"data":{
},
"mapping":{
"x":"class",
"y":"displ"
},
"data_meta":{
},
"coord":{
"name":"flip",
"flip":true
},
"kind":"plot",
"scales":[],
"layers":[{
"geom":"boxplot",
"mapping":{
"fill":"class"
},
"data_meta":{
},
"data":{
"..middle..":[2.2,2.8,4.65,6.2,3.3,4.7,2.2],
"..lower..":[2.0,2.4,4.0,5.7,3.3,3.9,1.9],
"..upper..":[2.8,3.5,5.3,6.2,3.8,4.7,3.25],
"..ymin..":[1.8,1.8,2.5,5.7,3.0,2.7,1.6],
"..ymax..":[3.3,4.2,6.5,6.2,4.0,5.9,4.6],
"class":["compact","midsize","suv","2seater","minivan","pickup","subcompact"]
}
},{
"geom":"point",
"stat":"boxplot_outlier",
"mapping":{
"fill":"class"
},
"show_legend":false,
"data_meta":{
},
"data":{
"..middle..":[2.2,2.8,4.65,6.2,3.3,4.7,2.2],
"..lower..":[2.0,2.4,4.0,5.7,3.3,3.9,1.9],
"..upper..":[2.8,3.5,5.3,6.2,3.8,4.7,3.25],
"..ymin..":[1.8,1.8,2.5,5.7,3.0,2.7,1.6],
"..ymax..":[3.3,4.2,6.5,6.2,4.0,5.9,4.6],
"class":["compact","midsize","suv","2seater","minivan","pickup","subcompact"],
"displ":[NaN,5.3,NaN,7.0,2.4,NaN,5.4]
}
}],
"metainfo_list":[]
};
           var plotContainer = document.getElementById("1r0rLy");
           window.letsPlotCall(function() {{
               LetsPlot.buildPlotFromProcessedSpecs(plotSpec, -1, -1, plotContainer);
           }});
       })();
   </script></div>
</div>
<p>Các cú pháp của <code class="docutils literal notranslate"><span class="pre">lets-plot</span></code> tương tự như <code class="docutils literal notranslate"><span class="pre">plotnine</span></code> và hỗ trợ rất tốt dạng biểu đồ động. Tuy nhiên, <code class="docutils literal notranslate"><span class="pre">lets-plot</span></code> chưa hỗ trợ nhiều các option tùy biến. Khi làm việc thực tế, ta có thể sử dụng cả 2 tùy trường hợp</p>
</section>
</section>
<section id="Tài-liệu-tham-khảo">
<h2><span class="section-number">5.5. </span>Tài liệu tham khảo<a class="headerlink" href="#Tài-liệu-tham-khảo" title="Link to this heading"></a></h2>
<ul class="simple">
<li><p><a class="reference external" href="https://aeturrell.github.io/python4DS/data-visualise.html">https://aeturrell.github.io/python4DS/data-visualise.html</a></p></li>
<li><p><a class="reference external" href="https://lets-plot.org/python/index.html">https://lets-plot.org/python/index.html</a></p></li>
<li><p><a class="reference external" href="https://plotnine.org/reference/">https://plotnine.org/reference/</a></p></li>
</ul>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="p01-04-pandas.html" class="btn btn-neutral float-left" title="4. Pandas" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="p01-06-datetime.html" class="btn btn-neutral float-right" title="6. Dữ liệu thời gian trong Python" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2022, Anh Hoang Duc.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>