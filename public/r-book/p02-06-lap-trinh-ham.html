

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="vi" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="vi" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>4. Lập trình hàm &mdash; Tài liệu Phân tích dữ liệu với R 2019</title>
  

  
  
  
  

  
  <script type="text/javascript" src="_static/js/modernizr.min.js"></script>
  
    
      <script type="text/javascript">
          var DOCUMENTATION_OPTIONS = {
              URL_ROOT:'./',
              VERSION:'2019',
              LANGUAGE:'vi',
              COLLAPSE_INDEX:false,
              FILE_SUFFIX:'.html',
              HAS_SOURCE:  true,
              SOURCELINK_SUFFIX: '.txt'
          };
      </script>
        <script type="text/javascript" src="_static/jquery.js"></script>
        <script type="text/javascript" src="_static/underscore.js"></script>
        <script type="text/javascript" src="_static/doctools.js"></script>
        <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.0/clipboard.min.js"></script>
        <script type="text/javascript" src="_static/copybutton.js"></script>
        <script type="text/javascript" src="_static/translations.js"></script>
        <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
    
    <script type="text/javascript" src="_static/js/theme.js"></script>

    

  
  <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="_static/copybutton.css" type="text/css" />
  <link rel="stylesheet" href="_static/css/custom.css" type="text/css" />
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Tìm Kiếm" href="search.html" />
    <link rel="next" title="5. Lập trình chức năng hàm với purrr" href="p02-07-lap-trinh-ham-voi-purrr.html" />
    <link rel="prev" title="3. Các chỉ số thống kê mô tả cơ bản" href="p02-05-cac-chi-so-thong-ke.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="index.html" class="icon icon-home"> Phân tích dữ liệu với R
          

          
          </a>

          
            
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <p class="caption"><span class="caption-text">Giới thiệu</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="p01-01-gioi-thieu.html">Khoa học dữ liệu và nghề phân tích dữ liệu</a></li>
</ul>
<p class="caption"><span class="caption-text">Phân tích khám phá dữ liệu</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="p02-03-bien-doi-du-lieu-dplyr.html">1. Ngữ pháp của biến đổi dữ liệu với DPLYR</a></li>
<li class="toctree-l1"><a class="reference internal" href="p02-04-phan-ra-va-xoay-chieu-du-lieu.html">2. Phân rã và xoay chiều dữ liệu</a></li>
<li class="toctree-l1"><a class="reference internal" href="p02-05-cac-chi-so-thong-ke.html">3. Các chỉ số thống kê mô tả cơ bản</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">4. Lập trình hàm</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#co-ban-ve-ham">4.1. Cơ bản về hàm</a></li>
<li class="toctree-l2"><a class="reference internal" href="#quotes-vs-unquotes">4.2. <strong>Quotes</strong> vs.&nbsp;<strong>Unquotes</strong></a></li>
<li class="toctree-l2"><a class="reference internal" href="#truong-hop-dung-quo-name">4.3. Trường hợp dùng <code class="docutils literal notranslate"><span class="pre">quo_name</span></code></a></li>
<li class="toctree-l2"><a class="reference internal" href="#truong-hop-nhieu-bien">4.4. Trường họp nhiều biến</a></li>
<li class="toctree-l2"><a class="reference internal" href="#ung-dung">4.5. Ứng dụng</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#ham-tinh-toan-tong-hop-nhieu-bien">4.5.1. Hàm tính toán tổng hợp nhiều biến</a></li>
<li class="toctree-l3"><a class="reference internal" href="#ve-do-thi-voi-ggplot2">4.5.2. Vẽ đồ thị với ggplot2</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="p02-07-lap-trinh-ham-voi-purrr.html">5. Lập trình chức năng hàm với purrr</a></li>
<li class="toctree-l1"><a class="reference internal" href="p02-08-bien-doi-du-lieu-text.html">6. Biến đổi dữ liệu text</a></li>
<li class="toctree-l1"><a class="reference internal" href="p02-11-quan-ly-nhieu-mo-hinh.html">7. Quản lý kết quả phân tích từ nhiều mô hình</a></li>
<li class="toctree-l1"><a class="reference internal" href="p02-15-thong-ke-co-ban.html">8. Xác suất và phân phối thống kê cơ bản</a></li>
<li class="toctree-l1"><a class="reference internal" href="p02-16-power-analysis.html">9. Power analysis</a></li>
<li class="toctree-l1"><a class="reference internal" href="p02-20-sampling-methods.html">10. Phương pháp ước lượng lấy mẫu</a></li>
<li class="toctree-l1"><a class="reference internal" href="p02-50-datatable.html">11. Biến đổi dữ liệu với <code class="docutils literal notranslate"><span class="pre">data.table</span></code></a></li>
<li class="toctree-l1"><a class="reference internal" href="p02-60-thu-thap-du-lieu-tu-website.html">12. Thu thập dữ liệu từ website</a></li>
<li class="toctree-l1"><a class="reference internal" href="p02-99-meo-trong-r.html">13. Các mẹo trong R</a></li>
</ul>
<p class="caption"><span class="caption-text">Supervised learning</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="p03-01-nguyen-ly-du-bao.html">1. Các nguyên lý dự báo</a></li>
<li class="toctree-l1"><a class="reference internal" href="p03-02-mo-hinh-ols.html">2. Mô hình OLS</a></li>
<li class="toctree-l1"><a class="reference internal" href="p03-03-logistic-regression.html">3. Mô hình hồi quy logistic</a></li>
<li class="toctree-l1"><a class="reference internal" href="p03-04-decision-tree.html">4. Cây quyết định</a></li>
<li class="toctree-l1"><a class="reference internal" href="p03-05-bagging-boosting.html">5. Bagging, RandomForest và Boosting</a></li>
<li class="toctree-l1"><a class="reference internal" href="p03-07-xay-dung-mo-hinh-voi-h2o.html">6. Xây dựng mô hình với H2O</a></li>
<li class="toctree-l1"><a class="reference internal" href="p03-08-svm.html">7. Support Vector Machine</a></li>
<li class="toctree-l1"><a class="reference internal" href="p03-09-feature-engineering.html">8. Feature Engineering</a></li>
<li class="toctree-l1"><a class="reference internal" href="p03-15-regularization.html">9. Regularization</a></li>
<li class="toctree-l1"><a class="reference internal" href="p03-17-nonlinear.html">10. Mô hình phi tuyến tính</a></li>
<li class="toctree-l1"><a class="reference internal" href="p03-30-credit-scoring.html">11. Credit Scoring</a></li>
<li class="toctree-l1"><a class="reference internal" href="p03-35-caret.html">12. Xây dựng mô hình dự báo với caret</a></li>
<li class="toctree-l1"><a class="reference internal" href="p03-65-chat-luong-mo-hinh.html">13. Chất lượng mô hình</a></li>
<li class="toctree-l1"><a class="reference internal" href="p03-70-tidymodels.html">14. Tidymodels</a></li>
</ul>
<p class="caption"><span class="caption-text">Unsupervised learning</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="p04-01-unsupervised-learning.html">1. Unsupervised learning</a></li>
<li class="toctree-l1"><a class="reference internal" href="p04-02-kmeans.html">2. k-means</a></li>
<li class="toctree-l1"><a class="reference internal" href="p04-03-hierarchical-clustering.html">3. Hierachical clustering</a></li>
<li class="toctree-l1"><a class="reference internal" href="p04-04-basket-analysis.html">4. Phân tích giỏ hàng</a></li>
<li class="toctree-l1"><a class="reference internal" href="p04-05-pca.html">5. Principal component analysis</a></li>
<li class="toctree-l1"><a class="reference internal" href="p04-06-factor-analysis.html">6. Phân tích nhân tố ẩn (factor analysis)</a></li>
</ul>
<p class="caption"><span class="caption-text">Chuỗi thời gian</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="p05-01-chuoi-thoi-gian.html">1. Giới thiệu về chuỗi thời gian</a></li>
<li class="toctree-l1"><a class="reference internal" href="p05-02-arima.html">2. Mô hình ARIMA</a></li>
<li class="toctree-l1"><a class="reference internal" href="p05-03-phan-tich-chuoi-thoi-gian-voi-tidyquant.html">3. Phân tích chuỗi thời gian với tidyquant và timetk</a></li>
<li class="toctree-l1"><a class="reference internal" href="p05-06-du-bao-ts-voi-prophet.html">4. Dự báo chuỗi thời gian với prophet</a></li>
<li class="toctree-l1"><a class="reference internal" href="p05-07-du-bao-ts-voi-timetk.html">5. Dự báo chuỗi thời gian với timetk</a></li>
<li class="toctree-l1"><a class="reference internal" href="p05-08-abnomaly-detection.html">6. Abnomaly detection trong times series</a></li>
</ul>
<p class="caption"><span class="caption-text">Ngôn ngữ tự nghiên</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="p06-01-nlp-co-ban.html">1. Xử lý ngôn ngữ tự nhiên cơ bản</a></li>
<li class="toctree-l1"><a class="reference internal" href="p06-04-text-classification.html">2. Phân loại text</a></li>
<li class="toctree-l1"><a class="reference internal" href="p06-07-nlp-api.html">3. Sử dụng API từ các dịch vụ đám mây</a></li>
<li class="toctree-l1"><a class="reference internal" href="p06-10-ocr-tesseract.html">4. OCR với <code class="docutils literal notranslate"><span class="pre">tesseract</span></code></a></li>
</ul>
<p class="caption"><span class="caption-text">Các phương pháp khác</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="p07-01-survival-analysis.html">1. Survival analysis</a></li>
<li class="toctree-l1"><a class="reference internal" href="p07-02-causal-impact.html">2. Causal Impact</a></li>
<li class="toctree-l1"><a class="reference internal" href="p07-03-collaborative-filtering.html">3. Collaborative Filtering</a></li>
<li class="toctree-l1"><a class="reference internal" href="p07-07-spatial-data.html">4. Spatial data</a></li>
<li class="toctree-l1"><a class="reference internal" href="p07-10-shiny.html">5. Shiny apps</a></li>
</ul>
<p class="caption"><span class="caption-text">Deep Learning</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="p09-01-gioi-thieu-deep-learning.html">1. Giới thiệu cơ bản về Deep Learning</a></li>
<li class="toctree-l1"><a class="reference internal" href="p09-02-co-ban-kien-thuc-toan.html">2. Kiến thức cơ bản toán học cho deep learning</a></li>
<li class="toctree-l1"><a class="reference internal" href="p09-03-mo-hinh-deep-learning-co-ban.html">3. Mô hình deep learning cơ bản</a></li>
<li class="toctree-l1"><a class="reference internal" href="p09-04-convolution-neural-network.html">4. Convolution neural networks</a></li>
</ul>
<p class="caption"><span class="caption-text">Cloud Computing</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="p10-01-cai-dat-rstudio-server-tren-amazon.html">1. Cài đặt server RStudio trên Amazon</a></li>
<li class="toctree-l1"><a class="reference internal" href="p10-03-web-service-azure.html">2. Xây dựng web service với Azure</a></li>
<li class="toctree-l1"><a class="reference internal" href="p10-09-apis-voi-plumber.html">3. API với Plumber</a></li>
</ul>
<p class="caption"><span class="caption-text">Kiến thức bổ trợ</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="p11-01-git.html">1. Sử dụng GIT</a></li>
<li class="toctree-l1"><a class="reference internal" href="p11-02-cmd.html">2. CMD và Bash</a></li>
<li class="toctree-l1"><a class="reference internal" href="p11-03-docker.html">3. Sử dụng docker</a></li>
<li class="toctree-l1"><a class="reference internal" href="p11-04-apis.html">4. API</a></li>
<li class="toctree-l1"><a class="reference internal" href="p11-05-html-css.html">5. Cơ bản về HTML và CSS</a></li>
<li class="toctree-l1"><a class="reference internal" href="p11-09-other.html">6. Các tricks khác</a></li>
</ul>
<p class="caption"><span class="caption-text">Case studies</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="p13-01-casestudy-truc-quan-hoa.html">1. Trực quan hóa dữ liệu</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">Phân tích dữ liệu với R</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="index.html">Docs</a> &raquo;</li>
        
      <li>4. Lập trình hàm</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="_sources/p02-06-lap-trinh-ham.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  
<style>
/* CSS overrides for sphinx_rtd_theme */

/* 24px margin */
.nbinput.nblast,
.nboutput.nblast {
    margin-bottom: 19px;  /* padding has already 5px */
}

/* ... except between code cells! */
.nblast + .nbinput {
    margin-top: -19px;
}

.admonition > p:before {
    margin-right: 4px;  /* make room for the exclamation icon */
}

/* Fix math alignment, see https://github.com/rtfd/sphinx_rtd_theme/pull/686 */
.math {
    text-align: unset;
}
</style>
<div class="section" id="lap-trinh-ham">
<h1>4. Lập trình hàm<a class="headerlink" href="#lap-trinh-ham" title="Permalink to this headline">¶</a></h1>
<p>Khi phân tích dữ liệu, một kỹ năng nâng cao giúp tăng năng suất phân
tích là kỹ năng viết hàm. Về lý thuyết, bất cứ đoạn code nào cũng có thể
chuyển thành hàm. Một hàm viết tốt phải đảm bảo 3 yếu tố chính:</p>
<ul class="simple">
<li><strong>Linh động</strong>: Có thể sử dụng trong nhiều tập dữ liệu khác nhau</li>
<li><strong>Ngắn gọn</strong>: Chỉ giải quyết 1 vấn đề cụ thể, không nên cho quá nhiều
vấn đề trong một hàm.</li>
<li><strong>Mở rộng</strong>: Có thể mở rộng khi tăng số biến và giải quyết được vấn
đề tổng quát</li>
</ul>
<p>Việc viết hàm là cả một nghệ thuật và đòi hỏi có sự hiểu biết sâu sắc về
R. Tuy nhiên, khi đứng dưới góc độ ứng dụng, ta có thể viết hàm một cách
nhanh chóng dựa trên khái niệm về NSE (Non Standard Evaluation).</p>
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span>df <span class="o">&lt;-</span> <span class="kt">data.frame</span><span class="p">(</span>x <span class="o">=</span> <span class="m">1</span><span class="o">:</span><span class="m">3</span><span class="p">,</span> y <span class="o">=</span> <span class="m">3</span><span class="o">:</span><span class="m">1</span><span class="p">)</span>
filter<span class="p">(</span>df<span class="p">,</span> x <span class="o">==</span> <span class="m">3</span><span class="p">)</span>
</pre></div>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1">##   x y</span>
<span class="c1">## 1 3 1</span>
</pre></div>
</div>
<p>Tuy nhiên, câu lệnh sau sẽ không hoạt động</p>
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="c1"># Cách 1: Không hoạt động</span>
my_var <span class="o">&lt;-</span> x
</pre></div>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1">## Error in eval(expr, envir, enclos): object &#39;x&#39; not found</span>
</pre></div>
</div>
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span>df <span class="o">%&gt;%</span> filter<span class="p">(</span>my_var <span class="o">==</span> <span class="m">1</span><span class="p">)</span>
</pre></div>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1">## Error: Evaluation error: object &#39;my_var&#39; not found.</span>
</pre></div>
</div>
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="c1"># Cách 2: Không hoạt động</span>
my_var <span class="o">&lt;-</span> <span class="s">&quot;x&quot;</span>
df <span class="o">%&gt;%</span> filter<span class="p">(</span>my_var <span class="o">==</span> <span class="m">1</span><span class="p">)</span>
</pre></div>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1">## [1] x y</span>
<span class="c1">## &lt;0 rows&gt; (or 0-length row.names)</span>
</pre></div>
</div>
<div class="section" id="co-ban-ve-ham">
<h2>4.1. Cơ bản về hàm<a class="headerlink" href="#co-ban-ve-ham" title="Permalink to this headline">¶</a></h2>
<p>Ba thành phần cơ bản của hàm:</p>
<ul class="simple">
<li><strong>body()</strong>: Code trong hàm</li>
<li><strong>fomals()</strong>: Tham số trong hàm</li>
<li><strong>environment()</strong>: Môi trường của hàm</li>
</ul>
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="kn">library</span><span class="p">(</span>dplyr<span class="p">)</span>
squared <span class="o">&lt;-</span> <span class="kr">function</span><span class="p">(</span>x<span class="p">){</span><span class="kr">return</span><span class="p">(</span>x<span class="o">^</span><span class="m">2</span><span class="p">)}</span>
squared<span class="p">(</span><span class="m">4</span><span class="p">)</span>
</pre></div>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1">## [1] 16</span>
</pre></div>
</div>
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span>squared <span class="o">%&gt;%</span> <span class="kp">body</span>
</pre></div>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1">## {</span>
<span class="c1">##     return(x^2)</span>
<span class="c1">## }</span>
</pre></div>
</div>
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span>squared <span class="o">%&gt;%</span> <span class="kp">formals</span>
</pre></div>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1">## $x</span>
</pre></div>
</div>
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span>squared <span class="o">%&gt;%</span> <span class="kp">environment</span><span class="p">()</span>
</pre></div>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1">## &lt;environment: R_GlobalEnv&gt;</span>
</pre></div>
</div>
<p><strong>Primitive function</strong>: Là các hàm được thực hiện thẳng từ
<code class="docutils literal notranslate"><span class="pre">.Primitive()</span></code> trên R base và không có các thành phần cơ bản của hàm,
vd: sum, sin, cos…</p>
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span>sum <span class="o">%&gt;%</span> <span class="kp">formals</span><span class="p">()</span>
</pre></div>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1">## NULL</span>
</pre></div>
</div>
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span>sin <span class="o">%&gt;%</span> <span class="kp">body</span><span class="p">()</span>
</pre></div>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1">## NULL</span>
</pre></div>
</div>
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span>cos <span class="o">%&gt;%</span> <span class="kp">environment</span><span class="p">()</span>
</pre></div>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1">## NULL</span>
</pre></div>
</div>
<p><strong>Infix function</strong></p>
<p>Các hàm trong R phần lớn đều là <code class="docutils literal notranslate"><span class="pre">prefix</span> <span class="pre">function</span></code>, nghĩa là tên hàm sẽ
đứng trước tham số. Tuy nhiên ta có thể tạo ra <strong>infix function</strong> với
các ký tự <code class="docutils literal notranslate"><span class="pre">%name_function%</span></code>. Loại hàm này có thể sử dụng như các toán
từ +, X trong toán học. Infix function có kết cấu như sau:</p>
<p><strong>``%Toán tử%``</strong> = Hàm</p>
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="c1">#Prefix function</span>
bin_string <span class="o">&lt;-</span> <span class="kr">function</span><span class="p">(</span>a<span class="p">,</span> b<span class="p">)</span> <span class="p">{</span><span class="kp">paste</span><span class="p">(</span>a<span class="p">,</span> b<span class="p">,</span> sep <span class="o">=</span> <span class="s">&quot; &quot;</span><span class="p">)}</span>
bin_string<span class="p">(</span><span class="s">&quot;He&quot;</span><span class="p">,</span> <span class="s">&quot;lo&quot;</span><span class="p">)</span>
</pre></div>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1">## [1] &quot;He lo&quot;</span>
</pre></div>
</div>
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="c1">#Infix function</span>
<span class="sb">`%+%`</span> <span class="o">&lt;-</span> <span class="kr">function</span><span class="p">(</span>a<span class="p">,</span> b<span class="p">)</span> <span class="p">{</span><span class="kp">paste</span><span class="p">(</span>a<span class="p">,</span> b<span class="p">,</span> sep <span class="o">=</span> <span class="s">&quot; &quot;</span><span class="p">)}</span>
<span class="s">&quot;He&quot;</span> <span class="o">%+%</span> <span class="s">&quot;lo&quot;</span>
</pre></div>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1">## [1] &quot;He lo&quot;</span>
</pre></div>
</div>
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="sb">`%+%`</span><span class="p">(</span><span class="s">&quot;He&quot;</span><span class="p">,</span> <span class="s">&quot;Lo&quot;</span><span class="p">)</span>
</pre></div>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1">## [1] &quot;He Lo&quot;</span>
</pre></div>
</div>
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="c1">#Ví dụ</span>
<span class="m">5</span> <span class="o">+</span> <span class="m">6</span>
</pre></div>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1">## [1] 11</span>
</pre></div>
</div>
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="sb">`+`</span><span class="p">(</span><span class="m">5</span><span class="p">,</span><span class="m">6</span><span class="p">)</span>
</pre></div>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1">## [1] 11</span>
</pre></div>
</div>
</div>
<div class="section" id="quotes-vs-unquotes">
<h2>4.2. <strong>Quotes</strong> vs.&nbsp;<strong>Unquotes</strong><a class="headerlink" href="#quotes-vs-unquotes" title="Permalink to this headline">¶</a></h2>
<ul class="simple">
<li><strong>Quotes</strong> là cách thức biến chỉ được lưu dưới dạng <em>string</em> mà chưa
đề cập đến giá trị mà biến đó chứa.</li>
<li><strong>Unquote</strong> là việc tính toán giá trị mà biến thực sự lưu trữ.</li>
</ul>
<p>Ví dụ, <code class="docutils literal notranslate"><span class="pre">x</span> <span class="pre">&lt;-</span> <span class="pre">5</span></code> thì <code class="docutils literal notranslate"><span class="pre">&quot;x&quot;</span></code> là quote vì chỉ lưu tên của biến dưới dạng
string. <code class="docutils literal notranslate"><span class="pre">x</span> <span class="pre">=</span> <span class="pre">5</span></code> là unquote vì đã tính đến giá trị thực sự mà x lưu trữ
là 5.</p>
<p>Xem thêm ví dụ sau:</p>
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span>greet <span class="o">&lt;-</span> <span class="kr">function</span><span class="p">(</span>name<span class="p">){</span>
  <span class="kp">print</span><span class="p">(</span><span class="s">&quot;Hello, name!&quot;</span><span class="p">)</span>
<span class="p">}</span>
greet<span class="p">(</span><span class="s">&quot;duc anh&quot;</span><span class="p">)</span>
</pre></div>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1">## [1] &quot;Hello, name!&quot;</span>
</pre></div>
</div>
<p>Hàm trên không hoạt động như chúng ta mong muốn vì <code class="docutils literal notranslate"><span class="pre">name</span></code> đang được
<code class="docutils literal notranslate"><span class="pre">quotes</span></code> và chỉ lưu trữ dưới dạng string.</p>
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span>greet <span class="o">&lt;-</span> <span class="kr">function</span><span class="p">(</span>name<span class="p">){</span>
  glue<span class="o">::</span>glue<span class="p">(</span><span class="s">&quot;Hello, {name}!&quot;</span><span class="p">)</span>
<span class="p">}</span>
greet<span class="p">(</span><span class="s">&quot;duc anh&quot;</span><span class="p">)</span>
</pre></div>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1">## Hello, duc anh!</span>
</pre></div>
</div>
<p>Ở hàm thứ hai, <code class="docutils literal notranslate"><span class="pre">name</span></code> được tính toán đến giá trị thực sự mà biến này
đang lưu trữ (giá trị <code class="docutils literal notranslate"><span class="pre">duc</span> <span class="pre">anh</span></code>).</p>
<hr class="docutils" />
<p>Để <code class="docutils literal notranslate"><span class="pre">quotes</span></code>, ta dùng hàm <code class="docutils literal notranslate"><span class="pre">quo()</span></code>. Kết quả của <code class="docutils literal notranslate"><span class="pre">quo()</span></code> là
<code class="docutils literal notranslate"><span class="pre">quosure</span></code>, một dạng của biểu thức (formula).</p>
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span>quo<span class="p">(</span>x<span class="p">)</span>
</pre></div>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1">## &lt;quosure&gt;</span>
<span class="c1">## expr: ^x</span>
<span class="c1">## env:  global</span>
</pre></div>
</div>
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span>quo<span class="p">(</span>a <span class="o">+</span> b <span class="o">+</span> <span class="kt">c</span><span class="p">)</span>
</pre></div>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1">## &lt;quosure&gt;</span>
<span class="c1">## expr: ^a + b + c</span>
<span class="c1">## env:  global</span>
</pre></div>
</div>
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span>quo<span class="p">(</span><span class="s">&quot;group_var&quot;</span><span class="p">)</span>
</pre></div>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1">## &lt;quosure&gt;</span>
<span class="c1">## expr: ^&quot;group_var&quot;</span>
<span class="c1">## env:  empty</span>
</pre></div>
</div>
<p>Để sử dụng <code class="docutils literal notranslate"><span class="pre">quosure</span></code> trong hàm, ta sử dụng <code class="docutils literal notranslate"><span class="pre">enquo</span></code>. Sự khác biệt
giữa <code class="docutils literal notranslate"><span class="pre">quo</span></code> và <code class="docutils literal notranslate"><span class="pre">enquo</span></code> có thể phân cấp như sau:</p>
<ul class="simple">
<li><code class="docutils literal notranslate"><span class="pre">quo</span></code>: Tạo <code class="docutils literal notranslate"><span class="pre">quosure</span></code> với biến</li>
<li><code class="docutils literal notranslate"><span class="pre">enquo</span></code>: Tạo <code class="docutils literal notranslate"><span class="pre">quosure</span></code> với <strong>giá trị</strong> của biến.</li>
</ul>
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span>x <span class="o">&lt;-</span> <span class="m">5</span>

<span class="c1"># Ví dụ 1</span>
quo<span class="p">(</span>x<span class="p">)</span>
</pre></div>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1">## &lt;quosure&gt;</span>
<span class="c1">## expr: ^x</span>
<span class="c1">## env:  global</span>
</pre></div>
</div>
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span>enquo<span class="p">(</span>x<span class="p">)</span>
</pre></div>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1">## &lt;quosure&gt;</span>
<span class="c1">## expr: ^5</span>
<span class="c1">## env:  empty</span>
</pre></div>
</div>
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="c1"># Ví dụ 2</span>
quo<span class="p">(</span>x <span class="o">+</span> <span class="m">2</span><span class="p">)</span>
</pre></div>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1">## &lt;quosure&gt;</span>
<span class="c1">## expr: ^x + 2</span>
<span class="c1">## env:  global</span>
</pre></div>
</div>
<p>Để <code class="docutils literal notranslate"><span class="pre">unquote</span></code>, ta dùng hàm <code class="docutils literal notranslate"><span class="pre">!!</span></code> để tính các giá trị mà biến đang lưu
trữ.</p>
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span>my_summarise <span class="o">&lt;-</span> <span class="kr">function</span><span class="p">(</span>df<span class="p">,</span> group_var<span class="p">)</span> <span class="p">{</span>
  group_var <span class="o">&lt;-</span> quo<span class="p">(</span>group_var<span class="p">)</span>
  <span class="kp">print</span><span class="p">(</span>group_var<span class="p">)</span>

  df <span class="o">%&gt;%</span>
    group_by<span class="p">(</span><span class="o">!!</span> group_var<span class="p">)</span> <span class="o">%&gt;%</span>
    summarise<span class="p">(</span>mean <span class="o">=</span> <span class="kp">mean</span><span class="p">(</span>mpg<span class="p">))</span>
<span class="p">}</span>
my_summarise<span class="p">(</span>mtcars<span class="p">,</span> cyl<span class="p">)</span>
</pre></div>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1">## &lt;quosure&gt;</span>
<span class="c1">## expr: ^group_var</span>
<span class="c1">## env:  000000000D74B578</span>
</pre></div>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1">## Error: Column `group_var` is unknown</span>
</pre></div>
</div>
<p>Câu lệnh trên không thực hiện được vì <code class="docutils literal notranslate"><span class="pre">quo(group_var)</span></code> sẽ trả ra kết
quả là <code class="docutils literal notranslate"><span class="pre">^group_var</span></code>, giá trị này không tồn tại. Cái chúng ta cần là
biểu thức (expression) dạng <code class="docutils literal notranslate"><span class="pre">^cyl</span></code>. Lúc này, ta phải dùng <code class="docutils literal notranslate"><span class="pre">enquo</span></code></p>
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span>my_summarise <span class="o">&lt;-</span> <span class="kr">function</span><span class="p">(</span>df<span class="p">,</span> group_var<span class="p">)</span> <span class="p">{</span>
  group_var <span class="o">&lt;-</span> enquo<span class="p">(</span>group_var<span class="p">)</span>
  <span class="kp">print</span><span class="p">(</span>group_var<span class="p">)</span>

  df <span class="o">%&gt;%</span>
    group_by<span class="p">(</span><span class="o">!!</span> group_var<span class="p">)</span> <span class="o">%&gt;%</span>
    summarise<span class="p">(</span>mean <span class="o">=</span> <span class="kp">mean</span><span class="p">(</span>mpg<span class="p">))</span>
<span class="p">}</span>
my_summarise<span class="p">(</span>mtcars<span class="p">,</span> cyl<span class="p">)</span>
</pre></div>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1">## &lt;quosure&gt;</span>
<span class="c1">## expr: ^cyl</span>
<span class="c1">## env:  global</span>
</pre></div>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1">## # A tibble: 3 x 2</span>
<span class="c1">##     cyl  mean</span>
<span class="c1">##   &lt;dbl&gt; &lt;dbl&gt;</span>
<span class="c1">## 1     4  26.7</span>
<span class="c1">## 2     6  19.7</span>
<span class="c1">## 3     8  15.1</span>
</pre></div>
</div>
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span>my_var <span class="o">&lt;-</span> quo<span class="p">(</span>mpg<span class="p">)</span>
mtcars <span class="o">%&gt;%</span> summarise<span class="p">(</span>mean <span class="o">=</span> <span class="kp">mean</span><span class="p">(</span><span class="o">!!</span>my_var<span class="p">))</span>
</pre></div>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1">##       mean</span>
<span class="c1">## 1 20.09062</span>
</pre></div>
</div>
<p>Ta cũng có thể sử dụng <code class="docutils literal notranslate"><span class="pre">quo</span></code>, <code class="docutils literal notranslate"><span class="pre">enquo</span></code> với một nhóm các biểu thức như
sau</p>
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span>exp <span class="o">&lt;-</span> quo<span class="p">(</span>summarise<span class="p">(</span>
  mtcars<span class="p">,</span> <span class="kp">mean</span><span class="p">(</span>mpg<span class="p">)</span>
<span class="p">))</span>
<span class="kp">exp</span>
</pre></div>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1">## &lt;quosure&gt;</span>
<span class="c1">## expr: ^summarise(mtcars, mean(mpg))</span>
<span class="c1">## env:  global</span>
</pre></div>
</div>
</div>
<div class="section" id="truong-hop-dung-quo-name">
<h2>4.3. Trường hợp dùng <code class="docutils literal notranslate"><span class="pre">quo_name</span></code><a class="headerlink" href="#truong-hop-dung-quo-name" title="Permalink to this headline">¶</a></h2>
<p><code class="docutils literal notranslate"><span class="pre">quo_name</span></code> cho phép convert biểu thức thành dạng string.</p>
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span>x <span class="o">&lt;-</span> <span class="m">5</span>
quo<span class="p">(</span>x<span class="p">)</span>
</pre></div>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1">## &lt;quosure&gt;</span>
<span class="c1">## expr: ^x</span>
<span class="c1">## env:  global</span>
</pre></div>
</div>
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span>quo<span class="p">(</span>x<span class="p">)</span> <span class="o">%&gt;%</span> quo_name<span class="p">()</span>
</pre></div>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1">## [1] &quot;x&quot;</span>
</pre></div>
</div>
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span>enquo<span class="p">(</span>x<span class="p">)</span>
</pre></div>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1">## &lt;quosure&gt;</span>
<span class="c1">## expr: ^5</span>
<span class="c1">## env:  empty</span>
</pre></div>
</div>
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span>enquo<span class="p">(</span>x<span class="p">)</span> <span class="o">%&gt;%</span> quo_name
</pre></div>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1">## [1] &quot;5&quot;</span>
</pre></div>
</div>
<p><strong>Lưu ý</strong>:</p>
<ul class="simple">
<li>Khi tạo các biến mới hoặc sử dụng dấu gán trong hàm khi lập trình,
cần dùng dấu <code class="docutils literal notranslate"><span class="pre">:=</span></code></li>
<li>Giá trị được gán (bên trái dấu gán) phải có <code class="docutils literal notranslate"><span class="pre">!!</span></code></li>
</ul>
<hr class="docutils" />
<ul class="simple">
<li>Ví dụ khi sử dụng với rename</li>
</ul>
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span>my_rename <span class="o">&lt;-</span> <span class="kr">function</span><span class="p">(</span>data<span class="p">,</span> var<span class="p">){</span>
  var <span class="o">&lt;-</span> enquo<span class="p">(</span>var<span class="p">)</span>
  new_var <span class="o">&lt;-</span> <span class="kp">paste0</span><span class="p">(</span><span class="s">&quot;new_&quot;</span><span class="p">,</span> quo_name<span class="p">(</span>var<span class="p">))</span>
  data <span class="o">&lt;-</span> data <span class="o">%&gt;%</span>
    rename<span class="p">(</span><span class="o">!!</span>new_var <span class="o">:=</span> <span class="o">!!</span>var<span class="p">)</span>
  <span class="kr">return</span><span class="p">(</span>data<span class="p">)</span>
<span class="p">}</span>
my_rename<span class="p">(</span>mtcars<span class="p">,</span> mpg<span class="p">)</span> <span class="o">%&gt;%</span> <span class="kp">head</span>
</pre></div>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1">##                   new_mpg cyl disp  hp drat    wt  qsec vs am gear carb</span>
<span class="c1">## Mazda RX4            21.0   6  160 110 3.90 2.620 16.46  0  1    4    4</span>
<span class="c1">## Mazda RX4 Wag        21.0   6  160 110 3.90 2.875 17.02  0  1    4    4</span>
<span class="c1">## Datsun 710           22.8   4  108  93 3.85 2.320 18.61  1  1    4    1</span>
<span class="c1">## Hornet 4 Drive       21.4   6  258 110 3.08 3.215 19.44  1  0    3    1</span>
<span class="c1">## Hornet Sportabout    18.7   8  360 175 3.15 3.440 17.02  0  0    3    2</span>
<span class="c1">## Valiant              18.1   6  225 105 2.76 3.460 20.22  1  0    3    1</span>
</pre></div>
</div>
<ul class="simple">
<li>Khi sử dụng với <code class="docutils literal notranslate"><span class="pre">mutate</span></code></li>
</ul>
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span>my_mutate <span class="o">&lt;-</span> <span class="kr">function</span><span class="p">(</span>data<span class="p">,</span> var<span class="p">){</span>
  var <span class="o">&lt;-</span> enquo<span class="p">(</span>var<span class="p">)</span>
  data <span class="o">&lt;-</span> data <span class="o">%&gt;%</span>
    mutate<span class="p">(</span><span class="o">!!</span><span class="s">&quot;new_var&quot;</span> <span class="o">:=</span> <span class="o">!!</span>var<span class="o">*</span><span class="m">2</span><span class="p">)</span>
  <span class="kr">return</span><span class="p">(</span>data<span class="p">)</span>
<span class="p">}</span>
mtcars <span class="o">%&gt;%</span>
  select<span class="p">(</span>mpg<span class="p">)</span> <span class="o">%&gt;%</span>
  my_mutate<span class="p">(</span>mpg<span class="p">)</span> <span class="o">%&gt;%</span> <span class="kp">head</span>
</pre></div>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1">##    mpg new_var</span>
<span class="c1">## 1 21.0    42.0</span>
<span class="c1">## 2 21.0    42.0</span>
<span class="c1">## 3 22.8    45.6</span>
<span class="c1">## 4 21.4    42.8</span>
<span class="c1">## 5 18.7    37.4</span>
<span class="c1">## 6 18.1    36.2</span>
</pre></div>
</div>
</div>
<div class="section" id="truong-hop-nhieu-bien">
<h2>4.4. Trường họp nhiều biến<a class="headerlink" href="#truong-hop-nhieu-bien" title="Permalink to this headline">¶</a></h2>
<ul class="simple">
<li>Khi có nhiều biến, ta dùng <code class="docutils literal notranslate"><span class="pre">quos(...)</span></code> &amp; <code class="docutils literal notranslate"><span class="pre">!!!</span></code> thay cho <code class="docutils literal notranslate"><span class="pre">enquo</span></code>
và <code class="docutils literal notranslate"><span class="pre">!!</span></code></li>
</ul>
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span>my_summarise <span class="o">&lt;-</span> <span class="kr">function</span><span class="p">(</span>df<span class="p">,</span> value_var<span class="p">,</span><span class="kc">...</span><span class="p">){</span>
  group_var <span class="o">&lt;-</span> quos<span class="p">(</span><span class="kc">...</span><span class="p">)</span>
  value_var <span class="o">&lt;-</span> enquo<span class="p">(</span>value_var<span class="p">)</span>
  df <span class="o">%&gt;%</span> group_by<span class="p">(</span><span class="o">!!!</span>group_var<span class="p">)</span> <span class="o">%&gt;%</span>
    summarise<span class="p">(</span>mean <span class="o">=</span> <span class="kp">mean</span><span class="p">(</span><span class="o">!!</span>value_var<span class="p">))</span>
<span class="p">}</span>

my_summarise<span class="p">(</span>mtcars<span class="p">,</span> mpg<span class="p">,</span> cyl<span class="p">,</span> vs<span class="p">)</span>
</pre></div>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1">## # A tibble: 5 x 3</span>
<span class="c1">## # Groups:   cyl [3]</span>
<span class="c1">##     cyl    vs  mean</span>
<span class="c1">##   &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;</span>
<span class="c1">## 1     4     0  26</span>
<span class="c1">## 2     4     1  26.7</span>
<span class="c1">## 3     6     0  20.6</span>
<span class="c1">## 4     6     1  19.1</span>
<span class="c1">## 5     8     0  15.1</span>
</pre></div>
</div>
<p><strong>Lưu ý</strong>: Trong thực tế, khi không muốn viết hàm mà vẫn có thể sử dụng
ứng dụng của toán tử <code class="docutils literal notranslate"><span class="pre">!</span></code>, ta có thể sử dụng toán tử <code class="docutils literal notranslate"><span class="pre">!!!</span></code> nhu sau.</p>
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span>my_var <span class="o">&lt;-</span> <span class="kt">c</span><span class="p">(</span><span class="s">&quot;mpg&quot;</span><span class="p">,</span> <span class="s">&quot;cyl&quot;</span><span class="p">)</span>
mtcars <span class="o">%&gt;%</span> select<span class="p">(</span><span class="o">!!!</span>my_var<span class="p">)</span> <span class="o">%&gt;%</span> <span class="kp">head</span>
</pre></div>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1">##                    mpg cyl</span>
<span class="c1">## Mazda RX4         21.0   6</span>
<span class="c1">## Mazda RX4 Wag     21.0   6</span>
<span class="c1">## Datsun 710        22.8   4</span>
<span class="c1">## Hornet 4 Drive    21.4   6</span>
<span class="c1">## Hornet Sportabout 18.7   8</span>
<span class="c1">## Valiant           18.1   6</span>
</pre></div>
</div>
</div>
<div class="section" id="ung-dung">
<h2>4.5. Ứng dụng<a class="headerlink" href="#ung-dung" title="Permalink to this headline">¶</a></h2>
<div class="section" id="ham-tinh-toan-tong-hop-nhieu-bien">
<h3>4.5.1. Hàm tính toán tổng hợp nhiều biến<a class="headerlink" href="#ham-tinh-toan-tong-hop-nhieu-bien" title="Permalink to this headline">¶</a></h3>
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span>analytics_summarise <span class="o">&lt;-</span> <span class="kr">function</span><span class="p">(</span>data<span class="p">,</span> value_var<span class="p">,</span><span class="kc">...</span><span class="p">){</span>
  group_var <span class="o">&lt;-</span> quos<span class="p">(</span><span class="kc">...</span><span class="p">)</span>
  value_var <span class="o">&lt;-</span> enquo<span class="p">(</span>value_var<span class="p">)</span>
  data <span class="o">%&gt;%</span>
    group_by<span class="p">(</span><span class="o">!!!</span>group_var<span class="p">)</span> <span class="o">%&gt;%</span>
    summarise<span class="p">(</span>n <span class="o">=</span> n<span class="p">(),</span>
              total <span class="o">=</span> <span class="kp">sum</span><span class="p">(</span><span class="o">!!</span>value_var<span class="p">),</span>
              min <span class="o">=</span> <span class="kp">min</span><span class="p">(</span><span class="o">!!</span>value_var<span class="p">),</span>
              q25 <span class="o">=</span> quantile<span class="p">(</span><span class="o">!!</span>value_var<span class="p">,</span> <span class="m">0.25</span><span class="p">,</span> na.rm <span class="o">=</span> <span class="bp">T</span><span class="p">),</span>
              q50 <span class="o">=</span> quantile<span class="p">(</span><span class="o">!!</span>value_var<span class="p">,</span> <span class="m">0.50</span><span class="p">,</span> na.rm <span class="o">=</span> <span class="bp">T</span><span class="p">),</span>
              q75 <span class="o">=</span> quantile<span class="p">(</span><span class="o">!!</span>value_var<span class="p">,</span> <span class="m">0.75</span><span class="p">,</span> na.rm <span class="o">=</span> <span class="bp">T</span><span class="p">),</span>
              q90 <span class="o">=</span> quantile<span class="p">(</span><span class="o">!!</span>value_var<span class="p">,</span> <span class="m">0.90</span><span class="p">,</span> na.rm <span class="o">=</span> <span class="bp">T</span><span class="p">),</span>
              q95 <span class="o">=</span> quantile<span class="p">(</span><span class="o">!!</span>value_var<span class="p">,</span> <span class="m">0.95</span><span class="p">,</span> na.rm <span class="o">=</span> <span class="bp">T</span><span class="p">),</span>
              max <span class="o">=</span> <span class="kp">max</span><span class="p">(</span><span class="o">!!</span>value_var<span class="p">),</span>
              mean <span class="o">=</span> <span class="kp">mean</span><span class="p">(</span><span class="o">!!</span>value_var<span class="p">,</span> na.rm <span class="o">=</span> <span class="bp">T</span><span class="p">),</span>
              mean_trimed <span class="o">=</span> <span class="kp">mean</span><span class="p">(</span><span class="o">!!</span>value_var<span class="p">,</span> trim <span class="o">=</span> <span class="m">0.1</span><span class="p">,</span> na.rm <span class="o">=</span> <span class="bp">T</span><span class="p">))</span> <span class="o">%&gt;%</span>
    ungroup <span class="o">-&gt;</span> result
  <span class="kr">return</span><span class="p">(</span>result<span class="p">)</span>
<span class="p">}</span>

<span class="c1"># Một biến</span>
mtcars <span class="o">%&gt;%</span>
  analytics_summarise<span class="p">(</span>mpg<span class="p">,</span> cyl<span class="p">)</span>
</pre></div>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1">## # A tibble: 3 x 12</span>
<span class="c1">##     cyl     n total   min   q25   q50   q75   q90   q95   max  mean</span>
<span class="c1">##   &lt;dbl&gt; &lt;int&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;</span>
<span class="c1">## 1     4    11  293.  21.4  22.8  26    30.4  32.4  33.2  33.9  26.7</span>
<span class="c1">## 2     6     7  138.  17.8  18.6  19.7  21    21.2  21.3  21.4  19.7</span>
<span class="c1">## 3     8    14  211.  10.4  14.4  15.2  16.2  18.3  18.9  19.2  15.1</span>
<span class="c1">## # ... with 1 more variable: mean_trimed &lt;dbl&gt;</span>
</pre></div>
</div>
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="c1"># Nhiều biến</span>
mtcars <span class="o">%&gt;%</span>
  analytics_summarise<span class="p">(</span>mpg<span class="p">,</span> cyl<span class="p">,</span> am<span class="p">)</span>
</pre></div>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1">## # A tibble: 6 x 13</span>
<span class="c1">##     cyl    am     n total   min   q25   q50   q75   q90   q95   max  mean</span>
<span class="c1">##   &lt;dbl&gt; &lt;dbl&gt; &lt;int&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;</span>
<span class="c1">## 1     4     0     3  68.7  21.5  22.2  22.8  23.6  24.1  24.2  24.4  22.9</span>
<span class="c1">## 2     4     1     8 225.   21.4  25.2  28.8  30.9  32.8  33.4  33.9  28.1</span>
<span class="c1">## 3     6     0     4  76.5  17.8  18.0  18.6  19.8  20.7  21.1  21.4  19.1</span>
<span class="c1">## 4     6     1     3  61.7  19.7  20.4  21    21    21    21    21    20.6</span>
<span class="c1">## 5     8     0    12 181.   10.4  14.0  15.2  16.6  18.6  18.9  19.2  15.0</span>
<span class="c1">## 6     8     1     2  30.8  15    15.2  15.4  15.6  15.7  15.8  15.8  15.4</span>
<span class="c1">## # ... with 1 more variable: mean_trimed &lt;dbl&gt;</span>
</pre></div>
</div>
</div>
<div class="section" id="ve-do-thi-voi-ggplot2">
<h3>4.5.2. Vẽ đồ thị với ggplot2<a class="headerlink" href="#ve-do-thi-voi-ggplot2" title="Permalink to this headline">¶</a></h3>
<p>Tương tự với dplyr, lập trình NSE có thể sử dụng đơn giản với ggplot2.</p>
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span>my_chart <span class="o">&lt;-</span> <span class="kr">function</span><span class="p">(</span>data<span class="p">,</span> value_var<span class="p">,</span> group_var<span class="p">){</span>
  value_var <span class="o">&lt;-</span> enquo<span class="p">(</span>value_var<span class="p">)</span>
  group_var <span class="o">&lt;-</span> enquo<span class="p">(</span>group_var<span class="p">)</span>
  data <span class="o">%&gt;%</span>
    ggplot<span class="p">(</span>aes<span class="p">(</span><span class="o">!!</span>group_var<span class="p">,</span> <span class="o">!!</span>value_var<span class="p">))</span> <span class="o">+</span>
    geom_bar<span class="p">(</span>stat <span class="o">=</span> <span class="s">&quot;identity&quot;</span><span class="p">,</span>
             aes<span class="p">(</span>fill <span class="o">=</span> <span class="o">!!</span>group_var<span class="p">))</span> <span class="o">+</span>
    theme_minimal<span class="p">()</span>
<span class="p">}</span>
mtcars <span class="o">%&gt;%</span>
  mutate<span class="p">(</span>cyl <span class="o">=</span> <span class="kp">as.factor</span><span class="p">(</span>cyl<span class="p">))</span> <span class="o">%&gt;%</span>
  group_by<span class="p">(</span>cyl<span class="p">)</span> <span class="o">%&gt;%</span>
  summarise<span class="p">(</span>mpg <span class="o">=</span> <span class="kp">sum</span><span class="p">(</span>mpg<span class="p">))</span> <span class="o">%&gt;%</span>
  my_chart<span class="p">(</span>mpg<span class="p">,</span> cyl<span class="p">)</span>
</pre></div>
</div>
<p><img alt="image0" src="p02-06-lap-trinh-ham_files/figure-html/unnamed-chunk-22-1.png" /></p>
</div>
</div>
</div>


           </div>
           
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="p02-07-lap-trinh-ham-voi-purrr.html" class="btn btn-neutral float-right" title="5. Lập trình chức năng hàm với purrr" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="p02-05-cac-chi-so-thong-ke.html" class="btn btn-neutral float-left" title="3. Các chỉ số thống kê mô tả cơ bản" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2019, Anh Hoang Duc

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>