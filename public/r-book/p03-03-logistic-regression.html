

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="vi" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="vi" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>3. Mô hình hồi quy logistic &mdash; Tài liệu Phân tích dữ liệu với R 2019</title>
  

  
  
  
  

  
  <script type="text/javascript" src="_static/js/modernizr.min.js"></script>
  
    
      <script type="text/javascript">
          var DOCUMENTATION_OPTIONS = {
              URL_ROOT:'./',
              VERSION:'2019',
              LANGUAGE:'vi',
              COLLAPSE_INDEX:false,
              FILE_SUFFIX:'.html',
              HAS_SOURCE:  true,
              SOURCELINK_SUFFIX: '.txt'
          };
      </script>
        <script type="text/javascript" src="_static/jquery.js"></script>
        <script type="text/javascript" src="_static/underscore.js"></script>
        <script type="text/javascript" src="_static/doctools.js"></script>
        <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.0/clipboard.min.js"></script>
        <script type="text/javascript" src="_static/copybutton.js"></script>
        <script type="text/javascript" src="_static/translations.js"></script>
        <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
    
    <script type="text/javascript" src="_static/js/theme.js"></script>

    

  
  <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="_static/copybutton.css" type="text/css" />
  <link rel="stylesheet" href="_static/css/custom.css" type="text/css" />
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Tìm Kiếm" href="search.html" />
    <link rel="next" title="4. Cây quyết định" href="p03-04-decision-tree.html" />
    <link rel="prev" title="2. Mô hình OLS" href="p03-02-mo-hinh-ols.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="index.html" class="icon icon-home"> Phân tích dữ liệu với R
          

          
          </a>

          
            
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <p class="caption"><span class="caption-text">Giới thiệu</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="p01-01-gioi-thieu.html">Khoa học dữ liệu và nghề phân tích dữ liệu</a></li>
</ul>
<p class="caption"><span class="caption-text">Phân tích khám phá dữ liệu</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="p02-03-bien-doi-du-lieu-dplyr.html">1. Ngữ pháp của biến đổi dữ liệu với DPLYR</a></li>
<li class="toctree-l1"><a class="reference internal" href="p02-04-phan-ra-va-xoay-chieu-du-lieu.html">2. Phân rã và xoay chiều dữ liệu</a></li>
<li class="toctree-l1"><a class="reference internal" href="p02-05-cac-chi-so-thong-ke.html">3. Các chỉ số thống kê mô tả cơ bản</a></li>
<li class="toctree-l1"><a class="reference internal" href="p02-06-lap-trinh-ham.html">4. Lập trình hàm</a></li>
<li class="toctree-l1"><a class="reference internal" href="p02-07-lap-trinh-ham-voi-purrr.html">5. Lập trình chức năng hàm với purrr</a></li>
<li class="toctree-l1"><a class="reference internal" href="p02-08-bien-doi-du-lieu-text.html">6. Biến đổi dữ liệu text</a></li>
<li class="toctree-l1"><a class="reference internal" href="p02-11-quan-ly-nhieu-mo-hinh.html">7. Quản lý kết quả phân tích từ nhiều mô hình</a></li>
<li class="toctree-l1"><a class="reference internal" href="p02-15-thong-ke-co-ban.html">8. Xác suất và phân phối thống kê cơ bản</a></li>
<li class="toctree-l1"><a class="reference internal" href="p02-16-power-analysis.html">9. Power analysis</a></li>
<li class="toctree-l1"><a class="reference internal" href="p02-20-sampling-methods.html">10. Phương pháp ước lượng lấy mẫu</a></li>
<li class="toctree-l1"><a class="reference internal" href="p02-50-datatable.html">11. Biến đổi dữ liệu với <code class="docutils literal notranslate"><span class="pre">data.table</span></code></a></li>
<li class="toctree-l1"><a class="reference internal" href="p02-60-thu-thap-du-lieu-tu-website.html">12. Thu thập dữ liệu từ website</a></li>
<li class="toctree-l1"><a class="reference internal" href="p02-99-meo-trong-r.html">13. Các mẹo trong R</a></li>
</ul>
<p class="caption"><span class="caption-text">Supervised learning</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="p03-01-nguyen-ly-du-bao.html">1. Các nguyên lý dự báo</a></li>
<li class="toctree-l1"><a class="reference internal" href="p03-02-mo-hinh-ols.html">2. Mô hình OLS</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">3. Mô hình hồi quy logistic</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#gioi-thieu">3.1. Giới thiệu</a></li>
<li class="toctree-l2"><a class="reference internal" href="#cach-xay-dung-mo-hinh">3.2. Cách xây dựng mô hình</a></li>
<li class="toctree-l2"><a class="reference internal" href="#vi-du-xay-dung-mo-hinh-don-gian">3.3. Ví dụ xây dựng mô hình đơn giản</a></li>
<li class="toctree-l2"><a class="reference internal" href="#cac-chi-so-can-quan-tam-khac">3.4. Các chỉ số cần quan tâm khác</a></li>
<li class="toctree-l2"><a class="reference internal" href="#danh-gia-chat-luong-mo-hinh">3.5. Đánh giá chất lượng mô hình</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#confusion-matrix">3.5.1. Confusion Matrix</a></li>
<li class="toctree-l3"><a class="reference internal" href="#roc">3.5.2. ROC</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#ly-thuyet">3.5.2.1. Lý thuyết</a></li>
<li class="toctree-l4"><a class="reference internal" href="#cach-ve-roc-thuc-te">3.5.2.2. Cách vẽ ROC thực tế</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#gain-va-lift">3.5.3. Gain và Lift</a></li>
<li class="toctree-l3"><a class="reference internal" href="#kolmogorovsmirnov-statistics">3.5.4. Kolmogorov–Smirnov statistics</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#thuc-hanh">3.6. Thực hành</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#du-lieu">3.6.1. Dữ liệu</a></li>
<li class="toctree-l3"><a class="reference internal" href="#xay-dung-mo-hinh-tren-tap-du-lieu-goc">3.6.2. Xây dựng mô hình trên tập dữ liệu gốc</a></li>
<li class="toctree-l3"><a class="reference internal" href="#xay-dung-mo-hinh-tren-hai-tap-train-va-test">3.6.3. Xây dựng mô hình trên hai tập train và test</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#chia-tap-train-test">3.6.3.1. Chia tập train/test</a></li>
<li class="toctree-l4"><a class="reference internal" href="#xay-dung-mo-hinh">3.6.3.2. Xây dựng mô hình</a></li>
<li class="toctree-l4"><a class="reference internal" href="#du-bao-xac-suat-co-no-xau-tren-tap-test">3.6.3.3. Dự báo xác suất có nợ xấu trên tập test</a></li>
<li class="toctree-l4"><a class="reference internal" href="#danh-gia-chat-luong-du-bao-tren-tap-test">3.6.3.4. Đánh giá chất lượng dự báo trên tập test</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#xay-dung-mo-hinh-logistics-theo-machine-learning">3.7. Xây dựng mô hình Logistics theo Machine Learning</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="p03-04-decision-tree.html">4. Cây quyết định</a></li>
<li class="toctree-l1"><a class="reference internal" href="p03-05-bagging-boosting.html">5. Bagging, RandomForest và Boosting</a></li>
<li class="toctree-l1"><a class="reference internal" href="p03-08-svm.html">6. Support Vector Machine</a></li>
<li class="toctree-l1"><a class="reference internal" href="p03-09-feature-engineering.html">7. Feature Engineering</a></li>
<li class="toctree-l1"><a class="reference internal" href="p03-15-regularization.html">8. Regularization</a></li>
<li class="toctree-l1"><a class="reference internal" href="p03-17-nonlinear.html">9. Mô hình phi tuyến tính</a></li>
<li class="toctree-l1"><a class="reference internal" href="p03-30-credit-scoring.html">10. Credit Scoring</a></li>
<li class="toctree-l1"><a class="reference internal" href="p03-35-caret.html">11. Xây dựng mô hình dự báo với caret</a></li>
<li class="toctree-l1"><a class="reference internal" href="p03-65-chat-luong-mo-hinh.html">12. Chất lượng mô hình</a></li>
<li class="toctree-l1"><a class="reference internal" href="p03-70-tidymodels.html">13. Tidymodels</a></li>
</ul>
<p class="caption"><span class="caption-text">Unsupervised learning</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="p04-01-unsupervised-learning.html">1. Unsupervised learning</a></li>
<li class="toctree-l1"><a class="reference internal" href="p04-02-kmeans.html">2. k-means</a></li>
<li class="toctree-l1"><a class="reference internal" href="p04-03-hierarchical-clustering.html">3. Hierachical clustering</a></li>
<li class="toctree-l1"><a class="reference internal" href="p04-04-basket-analysis.html">4. Phân tích giỏ hàng</a></li>
<li class="toctree-l1"><a class="reference internal" href="p04-05-pca.html">5. Principal component analysis</a></li>
<li class="toctree-l1"><a class="reference internal" href="p04-06-factor-analysis.html">6. Phân tích nhân tố ẩn (factor analysis)</a></li>
</ul>
<p class="caption"><span class="caption-text">Chuỗi thời gian</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="p05-01-chuoi-thoi-gian.html">1. Giới thiệu về chuỗi thời gian</a></li>
<li class="toctree-l1"><a class="reference internal" href="p05-02-arima.html">2. Mô hình ARIMA</a></li>
<li class="toctree-l1"><a class="reference internal" href="p05-03-phan-tich-chuoi-thoi-gian-voi-tidyquant.html">3. Phân tích chuỗi thời gian với tidyquant và timetk</a></li>
<li class="toctree-l1"><a class="reference internal" href="p05-06-du-bao-ts-voi-prophet.html">4. Dự báo chuỗi thời gian với prophet</a></li>
<li class="toctree-l1"><a class="reference internal" href="p05-07-du-bao-ts-voi-timetk.html">5. Dự báo chuỗi thời gian với timetk</a></li>
<li class="toctree-l1"><a class="reference internal" href="p05-08-abnomaly-detection.html">6. Abnomaly detection trong times series</a></li>
</ul>
<p class="caption"><span class="caption-text">Ngôn ngữ tự nghiên</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="p06-01-nlp-co-ban.html">1. Xử lý ngôn ngữ tự nhiên cơ bản</a></li>
<li class="toctree-l1"><a class="reference internal" href="p06-04-text-classification.html">2. Phân loại text</a></li>
<li class="toctree-l1"><a class="reference internal" href="p06-07-nlp-api.html">3. Sử dụng API từ các dịch vụ đám mây</a></li>
<li class="toctree-l1"><a class="reference internal" href="p06-10-ocr-tesseract.html">4. OCR với <code class="docutils literal notranslate"><span class="pre">tesseract</span></code></a></li>
</ul>
<p class="caption"><span class="caption-text">Các phương pháp khác</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="p07-01-survival-analysis.html">1. Survival analysis</a></li>
<li class="toctree-l1"><a class="reference internal" href="p07-02-causal-impact.html">2. Causal Impact</a></li>
<li class="toctree-l1"><a class="reference internal" href="p07-03-collaborative-filtering.html">3. Collaborative Filtering</a></li>
<li class="toctree-l1"><a class="reference internal" href="p07-07-spatial-data.html">4. Spatial data</a></li>
<li class="toctree-l1"><a class="reference internal" href="p07-10-shiny.html">5. Shiny apps</a></li>
</ul>
<p class="caption"><span class="caption-text">Deep Learning</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="p09-01-gioi-thieu-deep-learning.html">1. Giới thiệu cơ bản về Deep Learning</a></li>
<li class="toctree-l1"><a class="reference internal" href="p09-02-co-ban-kien-thuc-toan.html">2. Kiến thức cơ bản toán học cho deep learning</a></li>
<li class="toctree-l1"><a class="reference internal" href="p09-03-mo-hinh-deep-learning-co-ban.html">3. Mô hình deep learning cơ bản</a></li>
<li class="toctree-l1"><a class="reference internal" href="p09-04-convolution-neural-network.html">4. Convolution neural networks</a></li>
</ul>
<p class="caption"><span class="caption-text">Cloud Computing</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="p10-01-cai-dat-rstudio-server-tren-amazon.html">1. Cài đặt server RStudio trên Amazon</a></li>
<li class="toctree-l1"><a class="reference internal" href="p10-03-web-service-azure.html">2. Xây dựng web service với Azure</a></li>
<li class="toctree-l1"><a class="reference internal" href="p10-09-apis-voi-plumber.html">3. API với Plumber</a></li>
</ul>
<p class="caption"><span class="caption-text">Kiến thức bổ trợ</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="p11-01-git.html">1. Sử dụng GIT</a></li>
<li class="toctree-l1"><a class="reference internal" href="p11-02-cmd.html">2. CMD và Bash</a></li>
<li class="toctree-l1"><a class="reference internal" href="p11-03-docker.html">3. Sử dụng docker</a></li>
<li class="toctree-l1"><a class="reference internal" href="p11-04-apis.html">4. API</a></li>
<li class="toctree-l1"><a class="reference internal" href="p11-05-html-css.html">5. Cơ bản về HTML và CSS</a></li>
<li class="toctree-l1"><a class="reference internal" href="p11-09-other.html">6. Các tricks khác</a></li>
</ul>
<p class="caption"><span class="caption-text">Case studies</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="p13-01-casestudy-truc-quan-hoa.html">1. Trực quan hóa dữ liệu</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">Phân tích dữ liệu với R</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="index.html">Docs</a> &raquo;</li>
        
      <li>3. Mô hình hồi quy logistic</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="_sources/p03-03-logistic-regression.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  
<style>
/* CSS overrides for sphinx_rtd_theme */

/* 24px margin */
.nbinput.nblast,
.nboutput.nblast {
    margin-bottom: 19px;  /* padding has already 5px */
}

/* ... except between code cells! */
.nblast + .nbinput {
    margin-top: -19px;
}

.admonition > p:before {
    margin-right: 4px;  /* make room for the exclamation icon */
}

/* Fix math alignment, see https://github.com/rtfd/sphinx_rtd_theme/pull/686 */
.math {
    text-align: unset;
}
</style>
<div class="section" id="mo-hinh-hoi-quy-logistic">
<h1>3. Mô hình hồi quy logistic<a class="headerlink" href="#mo-hinh-hoi-quy-logistic" title="Permalink to this headline">¶</a></h1>
<div class="section" id="gioi-thieu">
<h2>3.1. Giới thiệu<a class="headerlink" href="#gioi-thieu" title="Permalink to this headline">¶</a></h2>
<p>Khi phân tích dữ liệu, bên cạnh biến liên tục, ta thường xuyên phải làm
việc với các biến rời rạc, các biến có đặc tinh nhóm (category) như “mua
hàng vs.&nbsp;không mua hàng”, “giàu vs.&nbsp;nghèo”, “nợ xấu vs.&nbsp;không nợ xấu”.
Quá trình phân tích và dự báo các quan sát thuộc về nhóm nào được gọi là
quá trình phân loại (classification).</p>
<p>Đối với bài toán phân loại, ta có thể chia thành hai nhóm lớn là phân
loại hai biến và phân loại nhiều biến. Trong đó, bài toán phân loại hai
biến là bài toán phổ biến nhất, được ứng dụng trong nhiều lĩnh vực trong
đời sống như đánh giá điểm tín dụng của khách hàng, dự báo khách hàng
phản ứng với chiến dịch marketing…</p>
<p>Trong chương này, chúng ta sẽ làm quen vơi kỹ thuật nổi tiếng và được
ứng dụng sớm nhất trong việc phân loại hai biến (<em>binary
classification</em>) là <em>logistic regression</em>.</p>
<p>Nếu như mô hình hồi quy tuyến tính thường (linear regression) cho phép
chúng ta tìm được mối quan hệ giữa biến phụ thuộc liên tục (continous
dependent variable) và một/nhiều biến độc lập (independent variable) -
liên tục hoặc không liên tục thì mô hình hồi quy Logistic tìm mối quan
hệ giữa biến phụ thuộc là biến nhị phân - <em>binary variable</em>. Biến cần dự
báo dạng này chỉ nhận 2 giá trị: có/không, sống/chết, yêu/không yêu… và
các biến độc lập có thể là liên tục hoặc không liên tục.</p>
<p>Ví dụ, ta tìm hiểu mối quan hệ giữa việc KH có nợ xấu hay không dựa vào
dư nợ của KH - thông qua việc tìm hiểu khả năng khách hàng có nợ xấu dựa
vào thông tin dư nợ của KH. Trong đó:</p>
<ul class="simple">
<li>Biến phụ thuộc:</li>
</ul>
<div class="math notranslate">
\[\begin{split}Y = \begin{cases}1, &amp; KH\:có\:nợ\:xấu\\
  0,  &amp; KH\:không\:có\:nợ\:xấu\end{cases}\end{split}\]</div>
<ul class="simple">
<li>Biến độc lập: X - dư nợ của KH (hay số tiền khách hàng nợ ngân hàng)</li>
</ul>
<p>Trong mô hình này, ta không thể sử dụng mô hình hồi quy thông thường bởi
lẽ biến phụ thuộc chỉ có hai giá trị 0 và 1. Hơn nữa, cái ta cần dự báo
là “xác suất” xảy ra sự kiện (xác suất vỡ nợ) cho mỗi quan sát. Để giải
quyết vấn đề nay, ta có thể sử dụng mô hình logistic có dạng như sau:</p>
<div class="math notranslate">
\[p= Pr(Y=1)=\frac{e^{B_{0} + B_{1}X}}{1+e^{B_{0} + B_{1}X}}\]</div>
<p>Trong đó, <span class="math notranslate">\(p\)</span> là xác suất khách hàng có nợ xấu, <span class="math notranslate">\((1-p)\)</span> là
xác suất khách hàng không có nợ xấu.</p>
<div class="math notranslate">
\[Pr(Y=0)=1-p=\frac{1}{1+e^{B_{0} + B_{1}X}}\]</div>
<p><strong>Lưu ý</strong>: Trong các bài toán phân loại, nhóm ta cần dự báo còn được gọi
là <code class="docutils literal notranslate"><span class="pre">class</span> <span class="pre">positive</span></code> hay <code class="docutils literal notranslate"><span class="pre">event</span> <span class="pre">of</span> <span class="pre">interest</span></code>. Khi ứng dụng với các
bài toán cụ thể khác nhau, class sẽ được xây dựng khác nhau. Ví dụ:
trong dự báo khách hàng phản hồi, thì sự kiện khách hàng phản hồi email
là 1, không phản hồi email là 0. Khi dự báo khách hàng có nợ xấu, khách
hàng có nợ xấu được đánh dấu là 1, không có nợ xấu được đánh dấu là 0.</p>
<p>Trong mô hình logistic, ta còn có một chỉ số khác được gọi là
<span class="math notranslate">\(Odds\: ratio\)</span>, tạm dịch là <em>khả năng xảy ra sự kiện so với khả
năng không xảy ra sự kiện</em>. Với bài toán dự báo nợ xấu, chỉ số này cho
chúng ta biết xác suất khách hàng có nợ xấu cao hơn bao nhiêu lần bao
nhiêu lần so với xác suất khách hàng không có nợ xấu.</p>
<div class="math notranslate">
\[Odds=\frac{p}{1-p}=e^{B_{0} + B_{1}X}\]</div>
<p><strong>Ví dụ</strong>:</p>
<ul class="simple">
<li>Xác suất khách hàng có nợ xấu: p = 0.8</li>
<li>Xác suất khách hàng không có nợ xấu: 1-p = 1-0.8=0.2</li>
<li>Odd ration: <span class="math notranslate">\(p/(1-p) = 4\)</span> - khả năng khách hàng có nợ xấu cao
gấp 4 lần khả năng khách hàng không có nợ xấu.</li>
</ul>
<p><strong>Logit</strong>: Là hàm log của odd ratio, được tính như sau.</p>
<div class="math notranslate">
\[logit=ln(Odds)=ln(\frac{p}{1-p}) = B_{0} + B_{1}X\]</div>
<p>Phương trình trên gọi là <strong>phương trình hồi quy Logistic</strong>. Hàm này có
thể chứa các giá trị bất kỳ trong khoảng từ <span class="math notranslate">\((-\infty, +\infty)\)</span>.
Lúc này, hàm trên đã trở về hàm hồi quy thông thường. Như vậy, mô hình
chúng ta cần xây dựng có dạng:</p>
<div class="math notranslate">
\[logit(p) = \alpha + \beta X\]</div>
<p>hay:</p>
<div class="math notranslate">
\[odds(p) = \frac{p}{1-p} = e^{\alpha + \beta X}\]</div>
<p><strong>Giải thích ý nghĩa</strong>: Khi x tăng thêm 1 đơn vị, thì <strong>Odds ratio</strong> (tỷ
số khả dĩ) sẽ tăng thêm <span class="math notranslate">\(e^{\beta}\)</span>. Nghĩa là, khi x tăng thêm 1
đơn vị, <em>khả năng</em> (chance) xảy ra biến cố X sẽ tăng lên
<span class="math notranslate">\(e^{\beta}\)</span> lần.</p>
<ul>
<li><p class="first">Khi <span class="math notranslate">\(x = x_0\)</span>, khả năng xảy ra biến cố là:</p>
<div class="math notranslate">
\[odds(p|x=x_0) = e^{\alpha + \beta x_0}\]</div>
</li>
<li><p class="first">Khi <span class="math notranslate">\(x = x_0 + 1\)</span>, khả năng xảy ra biến cố là:</p>
<div class="math notranslate">
\[odds(p|x=x_0+1) = e^{\alpha + \beta (x_0+1)}\]</div>
</li>
<li><p class="first">Tỷ số giữa 2 khả năng là:</p>
<div class="math notranslate">
\[\frac{e^{\alpha + \beta (x_0+1)}}{e^{\alpha + \beta (x_0)}} = e^{\beta}\]</div>
</li>
</ul>
<p><strong>Lưu ý</strong>: Cách giải thích ý nghĩa của hệ số <span class="math notranslate">\(\beta\)</span> trong
Logistic rất dễ nhầm lẫn. Cơ bản có 2 cách như sau:</p>
<ul class="simple">
<li>Cách 1: Giải thích dựa trên “xác suất” xảy ra biến cố A. Cách tính
này dựa trên việc đưa ra tính toán xác suất xảy ra A với X cho trước.</li>
<li>Cách 2: Dựa trên “khả năng” xảy ra biến cố A (Odd ratio)</li>
</ul>
<p><img alt="image0" src="p03-03-logistic-regression_files/figure-html/unnamed-chunk-2-1.png" /></p>
<p><img alt="image1" src="p03-03-logistic-regression_files/figure-html/unnamed-chunk-2-2.png" /></p>
</div>
<div class="section" id="cach-xay-dung-mo-hinh">
<h2>3.2. Cách xây dựng mô hình<a class="headerlink" href="#cach-xay-dung-mo-hinh" title="Permalink to this headline">¶</a></h2>
<p>Để ước lượng các tham số <span class="math notranslate">\(\beta_j\)</span>, ta dùng phương pháp hợp lý tối
đa (<strong>maximum likelihood</strong>), nghĩa là tìm <span class="math notranslate">\(\beta_j\)</span> để tối đa hóa
hàm likelihood.</p>
<div class="math notranslate">
\[L = p_1*p_2*...*p_n= \prod_{i=1}^np_i\]</div>
<p>Trong đó, <span class="math notranslate">\(p_i\)</span> là xác suất xảy sự kiện của quan sát thứ
<span class="math notranslate">\(i\)</span>.</p>
<p>Trong bài toán hồi quy logistic, ta quan tâm đến việc dự báo chính xác
sự kiện xảy ra (<span class="math notranslate">\(P_{y = 1}\)</span>). Do đó, hàm likelihood trong bài toán
nhị phân được tính như sau.</p>
<div class="math notranslate">
\[L = \prod[-y_i*log(h_\theta(x_i)) - (1-y_i)log(1-h_\theta(x_i))]\]</div>
<p>Trong đó:</p>
<ul class="simple">
<li><span class="math notranslate">\(y_i\)</span>: Là giá trị thực tế của biến cần dự báo (1 hoặc 0) tại
quan sát i</li>
<li><span class="math notranslate">\(h_{\theta}(x_i)\)</span>: Giá trị dự báo của quan sát i. Giá trị này
nằm trong khoảng [0, 1]</li>
</ul>
<p>Xem ví dụ dưới đây:</p>
<table border="1" class="docutils">
<colgroup>
<col width="41%" />
<col width="36%" />
<col width="23%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Thực tế</th>
<th class="head">Dự báo</th>
<th class="head">L</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>1</td>
<td>0.7</td>
<td>0.7</td>
</tr>
<tr class="row-odd"><td>0</td>
<td>0.6</td>
<td>0.4</td>
</tr>
<tr class="row-even"><td>1</td>
<td>0.8</td>
<td>0.8</td>
</tr>
</tbody>
</table>
<p>Với mô hình trên, ta có:</p>
<div class="math notranslate">
\[L = 0.7 * 0.4 * 0.8 = 0.224\]</div>
<div class="math notranslate">
\[log(L) = log(0.224) = -1.496\]</div>
<p>Như vậy, về mặt hình ảnh, hàm Likelihood sẽ tìm cách fit dữ liệu sao cho
sát với dữ liệu thực tế nhiều nhất. Hàm này sẽ đạt giá trị tối đa bằng 1
(L = 1), ứng với <span class="math notranslate">\(log(L_{max}) = 0\)</span></p>
<p>Để hiểu hơn về cách tối ưu hóa Logistic trong trường hợp đơn giản, xem
ví dụ trong file excel đính kèm</p>
</div>
<div class="section" id="vi-du-xay-dung-mo-hinh-don-gian">
<h2>3.3. Ví dụ xây dựng mô hình đơn giản<a class="headerlink" href="#vi-du-xay-dung-mo-hinh-don-gian" title="Permalink to this headline">¶</a></h2>
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="nf">library</span><span class="p">(</span><span class="n">ISLR</span><span class="p">)</span>
<span class="nf">library</span><span class="p">(</span><span class="n">tidyverse</span><span class="p">)</span>
<span class="n">data</span> <span class="o">&lt;-</span> <span class="n">Default</span> <span class="o">%&gt;%</span>
  <span class="nf">select</span><span class="p">(</span><span class="o">-</span><span class="n">student</span><span class="p">)</span> <span class="o">%&gt;%</span>
  <span class="nf">mutate</span><span class="p">(</span><span class="n">default</span> <span class="o">=</span> <span class="nf">case_when</span><span class="p">(</span>
    <span class="n">default</span> <span class="o">==</span> <span class="s">&quot;Yes&quot;</span> <span class="o">~</span> <span class="m">1</span><span class="p">,</span>
    <span class="kc">TRUE</span> <span class="o">~</span> <span class="m">0</span>
  <span class="p">))</span>
</pre></div>
</div>
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="nf">library</span><span class="p">(</span><span class="n">broom</span><span class="p">)</span>
<span class="n">model</span> <span class="o">&lt;-</span> <span class="nf">glm</span><span class="p">(</span><span class="n">default</span> <span class="o">~</span> <span class="n">income</span> <span class="o">+</span> <span class="n">balance</span><span class="p">,</span> <span class="n">data</span> <span class="o">=</span> <span class="n">data</span><span class="p">,</span>
    <span class="n">family</span> <span class="o">=</span> <span class="s">&quot;binomial&quot;</span><span class="p">)</span>
<span class="n">model</span> <span class="o">%&gt;%</span> <span class="n">summary</span>
</pre></div>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1">##</span>
<span class="c1">## Call:</span>
<span class="c1">## glm(formula = default ~ income + balance, family = &quot;binomial&quot;,</span>
<span class="c1">##     data = data)</span>
<span class="c1">##</span>
<span class="c1">## Deviance Residuals:</span>
<span class="c1">##     Min       1Q   Median       3Q      Max</span>
<span class="c1">## -2.4725  -0.1444  -0.0574  -0.0211   3.7245</span>
<span class="c1">##</span>
<span class="c1">## Coefficients:</span>
<span class="c1">##               Estimate Std. Error z value Pr(&gt;|z|)</span>
<span class="c1">## (Intercept) -1.154e+01  4.348e-01 -26.545  &lt; 2e-16 ***</span>
<span class="c1">## income       2.081e-05  4.985e-06   4.174 2.99e-05 ***</span>
<span class="c1">## balance      5.647e-03  2.274e-04  24.836  &lt; 2e-16 ***</span>
<span class="c1">## ---</span>
<span class="c1">## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1</span>
<span class="c1">##</span>
<span class="c1">## (Dispersion parameter for binomial family taken to be 1)</span>
<span class="c1">##</span>
<span class="c1">##     Null deviance: 2920.6  on 9999  degrees of freedom</span>
<span class="c1">## Residual deviance: 1579.0  on 9997  degrees of freedom</span>
<span class="c1">## AIC: 1585</span>
<span class="c1">##</span>
<span class="c1">## Number of Fisher Scoring iterations: 8</span>
</pre></div>
</div>
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="nf">library</span><span class="p">(</span><span class="n">broom</span><span class="p">)</span>
<span class="n">model</span> <span class="o">%&gt;%</span>
  <span class="n">tidy</span> <span class="o">%&gt;%</span>
  <span class="nf">filter</span><span class="p">(</span><span class="n">term</span> <span class="o">!=</span> <span class="s">&quot;(Intercept)&quot;</span><span class="p">)</span> <span class="o">%&gt;%</span>
  <span class="nf">select</span><span class="p">(</span><span class="n">term</span><span class="p">,</span> <span class="n">estimate</span><span class="p">)</span> <span class="o">%&gt;%</span>
  <span class="nf">mutate</span><span class="p">(</span><span class="nf">`odd_increase </span><span class="p">(</span><span class="n">thousands</span> <span class="n">USD</span><span class="p">)</span><span class="n">`</span> <span class="o">=</span> <span class="nf">exp</span><span class="p">(</span><span class="m">1000</span><span class="o">*</span><span class="n">estimate</span><span class="p">))</span>
</pre></div>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1">## # A tibble: 2 x 3</span>
<span class="c1">##   term     estimate `odd_increase (thousands USD)`</span>
<span class="c1">##   &lt;chr&gt;       &lt;dbl&gt;                          &lt;dbl&gt;</span>
<span class="c1">## 1 income  0.0000208                           1.02</span>
<span class="c1">## 2 balance 0.00565                           283.</span>
</pre></div>
</div>
<p><strong>Ý nghĩa</strong>:</p>
<ul class="simple">
<li>Nếu <code class="docutils literal notranslate"><span class="pre">balance</span></code> tăng 1000 USD, khả năng khách hàng có nợ xấu tăng 283
lần</li>
<li>Nếu <code class="docutils literal notranslate"><span class="pre">income</span></code> tăng 1000 USD, khả năng khách hàng có nợ xấu tăng 1.02
lần</li>
</ul>
<p>Khi ước lượng được các tham số <span class="math notranslate">\(\beta_j\)</span>, với mỗi KH cụ thể ta có
thể ước lượng được XS KH có nợ xấu bằng bao nhiêu dựa vào dư nợ của KH
đó. Từ đó, ta có thể phân loại được KH Good/Bad (ko có nợ xấu/có nợ xấu)
bằng việc so sánh XS có nợ xấu của KH với giá trị ngưỡng (“cutoff
point”).</p>
<p>Ví dụ, XS có nợ xấu của KH A là 0.2, điểm cutoff ta lựa chọn để phân
loại là 0.5 -&gt; KH A - “Good”.</p>
<p><strong>Dự báo trên tập mới</strong>.</p>
<p>Để dự báo trên tập dữ liệu mới, ta có thể dùng hàm <code class="docutils literal notranslate"><span class="pre">predict</span></code> với
option <code class="docutils literal notranslate"><span class="pre">type</span> <span class="pre">=</span> <span class="pre">&quot;response&quot;</span></code> để trả ra kết quả dưới dạng xác suất xảy ra
event (trong ví dụ này là xác suất xảy ra nợ xâu)</p>
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="nf">predict</span><span class="p">(</span><span class="n">model</span><span class="p">,</span> <span class="n">data</span> <span class="o">%&gt;%</span> <span class="n">head</span><span class="p">,</span> <span class="n">type</span> <span class="o">=</span> <span class="s">&quot;response&quot;</span><span class="p">)</span>
</pre></div>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1">##            1            2            3            4            5</span>
<span class="c1">## 0.0015047280 0.0012619299 0.0080262106 0.0004059957 0.0018267237</span>
<span class="c1">##            6</span>
<span class="c1">## 0.0020424398</span>
</pre></div>
</div>
</div>
<div class="section" id="cac-chi-so-can-quan-tam-khac">
<h2>3.4. Các chỉ số cần quan tâm khác<a class="headerlink" href="#cac-chi-so-can-quan-tam-khac" title="Permalink to this headline">¶</a></h2>
<p><strong>Null deviance vs.&nbsp;Residual Deviance</strong></p>
<ul>
<li><p class="first">LL: Log Likelihood</p>
<div class="math notranslate">
\[null\;deviance = 2(LL(saturated\;model) - LL(null\;model))\]</div>
<div class="math notranslate">
\[residual\;deviance = 2(LL(saturated\;model) - LL(proposed\;model))\]</div>
</li>
<li><p class="first">Trong đó:</p>
<ul class="simple">
<li>Saturated Model: Mỗi quan sát có 1 tham số riêng cần phải ước
lượng (n tham số)</li>
<li>Null Model: Tất cả quan sát chỉ có 1 tham số</li>
<li>Proposed Model: Mô hình có p tham số ứng với p biến và 1 tham số
ứng với intercept (p+1 tham số)</li>
</ul>
</li>
<li><p class="first">Nếu Null deviance thấp, nghĩa là mô hình có thể giải thích bằng mô
hình đơn giản</p>
</li>
</ul>
</div>
<div class="section" id="danh-gia-chat-luong-mo-hinh">
<h2>3.5. Đánh giá chất lượng mô hình<a class="headerlink" href="#danh-gia-chat-luong-mo-hinh" title="Permalink to this headline">¶</a></h2>
<p>Khi xây dựng mô hình dự báo, kết quả dự báo sẽ được trả ra dưới dạng 1
dãy các điểm xác suất xảy ra sự kiện. Khi đó, ta sẽ phải lựa chọn điểm
mà tại đó, nếu xác suất dự báo cao hơn điểm này, các quan sát sẽ được
đánh dấu là nợ xấu. Xem ví dụ sau.</p>
<table border="1" class="docutils">
<colgroup>
<col width="43%" />
<col width="57%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Customer ID</th>
<th class="head">Xác suất nợ xấu</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>1</td>
<td>0.7</td>
</tr>
<tr class="row-odd"><td>2</td>
<td>0.5</td>
</tr>
<tr class="row-even"><td>3</td>
<td>0.4</td>
</tr>
<tr class="row-odd"><td>4</td>
<td>0.3</td>
</tr>
</tbody>
</table>
<ul class="simple">
<li>Nếu cutoff là 0.6: Khách hàng 1 được dự báo sẽ có nợ xấu</li>
<li>Nếu cutoff là 0.45: Khách hàng 1, 2 được dự báo sẽ có nợ xấu</li>
</ul>
<p>Như vậy, với mỗi điểm cutoff khác nhau, ta sẽ có số lượng khách hàng bị
nợ xấu khác nhau</p>
<p><strong>R bình phương</strong></p>
<p>Không giống như mô hình OLS, trong mô hình OLS không có <span class="math notranslate">\(R^2\)</span> để
giải thích độ biến động của dữ liệu khi sử dụng mô hình. Tuy nhiên, mô
hình logistic có chỉ số pseudo <span class="math notranslate">\(R^2\)</span> được
<a class="reference external" href="http://stats.stackexchange.com/questions/82105/mcfaddens-pseudo-r2-interpretation">McFadden’s</a>
đưa ra. Chỉ số này có thể được dùng tương tự như <span class="math notranslate">\(R^2\)</span> trong OLS.</p>
<div class="math notranslate">
\[R^2 = 1−\frac{ln(LM_1)}{ln(LM_0)}\]</div>
<p>Trong đó:</p>
<ul class="simple">
<li><span class="math notranslate">\(ln(LM_1)\)</span> là log likelihood của mô hình</li>
<li><span class="math notranslate">\(ln(LM_0)\)</span> là log likelihood của mull model, nghĩa là mô hình
chỉ có hệ số tự do intercept.</li>
</ul>
<p>Trong mô hình logistic, nếu <span class="math notranslate">\(R^2\)</span> có giá trị trên 0.4 đã được coi
là mô hình tương đối tốt.</p>
<div class="section" id="confusion-matrix">
<h3>3.5.1. Confusion Matrix<a class="headerlink" href="#confusion-matrix" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li><strong>Confusion Matrix</strong>: Bảng mô tả kết quả dự báo vs.&nbsp;thực tế ứng với 1
điểm cut-off xác định trước.</li>
</ul>
<p><img alt="image2" src="Images/log6.png" /></p>
<ul>
<li><p class="first">Tính toán các chỉ số:</p>
<ul>
<li><p class="first">Accuracy (acc): Tỷ lệ dự báo chính xác trên cả hai class. Acc</p>
<div class="math notranslate">
\[Accuracy = \frac{TP+TN}{TP+TN+FN+FP}\]</div>
<p>.</p>
</li>
<li><p class="first">True Negative Rate (tnr): Tỷ lệ dự đoán Negative chính xác trong
toàn bộ quan sát thực tế là <em>Negative</em></p>
<div class="math notranslate">
\[tnr = Specificity = \frac{TN}{TN + FP}\]</div>
</li>
<li><p class="first">False Positive Rate (fpr - fall out): Tỷ lệ dự đoán Positive sai,
hay tỷ lệ các quan sát thực tế là Negative nhưng lại được dự báo
thành Positive</p>
<div class="math notranslate">
\[fpr = 1- Specificity = \frac{FP}{TN + FP}\]</div>
</li>
<li><p class="first">True Positive Rate (tpr - Sensitivity - hay còn gọi là
<strong>recall</strong>): Tỷ lệ dự báo Positive chính xác trên toàn bộ số lượng
quan sát thực tế là Positive</p>
<div class="math notranslate">
\[tpr = Sensitivity = \frac{TP}{TP + FN}\]</div>
</li>
<li><p class="first">False Negative Rate (fnr - Sensitivity): Tỷ lệ dự báo negative sai
- tỷ lệ positive nhưng dự báo nhầm thành Negative</p>
<div class="math notranslate">
\[fnr = 1- Sensitivity = \frac{FN}{FN + TP}\]</div>
</li>
<li><p class="first">Support: Tỷ lệ dự báo Positive trong toàn mẫu</p>
<div class="math notranslate">
\[sup = \frac{TP + FP}{N} = \frac{predicted pos}{total}\]</div>
</li>
<li><p class="first">Precision: Trong tổng số quan sát dự báo là Positive, bao nhiêu
quan sát thực sự là Positive</p>
<div class="math notranslate">
\[Precision = \frac{TP}{TP+FP}\]</div>
</li>
<li><p class="first">Rate of positive predictions (RPP): tỷ lệ tổng số quan sát được dự
báo là Y=1 (có nợ xấu) trên tổng số quan sát.</p>
</li>
</ul>
</li>
</ul>
<p>Trong các chỉ số trên, các chỉ số True Positive Rate, Precision và
Accuracy là quan trọng nhất. Để hiểu hơn về các chỉ số trên, giả sử ta
có bảng <em>confusion matrix</em> như sau:</p>
<table border="1" class="docutils">
<colgroup>
<col width="60%" />
<col width="20%" />
<col width="20%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Predicted/Actual</th>
<th class="head">1</th>
<th class="head">0</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>1</td>
<td>0.4</td>
<td>0.1</td>
</tr>
<tr class="row-odd"><td>0</td>
<td>0.2</td>
<td>0.3</td>
</tr>
</tbody>
</table>
<p>Các chỉ số trong bảng trên được tính như sau:</p>
<ul class="simple">
<li><span class="math notranslate">\(accurracy = 0.4 + 0.3 = 0.7\)</span>: Tỷ lệ dự báo chính xác trên cả
hai class là 70%. Nói cách khác, trong 100 quan sát, mô hình dự báo
chính xác 70%</li>
<li><span class="math notranslate">\(True \; Positive \; Rate = TPR = \frac{0.4}{0.4 + 0.2} = 0.67\)</span>
Trong 100 khách hàng thực sự bị nợ xấu, mô hình dự báo chính xác được
67 khách hàng.</li>
<li><span class="math notranslate">\(Precision = \frac{0.4}{0.4 + 0.1} = 0.8\)</span> Trong 100 khách hàng
được dự báo là nợ xấu, có 80 khách hàng thực sự bị nợ xấu</li>
<li><span class="math notranslate">\(True \;Negative \;Rate = Specificity = \frac{0.3}{0.3+0.1}=0.75\)</span>
Trong 100 khách hàng tốt, mô hình dự đoán chính xác 75 khách hàng</li>
</ul>
<p>Với phương pháp sử dụng <em>Confusion Matrix</em>, kết quả dự báo của mô hình
trở nên đơn giản, dễ hiểu, dễ giải thích. Tuy nhiên, để có được
confusion matrix, ta phải xác định trước giá trị của điểm cut-off. Điều
này không hề dễ dàng bởi lẽ mỗi điểm cut-off sẽ cho ta 1 giá trị của
confusion matrix hoàn toàn khác nhau. Để khắc phục điểm yếu này, một chỉ
số khác thường được sử dụng là đường ROC với chỉ số AUC.</p>
</div>
<div class="section" id="roc">
<h3>3.5.2. ROC<a class="headerlink" href="#roc" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li><strong>ROC Curve</strong>: Receiver Operating Characteristic. ROC cho ta đánh giá
hiệu quả của mô hình thông qua sự đánh đổi giữa TPR và FPR.</li>
<li><strong>Ý nghĩa</strong>: Mô tả tỷ lệ đánh đổi giữa 2 tỷ lệ: i, Tỷ lệ dự báo chính
xác sự kiện A và ii, Tỷ lệ dự báo rằng sự kiện đó không diễn ra<ul>
<li>Dự báo mang tính ngẫu nhiên (50 - 50), ROC là đường 45 độ</li>
<li>Dự báo hoàn toàn chính xác thì ROC là đường có dạng tam giác</li>
<li>Dự báo kém hơn kỳ vọng thì ROC ở dưới đường 45 độ</li>
<li>AUC (Area Under Curve): Cho phép so sánh độ chính xác của mô hình.
AUC càng cao (ROC ở vị trí càng cao) thì mô hình càng chính xác</li>
</ul>
</li>
</ul>
<div class="section" id="ly-thuyet">
<h4>3.5.2.1. Lý thuyết<a class="headerlink" href="#ly-thuyet" title="Permalink to this headline">¶</a></h4>
<p>Để xây dựng đường ROC trong, ta có các ký hiệu sau.</p>
<ul class="simple">
<li>N: số lượng quan sát</li>
<li>NEG: số lượng NEGATIVE, neg: tỷ lệ negative
(<span class="math notranslate">\(neg = \frac{NEG}{N}\)</span>)</li>
<li>POS: số lượng POSITIVE, pos: tỷ lệ positive
(<span class="math notranslate">\(pos = \frac{POS}{N}\)</span>)</li>
</ul>
<p>Quan hệ giữa acc và fpr, tpr:</p>
<div class="math notranslate">
\[acc =  \frac{TP}{N} \frac{TN}{N}= \frac{TP}{POS}\frac{POS}{N} + \frac{NEG-FP}{N}
= \frac{TP}{POS}\frac{POS}{N} + \frac{NEG}{N} - \frac{FP}{NEG}\frac{NEG}{N}\]</div>
<div class="math notranslate">
\[acc = tpr * pos + neg - neg * fpr\]</div>
<p>hay:</p>
<div class="math notranslate">
\[tpr = \frac{acc-neg}{pos} + \frac{neg}{pos}fpr\]</div>
<p>công thức trên giúp ta vẽ được đồ thị đường acc theo tpr và fpr</p>
<ul>
<li><p class="first">Đồ thị acc với 1 số trường hợp:</p>
<p><img alt="image3" src="Images/log1.png" /></p>
<p><img alt="image4" src="Images/log2.png" /></p>
</li>
</ul>
<p><strong>Lưu ý</strong>:</p>
<ul>
<li><p class="first">Mỗi điểm trên ROC thể hiện kết quả của mô hình ứng vơi <strong>MỘT</strong> điểm
cut-off. Do đó khi vẽ đường ROC, máy tính sẽ thay đổi các điểm cutoff
từ 0-1, sau đó tính tpr &amp; fpr với từng điểm cutoff. Tập hợp tất cả
các điểm này tạo thành ROC</p>
</li>
<li><p class="first">Để tìm điểm cutoff tốt nhất, nghia là với mô hình đã đưa ra, chọn
cutoff <span class="math notranslate">\(\alpha\)</span> sao cho <span class="math notranslate">\(acc\)</span> đạt max.</p>
</li>
<li><p class="first">Thuật toán:</p>
<ul class="simple">
<li>Vẽ đường acc theo tpr và fpr</li>
<li>Tịnh tiến đường acc cho đến khi acc tiếp tuyến với ROC</li>
<li>Tiếp điểm chính là điểm <span class="math notranslate">\(\alpha\)</span> cần tìm</li>
</ul>
<p><img alt="image5" src="Images/log3.png" /></p>
<p><img alt="image6" src="Images/log4.png" /></p>
</li>
</ul>
</div>
<div class="section" id="cach-ve-roc-thuc-te">
<h4>3.5.2.2. Cách vẽ ROC thực tế<a class="headerlink" href="#cach-ve-roc-thuc-te" title="Permalink to this headline">¶</a></h4>
<p>Trên thực tế, ROC được vẽ với thuật toán như sau:</p>
<ul class="simple">
<li>Gọi F là hàm tính xác suất của Y trong GLM</li>
</ul>
<div class="math notranslate">
\[F(X) ~ \frac{P(X)}{1-P(X)} = e^{\beta X}\]</div>
<ul>
<li><p class="first">Tính F(X) với tập dữ liệu phân tích, sắp xếp F(X) theo giá trị từ cao
xuống thấp. Tập hợp này tạo thành tập hợp A của biến score = x</p>
</li>
<li><p class="first">Bắt đầu từ điểm (0,0)</p>
</li>
<li><p class="first">Với mỗi giá trị của <span class="math notranslate">\(x \in A\)</span>, thực hiện như sau:</p>
<ul class="simple">
<li>Nếu x positive, di chuyển lên trên 1/pos</li>
<li>Nếu x negative, di chuyển sang phải 1/neg</li>
</ul>
<p><img alt="image7" src="Images/log5.gif" /></p>
</li>
</ul>
<p>Đường ROC nằm càng hướng về phía đỉnh góc bên trái thì độ chính xác của
dự báo càng cao, điều đó thể hiện true positive rate cao và false
positive rate thấp; còn nếu càng tiến tới đường chéo 45 độ so với trục
hoành thì độ chính xác của dự báo càng kém. Đường chéo 45 độ so với trục
hoành thể hiện sự phân loại là không có ý nghĩa.</p>
<p><strong>AUC</strong> (Area under ROC curve) - diện tích phía dưới đường cong ROC, là
thước đo độ chính xác của sự phân loại. AUC càng lớn thì độ chính xác
càng cao.</p>
<ul class="simple">
<li>AUC từ 0.5-0.6: Mô hình chỉ tương đương với việc chọn ngẫu nhiên</li>
<li>0.6-0.7: Chất lượng mô hình kém</li>
<li>0.7-0.8: Tương đối tốt</li>
<li>0.8-0.9: Tốt</li>
<li>trên 0.9: Rất tốt</li>
</ul>
<p>Nói cách khác, chỉ số AUC cho phép ta biết được chất lượng phân loại của
mô hình. AUC càng cao, cho ta thấy các quan sát xảy ra <em>positive class</em>
(nợ xấu), càng có điểm score cao (tương đối) và ngược lại.</p>
</div>
</div>
<div class="section" id="gain-va-lift">
<h3>3.5.3. Gain và Lift<a class="headerlink" href="#gain-va-lift" title="Permalink to this headline">¶</a></h3>
<p>Gain và Lift là hai biểu đồ vô cùng quan trọng với các nhà phân tích dữ
liệu thực tiễn nhưng lại ít được các nhà lý thuyết sử dụng. Hai đường
này đặc biệt quan trọng khi xây dựng các chiến lược marketing.</p>
<p><strong>Đường gain</strong> là tổ hợp giữa TPR (True Positive Rate) và RPP (Rate of
Positive Prediction). Vị trí các điểm trên đường gain cho ta biết nên
chọn điểm cut-off như thế nào.</p>
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="nf">library</span><span class="p">(</span><span class="n">scales</span><span class="p">)</span>
<span class="n">df</span> <span class="o">&lt;-</span> <span class="nf">data.frame</span><span class="p">(</span><span class="n">tpr</span> <span class="o">=</span> <span class="nf">c</span><span class="p">(</span><span class="m">0</span><span class="p">,</span> <span class="m">0.4</span><span class="p">,</span> <span class="m">0.7</span><span class="p">,</span> <span class="m">0.8</span><span class="p">,</span> <span class="m">0.85</span><span class="p">,</span> <span class="m">0.88</span><span class="p">,</span> <span class="m">0.93</span><span class="p">,</span> <span class="m">0.94</span><span class="p">,</span> <span class="m">0.97</span><span class="p">,</span> <span class="m">0.99</span><span class="p">,</span> <span class="m">1</span><span class="p">),</span>
                 <span class="n">rpp</span> <span class="o">=</span> <span class="nf">c</span><span class="p">(</span><span class="m">0</span><span class="p">,</span><span class="nf">seq</span><span class="p">(</span><span class="m">0.1</span><span class="p">,</span><span class="m">1</span><span class="p">,</span> <span class="n">by</span> <span class="o">=</span> <span class="m">0.1</span><span class="p">)))</span> <span class="o">%&gt;%</span>
  <span class="nf">mutate</span><span class="p">(</span><span class="n">lift</span> <span class="o">=</span> <span class="n">tpr</span><span class="o">/</span><span class="n">rpp</span><span class="p">)</span> <span class="o">%&gt;%</span>
  <span class="nf">mutate</span><span class="p">(</span><span class="n">lift</span> <span class="o">=</span> <span class="nf">replace_na</span><span class="p">(</span><span class="n">lift</span><span class="p">,</span> <span class="m">0</span><span class="p">))</span>

<span class="n">df</span> <span class="o">%&gt;%</span>
  <span class="nf">ggplot</span><span class="p">(</span><span class="nf">aes</span><span class="p">(</span><span class="n">rpp</span><span class="p">,</span> <span class="n">tpr</span><span class="p">))</span> <span class="o">+</span>
  <span class="nf">geom_line</span><span class="p">(</span><span class="n">col</span> <span class="o">=</span> <span class="s">&quot;darkred&quot;</span><span class="p">,</span> <span class="n">alpha</span> <span class="o">=</span> <span class="m">0.7</span><span class="p">)</span> <span class="o">+</span>
  <span class="nf">geom_point</span><span class="p">(</span><span class="n">col</span> <span class="o">=</span> <span class="s">&quot;darkred&quot;</span><span class="p">,</span> <span class="n">size</span> <span class="o">=</span> <span class="m">2</span><span class="p">)</span> <span class="o">+</span>
  <span class="nf">geom_text</span><span class="p">(</span><span class="nf">aes</span><span class="p">(</span><span class="n">label</span> <span class="o">=</span> <span class="n">tpr</span><span class="p">),</span> <span class="n">vjust</span> <span class="o">=</span> <span class="m">-0.5</span><span class="p">)</span> <span class="o">+</span>
  <span class="nf">theme_classic</span><span class="p">()</span> <span class="o">+</span>
  <span class="nf">scale_x_continuous</span><span class="p">(</span><span class="n">breaks</span> <span class="o">=</span> <span class="nf">seq</span><span class="p">(</span><span class="m">0.1</span><span class="p">,</span> <span class="m">1</span><span class="p">,</span> <span class="n">by</span> <span class="o">=</span> <span class="m">0.1</span><span class="p">))</span> <span class="o">+</span>
  <span class="nf">geom_line</span><span class="p">(</span><span class="nf">aes</span><span class="p">(</span><span class="n">rpp</span><span class="p">,</span> <span class="n">rpp</span><span class="p">),</span> <span class="n">col</span> <span class="o">=</span> <span class="s">&quot;black&quot;</span><span class="p">,</span> <span class="n">alpha</span> <span class="o">=</span> <span class="m">1</span><span class="p">,</span> <span class="n">linetype</span> <span class="o">=</span> <span class="s">&quot;dashed&quot;</span><span class="p">)</span> <span class="o">+</span>
  <span class="nf">annotate</span><span class="p">(</span><span class="n">geom</span> <span class="o">=</span> <span class="s">&quot;text&quot;</span><span class="p">,</span> <span class="n">x</span> <span class="o">=</span> <span class="m">0.5</span><span class="p">,</span> <span class="n">y</span> <span class="o">=</span> <span class="m">0.45</span><span class="p">,</span> <span class="n">label</span> <span class="o">=</span> <span class="s">&quot;Base line (No model)&quot;</span><span class="p">,</span> <span class="n">hjust</span> <span class="o">=</span> <span class="m">0</span><span class="p">)</span> <span class="o">+</span>
  <span class="nf">geom_vline</span><span class="p">(</span><span class="n">xintercept</span> <span class="o">=</span> <span class="nf">seq</span><span class="p">(</span><span class="m">0.1</span><span class="p">,</span> <span class="m">1</span><span class="p">,</span> <span class="n">by</span> <span class="o">=</span> <span class="m">0.1</span><span class="p">),</span> <span class="n">linetype</span> <span class="o">=</span> <span class="s">&quot;dashed&quot;</span><span class="p">,</span> <span class="n">col</span> <span class="o">=</span> <span class="s">&quot;darkgrey&quot;</span><span class="p">,</span> <span class="n">alpha</span> <span class="o">=</span> <span class="m">0.3</span><span class="p">)</span> <span class="o">+</span>
  <span class="nf">labs</span><span class="p">(</span><span class="n">x</span> <span class="o">=</span> <span class="s">&quot;Rate of Positive Prediction&quot;</span><span class="p">,</span>
       <span class="n">y</span> <span class="o">=</span> <span class="s">&quot;True Positive Rate&quot;</span><span class="p">,</span>
       <span class="n">title</span> <span class="o">=</span> <span class="s">&quot;Gain chart&quot;</span><span class="p">)</span>
</pre></div>
</div>
<p><img alt="image8" src="p03-03-logistic-regression_files/figure-html/unnamed-chunk-7-1.png" /></p>
<p><strong>Giải thích</strong>:</p>
<ul class="simple">
<li>Với top 20% khách hàng có điểm score cao nhất sẽ phủ được 70% khách
hàng có nợ xấu trong thực tế.</li>
<li>Với top 30% khách hàng có điểm score cao nhất sẽ phủ được 80% khách
hàng có nợ xấu trong thực tế.</li>
</ul>
<p>Thông thường, đường gain được chia thành các decile (10%) để
marketing/risk manager quyết định điểm cut-off trong mô hình. Nếu số
lượng khách hàng ít, 1000 khách hàng, đôi khi ta có thể quyết định gửi
email marketing cho cả 1000 khách hàng này.</p>
<p>Trong khi đó, đường <strong>lift</strong> thể hiện khía cạnh khác trong việc xây dựng
mô hình. Đường lift cho ta biết, ứng với từng decile, chất lượng mô hình
cao hơn bao nhiêu lần so với việc không sử dụng mô hình (ngẫu nhiên).
Đường lift luôn giảm về 1 khi ta dự báo 100% tất cả quan sát thuộc về
nhóm <em>positive</em>.</p>
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="n">df</span> <span class="o">%&gt;%</span>
  <span class="nf">filter</span><span class="p">(</span><span class="n">lift</span> <span class="o">&gt;</span> <span class="m">0</span><span class="p">)</span> <span class="o">%&gt;%</span>
  <span class="nf">ggplot</span><span class="p">(</span><span class="nf">aes</span><span class="p">(</span><span class="n">rpp</span><span class="p">,</span> <span class="n">lift</span><span class="p">))</span> <span class="o">+</span>
  <span class="nf">geom_line</span><span class="p">()</span> <span class="o">+</span>
  <span class="nf">geom_point</span><span class="p">()</span> <span class="o">+</span>
  <span class="nf">theme_classic</span><span class="p">()</span> <span class="o">+</span>
  <span class="nf">geom_line</span><span class="p">(</span><span class="n">col</span> <span class="o">=</span> <span class="s">&quot;darkred&quot;</span><span class="p">,</span> <span class="n">alpha</span> <span class="o">=</span> <span class="m">0.7</span><span class="p">)</span> <span class="o">+</span>
  <span class="nf">geom_point</span><span class="p">(</span><span class="n">col</span> <span class="o">=</span> <span class="s">&quot;darkred&quot;</span><span class="p">,</span> <span class="n">size</span> <span class="o">=</span> <span class="m">2</span><span class="p">)</span> <span class="o">+</span>
  <span class="nf">geom_text</span><span class="p">(</span><span class="nf">aes</span><span class="p">(</span><span class="n">label</span> <span class="o">=</span> <span class="nf">round</span><span class="p">(</span><span class="n">lift</span><span class="p">,</span> <span class="m">1</span><span class="p">)),</span> <span class="n">vjust</span> <span class="o">=</span> <span class="m">-0.5</span><span class="p">,</span> <span class="n">hjust</span> <span class="o">=</span> <span class="m">0</span><span class="p">)</span> <span class="o">+</span>
  <span class="nf">theme_classic</span><span class="p">()</span> <span class="o">+</span>
  <span class="nf">scale_x_continuous</span><span class="p">(</span><span class="n">breaks</span> <span class="o">=</span> <span class="nf">seq</span><span class="p">(</span><span class="m">0.1</span><span class="p">,</span> <span class="m">1</span><span class="p">,</span> <span class="n">by</span> <span class="o">=</span> <span class="m">0.1</span><span class="p">))</span> <span class="o">+</span>
  <span class="nf">annotate</span><span class="p">(</span><span class="n">geom</span> <span class="o">=</span> <span class="s">&quot;text&quot;</span><span class="p">,</span> <span class="n">x</span> <span class="o">=</span> <span class="m">0.1</span><span class="p">,</span> <span class="n">y</span> <span class="o">=</span> <span class="m">1.1</span><span class="p">,</span> <span class="n">label</span> <span class="o">=</span> <span class="s">&quot;Base line (No model)&quot;</span><span class="p">,</span> <span class="n">hjust</span> <span class="o">=</span> <span class="m">0</span><span class="p">)</span> <span class="o">+</span>
  <span class="nf">geom_vline</span><span class="p">(</span><span class="n">xintercept</span> <span class="o">=</span> <span class="nf">seq</span><span class="p">(</span><span class="m">0.1</span><span class="p">,</span> <span class="m">1</span><span class="p">,</span> <span class="n">by</span> <span class="o">=</span> <span class="m">0.1</span><span class="p">),</span> <span class="n">linetype</span> <span class="o">=</span> <span class="s">&quot;dashed&quot;</span><span class="p">,</span> <span class="n">col</span> <span class="o">=</span> <span class="s">&quot;darkgrey&quot;</span><span class="p">,</span> <span class="n">alpha</span> <span class="o">=</span> <span class="m">0.3</span><span class="p">)</span> <span class="o">+</span>
  <span class="nf">geom_hline</span><span class="p">(</span><span class="n">yintercept</span> <span class="o">=</span> <span class="m">1</span><span class="p">,</span> <span class="n">linetype</span> <span class="o">=</span> <span class="s">&quot;dashed&quot;</span><span class="p">,</span> <span class="n">col</span> <span class="o">=</span> <span class="s">&quot;darkblue&quot;</span><span class="p">,</span> <span class="n">alpha</span> <span class="o">=</span> <span class="m">1</span><span class="p">,</span> <span class="n">size</span> <span class="o">=</span> <span class="m">0.7</span><span class="p">)</span> <span class="o">+</span>
  <span class="nf">labs</span><span class="p">(</span><span class="n">x</span> <span class="o">=</span> <span class="s">&quot;Rate of Positive Prediction&quot;</span><span class="p">,</span>
       <span class="n">y</span> <span class="o">=</span> <span class="s">&quot;Lift ratio&quot;</span><span class="p">,</span>
       <span class="n">title</span> <span class="o">=</span> <span class="s">&quot;Lift chart&quot;</span><span class="p">)</span>
</pre></div>
</div>
<p><img alt="image9" src="p03-03-logistic-regression_files/figure-html/unnamed-chunk-8-1.png" /></p>
<p><strong>Ý nghĩa</strong>: Trong đồ thị trên, với top 10% khách hàng có điểm score mua
hàng cao nhất, tỷ lệ khách hàng mua hàng cao hơn 4 lần so với việc không
sử dụng mô hình (hay ngẫu nhiên)</p>
</div>
<div class="section" id="kolmogorovsmirnov-statistics">
<h3>3.5.4. Kolmogorov–Smirnov statistics<a class="headerlink" href="#kolmogorovsmirnov-statistics" title="Permalink to this headline">¶</a></h3>
<p>Chỉ số thống kê Kolmogorov-Smirnov là chỉ số khác để đo lường chất lượng
mô hình. Chỉ số này cho ta biết được liệu phân phối của của nhóm
<em>positive</em> có thực sự khác nhóm <em>negative</em> hay không.</p>
<p>Chỉ số KS được đo lường bằng khoảng cách lớn nhất giữa hai đường phân
phối lũy kế xác suất trên hai class. Khi xây dựng mô hình, KS có thể
được tính theo công thức sau.</p>
<div class="math notranslate">
\[KS = max(abs(tpr - fpr))\]</div>
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="n">pos_class</span> <span class="o">&lt;-</span> <span class="nf">c</span><span class="p">(</span><span class="m">0.8</span><span class="p">,</span> <span class="m">0.75</span><span class="p">,</span> <span class="m">0.7</span><span class="p">,</span> <span class="m">0.55</span><span class="p">,</span> <span class="m">0.4</span><span class="p">)</span>
<span class="n">pos_class</span>
</pre></div>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1">## [1] 0.80 0.75 0.70 0.55 0.40</span>
</pre></div>
</div>
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="n">neg_class</span> <span class="o">&lt;-</span> <span class="nf">c</span><span class="p">(</span><span class="m">0.7</span><span class="p">,</span> <span class="m">0.4</span><span class="p">,</span> <span class="m">0.3</span><span class="p">,</span> <span class="m">0.2</span><span class="p">,</span> <span class="m">0.15</span><span class="p">)</span>
<span class="n">neg_class</span>
</pre></div>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1">## [1] 0.70 0.40 0.30 0.20 0.15</span>
</pre></div>
</div>
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="nf">ks.test</span><span class="p">(</span><span class="n">pos_class</span><span class="p">,</span> <span class="n">neg_class</span><span class="p">,</span> <span class="n">alternative</span> <span class="o">=</span> <span class="s">&quot;greater&quot;</span><span class="p">)</span>
</pre></div>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1">##</span>
<span class="c1">##  Two-sample Kolmogorov-Smirnov test</span>
<span class="c1">##</span>
<span class="c1">## data:  pos_class and neg_class</span>
<span class="c1">## D^+ = 0, p-value = 1</span>
<span class="c1">## alternative hypothesis: the CDF of x lies above that of y</span>
</pre></div>
</div>
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="nf">data.frame</span><span class="p">(</span><span class="n">pos_class</span><span class="p">,</span> <span class="n">neg_class</span><span class="p">)</span> <span class="o">%&gt;%</span>
  <span class="nf">ggplot</span><span class="p">()</span> <span class="o">+</span>
  <span class="nf">stat_ecdf</span><span class="p">(</span><span class="nf">aes</span><span class="p">(</span><span class="n">pos_class</span><span class="p">),</span> <span class="n">col</span> <span class="o">=</span> <span class="s">&quot;darkred&quot;</span><span class="p">,</span> <span class="n">geom</span> <span class="o">=</span> <span class="s">&quot;line&quot;</span><span class="p">)</span> <span class="o">+</span>
  <span class="nf">stat_ecdf</span><span class="p">(</span><span class="nf">aes</span><span class="p">(</span><span class="n">neg_class</span><span class="p">),</span> <span class="n">col</span> <span class="o">=</span> <span class="s">&quot;darkblue&quot;</span><span class="p">,</span> <span class="n">geom</span> <span class="o">=</span> <span class="s">&quot;line&quot;</span><span class="p">)</span> <span class="o">+</span>
  <span class="nf">annotate</span><span class="p">(</span><span class="n">geom</span> <span class="o">=</span> <span class="s">&quot;text&quot;</span><span class="p">,</span> <span class="n">x</span> <span class="o">=</span> <span class="m">0.5</span><span class="p">,</span> <span class="n">y</span> <span class="o">=</span> <span class="m">0.5</span><span class="p">,</span> <span class="n">label</span> <span class="o">=</span> <span class="s">&quot;KS = 0.6&quot;</span><span class="p">)</span> <span class="o">+</span>
  <span class="nf">theme_minimal</span><span class="p">()</span>
</pre></div>
</div>
<p><img alt="image10" src="p03-03-logistic-regression_files/figure-html/unnamed-chunk-10-1.png" /></p>
<p><img alt="image11" src="p03-03-logistic-regression_files/figure-html/unnamed-chunk-12-1.png" /></p>
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="n">result</span><span class="o">$</span><span class="n">ksTable</span>
</pre></div>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1">##   dec total responders nonresponders cumResponders cumNonresponders</span>
<span class="c1">## 1   1     1          1             0             1                0</span>
<span class="c1">## 2   2     1          1             0             2                0</span>
<span class="c1">## 3   4     2          1             1             3                1</span>
<span class="c1">## 4   5     1          1             0             4                1</span>
<span class="c1">## 5   7     2          1             1             5                2</span>
<span class="c1">## 6   8     1          0             1             5                3</span>
<span class="c1">## 7   9     1          0             1             5                4</span>
<span class="c1">## 8  10     1          0             1             5                5</span>
<span class="c1">##   perCumResponders perCumNonresponders split</span>
<span class="c1">## 1               20                   0    20</span>
<span class="c1">## 2               40                   0    40</span>
<span class="c1">## 3               60                  20    40</span>
<span class="c1">## 4               80                  20    60</span>
<span class="c1">## 5              100                  40    60</span>
<span class="c1">## 6              100                  60    40</span>
<span class="c1">## 7              100                  80    20</span>
<span class="c1">## 8              100                 100     0</span>
</pre></div>
</div>
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="n">result</span><span class="o">$</span><span class="n">ks</span> <span class="o">%&gt;%</span> <span class="n">print</span>
</pre></div>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1">## [1] 60</span>
</pre></div>
</div>
<hr class="docutils" />
<p>Trong bốn nhóm chỉ số đánh giá chất lượng mô hình đã trình bày ở trên,
nhóm chỉ số AUC, Gain và Lift là quan trọng nhất khi dự báo trong thực
tế, đặc biệt là khi score khách hàng trong chiến dịch marketing, bán
chéo, giảm thiểu khách hàng churn. Khi xây dựng các mô hình dự báo nợ
xấu, phê duyệt tín dụng, ta cần sử dụng cả 4 nhóm chỉ số trên để đánh
giá hiệu quả mô hình. Đặc biệt, nếu xây dựng mô hình score-card, ta còn
phải sử dụng 1 số kỹ thuật khác để có thể xây dựng hệ thống score-card
hiệu quả. Chi tiết phần score card sẽ được trình bày trong chương tiếp
theo.</p>
</div>
</div>
<div class="section" id="thuc-hanh">
<h2>3.6. Thực hành<a class="headerlink" href="#thuc-hanh" title="Permalink to this headline">¶</a></h2>
<div class="section" id="du-lieu">
<h3>3.6.1. Dữ liệu<a class="headerlink" href="#du-lieu" title="Permalink to this headline">¶</a></h3>
<p>Dùng gói dữ liệu Default có sẵn trong R, bao gồm thông tin của 10,000
khách hàng sử dụng thẻ tín dụng.</p>
<p>Giải thích các biến:</p>
<ul class="simple">
<li>Default: Yes/No (khách hàng có nợ xấu/không có nợ xấu)</li>
<li>Student: Yes/No (khách hàng là sinh viên/không phải là sinh viên)</li>
<li>Balance: Dư nợ TB còn lại của KH sau khi trả tiền hàng tháng.</li>
<li>Income: Thu nhập của khách hàng</li>
</ul>
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="n">data</span> <span class="o">&lt;-</span> <span class="n">Default</span>
<span class="n">data</span> <span class="o">%&gt;%</span> <span class="n">head</span>
</pre></div>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1">##   default student   balance    income</span>
<span class="c1">## 1      No      No  729.5265 44361.625</span>
<span class="c1">## 2      No     Yes  817.1804 12106.135</span>
<span class="c1">## 3      No      No 1073.5492 31767.139</span>
<span class="c1">## 4      No      No  529.2506 35704.494</span>
<span class="c1">## 5      No      No  785.6559 38463.496</span>
<span class="c1">## 6      No     Yes  919.5885  7491.559</span>
</pre></div>
</div>
</div>
<div class="section" id="xay-dung-mo-hinh-tren-tap-du-lieu-goc">
<h3>3.6.2. Xây dựng mô hình trên tập dữ liệu gốc<a class="headerlink" href="#xay-dung-mo-hinh-tren-tap-du-lieu-goc" title="Permalink to this headline">¶</a></h3>
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="n">glm.fit1</span> <span class="o">&lt;-</span> <span class="nf">glm</span><span class="p">(</span><span class="n">default</span> <span class="o">~</span> <span class="n">.,</span>
                <span class="n">data</span> <span class="o">=</span> <span class="n">data</span><span class="p">,</span>
                <span class="n">family</span> <span class="o">=</span> <span class="n">binomial</span><span class="p">)</span>
<span class="n">glm.fit1</span> <span class="o">%&gt;%</span> <span class="n">summary</span>
</pre></div>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1">##</span>
<span class="c1">## Call:</span>
<span class="c1">## glm(formula = default ~ ., family = binomial, data = data)</span>
<span class="c1">##</span>
<span class="c1">## Deviance Residuals:</span>
<span class="c1">##     Min       1Q   Median       3Q      Max</span>
<span class="c1">## -2.4691  -0.1418  -0.0557  -0.0203   3.7383</span>
<span class="c1">##</span>
<span class="c1">## Coefficients:</span>
<span class="c1">##               Estimate Std. Error z value Pr(&gt;|z|)</span>
<span class="c1">## (Intercept) -1.087e+01  4.923e-01 -22.080  &lt; 2e-16 ***</span>
<span class="c1">## studentYes  -6.468e-01  2.363e-01  -2.738  0.00619 **</span>
<span class="c1">## balance      5.737e-03  2.319e-04  24.738  &lt; 2e-16 ***</span>
<span class="c1">## income       3.033e-06  8.203e-06   0.370  0.71152</span>
<span class="c1">## ---</span>
<span class="c1">## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1</span>
<span class="c1">##</span>
<span class="c1">## (Dispersion parameter for binomial family taken to be 1)</span>
<span class="c1">##</span>
<span class="c1">##     Null deviance: 2920.6  on 9999  degrees of freedom</span>
<span class="c1">## Residual deviance: 1571.5  on 9996  degrees of freedom</span>
<span class="c1">## AIC: 1579.5</span>
<span class="c1">##</span>
<span class="c1">## Number of Fisher Scoring iterations: 8</span>
</pre></div>
</div>
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="n">glm.fit2</span> <span class="o">&lt;-</span> <span class="nf">step</span><span class="p">(</span><span class="n">glm.fit1</span><span class="p">)</span>
</pre></div>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1">## Start:  AIC=1579.54</span>
<span class="c1">## default ~ student + balance + income</span>
<span class="c1">##</span>
<span class="c1">##           Df Deviance    AIC</span>
<span class="c1">## - income   1   1571.7 1577.7</span>
<span class="c1">## &lt;none&gt;         1571.5 1579.5</span>
<span class="c1">## - student  1   1579.0 1585.0</span>
<span class="c1">## - balance  1   2907.5 2913.5</span>
<span class="c1">##</span>
<span class="c1">## Step:  AIC=1577.68</span>
<span class="c1">## default ~ student + balance</span>
<span class="c1">##</span>
<span class="c1">##           Df Deviance    AIC</span>
<span class="c1">## &lt;none&gt;         1571.7 1577.7</span>
<span class="c1">## - student  1   1596.5 1600.5</span>
<span class="c1">## - balance  1   2908.7 2912.7</span>
</pre></div>
</div>
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="n">glm.fit2</span> <span class="o">%&gt;%</span> <span class="n">summary</span>
</pre></div>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1">##</span>
<span class="c1">## Call:</span>
<span class="c1">## glm(formula = default ~ student + balance, family = binomial,</span>
<span class="c1">##     data = data)</span>
<span class="c1">##</span>
<span class="c1">## Deviance Residuals:</span>
<span class="c1">##     Min       1Q   Median       3Q      Max</span>
<span class="c1">## -2.4578  -0.1422  -0.0559  -0.0203   3.7435</span>
<span class="c1">##</span>
<span class="c1">## Coefficients:</span>
<span class="c1">##               Estimate Std. Error z value Pr(&gt;|z|)</span>
<span class="c1">## (Intercept) -1.075e+01  3.692e-01 -29.116  &lt; 2e-16 ***</span>
<span class="c1">## studentYes  -7.149e-01  1.475e-01  -4.846 1.26e-06 ***</span>
<span class="c1">## balance      5.738e-03  2.318e-04  24.750  &lt; 2e-16 ***</span>
<span class="c1">## ---</span>
<span class="c1">## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1</span>
<span class="c1">##</span>
<span class="c1">## (Dispersion parameter for binomial family taken to be 1)</span>
<span class="c1">##</span>
<span class="c1">##     Null deviance: 2920.6  on 9999  degrees of freedom</span>
<span class="c1">## Residual deviance: 1571.7  on 9997  degrees of freedom</span>
<span class="c1">## AIC: 1577.7</span>
<span class="c1">##</span>
<span class="c1">## Number of Fisher Scoring iterations: 8</span>
</pre></div>
</div>
<p>Giải thích:</p>
<ul class="simple">
<li>Beta(balance) &gt; 0: Balance và XS có nợ xấu của KH có quan hệ cùng
chiều (cái này tăng thì cái kia tăng).</li>
</ul>
<p>Beta(balance) = 0.0057: Balance tăng 1 đơn vị -&gt; Ln(Odds) tăng 0.0057
đơn vị.</p>
<ul class="simple">
<li>Beta(studentYes) &lt; 0: KH là sinh viên có XS có nợ xấu thấp hơn so với
KH ko là sinh viên.</li>
</ul>
<p>Giả sử KH B có balance = 1000$:</p>
<div class="math notranslate">
\[Pr(default=Yes|student=Yes)=\frac{e^{-10.75-0.7149*1+0.0057*1000}}{1+e^{-10.75-0.7149*1+0.0057*1000}}= 0.003\]</div>
<div class="math notranslate">
\[Pr(default=Yes|student=No)=\frac{e^{-10.75-0.7149*0+0.0057*1000}}{1+e^{-10.75-0.7149*0+0.0057*1000}}= 0.006\]</div>
</div>
<div class="section" id="xay-dung-mo-hinh-tren-hai-tap-train-va-test">
<h3>3.6.3. Xây dựng mô hình trên hai tập train và test<a class="headerlink" href="#xay-dung-mo-hinh-tren-hai-tap-train-va-test" title="Permalink to this headline">¶</a></h3>
<div class="section" id="chia-tap-train-test">
<h4>3.6.3.1. Chia tập train/test<a class="headerlink" href="#chia-tap-train-test" title="Permalink to this headline">¶</a></h4>
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="c1">#chia tập train/test</span>
<span class="nf">set.seed</span><span class="p">(</span><span class="m">1</span><span class="p">)</span>
<span class="n">train</span> <span class="o">&lt;-</span> <span class="nf">sample</span><span class="p">(</span><span class="nf">nrow</span><span class="p">(</span><span class="n">data</span><span class="p">),</span> <span class="m">0.7</span> <span class="o">*</span> <span class="nf">nrow</span><span class="p">(</span><span class="n">data</span><span class="p">))</span>
<span class="n">df.train</span> <span class="o">&lt;-</span> <span class="n">data[train</span><span class="p">,</span><span class="n">]</span>            <span class="c1"># tập train</span>
<span class="n">df.test</span> <span class="o">&lt;-</span> <span class="n">data[</span><span class="o">-</span><span class="n">train</span><span class="p">,</span><span class="n">]</span>        <span class="c1"># tập test</span>

<span class="n">df.train</span> <span class="o">%&gt;%</span> <span class="n">summary</span>
</pre></div>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1">##  default    student       balance           income</span>
<span class="c1">##  No :6766   No :4952   Min.   :   0.0   Min.   : 2541</span>
<span class="c1">##  Yes: 234   Yes:2048   1st Qu.: 474.6   1st Qu.:21436</span>
<span class="c1">##                        Median : 819.1   Median :34646</span>
<span class="c1">##                        Mean   : 831.7   Mean   :33609</span>
<span class="c1">##                        3rd Qu.:1157.8   3rd Qu.:43826</span>
<span class="c1">##                        Max.   :2654.3   Max.   :73554</span>
</pre></div>
</div>
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="n">df.test</span> <span class="o">%&gt;%</span> <span class="n">summary</span>
</pre></div>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1">##  default    student       balance           income</span>
<span class="c1">##  No :2901   No :2104   Min.   :   0.0   Min.   :  772</span>
<span class="c1">##  Yes:  99   Yes: 896   1st Qu.: 495.1   1st Qu.:20962</span>
<span class="c1">##                        Median : 831.3   Median :34396</span>
<span class="c1">##                        Mean   : 844.0   Mean   :33303</span>
<span class="c1">##                        3rd Qu.:1177.5   3rd Qu.:43751</span>
<span class="c1">##                        Max.   :2502.7   Max.   :70022</span>
</pre></div>
</div>
</div>
<div class="section" id="xay-dung-mo-hinh">
<h4>3.6.3.2. Xây dựng mô hình<a class="headerlink" href="#xay-dung-mo-hinh" title="Permalink to this headline">¶</a></h4>
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="n">fit.logit</span> <span class="o">&lt;-</span> <span class="nf">glm</span><span class="p">(</span><span class="n">default</span><span class="o">~</span><span class="n">.,</span> <span class="n">data</span> <span class="o">=</span> <span class="n">df.train</span><span class="p">,</span> <span class="n">family</span> <span class="o">=</span> <span class="n">binomial</span><span class="p">)</span>

<span class="c1">#giảm biến ko có ý nghĩa thống kê</span>
<span class="n">logit.fit.reduced</span> <span class="o">&lt;-</span> <span class="nf">step</span><span class="p">(</span><span class="n">fit.logit</span><span class="p">)</span>
</pre></div>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1">## Start:  AIC=1078.68</span>
<span class="c1">## default ~ student + balance + income</span>
<span class="c1">##</span>
<span class="c1">##           Df Deviance    AIC</span>
<span class="c1">## - income   1   1070.7 1076.7</span>
<span class="c1">## &lt;none&gt;         1070.7 1078.7</span>
<span class="c1">## - student  1   1076.2 1082.2</span>
<span class="c1">## - balance  1   2041.2 2047.2</span>
<span class="c1">##</span>
<span class="c1">## Step:  AIC=1076.74</span>
<span class="c1">## default ~ student + balance</span>
<span class="c1">##</span>
<span class="c1">##           Df Deviance    AIC</span>
<span class="c1">## &lt;none&gt;         1070.7 1076.7</span>
<span class="c1">## - student  1   1088.7 1092.7</span>
<span class="c1">## - balance  1   2042.7 2046.7</span>
</pre></div>
</div>
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="n">logit.fit.reduced</span> <span class="o">%&gt;%</span> <span class="n">summary</span>
</pre></div>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1">##</span>
<span class="c1">## Call:</span>
<span class="c1">## glm(formula = default ~ student + balance, family = binomial,</span>
<span class="c1">##     data = df.train)</span>
<span class="c1">##</span>
<span class="c1">## Deviance Residuals:</span>
<span class="c1">##     Min       1Q   Median       3Q      Max</span>
<span class="c1">## -2.5097  -0.1357  -0.0522  -0.0184   3.7777</span>
<span class="c1">##</span>
<span class="c1">## Coefficients:</span>
<span class="c1">##               Estimate Std. Error z value Pr(&gt;|z|)</span>
<span class="c1">## (Intercept) -1.098e+01  4.539e-01 -24.185  &lt; 2e-16 ***</span>
<span class="c1">## studentYes  -7.372e-01  1.787e-01  -4.125 3.71e-05 ***</span>
<span class="c1">## balance      5.890e-03  2.843e-04  20.716  &lt; 2e-16 ***</span>
<span class="c1">## ---</span>
<span class="c1">## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1</span>
<span class="c1">##</span>
<span class="c1">## (Dispersion parameter for binomial family taken to be 1)</span>
<span class="c1">##</span>
<span class="c1">##     Null deviance: 2050.5  on 6999  degrees of freedom</span>
<span class="c1">## Residual deviance: 1070.7  on 6997  degrees of freedom</span>
<span class="c1">## AIC: 1076.7</span>
<span class="c1">##</span>
<span class="c1">## Number of Fisher Scoring iterations: 8</span>
</pre></div>
</div>
</div>
<div class="section" id="du-bao-xac-suat-co-no-xau-tren-tap-test">
<h4>3.6.3.3. Dự báo xác suất có nợ xấu trên tập test<a class="headerlink" href="#du-bao-xac-suat-co-no-xau-tren-tap-test" title="Permalink to this headline">¶</a></h4>
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="n">prob.test</span> <span class="o">&lt;-</span> <span class="nf">predict</span><span class="p">(</span><span class="n">logit.fit.reduced</span><span class="p">,</span> <span class="n">df.test</span><span class="p">,</span> <span class="n">type</span> <span class="o">=</span> <span class="s">&quot;response&quot;</span><span class="p">)</span>

<span class="c1">#phân loại (chọn cutoff = 0.5)</span>
<span class="n">class.pred.test</span> <span class="o">&lt;-</span> <span class="nf">factor</span><span class="p">(</span><span class="n">prob.test</span> <span class="o">&gt;</span> <span class="m">0.5</span><span class="p">,</span>
                          <span class="n">levels</span> <span class="o">=</span> <span class="nf">c</span><span class="p">(</span><span class="kc">FALSE</span><span class="p">,</span> <span class="kc">TRUE</span><span class="p">),</span>
                          <span class="n">labels</span> <span class="o">=</span> <span class="nf">c</span><span class="p">(</span><span class="s">&quot;No&quot;</span><span class="p">,</span> <span class="s">&quot;Yes&quot;</span><span class="p">))</span>

<span class="c1">#kết quả trên tập test</span>
<span class="n">prob.test.df</span> <span class="o">&lt;-</span> <span class="n">prob.test</span> <span class="o">%&gt;%</span> <span class="nf">as.data.frame</span><span class="p">()</span>
<span class="nf">names</span><span class="p">(</span><span class="n">prob.test.df</span><span class="p">)</span><span class="n">[1]</span> <span class="o">&lt;-</span> <span class="s">&quot;prob.default&quot;</span>

<span class="c1">#Lụa chọn điểm cutoff là 0.5</span>
<span class="n">prob.test.df</span> <span class="o">&lt;-</span> <span class="n">prob.test.df</span> <span class="o">%&gt;%</span>
  <span class="nf">mutate</span><span class="p">(</span><span class="n">class</span> <span class="o">=</span> <span class="nf">as.factor</span><span class="p">(</span><span class="nf">ifelse</span><span class="p">(</span><span class="n">prob.default</span> <span class="o">&gt;</span> <span class="m">0.5</span><span class="p">,</span> <span class="s">&quot;Yes&quot;</span><span class="p">,</span> <span class="s">&quot;No&quot;</span><span class="p">)))</span>
<span class="n">prob.test.df</span><span class="o">$</span><span class="n">student</span> <span class="o">&lt;-</span> <span class="n">df.test</span><span class="o">$</span><span class="n">student</span>
<span class="n">prob.test.df</span><span class="o">$</span><span class="n">balance</span> <span class="o">&lt;-</span> <span class="n">df.test</span><span class="o">$</span><span class="n">balance</span>
<span class="n">prob.test.df</span><span class="o">$</span><span class="n">income</span> <span class="o">&lt;-</span> <span class="n">df.test</span><span class="o">$</span><span class="n">income</span>

<span class="n">prob.test.df</span> <span class="o">%&gt;%</span>
  <span class="nf">select</span><span class="p">(</span><span class="m">3</span><span class="o">:</span><span class="m">5</span><span class="p">,</span><span class="m">1</span><span class="p">,</span><span class="m">2</span><span class="p">)</span> <span class="o">%&gt;%</span>
  <span class="nf">sample_n</span><span class="p">(</span><span class="m">10</span><span class="p">)</span>
</pre></div>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1">##      student    balance   income prob.default class</span>
<span class="c1">## 2097     Yes  703.06307 17692.66 5.136338e-04    No</span>
<span class="c1">## 1364     Yes 1026.15356 25393.77 3.434202e-03    No</span>
<span class="c1">## 1941      No    7.06953 48711.64 1.781314e-05    No</span>
<span class="c1">## 1840      No    0.00000 49250.46 1.708667e-05    No</span>
<span class="c1">## 799       No  421.89690 37323.76 2.050024e-04    No</span>
<span class="c1">## 2778     Yes 1068.45464 13638.70 4.401567e-03    No</span>
<span class="c1">## 849       No  708.81398 38295.23 1.109890e-03    No</span>
<span class="c1">## 2511     Yes  521.84148 10316.34 1.767045e-04    No</span>
<span class="c1">## 1864      No 1803.17026 36192.63 4.117378e-01    No</span>
<span class="c1">## 2133      No  800.24334 19051.32 1.900229e-03    No</span>
</pre></div>
</div>
</div>
<div class="section" id="danh-gia-chat-luong-du-bao-tren-tap-test">
<h4>3.6.3.4. Đánh giá chất lượng dự báo trên tập test<a class="headerlink" href="#danh-gia-chat-luong-du-bao-tren-tap-test" title="Permalink to this headline">¶</a></h4>
<div class="section" id="confusion-matrix-1">
<span id="id1"></span><h5>3.6.3.4.1. Confusion matrix<a class="headerlink" href="#confusion-matrix-1" title="Permalink to this headline">¶</a></h5>
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="c1">#conf.matrix</span>
<span class="n">logit.perf</span> <span class="o">&lt;-</span> <span class="nf">table</span><span class="p">(</span><span class="n">df.test</span><span class="o">$</span><span class="n">default</span><span class="p">,</span> <span class="n">class.pred.test</span><span class="p">)</span>
<span class="n">logit.perf</span>
</pre></div>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1">##      class.pred.test</span>
<span class="c1">##         No  Yes</span>
<span class="c1">##   No  2889   12</span>
<span class="c1">##   Yes   71   28</span>
</pre></div>
</div>
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="c1">###performance</span>
<span class="c1">#function to perform model</span>
<span class="n">model.performance</span> <span class="o">&lt;-</span> <span class="nf">function</span><span class="p">(</span><span class="n">confusion_matrix</span><span class="p">)</span> <span class="p">{</span>
  <span class="n">a</span> <span class="o">&lt;-</span> <span class="n">confusion_matrix[1</span><span class="p">,</span><span class="m">1</span><span class="n">]</span>
  <span class="n">b</span> <span class="o">&lt;-</span> <span class="n">confusion_matrix[1</span><span class="p">,</span><span class="m">2</span><span class="n">]</span>
  <span class="n">c</span> <span class="o">&lt;-</span> <span class="n">confusion_matrix[2</span><span class="p">,</span><span class="m">2</span><span class="n">]</span>
  <span class="n">d</span> <span class="o">&lt;-</span> <span class="n">confusion_matrix[2</span><span class="p">,</span><span class="m">1</span><span class="n">]</span>

  <span class="n">recall</span> <span class="o">&lt;-</span> <span class="n">c</span><span class="o">/</span><span class="p">(</span><span class="n">c</span><span class="o">+</span><span class="n">d</span><span class="p">)</span>
  <span class="n">precision</span> <span class="o">&lt;-</span> <span class="n">c</span><span class="o">/</span><span class="p">(</span><span class="n">b</span><span class="o">+</span><span class="n">c</span><span class="p">)</span>
  <span class="n">accuracy</span> <span class="o">&lt;-</span> <span class="p">(</span><span class="n">a</span><span class="o">+</span><span class="n">c</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="n">a</span><span class="o">+</span><span class="n">b</span><span class="o">+</span><span class="n">c</span><span class="o">+</span><span class="n">d</span><span class="p">)</span>

  <span class="nf">print</span><span class="p">(</span><span class="nf">paste</span><span class="p">(</span><span class="s">&#39;recall :&#39;</span><span class="p">,</span><span class="nf">round</span><span class="p">(</span><span class="n">recall</span><span class="p">,</span><span class="m">2</span><span class="p">)))</span>
  <span class="nf">print</span><span class="p">(</span><span class="nf">paste</span><span class="p">(</span><span class="s">&#39;precision :&#39;</span><span class="p">,</span><span class="nf">round</span><span class="p">(</span><span class="n">precision</span><span class="p">,</span><span class="m">2</span><span class="p">)))</span>
  <span class="nf">print</span><span class="p">(</span><span class="nf">paste</span><span class="p">(</span><span class="s">&#39;accuracy :&#39;</span><span class="p">,</span><span class="nf">round</span><span class="p">(</span><span class="n">accuracy</span><span class="p">,</span><span class="m">2</span><span class="p">)))</span>
<span class="p">}</span>

<span class="nf">model.performance</span><span class="p">(</span><span class="n">logit.perf</span><span class="p">)</span>
</pre></div>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1">## [1] &quot;recall : 0.28&quot;</span>
<span class="c1">## [1] &quot;precision : 0.7&quot;</span>
<span class="c1">## [1] &quot;accuracy : 0.97&quot;</span>
</pre></div>
</div>
</div>
<div class="section" id="roc-auc">
<h5>3.6.3.4.2. ROC &amp; AUC<a class="headerlink" href="#roc-auc" title="Permalink to this headline">¶</a></h5>
<p>Tất cả các chỉ số về chất lượng mô hình đều có thể sử dụng với package
<code class="docutils literal notranslate"><span class="pre">ROCR</span></code> thông qua hai bước</p>
<ul class="simple">
<li>Bước 1: Tạo object dự báo
<code class="docutils literal notranslate"><span class="pre">pred</span> <span class="pre">&lt;-</span> <span class="pre">prediction(prob_value,</span> <span class="pre">actual_value)</span></code>. Object này sẽ chứa
1 loạt các chỉ số của confusion matrix với từng điểm cut-off</li>
<li>Bước 2: Tính toán các chỉ số với hàm <code class="docutils literal notranslate"><span class="pre">performance</span></code> với giá trị trục
x và y mong muốn</li>
</ul>
<p><strong>Lưu ý</strong>: Object <code class="docutils literal notranslate"><span class="pre">pred</span></code> được lưu dưới dạng S4 class. Để chiết xuất dữ
liệu cần dùng toán tử <code class="docutils literal notranslate"><span class="pre">&#64;</span></code> thay cho <code class="docutils literal notranslate"><span class="pre">$</span></code> như <code class="docutils literal notranslate"><span class="pre">S3</span></code></p>
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="c1"># Bước 1: Tạo object pred</span>
<span class="n">pred</span> <span class="o">&lt;-</span> <span class="nf">prediction</span><span class="p">(</span><span class="n">prob.test</span><span class="p">,</span> <span class="n">df.test</span><span class="o">$</span><span class="n">default</span><span class="p">)</span>
<span class="n">pred</span> <span class="o">%&gt;%</span> <span class="n">str</span>
</pre></div>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1">## Formal class &#39;prediction&#39; [package &quot;ROCR&quot;] with 11 slots</span>
<span class="c1">##   ..@ predictions:List of 1</span>
<span class="c1">##   .. ..$ : Named num [1:3000] 1.25e-03 9.43e-03 3.86e-04 1.71e-05 1.71e-05 ...</span>
<span class="c1">##   .. .. ..- attr(*, &quot;names&quot;)= chr [1:3000] &quot;1&quot; &quot;3&quot; &quot;4&quot; &quot;10&quot; ...</span>
<span class="c1">##   ..@ labels     :List of 1</span>
<span class="c1">##   .. ..$ : Ord.factor w/ 2 levels &quot;No&quot;&lt;&quot;Yes&quot;: 1 1 1 1 1 1 1 1 1 1 ...</span>
<span class="c1">##   ..@ cutoffs    :List of 1</span>
<span class="c1">##   .. ..$ : Named num [1:2863] Inf 0.954 0.942 0.913 0.895 ...</span>
<span class="c1">##   .. .. ..- attr(*, &quot;names&quot;)= chr [1:2863] &quot;&quot; &quot;1161&quot; &quot;7438&quot; &quot;3977&quot; ...</span>
<span class="c1">##   ..@ fp         :List of 1</span>
<span class="c1">##   .. ..$ : num [1:2863] 0 0 0 1 1 1 1 1 1 2 ...</span>
<span class="c1">##   ..@ tp         :List of 1</span>
<span class="c1">##   .. ..$ : num [1:2863] 0 1 2 2 3 4 5 6 7 7 ...</span>
<span class="c1">##   ..@ tn         :List of 1</span>
<span class="c1">##   .. ..$ : num [1:2863] 2901 2901 2901 2900 2900 ...</span>
<span class="c1">##   ..@ fn         :List of 1</span>
<span class="c1">##   .. ..$ : num [1:2863] 99 98 97 97 96 95 94 93 92 92 ...</span>
<span class="c1">##   ..@ n.pos      :List of 1</span>
<span class="c1">##   .. ..$ : int 99</span>
<span class="c1">##   ..@ n.neg      :List of 1</span>
<span class="c1">##   .. ..$ : int 2901</span>
<span class="c1">##   ..@ n.pos.pred :List of 1</span>
<span class="c1">##   .. ..$ : num [1:2863] 0 1 2 3 4 5 6 7 8 9 ...</span>
<span class="c1">##   ..@ n.neg.pred :List of 1</span>
<span class="c1">##   .. ..$ : num [1:2863] 3000 2999 2998 2997 2996 ...</span>
</pre></div>
</div>
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="c1"># Bước 2: Tạo object tính toán prediction cho AUC</span>
<span class="n">roc</span> <span class="o">&lt;-</span> <span class="nf">performance</span><span class="p">(</span><span class="n">pred</span><span class="p">,</span> <span class="n">x.measure</span> <span class="o">=</span> <span class="s">&quot;fpr&quot;</span><span class="p">,</span> <span class="n">measure</span> <span class="o">=</span> <span class="s">&quot;tpr&quot;</span><span class="p">)</span>

<span class="c1"># Xây dựng hàm để convert giá trị sang data.frame</span>
<span class="n">get_df</span> <span class="o">&lt;-</span> <span class="nf">function</span><span class="p">(</span><span class="n">pred</span><span class="p">){</span>
  <span class="n">pred_new</span> <span class="o">&lt;-</span> <span class="nf">data.frame</span><span class="p">(</span><span class="n">x</span> <span class="o">=</span> <span class="n">pred</span><span class="o">@</span><span class="n">x.values</span> <span class="o">%&gt;%</span> <span class="n">unlist</span><span class="p">,</span>
                         <span class="n">y</span> <span class="o">=</span> <span class="n">pred</span><span class="o">@</span><span class="n">y.values</span> <span class="o">%&gt;%</span> <span class="n">unlist</span><span class="p">)</span>
  <span class="nf">return</span><span class="p">(</span><span class="n">pred_new</span><span class="p">)</span>
<span class="p">}</span>

<span class="nf">get_df</span><span class="p">(</span><span class="n">roc</span><span class="p">)</span> <span class="o">%&gt;%</span>
  <span class="nf">ggplot</span><span class="p">(</span><span class="nf">aes</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">))</span> <span class="o">+</span>
  <span class="nf">geom_line</span><span class="p">()</span> <span class="o">+</span>
  <span class="nf">theme_minimal</span><span class="p">()</span> <span class="o">+</span>
  <span class="nf">labs</span><span class="p">(</span><span class="n">x</span> <span class="o">=</span> <span class="s">&quot;FPR&quot;</span><span class="p">,</span>
       <span class="n">y</span> <span class="o">=</span> <span class="s">&quot;TPR&quot;</span><span class="p">,</span>
       <span class="n">title</span> <span class="o">=</span> <span class="s">&quot;ROC curve&quot;</span><span class="p">)</span>
</pre></div>
</div>
<p><img alt="image12" src="p03-03-logistic-regression_files/figure-html/unnamed-chunk-22-1.png" /></p>
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="c1"># Tính chỉ số AUC</span>
<span class="n">auc_test</span> <span class="o">&lt;-</span> <span class="nf">performance</span><span class="p">(</span><span class="n">pred</span><span class="p">,</span> <span class="s">&quot;auc&quot;</span><span class="p">,</span> <span class="s">&quot;cutoff&quot;</span><span class="p">)</span>
<span class="n">auc_test</span><span class="o">@</span><span class="n">y.values</span> <span class="o">%&gt;%</span> <span class="n">unlist</span>
</pre></div>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1">## [1] 0.9402992</span>
</pre></div>
</div>
</div>
<div class="section" id="gain-va-lift-1">
<span id="id2"></span><h5>3.6.3.4.3. Gain và Lift<a class="headerlink" href="#gain-va-lift-1" title="Permalink to this headline">¶</a></h5>
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="c1"># GAIN charts on testing set</span>
<span class="n">gain_df</span> <span class="o">&lt;-</span> <span class="nf">performance</span><span class="p">(</span><span class="n">pred</span><span class="p">,</span> <span class="s">&quot;tpr&quot;</span><span class="p">,</span> <span class="s">&quot;rpp&quot;</span><span class="p">)</span>

<span class="nf">get_df</span><span class="p">(</span><span class="n">gain_df</span><span class="p">)</span> <span class="o">%&gt;%</span>
  <span class="nf">ggplot</span><span class="p">(</span><span class="nf">aes</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">))</span> <span class="o">+</span>
  <span class="nf">geom_line</span><span class="p">()</span> <span class="o">+</span>
  <span class="nf">theme_minimal</span><span class="p">()</span> <span class="o">+</span>
  <span class="nf">labs</span><span class="p">(</span><span class="n">title</span> <span class="o">=</span> <span class="s">&quot;Gain chart&quot;</span><span class="p">,</span>
       <span class="n">x</span> <span class="o">=</span> <span class="s">&quot;RPP&quot;</span><span class="p">,</span>
       <span class="n">y</span> <span class="o">=</span> <span class="s">&quot;TPR&quot;</span><span class="p">)</span>
</pre></div>
</div>
<p><img alt="image13" src="p03-03-logistic-regression_files/figure-html/unnamed-chunk-23-1.png" /></p>
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="c1"># LIFT charts on testing set</span>
<span class="n">lift_df</span> <span class="o">&lt;-</span> <span class="nf">performance</span><span class="p">(</span><span class="n">pred</span><span class="p">,</span> <span class="s">&quot;lift&quot;</span><span class="p">,</span> <span class="s">&quot;rpp&quot;</span><span class="p">)</span>
<span class="nf">get_df</span><span class="p">(</span><span class="n">lift_df</span><span class="p">)</span> <span class="o">%&gt;%</span>
  <span class="nf">ggplot</span><span class="p">(</span><span class="nf">aes</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">))</span> <span class="o">+</span>
  <span class="nf">geom_line</span><span class="p">()</span> <span class="o">+</span>
  <span class="nf">theme_minimal</span><span class="p">()</span> <span class="o">+</span>
  <span class="nf">labs</span><span class="p">(</span><span class="n">title</span> <span class="o">=</span> <span class="s">&quot;Lift chart&quot;</span><span class="p">,</span>
       <span class="n">x</span> <span class="o">=</span> <span class="s">&quot;RPP&quot;</span><span class="p">,</span>
       <span class="n">y</span> <span class="o">=</span> <span class="s">&quot;Lift&quot;</span><span class="p">)</span>
</pre></div>
</div>
<p><img alt="image14" src="p03-03-logistic-regression_files/figure-html/unnamed-chunk-24-1.png" /></p>
</div>
<div class="section" id="ks-statistics">
<h5>3.6.3.4.4. KS statistics<a class="headerlink" href="#ks-statistics" title="Permalink to this headline">¶</a></h5>
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="n">lift_df</span> <span class="o">&lt;-</span> <span class="nf">performance</span><span class="p">(</span><span class="n">pred</span><span class="p">,</span> <span class="s">&quot;tpr&quot;</span><span class="p">,</span> <span class="s">&quot;fpr&quot;</span><span class="p">)</span>
<span class="n">lift_df</span> <span class="o">%&gt;%</span>
  <span class="n">get_df</span> <span class="o">%&gt;%</span>
  <span class="nf">mutate</span><span class="p">(</span><span class="n">ks</span> <span class="o">=</span> <span class="nf">abs</span><span class="p">(</span><span class="n">x</span> <span class="o">-</span> <span class="n">y</span><span class="p">))</span> <span class="o">%&gt;%</span>
  <span class="nf">pull</span><span class="p">(</span><span class="n">ks</span><span class="p">)</span> <span class="o">%&gt;%</span> <span class="n">max</span>
</pre></div>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1">## [1] 0.7445917</span>
</pre></div>
</div>
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="nf">data.frame</span><span class="p">(</span><span class="n">y</span> <span class="o">=</span> <span class="p">(</span><span class="n">df.test</span><span class="o">$</span><span class="n">default</span> <span class="o">%&gt;%</span> <span class="n">as.numeric</span><span class="p">)</span> <span class="o">-</span> <span class="m">1</span><span class="p">,</span>
           <span class="n">prob</span> <span class="o">=</span> <span class="n">prob.test</span><span class="p">)</span> <span class="o">%&gt;%</span>
  <span class="nf">ggplot</span><span class="p">(</span><span class="nf">aes</span><span class="p">(</span><span class="n">prob</span><span class="p">,</span> <span class="n">col</span> <span class="o">=</span> <span class="nf">as.factor</span><span class="p">(</span><span class="n">y</span><span class="p">)))</span> <span class="o">+</span>
  <span class="nf">stat_ecdf</span><span class="p">()</span> <span class="o">+</span>
  <span class="nf">theme_minimal</span><span class="p">()</span> <span class="o">+</span>
  <span class="nf">theme</span><span class="p">(</span><span class="n">legend.position</span> <span class="o">=</span> <span class="s">&quot;none&quot;</span><span class="p">)</span> <span class="o">+</span>
  <span class="nf">labs</span><span class="p">(</span><span class="n">tittle</span> <span class="o">=</span> <span class="s">&quot;CDF &amp; KS statistics&quot;</span><span class="p">)</span>
</pre></div>
</div>
<p><img alt="image15" src="p03-03-logistic-regression_files/figure-html/unnamed-chunk-25-1.png" /></p>
</div>
</div>
</div>
</div>
<div class="section" id="xay-dung-mo-hinh-logistics-theo-machine-learning">
<h2>3.7. Xây dựng mô hình Logistics theo Machine Learning<a class="headerlink" href="#xay-dung-mo-hinh-logistics-theo-machine-learning" title="Permalink to this headline">¶</a></h2>
<p><strong>Cost function</strong>: Đối với mô hình logistic, nếu sử dụng cost function
tương tự như như hồi quy tuyến tính, chúng ta sẽ gặp vấn đề về bài toán
tối ưu. Hàm tối ưu sẽ không thể tìm được điểm nhỏ nhất do tồn tại vô số
các điểm “local optimization”. Do đó, ta phải xây dựng một hàm tối ưu
mới cho bài toán phân loại của logistic như sau.</p>
<div class="math notranslate">
\[\begin{split}Cost(h_\theta(x), y)\cases{
-log(h_\theta(x) \text{ với } y = 1 \\
-log(1-h_\theta(x)) \text{ với } y = 0)
}\end{split}\]</div>
<p>Với hàm tối ưu trên, có 1 số điểm lưu ý như sau.</p>
<ul class="simple">
<li>Nếu y = 1 và <span class="math notranslate">\(h_\theta = 1\)</span> nghĩa là mô hình dự báo chính xác
với trường hợp xảy ra sự kiện, cost = 0</li>
<li>Tuy nhiên, nếu y = 1 và <span class="math notranslate">\(h_\theta \rightarrow 0\)</span>, nghĩa là mô
hình dự báo không xảy ra sự kiện (y = 0) trong khi thực tế xảy ra,
<span class="math notranslate">\(cost \rightarrow \infty\)</span>.</li>
</ul>
<p>Trong thực tế, hàm tối ưu được đơn giản hóa như sau.</p>
<div class="math notranslate">
\[Cost(h_\theta, y) = -y log(h_\theta(x)) - (1-y)log(1-h_\theta(y))\]</div>
<p>Với từng giá trị y = 0 hoặc y = 1, hàm tối ưu quay trở lại như bình
thường.</p>
<p>Đối với hàm tối ưu như trên, thuật toán <em>gradient descent</em> quay trở lại
tương tự như hàm hồi quy tuyến tính.</p>
<p><strong>Tối ưu hóa</strong>:</p>
<p>Bên cạnh thuật toán gradient descent, còn có các thuật toán khác giúp
tối ưu hóa hàm tối ưu (cost function) với tốc độ nhanh hơn và không cần
phải lựa chọn tham số <span class="math notranslate">\(\alpha\)</span> (learning rate) thủ công. Một số
thuật toán có thể kể đến như:</p>
<ul class="simple">
<li>Conjungate gradient</li>
<li>BFGS</li>
<li>L-BFGS</li>
</ul>
</div>
</div>


           </div>
           
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="p03-04-decision-tree.html" class="btn btn-neutral float-right" title="4. Cây quyết định" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="p03-02-mo-hinh-ols.html" class="btn btn-neutral float-left" title="2. Mô hình OLS" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2019, Anh Hoang Duc

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>