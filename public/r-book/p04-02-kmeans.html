

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="vi" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="vi" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>2. k-means &mdash; Tài liệu Phân tích dữ liệu với R 2019</title>
  

  
  
  
  

  
  <script type="text/javascript" src="_static/js/modernizr.min.js"></script>
  
    
      <script type="text/javascript">
          var DOCUMENTATION_OPTIONS = {
              URL_ROOT:'./',
              VERSION:'2019',
              LANGUAGE:'vi',
              COLLAPSE_INDEX:false,
              FILE_SUFFIX:'.html',
              HAS_SOURCE:  true,
              SOURCELINK_SUFFIX: '.txt'
          };
      </script>
        <script type="text/javascript" src="_static/jquery.js"></script>
        <script type="text/javascript" src="_static/underscore.js"></script>
        <script type="text/javascript" src="_static/doctools.js"></script>
        <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.0/clipboard.min.js"></script>
        <script type="text/javascript" src="_static/copybutton.js"></script>
        <script type="text/javascript" src="_static/translations.js"></script>
        <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
    
    <script type="text/javascript" src="_static/js/theme.js"></script>

    

  
  <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="_static/copybutton.css" type="text/css" />
  <link rel="stylesheet" href="_static/css/custom.css" type="text/css" />
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Tìm Kiếm" href="search.html" />
    <link rel="next" title="3. Hierachical clustering" href="p04-03-hierarchical-clustering.html" />
    <link rel="prev" title="1. Unsupervised learning" href="p04-01-unsupervised-learning.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="index.html" class="icon icon-home"> Phân tích dữ liệu với R
          

          
          </a>

          
            
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <p class="caption"><span class="caption-text">Giới thiệu</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="p01-01-gioi-thieu.html">Khoa học dữ liệu và nghề phân tích dữ liệu</a></li>
</ul>
<p class="caption"><span class="caption-text">Phân tích khám phá dữ liệu</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="p02-03-bien-doi-du-lieu-dplyr.html">1. Ngữ pháp của biến đổi dữ liệu với DPLYR</a></li>
<li class="toctree-l1"><a class="reference internal" href="p02-04-phan-ra-va-xoay-chieu-du-lieu.html">2. Phân rã và xoay chiều dữ liệu</a></li>
<li class="toctree-l1"><a class="reference internal" href="p02-05-cac-chi-so-thong-ke.html">3. Các chỉ số thống kê mô tả cơ bản</a></li>
<li class="toctree-l1"><a class="reference internal" href="p02-06-lap-trinh-ham.html">4. Lập trình hàm</a></li>
<li class="toctree-l1"><a class="reference internal" href="p02-07-lap-trinh-ham-voi-purrr.html">5. Lập trình chức năng hàm với purrr</a></li>
<li class="toctree-l1"><a class="reference internal" href="p02-08-bien-doi-du-lieu-text.html">6. Biến đổi dữ liệu text</a></li>
<li class="toctree-l1"><a class="reference internal" href="p02-11-quan-ly-nhieu-mo-hinh.html">7. Quản lý kết quả phân tích từ nhiều mô hình</a></li>
<li class="toctree-l1"><a class="reference internal" href="p02-15-thong-ke-co-ban.html">8. Xác suất và phân phối thống kê cơ bản</a></li>
<li class="toctree-l1"><a class="reference internal" href="p02-16-power-analysis.html">9. Power analysis</a></li>
<li class="toctree-l1"><a class="reference internal" href="p02-20-sampling-methods.html">10. Phương pháp ước lượng lấy mẫu</a></li>
<li class="toctree-l1"><a class="reference internal" href="p02-50-datatable.html">11. Biến đổi dữ liệu với <code class="docutils literal notranslate"><span class="pre">data.table</span></code></a></li>
<li class="toctree-l1"><a class="reference internal" href="p02-60-thu-thap-du-lieu-tu-website.html">12. Thu thập dữ liệu từ website</a></li>
<li class="toctree-l1"><a class="reference internal" href="p02-99-meo-trong-r.html">13. Các mẹo trong R</a></li>
</ul>
<p class="caption"><span class="caption-text">Supervised learning</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="p03-01-nguyen-ly-du-bao.html">1. Các nguyên lý dự báo</a></li>
<li class="toctree-l1"><a class="reference internal" href="p03-02-mo-hinh-ols.html">2. Mô hình OLS</a></li>
<li class="toctree-l1"><a class="reference internal" href="p03-03-logistic-regression.html">3. Mô hình hồi quy logistic</a></li>
<li class="toctree-l1"><a class="reference internal" href="p03-04-decision-tree.html">4. Cây quyết định</a></li>
<li class="toctree-l1"><a class="reference internal" href="p03-05-bagging-boosting.html">5. Bagging, RandomForest và Boosting</a></li>
<li class="toctree-l1"><a class="reference internal" href="p03-07-xay-dung-mo-hinh-voi-h2o.html">6. Xây dựng mô hình với H2O</a></li>
<li class="toctree-l1"><a class="reference internal" href="p03-08-svm.html">7. Support Vector Machine</a></li>
<li class="toctree-l1"><a class="reference internal" href="p03-09-feature-engineering.html">8. Feature Engineering</a></li>
<li class="toctree-l1"><a class="reference internal" href="p03-15-regularization.html">9. Regularization</a></li>
<li class="toctree-l1"><a class="reference internal" href="p03-17-nonlinear.html">10. Mô hình phi tuyến tính</a></li>
<li class="toctree-l1"><a class="reference internal" href="p03-30-credit-scoring.html">11. Credit Scoring</a></li>
<li class="toctree-l1"><a class="reference internal" href="p03-35-caret.html">12. Xây dựng mô hình dự báo với caret</a></li>
<li class="toctree-l1"><a class="reference internal" href="p03-65-chat-luong-mo-hinh.html">13. Chất lượng mô hình</a></li>
<li class="toctree-l1"><a class="reference internal" href="p03-70-tidymodels.html">14. Tidymodels</a></li>
</ul>
<p class="caption"><span class="caption-text">Unsupervised learning</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="p04-01-unsupervised-learning.html">1. Unsupervised learning</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">2. k-means</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#gioi-thieu">2.1. Giới thiệu</a></li>
<li class="toctree-l2"><a class="reference internal" href="#thuat-toan">2.2. Thuật toán</a></li>
<li class="toctree-l2"><a class="reference internal" href="#uu-nhuoc-diem-cua-k-means">2.3. Ưu nhược điểm của K-means</a></li>
<li class="toctree-l2"><a class="reference internal" href="#thuc-hanh-tren-r">2.4. Thực hành trên R</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="p04-03-hierarchical-clustering.html">3. Hierachical clustering</a></li>
<li class="toctree-l1"><a class="reference internal" href="p04-04-basket-analysis.html">4. Phân tích giỏ hàng</a></li>
<li class="toctree-l1"><a class="reference internal" href="p04-05-pca.html">5. Principal component analysis</a></li>
<li class="toctree-l1"><a class="reference internal" href="p04-06-factor-analysis.html">6. Phân tích nhân tố ẩn (factor analysis)</a></li>
</ul>
<p class="caption"><span class="caption-text">Chuỗi thời gian</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="p05-01-chuoi-thoi-gian.html">1. Giới thiệu về chuỗi thời gian</a></li>
<li class="toctree-l1"><a class="reference internal" href="p05-02-arima.html">2. Mô hình ARIMA</a></li>
<li class="toctree-l1"><a class="reference internal" href="p05-03-phan-tich-chuoi-thoi-gian-voi-tidyquant.html">3. Phân tích chuỗi thời gian với tidyquant và timetk</a></li>
<li class="toctree-l1"><a class="reference internal" href="p05-06-du-bao-ts-voi-prophet.html">4. Dự báo chuỗi thời gian với prophet</a></li>
<li class="toctree-l1"><a class="reference internal" href="p05-07-du-bao-ts-voi-timetk.html">5. Dự báo chuỗi thời gian với timetk</a></li>
<li class="toctree-l1"><a class="reference internal" href="p05-08-abnomaly-detection.html">6. Abnomaly detection trong times series</a></li>
</ul>
<p class="caption"><span class="caption-text">Ngôn ngữ tự nghiên</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="p06-01-nlp-co-ban.html">1. Xử lý ngôn ngữ tự nhiên cơ bản</a></li>
<li class="toctree-l1"><a class="reference internal" href="p06-04-text-classification.html">2. Phân loại text</a></li>
<li class="toctree-l1"><a class="reference internal" href="p06-07-nlp-api.html">3. Sử dụng API từ các dịch vụ đám mây</a></li>
<li class="toctree-l1"><a class="reference internal" href="p06-10-ocr-tesseract.html">4. OCR với <code class="docutils literal notranslate"><span class="pre">tesseract</span></code></a></li>
</ul>
<p class="caption"><span class="caption-text">Các phương pháp khác</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="p07-01-survival-analysis.html">1. Survival analysis</a></li>
<li class="toctree-l1"><a class="reference internal" href="p07-02-causal-impact.html">2. Causal Impact</a></li>
<li class="toctree-l1"><a class="reference internal" href="p07-03-collaborative-filtering.html">3. Collaborative Filtering</a></li>
<li class="toctree-l1"><a class="reference internal" href="p07-07-spatial-data.html">4. Spatial data</a></li>
<li class="toctree-l1"><a class="reference internal" href="p07-10-shiny.html">5. Shiny apps</a></li>
</ul>
<p class="caption"><span class="caption-text">Deep Learning</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="p09-01-gioi-thieu-deep-learning.html">1. Giới thiệu cơ bản về Deep Learning</a></li>
<li class="toctree-l1"><a class="reference internal" href="p09-02-co-ban-kien-thuc-toan.html">2. Kiến thức cơ bản toán học cho deep learning</a></li>
<li class="toctree-l1"><a class="reference internal" href="p09-03-mo-hinh-deep-learning-co-ban.html">3. Mô hình deep learning cơ bản</a></li>
<li class="toctree-l1"><a class="reference internal" href="p09-04-convolution-neural-network.html">4. Convolution neural networks</a></li>
</ul>
<p class="caption"><span class="caption-text">Cloud Computing</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="p10-01-cai-dat-rstudio-server-tren-amazon.html">1. Cài đặt server RStudio trên Amazon</a></li>
<li class="toctree-l1"><a class="reference internal" href="p10-03-web-service-azure.html">2. Xây dựng web service với Azure</a></li>
<li class="toctree-l1"><a class="reference internal" href="p10-09-apis-voi-plumber.html">3. API với Plumber</a></li>
</ul>
<p class="caption"><span class="caption-text">Kiến thức bổ trợ</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="p11-01-git.html">1. Sử dụng GIT</a></li>
<li class="toctree-l1"><a class="reference internal" href="p11-02-cmd.html">2. CMD và Bash</a></li>
<li class="toctree-l1"><a class="reference internal" href="p11-03-docker.html">3. Sử dụng docker</a></li>
<li class="toctree-l1"><a class="reference internal" href="p11-04-apis.html">4. API</a></li>
<li class="toctree-l1"><a class="reference internal" href="p11-05-html-css.html">5. Cơ bản về HTML và CSS</a></li>
<li class="toctree-l1"><a class="reference internal" href="p11-09-other.html">6. Các tricks khác</a></li>
</ul>
<p class="caption"><span class="caption-text">Case studies</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="p13-01-casestudy-truc-quan-hoa.html">1. Trực quan hóa dữ liệu</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">Phân tích dữ liệu với R</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="index.html">Docs</a> &raquo;</li>
        
      <li>2. k-means</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="_sources/p04-02-kmeans.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  
<style>
/* CSS overrides for sphinx_rtd_theme */

/* 24px margin */
.nbinput.nblast,
.nboutput.nblast {
    margin-bottom: 19px;  /* padding has already 5px */
}

/* ... except between code cells! */
.nblast + .nbinput {
    margin-top: -19px;
}

.admonition > p:before {
    margin-right: 4px;  /* make room for the exclamation icon */
}

/* Fix math alignment, see https://github.com/rtfd/sphinx_rtd_theme/pull/686 */
.math {
    text-align: unset;
}
</style>
<div class="section" id="k-means">
<h1>2. k-means<a class="headerlink" href="#k-means" title="Permalink to this headline">¶</a></h1>
<div class="section" id="gioi-thieu">
<h2>2.1. Giới thiệu<a class="headerlink" href="#gioi-thieu" title="Permalink to this headline">¶</a></h2>
<p>Trong chương này, chúng ta sẽ cùng tìm hiểu về thuật toán
<code class="docutils literal notranslate"><span class="pre">clustering</span> <span class="pre">K-means</span></code> - một thuật toán thuộc về nhóm <strong>unsupervised
learning</strong> (“học không giám sát”).</p>
<p><code class="docutils literal notranslate"><span class="pre">Clustering</span> <span class="pre">K-means</span></code> có thể ứng dụng trong các lĩnh vực như ngân hàng
hay thương mại điện tử vào việc phân nhóm khách hàng dựa trên những đặc
điểm về hành vi, thói quen chi tiêu và demographics của họ. Điều đó sẽ
giúp cho ngân hàng hay các công ty thương mại điện tử có thể hiểu rõ
được hành vi khách hàng của mình, để sau đó có thể offer những sản phẩm,
dịch vụ phù hợp với nhu cầu của từng khách hàng.</p>
<p>Thuật toán <code class="docutils literal notranslate"><span class="pre">K-means</span></code> sẽ nhóm các đối tượng (quan sát) có những đặc
điểm và hành vi tương đồng vào K nhóm bất kỳ. Số lượng nhóm K sẽ phụ
thuộc vào mục đích cũng như bối cảnh mà chúng ta đặt ra (thông thường
nên từ 2 đến 10 nhóm).</p>
<p>Ví dụ, sử dụng dữ liệu <code class="docutils literal notranslate"><span class="pre">iris</span></code> có sẵn trong <code class="docutils literal notranslate"><span class="pre">R</span></code> chúng ta sẽ phân nhóm
(<code class="docutils literal notranslate"><span class="pre">cluster</span></code>) các quan sát thành 2 nhóm dựa vào biến <code class="docutils literal notranslate"><span class="pre">Sepal.Length</span></code> và
<code class="docutils literal notranslate"><span class="pre">Petal.length</span></code>.</p>
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="kn">library</span><span class="p">(</span>dplyr<span class="p">)</span>
<span class="c1"># Lấy ngẫu nhiên 100 quan sát,</span>
<span class="c1"># và chỉ lấy 2 biến `Sepal.Length` và `Petal.Length`</span>
<span class="kp">set.seed</span><span class="p">(</span><span class="m">1</span><span class="p">)</span>
data <span class="o">&lt;-</span> iris <span class="o">%&gt;%</span>
  select<span class="p">(</span>Sepal.Length<span class="p">,</span> Petal.Length<span class="p">)</span> <span class="o">%&gt;%</span>
  sample_n<span class="p">(</span><span class="m">100</span><span class="p">)</span>

<span class="kn">library</span><span class="p">(</span>ggplot2<span class="p">)</span>
data <span class="o">%&gt;%</span>
  ggplot<span class="p">(</span>aes<span class="p">(</span>Sepal.Length<span class="p">,</span> Petal.Length<span class="p">))</span> <span class="o">+</span>
  geom_point<span class="p">(</span>size <span class="o">=</span> <span class="m">2</span><span class="p">,</span> col <span class="o">=</span> <span class="s">&quot;darkgreen&quot;</span><span class="p">)</span><span class="o">+</span>
  theme_classic<span class="p">()</span>
</pre></div>
</div>
<p><img alt="image0" src="p04-02-kmeans_files/figure-html/unnamed-chunk-2-1.png" /></p>
<ul class="simple">
<li><strong>Bước 1</strong>: Chúng ta sẽ lựa chọn ngẫu nhiên 2 tâm
(<code class="docutils literal notranslate"><span class="pre">cluster</span> <span class="pre">centroids</span></code>) - tương đương với 2 nhóm, là 2 điểm x (đỏ) và
x (xanh dương) như sau:</li>
</ul>
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span>data <span class="o">%&gt;%</span>
  ggplot<span class="p">(</span>aes<span class="p">(</span>Sepal.Length<span class="p">,</span> Petal.Length<span class="p">))</span> <span class="o">+</span>
  geom_point<span class="p">(</span>size <span class="o">=</span> <span class="m">2</span><span class="p">,</span> col <span class="o">=</span> <span class="s">&quot;darkgreen&quot;</span><span class="p">)</span><span class="o">+</span>
  theme_classic<span class="p">()</span><span class="o">+</span>
  geom_point<span class="p">(</span>aes<span class="p">(</span>x<span class="o">=</span><span class="m">6</span><span class="p">,</span>y<span class="o">=</span><span class="m">5</span><span class="p">),</span> col <span class="o">=</span> <span class="s">&quot;red&quot;</span><span class="p">,</span> shape<span class="o">=</span><span class="m">4</span><span class="p">,</span> size <span class="o">=</span> <span class="m">5</span><span class="p">)</span><span class="o">+</span>
  geom_point<span class="p">(</span>aes<span class="p">(</span>x<span class="o">=</span><span class="m">5</span><span class="p">,</span>y<span class="o">=</span><span class="m">1</span><span class="p">),</span> col <span class="o">=</span> <span class="s">&quot;blue&quot;</span><span class="p">,</span> shape<span class="o">=</span><span class="m">4</span><span class="p">,</span> size <span class="o">=</span> <span class="m">5</span><span class="p">)</span>
</pre></div>
</div>
<p><img alt="image1" src="p04-02-kmeans_files/figure-html/unnamed-chunk-3-1.png" /></p>
<ul class="simple">
<li><strong>Bước 2</strong>: Quan sát nào mà “gần” hơn với điểm x (đỏ) thì chúng ta sẽ
nhóm quan sát đó vào một nhóm màu đỏ, còn những quan sát nào mà “gần”
hơn với điểm x (xanh dương), sẽ thuộc về nhóm màu xanh dương. Ở đây
“gần” hơn được hiểu là khoảng cách từ quan sát đó đến điểm x nào nhỏ
hơn.</li>
</ul>
<p>Khoảng cách giữa 2 điểm có tọa độ (x1, y1) và (x2, y2) được tính như
sau:</p>
<div class="math notranslate">
\[d = \sqrt{(x_2 - x_1)^2 + (y_2 - y_1)^2}\]</div>
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span>data1 <span class="o">&lt;-</span> data <span class="o">%&gt;%</span>
  <span class="c1"># Set ngẫu nhiên 2 centroids</span>
  mutate<span class="p">(</span>Sepal.Length_red <span class="o">=</span> <span class="m">6</span><span class="p">,</span>
         Petal.Length_red <span class="o">=</span> <span class="m">5</span><span class="p">,</span>
         Sepal.Length_blue <span class="o">=</span> <span class="m">5</span><span class="p">,</span>
         Petal.Length_blue <span class="o">=</span> <span class="m">1</span>
         <span class="p">)</span> <span class="o">%&gt;%</span>
  <span class="c1"># Tính khoảng cách từ các quan sát đến 2 centroids</span>
  mutate<span class="p">(</span>
    distance_red <span class="o">=</span> <span class="kp">sqrt</span><span class="p">((</span>Sepal.Length<span class="o">-</span>Sepal.Length_red<span class="p">)</span><span class="o">^</span><span class="m">2</span> <span class="o">+</span> <span class="p">(</span>Petal.Length <span class="o">-</span> Petal.Length_red<span class="p">)</span><span class="o">^</span><span class="m">2</span><span class="p">),</span>
    distance_blue <span class="o">=</span> <span class="kp">sqrt</span><span class="p">((</span>Sepal.Length<span class="o">-</span>Sepal.Length_blue<span class="p">)</span><span class="o">^</span><span class="m">2</span> <span class="o">+</span> <span class="p">(</span>Petal.Length <span class="o">-</span> Petal.Length_blue<span class="p">)</span><span class="o">^</span><span class="m">2</span><span class="p">)</span>
    <span class="p">)</span> <span class="o">%&gt;%</span>
  <span class="c1"># Tạo biến mới - nhóm mà các quan sát được phân vào</span>
  mutate<span class="p">(</span>group <span class="o">=</span> case_when<span class="p">(</span>
    distance_red <span class="o">&lt;</span> distance_blue <span class="o">~</span> <span class="s">&quot;red&quot;</span><span class="p">,</span>
    <span class="kc">TRUE</span> <span class="o">~</span> <span class="s">&quot;blue&quot;</span>
  <span class="p">)</span> <span class="o">%&gt;%</span> <span class="kp">as.factor</span><span class="p">)</span>


<span class="c1"># Plot dữ liệu mới</span>
data1 <span class="o">%&gt;%</span>
  ggplot<span class="p">(</span>aes<span class="p">(</span>Sepal.Length<span class="p">,</span> Petal.Length<span class="p">),</span> group <span class="o">=</span> group<span class="p">)</span> <span class="o">+</span>
  geom_point<span class="p">(</span>size <span class="o">=</span> <span class="m">2</span><span class="p">,</span> aes<span class="p">(</span>col <span class="o">=</span> group<span class="p">))</span><span class="o">+</span>
  theme_classic<span class="p">()</span><span class="o">+</span>
  geom_point<span class="p">(</span>aes<span class="p">(</span>x<span class="o">=</span><span class="m">6</span><span class="p">,</span>y<span class="o">=</span><span class="m">5</span><span class="p">),</span> col <span class="o">=</span> <span class="s">&quot;red&quot;</span><span class="p">,</span> shape<span class="o">=</span><span class="m">4</span><span class="p">,</span> size <span class="o">=</span> <span class="m">5</span><span class="p">)</span><span class="o">+</span>
  geom_point<span class="p">(</span>aes<span class="p">(</span>x<span class="o">=</span><span class="m">5</span><span class="p">,</span>y<span class="o">=</span><span class="m">1</span><span class="p">),</span> col <span class="o">=</span> <span class="s">&quot;blue&quot;</span><span class="p">,</span> shape<span class="o">=</span><span class="m">4</span><span class="p">,</span> size <span class="o">=</span> <span class="m">5</span><span class="p">)</span><span class="o">+</span>
  scale_color_manual<span class="p">(</span>
    values <span class="o">=</span> <span class="kt">c</span><span class="p">(</span><span class="s">&quot;blue&quot;</span> <span class="o">=</span> <span class="s">&quot;blue&quot;</span><span class="p">,</span> <span class="s">&quot;red&quot;</span> <span class="o">=</span> <span class="s">&quot;red&quot;</span><span class="p">)</span>
  <span class="p">)</span><span class="o">+</span>
  theme<span class="p">(</span>legend.position <span class="o">=</span> <span class="s">&quot;none&quot;</span><span class="p">)</span>
</pre></div>
</div>
<p><img alt="image2" src="p04-02-kmeans_files/figure-html/unnamed-chunk-4-1.png" /></p>
<ul class="simple">
<li><strong>Bước 3</strong>: Tiếp theo, chúng ta sẽ di chuyển 2 tâm x (đỏ) và x (xanh
dương) (<code class="docutils literal notranslate"><span class="pre">move</span> <span class="pre">centroids</span></code>) đến điểm mới có tọa độ bằng trung bình
tọa độ các quan sát thuộc về 2 nhóm nói trên.</li>
</ul>
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="c1"># Tính tọa độ của 2 centroids mới</span>
new_centroids_1 <span class="o">&lt;-</span> data1 <span class="o">%&gt;%</span>
  group_by<span class="p">(</span>group<span class="p">)</span> <span class="o">%&gt;%</span>
  summarise<span class="p">(</span>average_sepal <span class="o">=</span> <span class="kp">mean</span><span class="p">(</span>Sepal.Length<span class="p">),</span>
            average_petal <span class="o">=</span> <span class="kp">mean</span><span class="p">(</span>Petal.Length<span class="p">)</span>
            <span class="p">)</span> <span class="o">%&gt;%</span>
  <span class="kp">as.data.frame</span>


<span class="c1"># Plot di chuyển centroids</span>
data1 <span class="o">%&gt;%</span>
  ggplot<span class="p">(</span>aes<span class="p">(</span>Sepal.Length<span class="p">,</span> Petal.Length<span class="p">),</span> group <span class="o">=</span> group<span class="p">)</span> <span class="o">+</span>
  geom_point<span class="p">(</span>size <span class="o">=</span> <span class="m">2</span><span class="p">,</span> aes<span class="p">(</span>col <span class="o">=</span> group<span class="p">))</span><span class="o">+</span>
  theme_classic<span class="p">()</span><span class="o">+</span>
  geom_point<span class="p">(</span>aes<span class="p">(</span>x<span class="o">=</span><span class="m">6</span><span class="p">,</span>y<span class="o">=</span><span class="m">5</span><span class="p">),</span> col <span class="o">=</span> <span class="s">&quot;red&quot;</span><span class="p">,</span> shape<span class="o">=</span><span class="m">4</span><span class="p">,</span> size <span class="o">=</span> <span class="m">5</span><span class="p">)</span><span class="o">+</span>
  geom_point<span class="p">(</span>aes<span class="p">(</span>x<span class="o">=</span><span class="m">5</span><span class="p">,</span>y<span class="o">=</span><span class="m">1</span><span class="p">),</span> col <span class="o">=</span> <span class="s">&quot;blue&quot;</span><span class="p">,</span> shape<span class="o">=</span><span class="m">4</span><span class="p">,</span> size <span class="o">=</span> <span class="m">5</span><span class="p">)</span><span class="o">+</span>
  scale_color_manual<span class="p">(</span>
    values <span class="o">=</span> <span class="kt">c</span><span class="p">(</span><span class="s">&quot;blue&quot;</span> <span class="o">=</span> <span class="s">&quot;blue&quot;</span><span class="p">,</span> <span class="s">&quot;red&quot;</span> <span class="o">=</span> <span class="s">&quot;red&quot;</span><span class="p">)</span>
  <span class="p">)</span><span class="o">+</span>
  theme<span class="p">(</span>legend.position <span class="o">=</span> <span class="s">&quot;none&quot;</span><span class="p">)</span><span class="o">+</span>
  geom_point<span class="p">(</span>aes<span class="p">(</span>x<span class="o">=</span>new_centroids_1<span class="o">$</span>average_sepal<span class="p">[</span>new_centroids_1<span class="o">$</span>group <span class="o">==</span> <span class="s">&quot;red&quot;</span><span class="p">],</span>
                 y<span class="o">=</span>new_centroids_1<span class="o">$</span>average_petal<span class="p">[</span>new_centroids_1<span class="o">$</span>group <span class="o">==</span> <span class="s">&quot;red&quot;</span><span class="p">]</span>
                 <span class="p">),</span>
             col <span class="o">=</span> <span class="s">&quot;red&quot;</span><span class="p">,</span> shape<span class="o">=</span><span class="m">4</span><span class="p">,</span> size <span class="o">=</span> <span class="m">5</span><span class="p">)</span><span class="o">+</span>
  geom_point<span class="p">(</span>aes<span class="p">(</span>x<span class="o">=</span>new_centroids_1<span class="o">$</span>average_sepal<span class="p">[</span>new_centroids_1<span class="o">$</span>group <span class="o">==</span> <span class="s">&quot;blue&quot;</span><span class="p">],</span>
                 y<span class="o">=</span>new_centroids_1<span class="o">$</span>average_petal<span class="p">[</span>new_centroids_1<span class="o">$</span>group <span class="o">==</span> <span class="s">&quot;blue&quot;</span><span class="p">]</span>
                 <span class="p">),</span>
             col <span class="o">=</span> <span class="s">&quot;blue&quot;</span><span class="p">,</span> shape<span class="o">=</span><span class="m">4</span><span class="p">,</span> size <span class="o">=</span> <span class="m">5</span><span class="p">)</span><span class="o">+</span>
  geom_segment<span class="p">(</span>aes<span class="p">(</span>x <span class="o">=</span> <span class="m">6</span><span class="p">,</span>
                   y <span class="o">=</span> <span class="m">5</span><span class="p">,</span>
                   xend <span class="o">=</span> new_centroids_1<span class="o">$</span>average_sepal<span class="p">[</span>new_centroids_1<span class="o">$</span>group <span class="o">==</span> <span class="s">&quot;red&quot;</span><span class="p">],</span>
                   yend <span class="o">=</span> new_centroids_1<span class="o">$</span>average_petal<span class="p">[</span>new_centroids_1<span class="o">$</span>group <span class="o">==</span> <span class="s">&quot;red&quot;</span><span class="p">]</span>
                   <span class="p">),</span>
               col <span class="o">=</span> <span class="s">&quot;black&quot;</span><span class="p">,</span>
               arrow <span class="o">=</span> arrow<span class="p">(</span>length <span class="o">=</span> unit<span class="p">(</span><span class="m">0.015</span><span class="p">,</span> <span class="s">&quot;npc&quot;</span><span class="p">)),</span>
               size <span class="o">=</span> <span class="m">0.1</span>
               <span class="p">)</span><span class="o">+</span>
  geom_segment<span class="p">(</span>aes<span class="p">(</span>x <span class="o">=</span> <span class="m">5</span><span class="p">,</span>
                   y <span class="o">=</span> <span class="m">1</span><span class="p">,</span>
                   xend <span class="o">=</span> new_centroids_1<span class="o">$</span>average_sepal<span class="p">[</span>new_centroids_1<span class="o">$</span>group <span class="o">==</span> <span class="s">&quot;blue&quot;</span><span class="p">],</span>
                   yend <span class="o">=</span> new_centroids_1<span class="o">$</span>average_petal<span class="p">[</span>new_centroids_1<span class="o">$</span>group <span class="o">==</span> <span class="s">&quot;blue&quot;</span><span class="p">]</span>
                   <span class="p">),</span>
               col <span class="o">=</span> <span class="s">&quot;black&quot;</span><span class="p">,</span>
               arrow <span class="o">=</span> arrow<span class="p">(</span>length <span class="o">=</span> unit<span class="p">(</span><span class="m">0.015</span><span class="p">,</span> <span class="s">&quot;npc&quot;</span><span class="p">)),</span>
               size <span class="o">=</span> <span class="m">0.1</span>
               <span class="p">)</span>
</pre></div>
</div>
<p><img alt="image3" src="p04-02-kmeans_files/figure-html/unnamed-chunk-5-1.png" /></p>
<ul class="simple">
<li><strong>Bước 4</strong>: Bây giờ, chúng ta sẽ lặp lại quá trình đã làm, tức quan
sát gần hơn với điểm centroids mới nào thì sẽ thuộc về nhóm tương
ứng. Kết quả như sau:</li>
</ul>
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span>data2 <span class="o">&lt;-</span> data <span class="o">%&gt;%</span>
  <span class="c1"># Update 2 centroids mới</span>
  mutate<span class="p">(</span>Sepal.Length_red <span class="o">=</span> new_centroids_1<span class="o">$</span>average_sepal<span class="p">[</span>new_centroids_1<span class="o">$</span>group <span class="o">==</span> <span class="s">&quot;red&quot;</span><span class="p">],</span>
         Petal.Length_red <span class="o">=</span> new_centroids_1<span class="o">$</span>average_petal<span class="p">[</span>new_centroids_1<span class="o">$</span>group <span class="o">==</span> <span class="s">&quot;red&quot;</span><span class="p">],</span>
         Sepal.Length_blue <span class="o">=</span> new_centroids_1<span class="o">$</span>average_sepal<span class="p">[</span>new_centroids_1<span class="o">$</span>group <span class="o">==</span> <span class="s">&quot;blue&quot;</span><span class="p">],</span>
         Petal.Length_blue <span class="o">=</span> new_centroids_1<span class="o">$</span>average_petal<span class="p">[</span>new_centroids_1<span class="o">$</span>group <span class="o">==</span> <span class="s">&quot;blue&quot;</span><span class="p">]</span>
         <span class="p">)</span> <span class="o">%&gt;%</span>
  <span class="c1"># Tính khoảng cách từ các quan sát đến 2 centroids</span>
  mutate<span class="p">(</span>
    distance_red <span class="o">=</span> <span class="kp">sqrt</span><span class="p">((</span>Sepal.Length<span class="o">-</span>Sepal.Length_red<span class="p">)</span><span class="o">^</span><span class="m">2</span> <span class="o">+</span> <span class="p">(</span>Petal.Length <span class="o">-</span> Petal.Length_red<span class="p">)</span><span class="o">^</span><span class="m">2</span><span class="p">),</span>
    distance_blue <span class="o">=</span> <span class="kp">sqrt</span><span class="p">((</span>Sepal.Length<span class="o">-</span>Sepal.Length_blue<span class="p">)</span><span class="o">^</span><span class="m">2</span> <span class="o">+</span> <span class="p">(</span>Petal.Length <span class="o">-</span> Petal.Length_blue<span class="p">)</span><span class="o">^</span><span class="m">2</span><span class="p">)</span>
    <span class="p">)</span> <span class="o">%&gt;%</span>
  <span class="c1"># Tạo biến mới - nhóm mà các quan sát được phân vào</span>
  mutate<span class="p">(</span>group <span class="o">=</span> case_when<span class="p">(</span>
    distance_red <span class="o">&lt;</span> distance_blue <span class="o">~</span> <span class="s">&quot;red&quot;</span><span class="p">,</span>
    <span class="kc">TRUE</span> <span class="o">~</span> <span class="s">&quot;blue&quot;</span>
  <span class="p">)</span> <span class="o">%&gt;%</span> <span class="kp">as.factor</span><span class="p">)</span>


<span class="c1"># Plot dữ liệu mới</span>
data2 <span class="o">%&gt;%</span>
  ggplot<span class="p">(</span>aes<span class="p">(</span>Sepal.Length<span class="p">,</span> Petal.Length<span class="p">),</span> group <span class="o">=</span> group<span class="p">)</span> <span class="o">+</span>
  geom_point<span class="p">(</span>size <span class="o">=</span> <span class="m">2</span><span class="p">,</span> aes<span class="p">(</span>col <span class="o">=</span> group<span class="p">))</span><span class="o">+</span>
  theme_classic<span class="p">()</span><span class="o">+</span>
  scale_color_manual<span class="p">(</span>
    values <span class="o">=</span> <span class="kt">c</span><span class="p">(</span><span class="s">&quot;blue&quot;</span> <span class="o">=</span> <span class="s">&quot;blue&quot;</span><span class="p">,</span> <span class="s">&quot;red&quot;</span> <span class="o">=</span> <span class="s">&quot;red&quot;</span><span class="p">)</span>
  <span class="p">)</span><span class="o">+</span>
  theme<span class="p">(</span>legend.position <span class="o">=</span> <span class="s">&quot;none&quot;</span><span class="p">)</span><span class="o">+</span>
  geom_point<span class="p">(</span>aes<span class="p">(</span>x<span class="o">=</span>new_centroids_1<span class="o">$</span>average_sepal<span class="p">[</span>new_centroids_1<span class="o">$</span>group <span class="o">==</span> <span class="s">&quot;red&quot;</span><span class="p">],</span>
                 y<span class="o">=</span>new_centroids_1<span class="o">$</span>average_petal<span class="p">[</span>new_centroids_1<span class="o">$</span>group <span class="o">==</span> <span class="s">&quot;red&quot;</span><span class="p">]</span>
                 <span class="p">),</span>
             col <span class="o">=</span> <span class="s">&quot;red&quot;</span><span class="p">,</span> shape<span class="o">=</span><span class="m">4</span><span class="p">,</span> size <span class="o">=</span> <span class="m">5</span><span class="p">)</span><span class="o">+</span>
  geom_point<span class="p">(</span>aes<span class="p">(</span>x<span class="o">=</span>new_centroids_1<span class="o">$</span>average_sepal<span class="p">[</span>new_centroids_1<span class="o">$</span>group <span class="o">==</span> <span class="s">&quot;blue&quot;</span><span class="p">],</span>
                 y<span class="o">=</span>new_centroids_1<span class="o">$</span>average_petal<span class="p">[</span>new_centroids_1<span class="o">$</span>group <span class="o">==</span> <span class="s">&quot;blue&quot;</span><span class="p">]</span>
                 <span class="p">),</span>
             col <span class="o">=</span> <span class="s">&quot;blue&quot;</span><span class="p">,</span> shape<span class="o">=</span><span class="m">4</span><span class="p">,</span> size <span class="o">=</span> <span class="m">5</span><span class="p">)</span><span class="o">+</span>
  annotate<span class="p">(</span><span class="s">&quot;text&quot;</span><span class="p">,</span>
           x <span class="o">=</span> <span class="m">4.9</span><span class="p">,</span> y <span class="o">=</span> <span class="m">3.3</span><span class="p">,</span>
           col <span class="o">=</span> <span class="s">&quot;black&quot;</span><span class="p">,</span>
           size <span class="o">=</span> <span class="m">4</span><span class="p">,</span>
           hjust <span class="o">=</span> <span class="m">1</span><span class="p">,</span>
           label <span class="o">=</span> <span class="s">&quot;This point: \n red -&gt; blue&quot;</span>
           <span class="p">)</span>
</pre></div>
</div>
<p><img alt="image4" src="p04-02-kmeans_files/figure-html/unnamed-chunk-6-1.png" /></p>
<p>Như vậy, với 2 centroids mới việc phân nhóm quan sát có sự thay đổi: Có
1 điểm lúc trước thuộc về nhóm đỏ, nhưng giờ thuộc về nhóm xanh dương.</p>
<ul class="simple">
<li><strong>Bước 5</strong>: Tiếp tục quá trình như trên, chúng ta sẽ lại di chuyển
các centroids để tìm các centroids mới.</li>
</ul>
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="c1"># Tính tọa độ của 2 centroids mới</span>
new_centroids_2 <span class="o">&lt;-</span> data2 <span class="o">%&gt;%</span>
  group_by<span class="p">(</span>group<span class="p">)</span> <span class="o">%&gt;%</span>
  summarise<span class="p">(</span>average_sepal <span class="o">=</span> <span class="kp">mean</span><span class="p">(</span>Sepal.Length<span class="p">),</span>
            average_petal <span class="o">=</span> <span class="kp">mean</span><span class="p">(</span>Petal.Length<span class="p">)</span>
            <span class="p">)</span> <span class="o">%&gt;%</span>
  <span class="kp">as.data.frame</span>


<span class="c1"># Plot di chuyển centroids</span>
data2 <span class="o">%&gt;%</span>
  ggplot<span class="p">(</span>aes<span class="p">(</span>Sepal.Length<span class="p">,</span> Petal.Length<span class="p">),</span> group <span class="o">=</span> group<span class="p">)</span> <span class="o">+</span>
  geom_point<span class="p">(</span>size <span class="o">=</span> <span class="m">2</span><span class="p">,</span> aes<span class="p">(</span>col <span class="o">=</span> group<span class="p">))</span><span class="o">+</span>
  theme_classic<span class="p">()</span><span class="o">+</span>
  scale_color_manual<span class="p">(</span>
    values <span class="o">=</span> <span class="kt">c</span><span class="p">(</span><span class="s">&quot;blue&quot;</span> <span class="o">=</span> <span class="s">&quot;blue&quot;</span><span class="p">,</span> <span class="s">&quot;red&quot;</span> <span class="o">=</span> <span class="s">&quot;red&quot;</span><span class="p">)</span>
  <span class="p">)</span><span class="o">+</span>
  theme<span class="p">(</span>legend.position <span class="o">=</span> <span class="s">&quot;none&quot;</span><span class="p">)</span><span class="o">+</span>
  geom_point<span class="p">(</span>aes<span class="p">(</span>x<span class="o">=</span>new_centroids_1<span class="o">$</span>average_sepal<span class="p">[</span>new_centroids_1<span class="o">$</span>group <span class="o">==</span> <span class="s">&quot;red&quot;</span><span class="p">],</span>
                 y<span class="o">=</span>new_centroids_1<span class="o">$</span>average_petal<span class="p">[</span>new_centroids_1<span class="o">$</span>group <span class="o">==</span> <span class="s">&quot;red&quot;</span><span class="p">]</span>
                 <span class="p">),</span>
             col <span class="o">=</span> <span class="s">&quot;red&quot;</span><span class="p">,</span> shape<span class="o">=</span><span class="m">4</span><span class="p">,</span> size <span class="o">=</span> <span class="m">5</span><span class="p">)</span><span class="o">+</span>
  geom_point<span class="p">(</span>aes<span class="p">(</span>x<span class="o">=</span>new_centroids_1<span class="o">$</span>average_sepal<span class="p">[</span>new_centroids_1<span class="o">$</span>group <span class="o">==</span> <span class="s">&quot;blue&quot;</span><span class="p">],</span>
                 y<span class="o">=</span>new_centroids_1<span class="o">$</span>average_petal<span class="p">[</span>new_centroids_1<span class="o">$</span>group <span class="o">==</span> <span class="s">&quot;blue&quot;</span><span class="p">]</span>
                 <span class="p">),</span>
             col <span class="o">=</span> <span class="s">&quot;blue&quot;</span><span class="p">,</span> shape<span class="o">=</span><span class="m">4</span><span class="p">,</span> size <span class="o">=</span> <span class="m">5</span><span class="p">)</span><span class="o">+</span>
  geom_point<span class="p">(</span>aes<span class="p">(</span>x<span class="o">=</span>new_centroids_2<span class="o">$</span>average_sepal<span class="p">[</span>new_centroids_2<span class="o">$</span>group <span class="o">==</span> <span class="s">&quot;red&quot;</span><span class="p">],</span>
                 y<span class="o">=</span>new_centroids_2<span class="o">$</span>average_petal<span class="p">[</span>new_centroids_2<span class="o">$</span>group <span class="o">==</span> <span class="s">&quot;red&quot;</span><span class="p">]</span>
                 <span class="p">),</span>
             col <span class="o">=</span> <span class="s">&quot;red&quot;</span><span class="p">,</span> shape<span class="o">=</span><span class="m">4</span><span class="p">,</span> size <span class="o">=</span> <span class="m">5</span><span class="p">)</span><span class="o">+</span>
  geom_point<span class="p">(</span>aes<span class="p">(</span>x<span class="o">=</span>new_centroids_2<span class="o">$</span>average_sepal<span class="p">[</span>new_centroids_2<span class="o">$</span>group <span class="o">==</span> <span class="s">&quot;blue&quot;</span><span class="p">],</span>
                 y<span class="o">=</span>new_centroids_2<span class="o">$</span>average_petal<span class="p">[</span>new_centroids_2<span class="o">$</span>group <span class="o">==</span> <span class="s">&quot;blue&quot;</span><span class="p">]</span>
                 <span class="p">),</span>
             col <span class="o">=</span> <span class="s">&quot;blue&quot;</span><span class="p">,</span> shape<span class="o">=</span><span class="m">4</span><span class="p">,</span> size <span class="o">=</span> <span class="m">5</span><span class="p">)</span><span class="o">+</span>
  geom_segment<span class="p">(</span>aes<span class="p">(</span>x <span class="o">=</span> new_centroids_1<span class="o">$</span>average_sepal<span class="p">[</span>new_centroids_1<span class="o">$</span>group <span class="o">==</span> <span class="s">&quot;red&quot;</span><span class="p">],</span>
                   y <span class="o">=</span> new_centroids_1<span class="o">$</span>average_petal<span class="p">[</span>new_centroids_1<span class="o">$</span>group <span class="o">==</span> <span class="s">&quot;red&quot;</span><span class="p">],</span>
                   xend <span class="o">=</span> new_centroids_2<span class="o">$</span>average_sepal<span class="p">[</span>new_centroids_2<span class="o">$</span>group <span class="o">==</span> <span class="s">&quot;red&quot;</span><span class="p">],</span>
                   yend <span class="o">=</span> new_centroids_2<span class="o">$</span>average_petal<span class="p">[</span>new_centroids_2<span class="o">$</span>group <span class="o">==</span> <span class="s">&quot;red&quot;</span><span class="p">]</span>
                   <span class="p">),</span>
               col <span class="o">=</span> <span class="s">&quot;black&quot;</span><span class="p">,</span>
               arrow <span class="o">=</span> arrow<span class="p">(</span>length <span class="o">=</span> unit<span class="p">(</span><span class="m">0.015</span><span class="p">,</span> <span class="s">&quot;npc&quot;</span><span class="p">)),</span>
               size <span class="o">=</span> <span class="m">0.1</span>
               <span class="p">)</span><span class="o">+</span>
  geom_segment<span class="p">(</span>aes<span class="p">(</span>x <span class="o">=</span> new_centroids_1<span class="o">$</span>average_sepal<span class="p">[</span>new_centroids_1<span class="o">$</span>group <span class="o">==</span> <span class="s">&quot;blue&quot;</span><span class="p">],</span>
                   y <span class="o">=</span> new_centroids_1<span class="o">$</span>average_petal<span class="p">[</span>new_centroids_1<span class="o">$</span>group <span class="o">==</span> <span class="s">&quot;blue&quot;</span><span class="p">],</span>
                   xend <span class="o">=</span> new_centroids_2<span class="o">$</span>average_sepal<span class="p">[</span>new_centroids_2<span class="o">$</span>group <span class="o">==</span> <span class="s">&quot;blue&quot;</span><span class="p">],</span>
                   yend <span class="o">=</span> new_centroids_2<span class="o">$</span>average_petal<span class="p">[</span>new_centroids_2<span class="o">$</span>group <span class="o">==</span> <span class="s">&quot;blue&quot;</span><span class="p">]</span>
                   <span class="p">),</span>
               col <span class="o">=</span> <span class="s">&quot;black&quot;</span><span class="p">,</span>
               arrow <span class="o">=</span> arrow<span class="p">(</span>length <span class="o">=</span> unit<span class="p">(</span><span class="m">0.015</span><span class="p">,</span> <span class="s">&quot;npc&quot;</span><span class="p">)),</span>
               size <span class="o">=</span> <span class="m">0.1</span>
               <span class="p">)</span>
</pre></div>
</div>
<p><img alt="image5" src="p04-02-kmeans_files/figure-html/unnamed-chunk-7-1.png" /></p>
<ul class="simple">
<li><strong>Bước 6</strong>: Phân nhóm lại theo các centroids mới</li>
</ul>
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span>data3 <span class="o">&lt;-</span> data <span class="o">%&gt;%</span>
  <span class="c1"># Update 2 centroids mới</span>
  mutate<span class="p">(</span>Sepal.Length_red <span class="o">=</span> new_centroids_2<span class="o">$</span>average_sepal<span class="p">[</span>new_centroids_2<span class="o">$</span>group <span class="o">==</span> <span class="s">&quot;red&quot;</span><span class="p">],</span>
         Petal.Length_red <span class="o">=</span> new_centroids_2<span class="o">$</span>average_petal<span class="p">[</span>new_centroids_2<span class="o">$</span>group <span class="o">==</span> <span class="s">&quot;red&quot;</span><span class="p">],</span>
         Sepal.Length_blue <span class="o">=</span> new_centroids_2<span class="o">$</span>average_sepal<span class="p">[</span>new_centroids_2<span class="o">$</span>group <span class="o">==</span> <span class="s">&quot;blue&quot;</span><span class="p">],</span>
         Petal.Length_blue <span class="o">=</span> new_centroids_2<span class="o">$</span>average_petal<span class="p">[</span>new_centroids_2<span class="o">$</span>group <span class="o">==</span> <span class="s">&quot;blue&quot;</span><span class="p">]</span>
         <span class="p">)</span> <span class="o">%&gt;%</span>
  <span class="c1"># Tính khoảng cách từ các quan sát đến 2 centroids</span>
  mutate<span class="p">(</span>
    distance_red <span class="o">=</span> <span class="kp">sqrt</span><span class="p">((</span>Sepal.Length<span class="o">-</span>Sepal.Length_red<span class="p">)</span><span class="o">^</span><span class="m">2</span> <span class="o">+</span> <span class="p">(</span>Petal.Length <span class="o">-</span> Petal.Length_red<span class="p">)</span><span class="o">^</span><span class="m">2</span><span class="p">),</span>
    distance_blue <span class="o">=</span> <span class="kp">sqrt</span><span class="p">((</span>Sepal.Length<span class="o">-</span>Sepal.Length_blue<span class="p">)</span><span class="o">^</span><span class="m">2</span> <span class="o">+</span> <span class="p">(</span>Petal.Length <span class="o">-</span> Petal.Length_blue<span class="p">)</span><span class="o">^</span><span class="m">2</span><span class="p">)</span>
    <span class="p">)</span> <span class="o">%&gt;%</span>
  <span class="c1"># Tạo biến mới - nhóm mà các quan sát được phân vào</span>
  mutate<span class="p">(</span>group <span class="o">=</span> case_when<span class="p">(</span>
    distance_red <span class="o">&lt;</span> distance_blue <span class="o">~</span> <span class="s">&quot;red&quot;</span><span class="p">,</span>
    <span class="kc">TRUE</span> <span class="o">~</span> <span class="s">&quot;blue&quot;</span>
  <span class="p">)</span> <span class="o">%&gt;%</span> <span class="kp">as.factor</span><span class="p">)</span>


<span class="c1"># Plot dữ liệu mới</span>
data3 <span class="o">%&gt;%</span>
  ggplot<span class="p">(</span>aes<span class="p">(</span>Sepal.Length<span class="p">,</span> Petal.Length<span class="p">),</span> group <span class="o">=</span> group<span class="p">)</span> <span class="o">+</span>
  geom_point<span class="p">(</span>size <span class="o">=</span> <span class="m">2</span><span class="p">,</span> aes<span class="p">(</span>col <span class="o">=</span> group<span class="p">))</span><span class="o">+</span>
  theme_classic<span class="p">()</span><span class="o">+</span>
  scale_color_manual<span class="p">(</span>
    values <span class="o">=</span> <span class="kt">c</span><span class="p">(</span><span class="s">&quot;blue&quot;</span> <span class="o">=</span> <span class="s">&quot;blue&quot;</span><span class="p">,</span> <span class="s">&quot;red&quot;</span> <span class="o">=</span> <span class="s">&quot;red&quot;</span><span class="p">)</span>
  <span class="p">)</span><span class="o">+</span>
  theme<span class="p">(</span>legend.position <span class="o">=</span> <span class="s">&quot;none&quot;</span><span class="p">)</span><span class="o">+</span>
  geom_point<span class="p">(</span>aes<span class="p">(</span>x<span class="o">=</span>new_centroids_2<span class="o">$</span>average_sepal<span class="p">[</span>new_centroids_2<span class="o">$</span>group <span class="o">==</span> <span class="s">&quot;red&quot;</span><span class="p">],</span>
                 y<span class="o">=</span>new_centroids_2<span class="o">$</span>average_petal<span class="p">[</span>new_centroids_2<span class="o">$</span>group <span class="o">==</span> <span class="s">&quot;red&quot;</span><span class="p">]</span>
                 <span class="p">),</span>
             col <span class="o">=</span> <span class="s">&quot;red&quot;</span><span class="p">,</span> shape<span class="o">=</span><span class="m">4</span><span class="p">,</span> size <span class="o">=</span> <span class="m">5</span><span class="p">)</span><span class="o">+</span>
  geom_point<span class="p">(</span>aes<span class="p">(</span>x<span class="o">=</span>new_centroids_2<span class="o">$</span>average_sepal<span class="p">[</span>new_centroids_2<span class="o">$</span>group <span class="o">==</span> <span class="s">&quot;blue&quot;</span><span class="p">],</span>
                 y<span class="o">=</span>new_centroids_2<span class="o">$</span>average_petal<span class="p">[</span>new_centroids_2<span class="o">$</span>group <span class="o">==</span> <span class="s">&quot;blue&quot;</span><span class="p">]</span>
                 <span class="p">),</span>
             col <span class="o">=</span> <span class="s">&quot;blue&quot;</span><span class="p">,</span> shape<span class="o">=</span><span class="m">4</span><span class="p">,</span> size <span class="o">=</span> <span class="m">5</span><span class="p">)</span>
</pre></div>
</div>
<p><img alt="image6" src="p04-02-kmeans_files/figure-html/unnamed-chunk-8-1.png" /></p>
<p>Kết quả phân nhóm vẫn giống như kết quả trước đó, thuật toán dừng lại.</p>
</div>
<div class="section" id="thuat-toan">
<h2>2.2. Thuật toán<a class="headerlink" href="#thuat-toan" title="Permalink to this headline">¶</a></h2>
<p>Như vậy, chúng ta có thể khái quát lại <strong>thuật toán của ``K-means``</strong>
như sau:</p>
<ul class="simple">
<li><strong>Bước 1</strong>: Chọn ngẫu nhiên K tâm/centroids</li>
<li><strong>Bước 2</strong>: Tính khoảng cách từ các đối tượng/quan sát đến K tâm</li>
<li><strong>Bước 3</strong>: Dựa vào giá trị khoảng cách ở bước 2, chúng ta nhóm các
quan sát vào K nhóm: Các quan sát gần với tâm nào hơn thì sẽ thuộc về
nhóm đó.</li>
<li><strong>Bước 4</strong>: Xác định các tâm mới của K nhóm (tâm mới của mỗi nhóm có
tọa độ bằng trung bình tọa độ của các quan sát trong nhóm đó).</li>
<li><strong>Bước 5</strong>: Lặp lại bước 2 đến bước 4 cho đến khi không có sự thay
đổi kết quả phân nhóm các quan sát hoặc theo số lượng <code class="docutils literal notranslate"><span class="pre">iterations</span></code>
mà chúng ta đặt ra cho thuật toán chạy.</li>
</ul>
</div>
<div class="section" id="uu-nhuoc-diem-cua-k-means">
<h2>2.3. Ưu nhược điểm của K-means<a class="headerlink" href="#uu-nhuoc-diem-cua-k-means" title="Permalink to this headline">¶</a></h2>
<p><strong>Ưu điểm</strong> của thuật toán <code class="docutils literal notranslate"><span class="pre">clustering</span> <span class="pre">K-means</span></code> là đơn giản và dễ tính
toán. Tuy nhiên thuật toán này có một số <strong>nhược điểm</strong> sau: Thứ nhất,
do lấy ngẫu nhiên tâm/centroid nên khi dữ liệu lớn với rất nhiều các
biến đầu vào thuật toán có thể phân loại các quan sát vào các nhóm khác
nhau tại mỗi vòng (<code class="docutils literal notranslate"><span class="pre">iteration</span></code>). Thứ hai, thuật toán sẽ gặp vấn đề nếu
các biến đầu vào có các đơn vị khác nhau, ví dụ như: biến chi tiêu hoặc
thu nhập của khách hàng đơn vị là triệu đồng, biến đánh dấu khách hàng
có sử dụng thẻ tín dụng (dummy 1-0), hoặc biến tỷ lệ chi tiêu thẻ tín
dụng trên hạn mức được cấp, v.v.</p>
<p>Vì vậy, để khắc phục vấn đề trên trước khi áp dụng thuật toán
<code class="docutils literal notranslate"><span class="pre">K-means</span></code>, chúng ta cần phải chuẩn hóa dữ liệu đầu vào bằng cách
<code class="docutils literal notranslate"><span class="pre">scaling</span></code> dữ liệu:</p>
<div class="math notranslate">
\[x_i = \frac{x_i - min(x_i)}{max(x_i) - min(x_i)}\]</div>
</div>
<div class="section" id="thuc-hanh-tren-r">
<h2>2.4. Thực hành trên R<a class="headerlink" href="#thuc-hanh-tren-r" title="Permalink to this headline">¶</a></h2>
<p>Sau đây chúng ta sẽ cùng tìm hiểu cách thực hiện <code class="docutils literal notranslate"><span class="pre">K-means</span></code> trên <code class="docutils literal notranslate"><span class="pre">R</span></code>.</p>
<ul class="simple">
<li><strong>Bước 1</strong>: Chuẩn hóa dữ liệu (<code class="docutils literal notranslate"><span class="pre">Scaling</span></code>):</li>
</ul>
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="c1"># Scale dữ liệu</span>
iris_scale <span class="o">&lt;-</span> <span class="kp">scale</span><span class="p">(</span>iris <span class="o">%&gt;%</span> select<span class="p">(</span><span class="o">-</span>Species<span class="p">))</span>
</pre></div>
</div>
<ul class="simple">
<li><strong>Bước 2</strong>: Xác định số lượng nhóm tối ưu</li>
</ul>
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="c1"># Xác định số lượng nhóm tối ưu</span>
<span class="kn">library</span><span class="p">(</span>factoextra<span class="p">)</span>
fviz_nbclust<span class="p">(</span>iris_scale<span class="p">,</span>
             kmeans<span class="p">,</span>
             method <span class="o">=</span> <span class="s">&quot;silhouette&quot;</span><span class="p">)</span>
</pre></div>
</div>
<p><img alt="image7" src="p04-02-kmeans_files/figure-html/unnamed-chunk-10-1.png" /></p>
<p>Kết quả cho thấy trường hợp này chúng ta nên chia làm 2 nhóm sẽ tối ưu.
Trong thực tế, việc chia thành bao nhiêu nhóm sẽ phụ thuộc vào mục tiêu
kinh doanh, thông thường số lượng nhóm nên từ 2 đến 10.</p>
<ul class="simple">
<li><strong>Bước 3</strong>: Thực hiện <code class="docutils literal notranslate"><span class="pre">clustering</span> <span class="pre">K-means</span></code> thành 2 nhóm</li>
</ul>
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="c1"># Thực hiện thuật toán K-means</span>
k_means_fit <span class="o">&lt;-</span> kmeans<span class="p">(</span>iris_scale<span class="p">,</span>
                      centers <span class="o">=</span> <span class="m">2</span> <span class="c1"># số lượng nhóm</span>
                      <span class="p">)</span>

<span class="c1"># Nhóm của các quan sát</span>
k_means_fit<span class="o">$</span>cluster
</pre></div>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1">##   [1] 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2</span>
<span class="c1">##  [36] 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1</span>
<span class="c1">##  [71] 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1</span>
<span class="c1">## [106] 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1</span>
<span class="c1">## [141] 1 1 1 1 1 1 1 1 1 1</span>
</pre></div>
</div>
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="c1"># Tâm của mỗi nhóm</span>
k_means_fit<span class="o">$</span>centers
</pre></div>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1">##   Sepal.Length Sepal.Width Petal.Length Petal.Width</span>
<span class="c1">## 1    0.5055957  -0.4252069     0.650315   0.6253518</span>
<span class="c1">## 2   -1.0111914   0.8504137    -1.300630  -1.2507035</span>
</pre></div>
</div>
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="c1"># Số lượng quan sát tại mỗi nhóm</span>
k_means_fit<span class="o">$</span>size
</pre></div>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1">## [1] 100  50</span>
</pre></div>
</div>
<ul class="simple">
<li><strong>Bước 4</strong>: Trực quan hóa kết quả</li>
</ul>
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="c1"># Trực quan hóa kết quả K-means</span>
fviz_cluster<span class="p">(</span>k_means_fit<span class="p">,</span>
             data <span class="o">=</span> iris_scale<span class="p">,</span>
             geom <span class="o">=</span> <span class="s">&quot;point&quot;</span><span class="p">,</span>
             main <span class="o">=</span> <span class="s">&quot;Iris Cluster&quot;</span>
             <span class="p">)</span><span class="o">+</span>
  theme_bw<span class="p">()</span><span class="o">+</span>
  theme<span class="p">(</span>axis.text <span class="o">=</span> element_blank<span class="p">(),</span>
        axis.title <span class="o">=</span> element_blank<span class="p">(),</span>
        axis.ticks <span class="o">=</span> element_blank<span class="p">(),</span>
        panel.grid <span class="o">=</span> element_blank<span class="p">()</span>
        <span class="p">)</span>
</pre></div>
</div>
<p><img alt="image8" src="p04-02-kmeans_files/figure-html/unnamed-chunk-12-1.png" /></p>
<p>Như vậy, chúng ta đã vừa tìm hiểu về thuật toán <code class="docutils literal notranslate"><span class="pre">clustering</span> <span class="pre">K-means</span></code>
cũng như cách thực hiện thuật toán trên <code class="docutils literal notranslate"><span class="pre">R</span></code>.</p>
</div>
</div>


           </div>
           
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="p04-03-hierarchical-clustering.html" class="btn btn-neutral float-right" title="3. Hierachical clustering" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="p04-01-unsupervised-learning.html" class="btn btn-neutral float-left" title="1. Unsupervised learning" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2019, Anh Hoang Duc

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>